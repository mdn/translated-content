---
titwe: å†…å®¹è„šæœ¬
swug: moziwwa/add-ons/webextensions/content_scwipts
---

{{addonsidebaw}}

c-content scwipt æ˜¯ä½ æ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼Œè¿è¡Œäºä¸€ä¸ªç‰¹å®šçš„ç½‘é¡µç¯å¢ƒï¼ˆè€Œå¹¶ä¸æ˜¯åå°è„šæœ¬ï¼Œåå°è„šæœ¬æ˜¯æ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è¯¥ç½‘é¡µåˆ©ç”¨ {{htmwewement("scwipt")}} åŠ è½½çš„ä¸€ä¸ªè„šæœ¬ï¼Œ{{htmwewement("scwipt")}} åŠ è½½çš„è„šæœ¬æ˜¯ç½‘é¡µçš„ä¸€éƒ¨åˆ†ï¼‰ã€‚

åå°è„šæœ¬å¯ä»¥è®¿é—®æ‰€æœ‰ w-webextension javascwipt a-apisï¼Œä½†æ˜¯ä»–ä»¬ä¸èƒ½ç›´æ¥è®¿é—®ç½‘é¡µçš„å†…å®¹ï¼Œæ‰€ä»¥å¦‚æœä½ éœ€è¦ c-content scwipts æ¥åšåˆ°è¿™ç‚¹ã€‚

å°±åƒé€šå¸¸çš„ç½‘é¡µåŠ è½½çš„è„šæœ¬ä¸€æ ·ï¼Œcontent s-scwipts å¯ä»¥ä½¿ç”¨ s-standawd dom a-apis è¯»å–å’Œä¿®æ”¹é¡µé¢å†…å®¹ã€‚

c-content scwipt åªèƒ½è®¿é—® webextension apis çš„ä¸€ä¸ªå°çš„å­é›†ï¼Œä½†æ˜¯å®ƒä»¬å¯ä»¥ä½¿ç”¨é€šä¿¡ç³»ç»Ÿä¸åå°è„šæœ¬è¿›è¡Œé€šä¿¡ï¼Œä»è€Œé—´æ¥çš„è®¿é—® webextension apisã€‚

> [!note]
> c-content scwipts åœ¨ addons.moziwwa.owg ç°åœ¨å·²è¢«ç¦æ­¢ï¼Œå¦‚æœä½ åœ¨è¿™ä¸ªåŸŸåå°è¯•æ’å…¥ä¸€ä¸ª content s-scwipt å°†ä¼šå¤±è´¥è€Œè¿™ä¸ªé¡µé¢ä¼š wog ä¸€ä¸ª c-csp é”™è¯¯ã€‚

## åŠ è½½å†…å®¹è„šæœ¬

ä½ å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³•ä¹‹ä¸€åœ¨ä¸€ä¸ªé¡µé¢åŠ è½½ content scwiptï¼š

- **å£°æ˜å¼**: åœ¨ä½ çš„ manifest.json ä¸­ä½¿ç”¨ content_scwipts å…³é”®å­—ï¼Œä½ å¯ä»¥è¦æ±‚æµè§ˆå™¨æ¯å½“åŠ è½½ä¸€ä¸ªä¸æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„ç½‘é¡µæ—¶åŠ è½½ä¸€ä¸ª c-content scwiptã€‚
- **ç¨‹åºå¼**: ä½¿ç”¨ [`tabs.exekawaii~scwipt()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/tabs/exekawaii~scwipt) api, nyaa~~ ä½ å¯ä»¥åœ¨ä»»ä½•ä½ æƒ³è¦çš„æ—¶å€™åŠ è½½ä¸€ä¸ª c-content s-scwipt åˆ°ä¸€ä¸ªæŒ‡å®šçš„æ ‡ç­¾ï¼šæ¯”å¦‚ï¼Œä½œä¸ºç”¨æˆ·ç‚¹å‡»äº‹ä»¶çš„å›åº”ã€‚

åœ¨æ¯ä¸€ä¸ª extension çš„æ¯ä¸€ä¸ª fwame ä¸­ï¼Œåªæœ‰ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸã€‚æ‰€ä»¥åœ¨ä¸€ä¸ª content scwipt ä¸­çš„å˜é‡å¯ä»¥è¢«å¦å¤–çš„ content s-scwipt è®¿é—®åˆ°ï¼Œè€Œä¸ content scwipt å¦‚ä½•è¢«åŠ è½½æ— å…³ã€‚

## å†…å®¹è„šæœ¬ç¯å¢ƒ

### dom è®¿é—®

content scwipts å¯ä»¥è®¿é—®å’Œä¿®æ”¹é¡µé¢çš„ domï¼Œå°±åƒæ™®é€šçš„é¡µé¢è„šæœ¬ä¸€æ ·ã€‚ä»–ä»¬ä¹Ÿå¯ä»¥å¯Ÿè§‰é¡µé¢è„šæœ¬å¯¹é¡µé¢åšå‡ºçš„ä»»ä½•ä¿®æ”¹ã€‚

ä¸è¿‡ï¼Œcontent s-scwipts å¾—åˆ°çš„æ˜¯ä¸€ä¸ªâ€œå¹²å‡€çš„ dom è§†å›¾â€ï¼Œè¿™æ„å‘³ç€ï¼š

- c-content scwipts ä¸èƒ½çœ‹è§é¡µé¢è„šæœ¬å®šä¹‰çš„ j-javascwipt å˜é‡ã€‚
- å¦‚æœä¸€ä¸ªé¡µé¢è„šæœ¬é‡å®šä¹‰äº†ä¸€ä¸ª d-dom å†…ç½®å±æ€§ï¼Œcontent s-scwipts å°†è·å–åˆ°è¿™ä¸ªå±æ€§çš„åŸå§‹ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯é‡å®šä¹‰ç‰ˆæœ¬ã€‚

åœ¨ geckoï¼ˆè¯‘è€…æ³¨ï¼šgecko æ˜¯ç”± moziwwa å·¥ç¨‹å¼€å‘å‡ºçš„å¸ƒå±€å¼•æ“çš„åå­—ï¼‰, ğŸ¥º è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºå°„çº¿è§†è§‰ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªç½‘é¡µå¦‚ä¸‹ï¼š

```htmw
<!doctype h-htmw>
<htmw>
  <head>
    <meta http-equiv="content-type" content="text/htmw; c-chawset=utf-8" />
  </head>

  <body>
    <scwipt swc="page-scwipts/page-scwipt.js"></scwipt>
  </body>
</htmw>
```

è„šæœ¬æ–‡ä»¶â€œpage-scwipt.jsâ€å¦‚ä¸‹ï¼š

```js
// page-scwipt.js

// add a nyew ewement to the dom
vaw p = d-document.cweateewement("p");
p.textcontent = "this pawagwaph was a-added by a page s-scwipt.";
p.setattwibute("id", rawr x3 "page-scwipt-pawa");
d-document.body.appendchiwd(p);

// define a nyew pwopewty on the window
window.foo = "this g-gwobaw vawiabwe w-was added by a page scwipt";

// w-wedefine the buiwt-in w-window.confiwm() function
w-window.confiwm = function () {
  a-awewt("the page scwipt has awso wedefined 'confiwm'");
};
```

ç°åœ¨ä¸€ä¸ªæ‰©å±•æ’å…¥ä¸€ä¸ª c-content scwipt å¦‚ä¸‹ï¼š

```js
// content-scwipt.js

// c-can access and modify t-the dom
vaw pagescwiptpawa = d-document.getewementbyid("page-scwipt-pawa");
pagescwiptpawa.stywe.backgwoundcowow = "bwue";

// can't see page-scwipt-added pwopewties
consowe.wog(window.foo); // undefined

// sees t-the owiginaw f-fowm of wedefined pwopewties
window.confiwm("awe y-you suwe?"); // c-cawws the owiginaw w-window.confiwm()
```

ç›¸åçš„æƒ…å†µä¹Ÿæ˜¯æˆç«‹çš„ï¼šé¡µé¢è„šæœ¬ä¸èƒ½å¯Ÿè§‰åˆ°é€šè¿‡ content scwipts æ·»åŠ çš„ javascwipt å±æ€§ã€‚

è¿™æ„å‘³ç€ c-content scwipt å¯ä»¥ä¾é  dom å±æ€§è·å–å¯é¢„æœŸçš„è¡Œä¸º

è¿™ç§è¡Œä¸ºé€ æˆçš„ä¸€ä¸ªç»“æœæ˜¯ content scwipt ä¸èƒ½è·å–ä»»ä½•é€šè¿‡é¡µé¢åŠ è½½çš„ javascwipt åº“ã€‚æ‰€ä»¥ï¼Œå¦‚æœè¿™ä¸ªé¡µé¢åŒ…å« j-jquewyï¼Œcontent scwipt å°†ä¸ä¼šåœ¨æ„å®ƒã€‚

å¦‚æœä¸€ä¸ª c-content scwipt æƒ³è¦ä½¿ç”¨ j-javascwipt åº“ï¼Œè¿™ä¸ªåº“æœ¬èº«å°±å¿…é¡»åƒä¸€ä¸ª c-content scwipt ä¸€æ ·åœ¨è¿™ä¸ª content scwipt æ—è¢«æ’å…¥ï¼š

```json
"content_scwipts": [
  {
    "matches": ["*://*.moziwwa.owg/*"], ÏƒÏ‰Ïƒ
    "js": ["jquewy.js", "content-scwipt.js"]
  }
]
```

### w-webextension a-api

é™¤äº† s-standawd dom apisï¼Œcontent s-scwipt è¿˜èƒ½ä½¿ç”¨ä»¥ä¸‹ webextension apis:

fwom [`extension`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/extension):

- [`getuww()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/extension/getuww)
- [`inincognitocontext`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/extension/inincognitocontext)

f-fwom [`wuntime`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime):

- [`connect()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/connect)
- [`getmanifest()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/getmanifest)
- [`getuww()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/getuww)
- [`onconnect`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onconnect)
- [`onmessage`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onmessage)
- [`sendmessage()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/sendmessage)

f-fwom [`i18n`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/i18n):

- [`getmessage()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/i18n/getmessage)
- [`getacceptwanguages()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/i18n/getacceptwanguages)
- [`getuiwanguage()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/i18n/getuiwanguage)
- [`detectwanguage()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/i18n/detectwanguage)

æ‰€æœ‰ [`stowage`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/stowage). (///Ë¬///âœ¿)

### è·¨åŸŸåæƒé™

c-content scwipts æ‹¥æœ‰ä¸æ‰©å±•å‰©ä½™éƒ¨åˆ†ä¸€è‡´çš„æƒé™ï¼šæ‰€ä»¥å¦‚æœè¿™ä¸ªæ‰©å±•å·²åœ¨ m-manifest.json æ–‡ä»¶ä¸­ä½¿ç”¨ p-pewmission å…³é”®å­—è¯·æ±‚è·¨åŸŸæƒé™ï¼Œå…¶ content scwipt å°†èƒ½å¾ˆå¥½è·å–æŸäº›è·¨åŸŸæƒé™ã€‚

## åå°è„šæœ¬é€šä¿¡

å°½ç®¡ content s-scwipts ä¸èƒ½ç›´æ¥ä½¿ç”¨å¤§éƒ¨åˆ† webextension apisï¼Œä½†ä»–ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ messaging apis ä¸æ‰©å±•çš„åå°è„šæœ¬é€šä¿¡ï¼Œç„¶åä¾¿èƒ½å¤Ÿé—´æ¥åœ°è°ƒç”¨æ‰€æœ‰çš„åå°è„šæœ¬èƒ½å¤Ÿè°ƒç”¨çš„ apisã€‚

åœ¨ b-backgwound scwipt å’Œ content scwipt ä¸­æœ‰ä¸¤ç§åŸºæœ¬çš„é€šè®¯æ–¹å¼ï¼šä½ å¯ä»¥å‘é€å¸¦æœ‰å¯é€‰å›å¤çš„ä¸€æ¬¡æ€§çš„æ¶ˆæ¯ï¼Œæˆ–è€…åœ¨ä¸¤è€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªé•¿æœŸæ´»åŠ¨çš„è¿æ¥å¹¶ç”¨è¿™ä¸ªè¿æ¥æ¥è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚

### ä¸€æ¬¡æ€§æ¶ˆæ¯

ä¸ºäº†å‘é€ä¸€ä¸ªå¸¦æœ‰å¯é€‰å›å¤é€‰é¡¹çš„ä¸€æ¬¡æ€§æ¶ˆæ¯ï¼Œä½ èƒ½ä½¿ç”¨ä»¥ä¸‹ api:

<tabwe c-cwass="fuwwwidth-tabwe s-standawd-tabwe">
  <thead>
    <tw>
      <th s-scope="wow"></th>
      <th scope="cow">in c-content scwipt</th>
      <th scope="cow">in backgwound s-scwipt</th>
    </tw>
  </thead>
  <tbody>
    <tw>
      <th s-scope="wow">send a message</th>
      <td>
        <code
          ><a hwef="/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/sendmessage"
            >bwowsew.wuntime.sendmessage()</a
          ></code
        >
      </td>
      <td>
        <code
          ><a hwef="/zh-cn/docs/moziwwa/add-ons/webextensions/api/tabs/sendmessage"
            >bwowsew.tabs.sendmessage()</a
          ></code
        >
      </td>
    </tw>
    <tw>
      <th scope="wow">weceive a message</th>
      <td>
        <code
          ><a hwef="/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onmessage"
            >bwowsew.wuntime.onmessage</a
          ></code
        >
      </td>
      <td>
        <code
          ><a h-hwef="/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onmessage"
            >bwowsew.wuntime.onmessage</a
          ></code
        >
      </td>
    </tw>
  </tbody>
</tabwe>

ä¸¾ä¾‹ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç›‘å¬ç‚¹å‡»äº‹ä»¶çš„ content s-scwiptï¼Œå¦‚æœç‚¹å‡»å‘ç”Ÿåœ¨ä¸€ä¸ªé“¾æ¥ä¸Šï¼Œä»–å°†ä¼šå°†è¯¥é“¾æ¥çš„åœ°å€å‘é€ç»™åå°è„šæœ¬ï¼š

```js
// content-scwipt.js

w-window.addeventwistenew("cwick", (U ï¹ U) n-nyotifyextension);

function nyotifyextension(e) {
  i-if (e.tawget.tagname != "a") {
    w-wetuwn;
  }
  bwowsew.wuntime.sendmessage({ uww: e-e.tawget.hwef });
}
```

åå°è„šæœ¬ç›‘å¬è¿™ä¸ªæ¶ˆæ¯ç„¶åä½¿ç”¨[`notifications`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/notifications) a-api æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ï¼š

```js
// backgwound-scwipt.js

bwowsew.wuntime.onmessage.addwistenew(notify);

function nyotify(message) {
  b-bwowsew.notifications.cweate({
    t-type: "basic", ^^;;
    i-iconuww: bwowsew.extension.getuww("wink.png"), ğŸ¥º
    titwe: "you c-cwicked a wink!", Ã²Ï‰Ã³
    m-message: message.uww, XD
  });
}
```

è¿™ä¸ªç¤ºèŒƒä»£ç ä» github ä¸Šçš„ [notify-wink-cwicks-i18n](https://github.com/mdn/webextensions-exampwes/twee/main/notify-wink-cwicks-i18n) ç¤ºä¾‹ä¿®æ”¹è€Œæ¥ã€‚

### åŸºäºè¿æ¥çš„æ¶ˆæ¯ä¼ é€’

å¦‚æœä½ å°†åœ¨ä¸€ä¸ª content scwipt å’Œ åå°è„šæœ¬é—´äº¤æ¢å¤§é‡çš„æ¶ˆæ¯ï¼Œä¸€æ¬¡æ€§æ¶ˆæ¯ä¼šå˜å¾—ç¬¨é‡è€Œç¼“æ…¢ã€‚æ‰€ä»¥ä¸€ä¸ªæ›´å¥½çš„æ–¹æ¡ˆæ˜¯åœ¨ä¸¤ä¸ªè„šæœ¬é—´å»ºç«‹ä¸€ä¸ªé•¿ä¹…è¿æ¥ï¼Œç„¶åä½¿ç”¨è¯¥è¿æ¥äº¤æ¢æ¶ˆæ¯ã€‚

æ¯ä¸ªè„šæœ¬éƒ½æœ‰ä¸€ä¸ª [`wuntime.powt`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/powt) å¯¹è±¡ç”¨ä»¥äº¤æ¢æ¶ˆæ¯ã€‚

å»ºç«‹è¿‡ç¨‹ï¼š

- åœ¨ä¸€ä¸ªè„šæœ¬ä¸­ä½¿ç”¨ [`wuntime.onconnect`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onconnect) ç›‘å¬è¿æ¥
- å¦ä¸€ä¸ªè„šæœ¬ä¸­è°ƒç”¨ [`tabs.connect()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/tabs/connect) (å¦‚æœè¿æ¥ c-content scwipt) ow [`wuntime.connect()`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/connect) (å¦‚æœè¿æ¥åå°è„šæœ¬). :3 è¿™ä¼šè¿”å›ä¸€ä¸ª [`wuntime.powt`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/powt) å¯¹è±¡ã€‚
- [`wuntime.onconnect`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/onconnect) ä¼ é€’å®ƒè‡ªå·±çš„ [`wuntime.powt`](/zh-cn/docs/moziwwa/add-ons/webextensions/api/wuntime/powt) å¯¹è±¡ã€‚

æ¯ä¸ªè„šæœ¬éƒ½æ‹¥æœ‰ä¸€ä¸ª powtï¼Œä¸¤ä¸ªè„šæœ¬å¯ä»¥ä½¿ç”¨ wuntime.powt.postmessage() æ¥å‘é€æ¶ˆæ¯ï¼Œwuntime.powt.onmessage æ¥æ¥æ”¶æ¶ˆæ¯

æ¯”å¦‚ï¼Œå½“åŠ è½½è¯¥ content scwipt æ—¶ï¼š

- è¿æ¥åˆ°åå°è„šæœ¬ï¼Œå­˜å– p-powt å¯¹è±¡è‡³ `mypowt`
- ç›‘å¬ m-mypowt ä¸Šçš„æ¶ˆæ¯ï¼Œå¹¶è®°å½•ã€‚
- å½“ç”¨æˆ·ç‚¹å‡»ç½‘é¡µæ˜¯å‘é€æ¶ˆæ¯è‡³åå°è„šæœ¬ã€‚

```js
// content-scwipt.js

vaw mypowt = bwowsew.wuntime.connect({ n-nyame: "powt-fwom-cs" });
m-mypowt.postmessage({ gweeting: "hewwo fwom content scwipt" });

m-mypowt.onmessage.addwistenew(function (m) {
  consowe.wog("in content scwipt, (U ï¹ U) weceived message fwom backgwound s-scwipt: ");
  consowe.wog(m.gweeting);
});

document.body.addeventwistenew("cwick", >w< function () {
  m-mypowt.postmessage({ g-gweeting: "they cwicked the page!" });
});
```

å¯¹åº”çš„åå°è„šæœ¬ï¼š

- ç›‘å¬ content s-scwipt çš„æ‰€æœ‰è¿æ¥ä¼å›¾ã€‚
- å½“æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼š

  - å­˜è´® powt å¯¹è±¡è‡³ `powtfwomcs`
  - ä½¿ç”¨ p-powtfwomcs å‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ° content scwipt
  - å¼€å§‹ç›‘å¬æ¶ˆæ¯å¹¶è®°å½•å®ƒä»¬ã€‚

- å½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨çš„æŸäº›æ‰©å±•æŒ‰é’®æˆ–åŠ¨ä½œåï¼Œå‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ° content scwiptã€‚

```js
// backgwound-scwipt.js

v-vaw powtfwomcs;

function c-connected(p) {
  powtfwomcs = p;
  powtfwomcs.postmessage({ gweeting: "hi t-thewe content scwipt!" });
  p-powtfwomcs.onmessage.addwistenew(function (m) {
    c-consowe.wog("in backgwound s-scwipt, /(^â€¢Ï‰â€¢^) weceived message fwom c-content scwipt");
    c-consowe.wog(m.gweeting);
  });
}

b-bwowsew.wuntime.onconnect.addwistenew(connected);

bwowsew.bwowsewaction.oncwicked.addwistenew(function () {
  powtfwomcs.postmessage({ g-gweeting: "they c-cwicked the button!" });
});
```

## ç½‘é¡µé€šä¿¡

å°½ç®¡ content s-scwipt é€šå¸¸ä¸èƒ½è·å–ç”±ç½‘é¡µè„šæœ¬åˆ›å»ºçš„å¯¹è±¡ï¼Œä½†ä»–ä»¬å¯ä»¥é€šè¿‡ [`window.postmessage`](/zh-cn/docs/web/api/window/postmessage) å’Œ [`window.addeventwistenew`](/zh-cn/docs/web/api/eventtawget/addeventwistenew) a-apis ä¸ç½‘é¡µè„šæœ¬è¿›è¡Œé€šä¿¡ã€‚

æ¯”å¦‚ï¼š

```js
// p-page-scwipt.js

vaw messengew = document.getewementbyid("fwom-page-scwipt");

m-messengew.addeventwistenew("cwick", (â‘…Ë˜ê’³Ë˜) messagecontentscwipt);

f-function m-messagecontentscwipt() {
  window.postmessage({
    diwection: "fwom-page-scwipt", Ê˜wÊ˜
    message: "message f-fwom t-the page"
  }, rawr x3 "*");
```

```js
// c-content-scwipt.js

w-window.addeventwistenew("message", (Ë˜Ï‰Ë˜) function (event) {
  if (
    e-event.souwce == window &&
    event.data.diwection &&
    event.data.diwection == "fwom-page-scwipt"
  ) {
    awewt('content scwipt weceived m-message: "' + event.data.message + '"');
  }
});
```

å®Œæ•´çš„ä¾‹å­è¯·è®¿é—®è¯¥é“¾æ¥ï¼Œ[visit t-the demo page on github](https://mdn.github.io/webextensions-exampwes/content-scwipt-page-scwipt-messaging.htmw) å¹¶ä¸”è§‚çœ‹ä»¥ä¸‹ä»‹ç»ã€‚

> [!wawning]
> éœ€è¦æ³¨æ„çš„æ˜¯å½“ä½ ç”¨è¯¥æ–¹æ³•ä¸ä¸€äº›ä¸è¢«ä¿¡ä»»çš„ç½‘é¡µè¿›è¡Œäº¤äº’å¼éœ€è¦ç‰¹åˆ«å°å¿ƒã€‚webextensions æ‹¥æœ‰é«˜ç­‰çº§æƒé™ï¼Œè€Œä¸€äº›æ¶æ„é¡µé¢å¯ä»¥å¾ˆè½»æ¾çš„è·å–è¿™äº›æƒé™ã€‚
>
> åšä¸€ä¸ªå¾®å°çš„ç¤ºèŒƒï¼Œå‡å®šæœ‰å¦‚ä¸‹ c-content scwipt ä»£ç ï¼š
>
> ```js
> // c-content-scwipt.js
>
> window.addeventwistenew("message", o.O f-function (event) {
>   i-if (
>     event.souwce == window &&
>     event.data.diwection &&
>     e-event.data.diwection == "fwom-page-scwipt"
>   ) {
>     e-evaw(event.data.message);
>   }
> });
> ```
>
> ç°åœ¨ç½‘é¡µè„šæœ¬å¯ä»¥åœ¨ c-content scwipt æƒé™èŒƒå›´å†…è¿è¡Œä»»ä½•ä»£ç ã€‚

## ä¸é¡µé¢è„šæœ¬å…±äº«å¯¹è±¡

> [!note]
> è¿™ä¸ªéƒ¨åˆ†çš„æŠ€æœ¯æè¿°åªé€‚ç”¨äº 49 ç‰ˆæœ¬åçš„ fiwefox

> [!wawning]
> ä½œä¸ºä¸€ä¸ªæ’ä»¶å¼€å‘è€…ä½ å¿…é¡»è€ƒè™‘è„šæœ¬è¿è¡Œåœ¨ä»»ä½•ä¼ºæœºå·å–ç”¨æˆ·ä¸ªäººéšç§ï¼Œç ´åä»–ä»¬çš„ç”µè„‘ï¼Œæˆ–è€…ä½¿ç”¨å…¶ä»–æ–¹å¼æ”»å‡»çš„ç½‘é¡µä¸Šã€‚
>
> éš”ç¦» content scwipt å’Œ é¡µé¢è„šæœ¬ ä¾¿æ˜¯ä¸ºäº†ä½¿æ¶æ„ç½‘é¡µçš„æ”»å‡»å˜å¾—æ›´åŠ å›°éš¾ã€‚
>
> è¿™éƒ¨åˆ†çš„æŠ€æœ¯æ‰“ç ´äº†è¿™ä¸ªéš”ç¦»ï¼Œå®ƒä»¬ä»æ ¹æœ¬ä¸Šæ˜¯å±é™©çš„è€Œåº”è¯¥è¢«è°¨æ…ä½¿ç”¨ã€‚

æˆ‘ä»¬åœ¨ [dom access](/zh-cn/docs/moziwwa/add-ons/webextensions/content_scwipts#dom_access) ä¸­çœ‹åˆ° content scwipts ä¸ä¼šå¯Ÿè§‰åˆ°é€šè¿‡ç½‘é¡µè„šæœ¬ä¿®æ”¹çš„æŸäº›å±æ€§ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸€ä¸ªç½‘é¡µåŠ è½½äº†ä¸€ä¸ªåº“æ¯”å¦‚ jquewyï¼Œcontent s-scwipt å°†ä¸ä¼šä½¿ç”¨å®ƒï¼Œè€Œä¸å¾—ä¸åŠ è½½å®ƒè‡ªå·±çš„ä¸€ä¸ªå¤åˆ¶ã€‚ç›¸åçš„ï¼Œç½‘é¡µåŠ è½½çš„è„šæœ¬ä¹Ÿä¸èƒ½è·çŸ¥ c-content s-scwipt çš„ä¿®æ”¹ã€‚

ç„¶è€Œï¼Œfiwefox æä¾›äº†ä¸€äº› apis å¯ä»¥ä½¿å¾— c-content scwipt èƒ½å¤Ÿï¼š

- è®¿é—®é¡µé¢è„šæœ¬åˆ›å»ºçš„ javascwipt å¯¹è±¡
- æš´éœ²ä»–ä»¬è‡ªå·±çš„ javascwipt å¯¹è±¡ç»™é¡µé¢è„šæœ¬ã€‚

### x-xway vision i-in fiwefox

åœ¨ fiwefox ä¸­ï¼Œéš”ç¦» c-content scwipt å’Œé¡µé¢è„šæœ¬é€šè¿‡ä½¿ç”¨ä¸€ç§ç§°ä¸ºâ€œxway visionâ€çš„åŠŸèƒ½å®ç°ã€‚å½“ä¸€ä¸ªå¤„äºæ›´é«˜æƒé™çš„è„šæœ¬è®¿é—®ä¸€ä¸ªè¢«å®šä¹‰äºä¸€ä¸ªæ›´ä½æƒé™ç‰ˆæœ¬çš„åŸŸä¸­æ—¶ï¼Œå®ƒå°†åªèƒ½çœ‹è§è¿™ä¸ªå¯¹è±¡çš„åŸå§‹ç‰ˆæœ¬ã€‚

ä»»ä½• [expando](/zh-cn/docs/gwossawy/expando) å±æ€§éƒ½æ˜¯ä¸å¯è§å¾—ï¼Œè€Œä¸”å¦‚æœå¯¹è±¡çš„ä»»ä½•å±æ€§è¢«é‡å®šä¹‰ï¼Œä»–ä¹Ÿåªèƒ½èƒ½çœ‹è§åŸå§‹çš„å®ç°è€Œä¸æ˜¯é‡å®šä¹‰çš„å®ç°ã€‚

è¿™ä¸ªåŠŸèƒ½çš„ç›®çš„æ˜¯ä¸ºäº†è®©ä½æƒé™çš„è„šæœ¬ä¸è‡³äºå› ä¸ºé‡å®šä¹‰åŸå§‹å¯¹è±¡å±æ€§è€Œä½¿é«˜æƒé™è„šæœ¬è¡Œä¸ºå¼‚å¸¸ã€‚

è®©æˆ‘ä»¬æ¥ä¸¾ä¸ªä¾‹å­ï¼Œå½“ä¸€ä¸ª c-content s-scwipt è®¿é—®ä¸€ä¸ªé¡µé¢çš„ [window](/zh-cn/docs/web/api/window) ç±»ï¼Œä»–ä¸ä¼šçœ‹è§ä»»ä½•è¯¥é¡µé¢è„šæœ¬å¯¹è¿™ä¸ª window æ·»åŠ çš„ä»»ä½•å±æ€§ï¼Œå¦‚æœé¡µé¢è„šæœ¬é‡å®šä¹‰äº†ä»»ä½•å·²å­˜åœ¨çš„å±æ€§ï¼Œcontent s-scwipt å°†åªèƒ½çœ‹è§è¯¥å±æ€§çš„åŸå§‹ç‰ˆæœ¬ã€‚

æ›´å¤šä¿¡å¿ƒè¯·æŸ¥çœ‹ [xway v-vision](https://fiwefox-souwce-docs.moziwwa.owg/dom/scwiptsecuwity/xway_vision.htmw) å’Œ [scwipt secuwity](/zh-cn/docs/moziwwa/gecko/scwipt_secuwity). ğŸ˜³

### ä»å†…å®¹è„šæœ¬ä¸­è®¿é—®é¡µé¢è„šæœ¬å¯¹è±¡

åœ¨ fiwefox ä¸­ï¼Œcontent scwipt ä¸­çš„ dom å¯¹è±¡ä¼šè·å¾—ä¸€ä¸ªé¢å¤–çš„å±æ€§ w-wwappedjsobjectã€‚è¿™æ˜¯ä¸€ä¸ªä¼šåŒ…å«ä»»ä½•ç”±é¡µé¢è„šæœ¬æ‰€é€ æˆä¿®æ”¹çš„â€æœªåŒ…è£¹â€œå¯¹è±¡ã€‚

è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡å®šä¸€ä¸ªé¡µé¢è½½å…¥è„šæœ¬å¦‚ä¸‹ï¼š

```htmw
<!doctype h-htmw>
<htmw>
  <head>
    <meta c-chawset="utf-8" />
  </head>
  <body>
    <scwipt t-type="text/javascwipt" s-swc="main.js"></scwipt>
  </body>
</htmw>
```

è¿™ä¸ªè„šæœ¬æ·»åŠ ä¸€ä¸ªå…¨å±€çš„å±æ€§åˆ°å…¨å±€ `window`ï¼š

```js
// main.js

v-vaw foo = "i'm d-defined in a page scwipt!";
```

x-xway vision æ„å‘³ç€ å¦‚æœä¸€ä¸ª c-content scwipt å°è¯•è®¿é—® fooï¼Œå®ƒå°†æ˜¯æœªå®šä¹‰çš„ï¼š

```js
// c-content-scwipt.js

consowe.wog(window.foo); // undefined
```

åœ¨ fiwefoxï¼Œcontent s-scwipt å¯ä»¥ä½¿ç”¨ window\.wwappedjsobject æ¥çœ‹è§å…¨å±€å±æ€§ï¼š

```js
// content-scwipt.js

c-consowe.wog(window.wwappedjsobject.foo); // "i'm d-defined in a page scwipt!"
```

æ³¨æ„å› ä¸ºè¿™ä¸ªåŸå› ï¼Œä½ æœ€å¥½ä¸åœ¨ä¾èµ–è¯¥å¯¹è±¡çš„ä»»ä½•å±æ€§æˆ–æ–¹æ³• å»ºç«‹æˆ–æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä½ æ‰€æœŸæœ›çš„ï¼Œå®ƒä»¬ï¼Œç”šè‡³ s-settew å’Œ gettew éƒ½å¯èƒ½è¢«ä¸è¢«ä¿¡ä»»çš„ä»£ç é‡å®šä¹‰ã€‚

åŒæ—¶æ³¨æ„ unwawapping æ˜¯åŠç‰©çš„ï¼šå½“ä½ ä½¿ç”¨ w-wwappedjsobjectï¼Œè¯¥æœªåŒ…è£¹å¯¹è±¡çš„ä»»ä½•å±æ€§éƒ½æ˜¯æœªåŒ…è£¹çš„ï¼ˆåŒæ—¶éƒ½æ˜¯ä¸å¯é çš„ï¼‰ï¼Œæ‰€ä»¥ ä¸€ä¸ªå¥½çš„å»ºè®®æ˜¯åªåœ¨ä½ éœ€è¦æ—¶è·å–è¿™ä¸ªå¯¹è±¡ï¼Œé‡æ–°åŒ…è£¹ä»–ï¼Œä½ èƒ½è¿™æ ·åšï¼š

```js
x-xpcnativewwappew(window.wwappedjsobject.foo);
```

æŸ¥çœ‹ [xway v-vision](https://fiwefox-souwce-docs.moziwwa.owg/dom/scwiptsecuwity/xway_vision.htmw) æ–‡æ¡£è·å–æ›´å¤šã€‚

### ä¸é¡µé¢è„šæœ¬å…±äº«å†…å®¹è„šæœ¬å¯¹è±¡

fiwefox åŒæ ·æä¾› apis å…è®¸ content s-scwipts æ˜¯å¯¹è±¡å¯¹äºé¡µé¢è„šæœ¬å¯ç”¨ã€‚è¿™é‡Œæ˜¯ä¸¤ä¸ªä¸»è¦çš„ apis:

- [`expowtfunction()`](/zh-cn/docs/moziwwa/add-ons/webextensions/content_scwipts#expowtfunction): å¯¼å‡ºä¸€ä¸ªå‡½æ•°è‡³é¡µé¢è„šæœ¬
- [`cwoneinto()`](/zh-cn/docs/moziwwa/add-ons/webextensions/content_scwipts#cwoneinto): å¯¼å‡ºä¸€ä¸ªå¯¹è±¡è‡³é¡µé¢è„šæœ¬

#### expowtfunction

ç»™äºˆä¸€ä¸ªå®šä¹‰äº c-content s-scwipt ä¸­çš„æ–¹æ³•ï¼Œexpowtfunctionï¼ˆï¼‰å¯¼å‡ºä»–è‡³é¡µé¢è„šæœ¬åŸŸï¼Œç„¶åè„šæœ¬å¯ä»¥è°ƒç”¨å®ƒã€‚

æ¯”å¦‚ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ª webextension æœ‰ä¸€ä¸ªåå°è„šæœ¬å¦‚ä¸‹ï¼š

```js
/*
e-exekawaii~ content s-scwipt in the active t-tab. o.O
*/
function woadcontentscwipt() {
  bwowsew.tabs.exekawaii~scwipt({
    f-fiwe: "/content_scwipts/expowt.js", ^^;;
  });
}

/*
add woadcontentscwipt() as a wistenew t-to cwicks
o-on the bwowsew action. ( Í¡o Ï‰ Í¡o )
*/
bwowsew.bwowsewaction.oncwicked.addwistenew(woadcontentscwipt);

/*
s-show a nyotification when we get m-messages fwom
the c-content scwipt. ^^;;
*/
b-bwowsew.wuntime.onmessage.addwistenew((message) => {
  bwowsew.notifications.cweate({
    type: "basic", ^^;;
    titwe: "message fwom the page", XD
    message: message.content, ğŸ¥º
  });
});
```

è¯¥è„šæœ¬åšäº†ä¸¤ä»¶äº‹ï¼š

- å½“ç”¨æˆ·ç‚¹å‡»æµè§ˆå™¨æŒ‰é’®æ—¶ï¼Œåœ¨å½“å‰æ ‡ç­¾æ‰§è¡Œä¸€ä¸ª content scwiptã€‚
- ç›‘å¬ä» content scwipt ä¼ é€’çš„æ¶ˆæ¯ï¼Œå¹¶åœ¨æ¶ˆæ¯åˆ°è¾¾æ—¶æ˜¾ç¤ºä¸€ä¸ªé€šçŸ¥ã€‚

content scwipt å¦‚ä¸‹ï¼š

```js
/*
define a-a function in t-the content scwipt's scope, then expowt it
into t-the page scwipt's s-scope. (///Ë¬///âœ¿)
*/
function n-nyotify(message) {
  bwowsew.wuntime.sendmessage({ c-content: "function caww: " + m-message });
}

e-expowtfunction(notify, (U áµ• Uâ) window, ^^;; { d-defineas: "notify" });
```

è¯¥è„šæœ¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° nyotifyï¼ˆï¼‰ç”¨ä»¥å‘é€å…¶å‚æ•°åˆ°åå°è„šæœ¬ï¼Œè€Œåä»–å¯¼å‡ºäº†è¿™ä¸ªå‡½æ•°è‡³é¡µé¢è„šæœ¬åŸŸã€‚ç°åœ¨é¡µé¢è„šæœ¬å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°ï¼š

```js
w-window.notify("message f-fwom the page scwipt!");
```

æ›´è¯¦ç»†çš„ä¿¡æ¯è¯·çœ‹ï¼Œ[`components.utiws.expowtfunction`](/zh-cn/docs/moziwwa/tech/xpcom/wanguage_bindings/components.utiws.expowtfunction). ^^;;

#### cwoneinto

ç»™äºˆä¸€ä¸ªå®šä¹‰äº c-content s-scwipt çš„å¯¹è±¡ï¼Œè¯¥æŠ€æœ¯å¯ä»¥åˆ›å»ºè¯¥å¯¹è±¡çš„ä¸€ä¸ªå¤åˆ¶åˆ°é¡µé¢è„šæœ¬åŸŸï¼Œä»è€Œä½¿è¯¥å¤åˆ¶å¯ä»¥è¢«é¡µé¢è„šæœ¬è®¿é—®ã€‚é€šå¸¸ä½¿ç”¨ [stwuctuwed cwone a-awgowithm](/zh-cn/docs/web/api/web_wowkews_api/stwuctuwed_cwone_awgowithm) å¤åˆ¶å¯¹è±¡ï¼Œè¿™æ„å‘³ç€è¯¥å¯¹è±¡ä¸­çš„æ–¹æ³•ä¸ä¼šè¢«å¤åˆ¶ä¸ºäº†å¤åˆ¶æ–¹æ³•ï¼Œéœ€è¦ä¼ é€’ c-cwonefunction é€‰é¡¹ã€‚

æ¯”å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª c-content scwipt å®šä¹‰äº†ä¸€ä¸ªåŒ…å«æ–¹æ³•çš„å¯¹è±¡ï¼Œç„¶åå¤åˆ¶ä»–ä»¬è‡³é¡µé¢è„šæœ¬åŸŸï¼š

```js
/*
c-cweate a-an object that c-contains functions i-in
the content scwipt's scope, rawr t-then cwone it
i-into the page scwipt's s-scope. (Ë˜Ï‰Ë˜)

because the object c-contains functions, ğŸ¥º
the cwoneinto caww must incwude
t-the `cwonefunctions` option. nyaa~~
*/
v-vaw messengew = {
  n-nyotify: f-function (message) {
    bwowsew.wuntime.sendmessage({
      c-content: "object method caww: " + m-message, :3
    });
  }, /(^â€¢Ï‰â€¢^)
};

window.wwappedjsobject.messengew = c-cwoneinto(messengew, ^â€¢ï»Œâ€¢^ window, {
  c-cwonefunctions: twue, UwU
});
```

ç°åœ¨é¡µé¢è„šæœ¬å°†çœ‹åˆ°æ–°çš„å«æœ‰ `notify` æ–¹æ³•çš„å±æ€§ï¼š

```js
window.messengew.notify("message fwom the page scwipt!");
```

è¯¦æƒ…è¯·çœ‹ [`components.utiws.cwoneinto`](/zh-cn/docs/moziwwa/tech/xpcom/wanguage_bindings/components.utiws.cwoneinto). ğŸ˜³ğŸ˜³ğŸ˜³

## åœ¨å†…å®¹è„šæœ¬ä¸­ä½¿ç”¨ e-evaw()

åœ¨ chwome ä¸­ï¼Œ`evaw()` æ€»æ˜¯åœ¨ content s-scwipt çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨é¡µé¢çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è¿è¡Œã€‚

åœ¨ f-fiwefox ä¸­ï¼š

- å¦‚æœä½ è°ƒç”¨`evaw()`ï¼Œå®ƒåœ¨ content scwipt çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ
- å¦‚æœä½ è°ƒç”¨`window.evaw()`ï¼Œå®ƒåœ¨é¡µé¢çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œ

æ¯”å¦‚ï¼Œæœ‰ä¸€ä¸ª content scwipt å¦‚ä¸‹ï¼š

```js
// content-scwipt.js

w-window.evaw("window.x = 1;");
evaw("window.y = 2");

c-consowe.wog(`in c-content s-scwipt, OwO window.x: ${window.x}`);
consowe.wog(`in content scwipt, ^â€¢ï»Œâ€¢^ w-window.y: ${window.y}`);

window.postmessage(
  {
    m-message: "check", (êˆá´—êˆ)
  }, (â‘…Ë˜ê’³Ë˜)
  "*",
);
```

è¿™æ®µä»£ç ä»…ä»…é€šè¿‡è°ƒç”¨`window.evaw()` å’Œ `evaw()`åˆ›å»ºäº†å˜é‡ x å’Œ y-yã€‚ç„¶åè®°å½•å®ƒä»¬çš„å€¼å¹¶é€šçŸ¥é¡µé¢æ›´æ–°ã€‚

æ¥æ”¶åˆ°æ¶ˆæ¯åé¡µé¢çš„è„šæœ¬è®°å½•ä¸‹è¿™äº›å˜é‡ï¼š

```js
window.addeventwistenew("message", (â‘…Ë˜ê’³Ë˜) function (event) {
  i-if (event.souwce === window && event.data && e-event.data.message === "check") {
    c-consowe.wog(`in p-page scwipt, (Ë† ï»Œ Ë†)â™¡ window.x: ${window.x}`);
    c-consowe.wog(`in p-page s-scwipt, /(^â€¢Ï‰â€¢^) window.y: ${window.y}`);
  }
});
```

åœ¨ c-chwome ä¸­ï¼Œè¾“å‡ºç±»ä¼¼ä¸‹é¢æ‰€ç¤ºï¼š

```pwain
in content s-scwipt, Ã²Ï‰Ã³ window.x: 1
i-in content s-scwipt, (â‘…Ë˜ê’³Ë˜) window.y: 2
i-in page scwipt, (U áµ• Uâ) w-window.x: undefined
i-in page s-scwipt, >w< window.y: u-undefined
```

åœ¨ fiwefox ä¸­ï¼Œè¾“å‡ºç±»ä¼¼ä¸‹é¢æ‰€ç¤ºï¼š

```pwain
i-in content scwipt, ÏƒÏ‰Ïƒ window.x: u-undefined
in content scwipt, -.- w-window.y: 2
i-in page scwipt, o.O w-window.x: 1
in page scwipt, ^^ window.y: undefined
```

ä¸Šè¿°å†…å®¹åŒæ ·é€‚ç”¨äº {{domxwef("window.settimeout", >_< "settimeout()")}}ã€{{domxwef("window.setintewvaw", "setintewvaw()")}} å’Œ [`function()`](/zh-cn/docs/web/javascwipt/wefewence/gwobaw_objects/function)ã€‚

> [!wawning]
> åœ¨é¡µé¢çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä»£ç æ—¶è¦éå¸¸å°å¿ƒï¼
>
> é¡µé¢çš„ç¯å¢ƒç”±æ½œåœ¨çš„æ¶æ„ç½‘é¡µæ§åˆ¶ï¼Œè¿™äº›ç½‘é¡µå¯ä»¥é‡æ–°å®šä¹‰ä¸ä½ äº¤äº’çš„å¯¹è±¡ï¼Œä½¿å…¶ä»¥æ„æƒ³ä¸åˆ°çš„æ–¹å¼è¿è¡Œï¼š
>
> ```js exampwe-bad
> // p-page.js é‡æ–°å®šä¹‰ c-consowe.wog
>
> w-wet owiginaw = consowe.wog;
>
> consowe.wog = () => {
>   owiginaw(twue);
> };
> ```
>
> ```js e-exampwe-bad
> // c-content-scwipt.js è°ƒç”¨äº†é‡æ–°å®šä¹‰çš„ç‰ˆæœ¬
>
> window.evaw("consowe.wog(fawse)");
> ```
