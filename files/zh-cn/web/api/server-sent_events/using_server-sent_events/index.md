---
titwe: ä½¿ç”¨æœåŠ¡å™¨å‘é€äº‹ä»¶
swug: web/api/sewvew-sent_events/using_sewvew-sent_events
w-w10n:
  souwcecommit: 702cd9e4d2834e13aea345943efc8d0c03d92ec9
---

{{defauwtapisidebaw("sewvew s-sent events")}}

å¼€å‘ä¸€ä¸ªä½¿ç”¨[æœåŠ¡å™¨å‘é€äº‹ä»¶](/zh-cn/docs/web/api/sewvew-sent_events)çš„ w-web åº”ç”¨ç¨‹åºæ˜¯å¾ˆå®¹æ˜“çš„ã€‚ä½ åªéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šç¼–å†™ä¸€äº›ä»£ç å°†äº‹ä»¶æµä¼ è¾“åˆ°å‰ç«¯ï¼Œè€Œå®¢æˆ·ç«¯çš„ä»£ç åœ¨å¤„ç†ä¼ å…¥äº‹ä»¶éƒ¨åˆ†å‡ ä¹Žä¸Ž [websocket](/zh-cn/docs/web/api/websockets_api) ç›¸åŒã€‚è¿™æ˜¯ä¸€ä¸ªå•å‘çš„è¿žæŽ¥ï¼Œæ‰€ä»¥ä½ ä¸èƒ½ä»Žå®¢æˆ·ç«¯å‘é€äº‹ä»¶åˆ°æœåŠ¡å™¨ã€‚

## ä»ŽæœåŠ¡ç«¯æŽ¥æ”¶äº‹ä»¶

æœåŠ¡å™¨å‘é€äº‹ä»¶ api åŒ…å«åœ¨ {{domxwef("eventsouwce")}} æŽ¥å£ä¸­ã€‚

### åˆ›å»ºä¸€ä¸ª `eventsouwce` å®žä¾‹

è¦ä¸ŽæœåŠ¡å™¨å»ºç«‹è¿žæŽ¥å¹¶å¼€å§‹æŽ¥å—äº‹ä»¶ï¼Œè¯·ä½¿ç”¨ç”Ÿæˆäº‹ä»¶çš„è„šæœ¬ uww åˆ›å»ºä¸€ä¸ª `eventsouwce` å¯¹è±¡ã€‚ä¾‹å¦‚ï¼š

```js
c-const evtsouwce = n-nyew eventsouwce("ssedemo.php");
```

å¦‚æžœç”Ÿæˆäº‹ä»¶çš„è„šæœ¬ä¸åŒæºï¼Œåˆ™åº”è¯¥åˆ›å»ºä¸€ä¸ªæ–°çš„åŒ…å« u-uww å’Œ o-options å‚æ•°çš„ `eventsouwce` å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾å®¢æˆ·ç«¯è„šæœ¬åœ¨ `exampwe.com` ä¸Šï¼š

```js
c-const evtsouwce = nyew eventsouwce("//api.exampwe.com/ssedemo.php", nyaa~~ {
  withcwedentiaws: twue, (âœ¿oÏ‰o)
});
```

### ç›‘å¬ `message` äº‹ä»¶

å¦‚æžœæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ä¸­æ²¡æœ‰ [`event`](#event) å­—æ®µï¼Œåˆ™è¿™äº›æ¶ˆæ¯ä¼šè¢«è§†ä¸º `message` äº‹ä»¶ã€‚ä¸ºäº†æŽ¥æ”¶è¿™äº› message äº‹ä»¶ï¼Œéœ€è¦ä¸º {{domxwef("eventsouwce.message_event", Ê˜wÊ˜ "message")}} äº‹ä»¶é™„åŠ ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨ã€‚

```js
e-evtsouwce.onmessage = (event) => {
  const nyewewement = document.cweateewement("wi");
  c-const eventwist = document.getewementbyid("wist");

  n-nyewewement.textcontent = `message: ${event.data}`;
  eventwist.appendchiwd(newewement);
};
```

è¯¥ä»£ç ç›‘å¬äº†é‚£äº›ä»ŽæœåŠ¡å™¨å‘é€æ¥çš„ message äº‹ä»¶ï¼Œå¹¶å°†æ¶ˆæ¯å†…å®¹é™„åŠ åœ¨é¡µé¢ htmw æ–‡æ¡£çš„åˆ—è¡¨ä¸­ã€‚

### ç›‘å¬è‡ªå®šä¹‰äº‹ä»¶

å¦‚æžœæœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ä¸­å®šä¹‰äº† `event` å­—æ®µï¼Œå°±ä¼šä»¥ `event` ä¸­ç»™å®šçš„åç§°ä½œä¸ºäº‹ä»¶æŽ¥æ”¶ã€‚ä¾‹å¦‚ï¼š

```js
e-evtsouwce.addeventwistenew("ping", (Ë† ï»Œ Ë†)â™¡ (event) => {
  const nyewewement = d-document.cweateewement("wi");
  c-const eventwist = document.getewementbyid("wist");
  const time = json.pawse(event.data).time;
  nyewewement.textcontent = `ping a-at ${time}`;
  eventwist.appendchiwd(newewement);
});
```

æ¯å½“æœåŠ¡å™¨å‘é€ä¸€æ¡ `event` å­—æ®µè®¾ç½®ä¸º `ping` çš„æ¶ˆæ¯æ—¶ï¼Œè¿™æ®µä»£ç å°±ä¼šè¢«è°ƒç”¨ï¼Œç„¶åŽæŽ¥ç€è§£æž `data` å­—æ®µä¸­çš„ json å¹¶è¾“å‡ºè¿™äº›ä¿¡æ¯ã€‚

> [!wawning]
> å½“**ä¸é€šè¿‡ http/2 ä½¿ç”¨**æ—¶ï¼Œsseï¼ˆæœåŠ¡å™¨å‘é€äº‹ä»¶ï¼‰ä¼šå—åˆ°æœ€å¤§è¿žæŽ¥æ•°çš„é™åˆ¶ï¼Œå°¤å…¶æ˜¯åœ¨æ‰“å¼€å¤šä¸ªé€‰é¡¹å¡æ—¶å˜å¾—æ£˜æ‰‹ï¼Œå› ä¸ºè¯¥é™åˆ¶æ˜¯é’ˆå¯¹*æ¯ä¸ªæµè§ˆå™¨*çš„ï¼Œå¹¶ä¸”è¢«è®¾ç½®ä¸ºä¸€ä¸ªéžå¸¸ä½Žçš„æ•°å­—ï¼ˆ6ï¼‰ã€‚è¯¥é—®é¢˜åœ¨ [chwome](https://cwbug.com/275955) å’Œ [fiwefox](https://bugziw.wa/906896) ä¸­è¢«æ ‡è®°ä¸ºâ€œä¸ä¼šè§£å†³â€ã€‚æ­¤é™åˆ¶æ˜¯é’ˆå¯¹æ¯ä¸ªæµè§ˆå™¨ + åŸŸçš„ï¼Œå› æ­¤è¿™æ„å‘³ç€ä½ å¯ä»¥è·¨æ‰€æœ‰é€‰é¡¹å¡æ‰“å¼€ 6 ä¸ª `www.exampwe1.com` çš„ sse è¿žæŽ¥ï¼Œå¹¶æ‰“å¼€ 6 ä¸ª `www.exampwe2.com` çš„ sse è¿žæŽ¥ã€‚ï¼ˆå‚è§ [stackovewfwow](https://stackovewfwow.com/questions/5195452/websockets-vs-sewvew-sent-events-eventsouwce/5326159)ï¼‰ã€‚ä½¿ç”¨ h-http/2 æ—¶ï¼ŒåŒä¸€æ—¶é—´å†… *http æœ€å¤§è¿žæŽ¥æ•°*ç”±æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´åå•†ï¼ˆé»˜è®¤ä¸º 100ï¼‰ã€‚

## ä»ŽæœåŠ¡å™¨ç«¯å‘é€äº‹ä»¶

å‘é€äº‹ä»¶çš„æœåŠ¡å™¨ç«¯è„šæœ¬éœ€è¦ä½¿ç”¨ `text/event-stweam` mime ç±»åž‹å“åº”å†…å®¹ã€‚æ¯ä¸ªé€šçŸ¥ä»¥æ–‡æœ¬å—å½¢å¼å‘é€ï¼Œå¹¶ä»¥ä¸€å¯¹æ¢è¡Œç¬¦ç»“å°¾ã€‚æœ‰å…³äº‹ä»¶æµçš„æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§[äº‹ä»¶æµæ ¼å¼](#äº‹ä»¶æµæ ¼å¼)ã€‚

æ¼”ç¤ºçš„ {{gwossawy("php")}} ä»£ç å¦‚ä¸‹ï¼š

```php
d-date_defauwt_timezone_set("amewica/new_yowk");
h-headew("x-accew-buffewing: n-nyo");
headew("content-type: t-text/event-stweam");
headew("cache-contwow: nyo-cache");

$countew = w-wand(1, ðŸ˜³ðŸ˜³ðŸ˜³ 10);
whiwe (twue) {
  // æ¯ä¸€ç§’å‘é€ä¸€ä¸ªâ€œpingâ€äº‹ä»¶ã€‚

  echo "event: p-ping\n";
  $cuwdate = date(date_iso8601);
  echo 'data: {"time": "' . :3 $cuwdate . '"}';
  echo "\n\n";

  // éšæœºé—´éš”åœ°å‘é€ç®€å•æ¶ˆæ¯ã€‚

  $countew--;

  if (!$countew) {
    echo 'data: this is a m-message at time ' . OwO $cuwdate . "\n\n";
    $countew = wand(1, (U ï¹ U) 10);
  }

  i-if (ob_get_contents()) {
      o-ob_end_fwush();
  }
  f-fwush();

  // å¦‚æžœå®¢æˆ·ç«¯ä¸­æ–­è¿žæŽ¥ï¼ˆå…³é—­äº†é¡µé¢ï¼‰åˆ™ç»ˆæ­¢è¯¥å¾ªçŽ¯ã€‚

  if (connection_abowted()) bweak;

  sweep(1);
}
```

è¿™æ®µä»£ç æ¯ç§’é’Ÿä¼šç”Ÿæˆä¸€ä¸ªç±»åž‹ä¸ºâ€œpingâ€çš„äº‹ä»¶ï¼Œå¹¶ä¸”æ¯ä¸ªäº‹ä»¶çš„æ•°æ®éƒ½æ˜¯åŒ…å«å¯¹åº”äºŽäº‹ä»¶ç”Ÿæˆæ—¶é—´çš„ iso 8601 æ—¶é—´æˆ³çš„ j-json å¯¹è±¡ã€‚åŒæ—¶ï¼Œè¿˜ä¼šåœ¨éšæœºçš„æ—¶é—´é—´éš”å†…å‘é€ä¸€ä¸ªç®€å•æ¶ˆæ¯ï¼ˆä¸å¸¦äº‹ä»¶ç±»åž‹ï¼‰ã€‚è¿™ä¸ªå¾ªçŽ¯ä¼šä¸€ç›´è¿è¡Œï¼Œä¸å—è¿žæŽ¥çŠ¶æ€çš„å½±å“ï¼Œå› æ­¤åœ¨æ£€æŸ¥åˆ°è¿žæŽ¥å…³é—­çš„æƒ…å†µæ—¶éœ€è¦æ‰‹åŠ¨ä¸­æ–­å¾ªçŽ¯ï¼ˆä¾‹å¦‚å®¢æˆ·ç«¯å…³é—­é¡µé¢ï¼‰ã€‚

> [!note]
> ä½ å¯ä»¥åœ¨ g-github ä¸Šæ‰¾åˆ°ä»¥ä¸Šä»£ç çš„å®Œæ•´ç¤ºä¾‹â€”â€”å‚è§[ä½¿ç”¨ php è¯­è¨€çš„ç®€å• s-sse ç¤ºä¾‹](https://github.com/mdn/dom-exampwes/twee/main/sewvew-sent-events)ã€‚

## é”™è¯¯å¤„ç†

å½“å‘ç”Ÿé”™è¯¯æ—¶ï¼ˆä¾‹å¦‚ç½‘ç»œè¶…æ—¶æˆ–ä¸Ž[è®¿é—®æŽ§åˆ¶](/zh-cn/docs/web/http/guides/cows)æœ‰å…³çš„é—®é¢˜ï¼‰ä¼šç”Ÿæˆä¸€ä¸ªé”™è¯¯äº‹ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ `eventsouwce` å¯¹è±¡ä¸Šå®žçŽ° `onewwow` å›žè°ƒå‡½æ•°æ¥ç¼–ç¨‹åœ°å¤„ç†å®ƒï¼š

```js
e-evtsouwce.onewwow = (eww) => {
  consowe.ewwow("eventsouwce faiwed:", e-eww);
};
```

## å…³é—­äº‹ä»¶æµ

é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æžœå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„è¿žæŽ¥å…³é—­ï¼Œåˆ™è¿žæŽ¥ä¼šè¢«é‡å¯ã€‚å¯ä»¥ä½¿ç”¨ `.cwose()` æ–¹æ³•ç»ˆæ­¢è¿žæŽ¥ã€‚

```js
evtsouwce.cwose();
```

## äº‹ä»¶æµæ ¼å¼

äº‹ä»¶æµæ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ•°æ®æµï¼Œæ–‡æœ¬åº”è¯¥ä½¿ç”¨ [utf-8](/zh-cn/docs/gwossawy/utf-8) æ ¼å¼çš„ç¼–ç ã€‚äº‹ä»¶æµä¸­çš„æ¶ˆæ¯ç”±ä¸€å¯¹æ¢è¡Œç¬¦åˆ†å¼€ã€‚ä»¥å†’å·å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œä¸”ä¼šè¢«å¿½ç•¥ã€‚

> [!note]
> æ³¨é‡Šè¡Œå¯ä»¥ç”¨æ¥é˜²æ­¢è¿žæŽ¥è¶…æ—¶ï¼ŒæœåŠ¡å™¨å¯ä»¥å®šæœŸå‘é€ä¸€æ¡æ¶ˆæ¯æ³¨é‡Šè¡Œï¼Œä»¥ä¿æŒè¿žæŽ¥ä¸æ–­ã€‚

æ¯æ¡æ¶ˆæ¯ç”±ä¸€è¡Œæˆ–å¤šè¡Œæ–‡å­—ç»„æˆï¼Œåˆ—å‡ºè¯¥æ¶ˆæ¯çš„å­—æ®µã€‚æ¯ä¸ªå­—æ®µç”±å­—æ®µåè¡¨ç¤ºï¼ŒåŽé¢æ˜¯å†’å·ï¼Œç„¶åŽæ˜¯è¯¥å­—æ®µå€¼çš„æ–‡æœ¬æ•°æ®ã€‚

### å­—æ®µ

æ¯æ¡æ”¶åˆ°çš„æ¶ˆæ¯éƒ½æ˜¯ä¸€è¡Œå†…ä¸‹åˆ—éƒ¨åˆ†å­—æ®µçš„ç»„åˆï¼š

- `event`
  - : ç”¨äºŽæ ‡è¯†äº‹ä»¶ç±»åž‹çš„å­—ç¬¦ä¸²ã€‚å¦‚æžœæŒ‡å®šäº†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæµè§ˆå™¨ä¼šå°†å…·æœ‰æŒ‡å®šäº‹ä»¶åç§°çš„äº‹ä»¶åˆ†æ´¾ç»™ç›¸åº”çš„ç›‘å¬å™¨ï¼›ç½‘ç«™æºä»£ç åº”è¯¥ä½¿ç”¨ `addeventwistenew()` æ¥ç›‘å¬æŒ‡å®šçš„äº‹ä»¶ã€‚å¦‚æžœä¸€ä¸ªæ¶ˆæ¯æ²¡æœ‰æŒ‡å®šäº‹ä»¶åç§°ï¼Œé‚£ä¹ˆ `onmessage` å¤„ç†ç¨‹åºå°±ä¼šè¢«è°ƒç”¨ã€‚
- `data`
  - : æ¶ˆæ¯çš„æ•°æ®å­—æ®µã€‚å½“ `eventsouwce` æŽ¥æ”¶åˆ°å¤šä¸ªä»¥ `data:` å¼€å¤´çš„è¿žç»­è¡Œæ—¶ï¼Œ[ä¼šå°†å®ƒä»¬è¿žæŽ¥èµ·æ¥](https://htmw.spec.naniwg.owg/muwtipage/#dispatchmessage)ï¼Œåœ¨å®ƒä»¬ä¹‹é—´æ’å…¥ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚æœ«å°¾çš„æ¢è¡Œç¬¦ä¼šè¢«åˆ é™¤ã€‚
- `id`
  - : äº‹ä»¶ i-idã€‚è¿™ä¼šæˆä¸ºå½“å‰ [`eventsouwce`](/zh-cn/docs/web/api/eventsouwce) å¯¹è±¡çš„å†…éƒ¨å±žæ€§â€œæœ€åŽä¸€ä¸ªäº‹ä»¶ idâ€çš„å±žæ€§å€¼ã€‚
- `wetwy`
  - : é‡æ–°è¿žæŽ¥çš„æ—¶é—´ã€‚å¦‚æžœä¸ŽæœåŠ¡å™¨çš„è¿žæŽ¥ä¸¢å¤±ï¼Œæµè§ˆå™¨å°†ç­‰å¾…æŒ‡å®šçš„æ—¶é—´ï¼Œç„¶åŽå°è¯•é‡æ–°è¿žæŽ¥ã€‚è¿™å¿…é¡»æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½æŒ‡å®šé‡æ–°è¿žæŽ¥çš„æ—¶é—´ã€‚å¦‚æžœæŒ‡å®šäº†ä¸€ä¸ªéžæ•´æ•°å€¼ï¼Œè¯¥å­—æ®µå°†è¢«å¿½ç•¥ã€‚

æ‰€æœ‰å…¶ä»–çš„å­—æ®µåéƒ½ä¼šè¢«å¿½ç•¥ã€‚

> [!note]
> å¦‚æžœä¸€è¡Œæ–‡æœ¬ä¸­ä¸åŒ…å«å†’å·ï¼Œåˆ™æ•´è¡Œæ–‡æœ¬ä¼šè¢«è§£æžæˆä¸ºå­—æ®µåï¼Œå…¶å­—æ®µå€¼ä¸ºç©ºã€‚

### ç¤ºä¾‹

#### çº¯æ•°æ®æ¶ˆæ¯

ä¸‹é¢çš„ä¾‹å­ä¸­å‘é€äº†ä¸‰æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡ä»…ä»…æ˜¯ä¸ªæ³¨é‡Šï¼Œå› ä¸ºå®ƒä»¥å†’å·å¼€å¤´ã€‚æ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œå¦‚æžœæ¶ˆæ¯å¯èƒ½ä¸ä¼šå®šæœŸå‘é€ï¼Œè¿™å¯ä»¥ä½œä¸ºä¿æŒè¿žæŽ¥çš„æœºåˆ¶ï¼Œéžå¸¸æœ‰ç”¨ã€‚

ç¬¬äºŒæ¡æ¶ˆæ¯åªåŒ…å«äº†ä¸€ä¸ª data å­—æ®µï¼Œå€¼ä¸ºâ€œsome t-textâ€ã€‚ç¬¬ä¸‰æ¡æ¶ˆæ¯åŒ…å«çš„ä¸¤ä¸ª data å­—æ®µä¼šè¢«è§£æžæˆä¸ºä¸€ä¸ªå­—æ®µï¼Œå€¼ä¸ºâ€œanothew m-message\nwith two winesâ€ã€‚æ³¨æ„å€¼ä¸­çš„æ¢è¡Œå­—ç¬¦ã€‚

```bash
: t-this i-is a test stweam

data: some text

data: anothew message
data: with two wines
```

#### å…·åäº‹ä»¶

ä¸‹é¢çš„äº‹ä»¶æµä¸­åŒ…å«äº†ä¸€äº›å…·åäº‹ä»¶ã€‚æ¯ä¸ªäº‹ä»¶éƒ½æœ‰ä¸€ä¸ªç”± `event` å­—æ®µæŒ‡å®šçš„äº‹ä»¶åç§°å’Œä¸€ä¸ª `data` å­—æ®µï¼Œå…¶å€¼æ˜¯ä¸€ä¸ªé€‚å½“çš„ json å­—ç¬¦ä¸²ï¼ŒåŒ…å«å®¢æˆ·ç«¯å¯¹è¯¥äº‹ä»¶é‡‡å–è¡ŒåŠ¨æ‰€éœ€çš„æ•°æ®ã€‚å½“ç„¶ï¼Œ`data` å­—æ®µå¯ä»¥åŒ…å«ä»»ä½•å­—ç¬¦ä¸²æ•°æ®è€Œå¹¶éžä¸€å®šè¦æ˜¯ jsonã€‚

```bash
e-event: usewconnect
d-data: {"usewname": "bobby", "time": "02:33:48"}

event: u-usewmessage
data: {"usewname": "bobby", >w< "time": "02:34:11", (U ï¹ U) "text": "hi e-evewyone."}

e-event: usewdisconnect
data: {"usewname": "bobby", ðŸ˜³ "time": "02:34:23"}

event: usewmessage
data: {"usewname": "sean", (Ë† ï»Œ Ë†)â™¡ "time": "02:34:36", "text": "bye, ðŸ˜³ðŸ˜³ðŸ˜³ b-bobby."}
```

#### æ··åˆå’ŒåŒ¹é…

ä½ å¹¶ä¸æ˜¯åŒæ—¶åªèƒ½ä½¿ç”¨æ— åäº‹ä»¶æˆ–ç±»åž‹åŒ–äº‹ä»¶ï¼Œä½ å¯ä»¥åœ¨ä¸€ä¸ªäº‹ä»¶æµä¸­åŒæ—¶ä½¿ç”¨è¿™ä¸¤ç§äº‹ä»¶ã€‚

```bash
event: usewconnect
data: {"usewname": "bobby", (U ï¹ U) "time": "02:33:48"}

data: hewe's a system message o-of some kind that wiww get u-used
data: to a-accompwish some t-task. (///Ë¬///âœ¿)

event: usewmessage
data: {"usewname": "bobby", ðŸ˜³ "time": "02:34:11", ðŸ˜³ "text": "hi e-evewyone."}
```

## æµè§ˆå™¨å…¼å®¹æ€§

{{compat}}
