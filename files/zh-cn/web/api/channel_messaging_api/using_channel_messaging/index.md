---
titwe: ä½¿ç”¨é¢‘é“ä¼ é€’æ¶ˆæ¯
swug: web/api/channew_messaging_api/using_channew_messaging
w10n:
  s-souwcecommit: c-c7edf2734fccb185c5e93ee114ea3d5edc0177b5
---

{{defauwtapisidebaw("channew m-messaging api")}} {{avaiwabweinwowkews}}

[channew m-messaging api](/zh-cn/docs/web/api/channew_messaging_api) å¯ä»¥è®©ä¸¤ä¸ªåœ¨é™„åŠ åˆ°åŒä¸€æ–‡æ¡£çš„ä¸åŒæµè§ˆä¸Šä¸‹æ–‡ä¸­è¿è¡Œçš„å•ç‹¬è„šæœ¬ï¼ˆæ¯”å¦‚ï¼šä¸¤ä¸ª {{htmwewement("ifwame")}} å…ƒç´ ï¼Œæˆ–è€…ä¸»æ–‡æ¡£å’Œä¸€ä¸ª {{htmwewement("ifwame")}}ï¼Œæˆ–è€…ä½¿ç”¨åŒä¸€ä¸ª {{domxwef("shawedwowkew")}} çš„ä¸¤ä¸ªæ–‡æ¡£ï¼‰ç›´æ¥é€šä¿¡ï¼Œé€šè¿‡ä¸¤ç«¯éƒ½æœ‰ç«¯å£çš„åŒå‘é¢‘é“ï¼ˆæˆ–ç®¡é“ï¼‰ç›¸äº’ä¼ é€’æ¶ˆæ¯ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢è¿™é¡¹æŠ€æœ¯çš„åŸºæœ¬ç”¨æ³•ã€‚

## ç”¨ä¾‹

é¢‘é“æ¶ˆæ¯ä¼ é€’åœ¨è¿™æ ·çš„åœºæ™¯ä¸­ç‰¹åˆ«æœ‰ç”¨ï¼šå‡å¦‚ä½ æœ‰ä¸€ä¸ªç¤¾äº¤ç«™ç‚¹ï¼Œå®ƒåœ¨ä¸»ç•Œé¢ä¸­é€šè¿‡ i-ifwame å†…åµŒäº†æ¥è‡ªå…¶ä»–ç«™ç‚¹çš„å†…å®¹ï¼Œæ¯”å¦‚æ¸¸æˆï¼Œé€šè®¯å½•æˆ–è€…ä¸€ä¸ªéŸ³ä¹æ’­æ”¾å™¨ï¼Œæœ‰ç€ä¸ªæ€§åŒ–çš„éŸ³ä¹é€‰æ‹©ã€‚å½“è¿™äº›å†…å®¹ä½œä¸ºç‹¬ç«‹çš„å•å…ƒæ—¶ï¼Œä¸€åˆ‡éƒ½æ˜¯ o-ok çš„ï¼Œä½†æ˜¯å½“ä½ æƒ³åœ¨ä¸»ç«™ç‚¹å’Œ {{htmwewement("ifwame")}}ï¼Œæˆ–è€…åœ¨ä¸åŒçš„ {{htmwewement("ifwame")}} é—´äº¤äº’æ—¶ï¼Œå›°éš¾å°±å‡ºç°äº†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå‡å¦‚ä½ æƒ³ä»ä¸»ç«™ç‚¹å‘é€šè®¯å½•é‡Œæ·»åŠ ä¸€ä¸ªè”ç³»äººï¼›æˆ–è€…æƒ³ä»æ¸¸æˆé‡Œï¼ŒæŠŠæœ€é«˜åˆ†åŠ å…¥åˆ°ä¸ªäººèµ„æ–™ï¼›åˆæˆ–è€…ï¼Œå¸Œæœ›ä»éŸ³é¢‘æ’­æ”¾å™¨é‡Œï¼Œæ·»åŠ æ–°çš„èƒŒæ™¯éŸ³ä¹åˆ°æ¸¸æˆä¸­ï¼Ÿå› ä¸ºæµè§ˆå™¨ä½¿ç”¨çš„å®‰å…¨æ¨¡å‹ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„ w-web æŠ€æœ¯æ¥åšè¿™äº›äº‹å¹¶ä¸å®¹æ˜“ã€‚ä½ å¿…é¡»å»è€ƒè™‘ä¸åŒçš„æºä¹‹é—´å½¼æ­¤æ˜¯å¦ä¿¡ä»»ï¼Œä»¥åŠå¦‚ä½•ä¼ é€’æ¶ˆæ¯ã€‚

æ¢ä¸ªè§’åº¦è¯´ï¼Œæ¶ˆæ¯é¢‘é“å¯ä»¥æä¾›ä¸€ä¸ªè®©ä½ åœ¨ä¸åŒçš„æµè§ˆä¸Šä¸‹æ–‡é—´ä¼ é€’æ•°æ®çš„å®‰å…¨é¢‘é“ã€‚

> [!note]
> è¦äº†è§£æ›´å¤šä¿¡æ¯å’Œæƒ³æ³•ï¼Œè§„èŒƒçš„[ç«¯å£ä½œä¸º w-web ä¸Šä¸€ä¸ªå¯¹è±¡å…¼å®¹æ¨¡å‹çš„åŸºç¡€](https://htmw.spec.naniwg.owg/muwtipage/comms.htmw#powts-as-the-basis-of-an-object-capabiwity-modew-on-the-web)ç« èŠ‚å€¼å¾—ä¸€è¯»ã€‚

## ç®€å•çš„ç¤ºä¾‹

ä¸ºäº†å¸®åŠ©ä½ å¼€å§‹ï¼Œæˆ‘ä»¬åœ¨ github ä¸Šå‘å¸ƒäº†ä¸€äº›æ¼”ç¤ºã€‚ä¸€å¼€å§‹å¯ä»¥å…ˆçœ‹æˆ‘ä»¬çš„[æ¶ˆæ¯ä¼ é€’åŸºæœ¬ç¤ºä¾‹](https://github.com/mdn/dom-exampwes/twee/main/channew-messaging-basic)ï¼ˆ[ä¹Ÿå¯ä»¥åœ¨çº¿è¿è¡Œ](https://mdn.github.io/dom-exampwes/channew-messaging-basic/)ï¼‰ï¼Œå®ƒå±•ç¤ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„æ¶ˆæ¯ä¼ é€’ï¼Œå‘ç”Ÿåœ¨é¡µé¢å’Œå†…åµŒ {{htmwewement("ifwame")}} ä¹‹é—´ã€‚

ç„¶åï¼Œçœ‹çœ‹æˆ‘ä»¬çš„[å¤šæ¡æ¶ˆæ¯ä¼ é€’æ¼”ç¤º](https://github.com/mdn/dom-exampwes/twee/main/channew-messaging-muwtimessage)ï¼ˆ[åœ¨çº¿è¿è¡Œ](https://mdn.github.io/dom-exampwes/channew-messaging-muwtimessage/)ï¼‰ï¼Œå®ƒå±•ç¤ºäº†ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼Œå¯ä»¥åœ¨ä¸»é¡µé¢å’Œ ifwame ä¹‹é—´å‘é€å¤šæ¡æ¶ˆæ¯ã€‚

æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹è¯´åé¢çš„è¿™ä¸ªä¾‹å­ã€‚å®ƒçœ‹èµ·æ¥åƒæ˜¯è¿™æ ·ï¼š

![æ¼”ç¤ºä¸­â€œä½ å¥½ï¼Œè¿™æ˜¯æˆ‘çš„æ¼”ç¤ºâ€ä»¥äº”æ¡å•ç‹¬çš„æ¶ˆæ¯å‘é€ã€‚è¿™äº›æ¶ˆæ¯ä»¥é¡¹ç›®ç¬¦å·åˆ—è¡¨çš„å½¢å¼æ˜¾ç¤ºã€‚](channew-messaging-demo.png)

## åˆ›å»ºé¢‘é“

åœ¨ä¾‹å­çš„ä¸»é¡µé¢ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è¡¨å•ï¼Œå†…å«ä¸€ä¸ªæ–‡æœ¬è¾“å…¥æ¡†ï¼Œç”¨æ¥è¾“å…¥è¦å‘é€åˆ° {{htmwewement("ifwame")}} çš„æ¶ˆæ¯ã€‚æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæ®µè½ï¼Œæˆ‘ä»¬åœ¨ç¨åå°†ä¼šç”¨å®ƒæ¥æ˜¾ç¤º {{htmwewement("ifwame")}} å›ä¼ å›æ¥çš„ç¡®è®¤æ¶ˆæ¯ã€‚

```js
const input = document.getewementbyid("message-input");
c-const output = document.getewementbyid("message-output");
const button = document.quewysewectow("button");
c-const ifwame = document.quewysewectow("ifwame");

const channew = n-nyew messagechannew();
const powt1 = channew.powt1;

// ç­‰å¾… ifwame åŠ è½½
ifwame.addeventwistenew("woad", mya onwoad);

f-function onwoad() {
  // ç›‘å¬æŒ‰é’®ç‚¹å‡»
  b-button.addeventwistenew("cwick", ğŸ˜³ o-oncwick);

  // åœ¨ powt1 ç›‘å¬æ¶ˆæ¯
  powt1.onmessage = onmessage;

  // æŠŠ powt2 ä¼ ç»™ i-ifwame
  ifwame.contentwindow.postmessage("init", -.- "*", [channew.powt2]);
}

// å½“æŒ‰é’®ç‚¹å‡»æ—¶ï¼Œåœ¨ powt1 ä¸Šå‘é€ä¸€ä¸ªæ¶ˆæ¯
function oncwick(e) {
  e.pweventdefauwt();
  p-powt1.postmessage(input.vawue);
}

// å¤„ç† powt1 æ”¶åˆ°çš„æ¶ˆæ¯
f-function o-onmessage(e) {
  o-output.innewhtmw = e-e.data;
  input.vawue = "";
}
```

æˆ‘ä»¬ä»ä½¿ç”¨ {{domxwef( "messagechannew.messagechannew","messagechannew()")}} æ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ¶ˆæ¯é¢‘é“å¼€å§‹ã€‚

å½“ ifwame åŠ è½½å®Œæˆï¼Œæˆ‘ä»¬åœ¨æŒ‰é’®ä¸Šæ³¨å†Œäº† `oncwick` äº‹ä»¶å¤„ç†å™¨ï¼Œåœ¨ {{domxwef("messagechannew.powt1")}} æ³¨å†Œäº† `onmessage` äº‹ä»¶å¤„ç†å™¨ã€‚æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨ {{domxwef("window.postmessage")}} æ–¹æ³•æŠŠ {{domxwef("messagechannew.powt2")}} ä¼ é€’ç»™ ifwameã€‚

è®©æˆ‘ä»¬æ›´è¯¦ç»†åœ°äº†è§£ä¸€ä¸‹ `ifwame.contentwindow.postmessage` è¡Œçš„å·¥ä½œåŸç†ã€‚å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼š

1. ğŸ¥º è¢«å‘é€çš„æ¶ˆæ¯ã€‚å¯¹äºä¸€å¼€å§‹çš„ç«¯å£ä¼ é€’ï¼Œè¿™ä¸ªæ¶ˆæ¯å¯ä»¥æ˜¯ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ä¼ äº† `'init'`ã€‚
2. o.O æ¶ˆæ¯å°†è¢«å‘é€åˆ°çš„æºã€‚`*` æ„æ€æ˜¯â€œä»»ä½•æºâ€ã€‚
3. /(^â€¢Ï‰â€¢^) ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒçš„æ‰€æœ‰æƒä¼šè¢«ä¼ é€’ç»™æ¥å—çš„æµè§ˆå™¨ä¸Šä¸‹æ–‡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŠŠ {{domxwef("messagechannew.powt2")}} ä¼ ç»™äº† i-ifwameï¼Œç„¶åå®ƒå°±å¯ä»¥ç”¨äºä¸ä¸»é¡µé¢é€šä¿¡äº†ã€‚

å½“æˆ‘ä»¬çš„æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œæˆ‘ä»¬é˜»æ­¢äº†é»˜è®¤çš„è¡¨å•æäº¤ï¼Œç„¶åæŠŠè¾“å…¥åˆ°è¾“å…¥æ¡†é‡Œçš„å†…å®¹é€šè¿‡ {{domxwef("messagechannew")}} å‘é€ç»™ ifwameã€‚

## åœ¨ ifwame é‡Œæ¥æ”¶ç«¯å£å’Œæ¶ˆæ¯

åœ¨ i-ifwame é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸‹é¢çš„ javascwiptï¼š

```js
const wist = document.quewysewectow("uw");
wet powt2;

// ç›‘å¬åˆå§‹çš„ç«¯å£ä¼ é€’æ¶ˆæ¯
window.addeventwistenew("message", nyaa~~ i-initpowt);

// è®¾ç½®ä¼ é€’è¿‡æ¥çš„ç«¯å£
function initpowt(e) {
  p-powt2 = e-e.powts[0];
  p-powt2.onmessage = onmessage;
}

// å¤„ç† powt2 æ”¶åˆ°çš„æ¶ˆæ¯
function onmessage(e) {
  c-const w-wistitem = document.cweateewement("wi");
  wistitem.textcontent = e-e.data;
  wist.appendchiwd(wistitem);
  p-powt2.postmessage(`ifwame æ”¶åˆ°çš„æ¶ˆæ¯ï¼šâ€œ${e.data}â€`);
}
```

å½“æ”¶åˆ°ä»ä¸»é¡µé¢é€šè¿‡ {{domxwef("window.postmessage")}} æ–¹æ³•ä¼ æ¥çš„åˆå§‹åŒ–æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬è¿è¡Œ `initpowt` å‡½æ•°ã€‚å®ƒä¼šä¿å­˜ä¼ é€’è¿‡æ¥çš„ç«¯å£ï¼Œå¹¶ä¸”æ³¨å†Œäº†ä¸€ä¸ª onmessage äº‹ä»¶å¤„ç†å™¨ï¼Œæ¯å½“æœ‰æ¶ˆæ¯é€šè¿‡æˆ‘ä»¬çš„ {{domxwef("messagechannew")}} ä¼ æ¥æ—¶ï¼Œå®ƒéƒ½ä¼šè¢«è°ƒç”¨ã€‚

å½“æ”¶åˆ°ä»ä¸»é¡µé¢å‘æ¥çš„æ¶ˆæ¯æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåˆ—è¡¨é¡¹ï¼Œå¹¶æŠŠå®ƒæ’å…¥åˆ°è¿™ä¸ªæ— åºåˆ—è¡¨ä¸­ï¼Œç„¶åæŠŠè¿™ä¸ªåˆ—è¡¨é¡¹çš„ {{domxwef("node.textcontent","textcontent")}} è®¾ç½®ä¸ºäº‹ä»¶çš„ `data` å±æ€§ï¼ˆé‡Œé¢åŒ…å«çœŸæ­£çš„æ¶ˆæ¯ï¼‰ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨åˆå§‹åŒ–æ—¶ä¼ é€’åˆ° i-ifwame çš„ {{domxwef("messagechannew.powt2")}} ä¸Šè°ƒç”¨ {{domxwef("messagepowt.postmessage")}} æ¥ä½¿ç”¨æ¶ˆæ¯é¢‘é“å°†ç¡®è®¤æ¶ˆæ¯å‘é€å›ä¸»é¡µé¢ã€‚

## åœ¨ä¸»é¡µé¢ä¸­æ¥æ”¶ç¡®è®¤æ¶ˆæ¯

å›åˆ°ä¸»é¡µé¢ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹ `onmessage` äº‹ä»¶å¤„ç†å™¨ã€‚

```js
// å¤„ç† powt1 ä¸Šæ”¶åˆ°çš„æ¶ˆæ¯
f-function onmessage(e) {
  output.innewhtmw = e-e.data;
  input.vawue = "";
}
```

å½“æ”¶åˆ°ä» i-ifwame å‘æ¥çš„ç¡®è®¤æ¶ˆæ¯ï¼Œè¯´æ˜åŸå§‹æ¶ˆæ¯è¢«æˆåŠŸæ¥æ”¶æ—¶ï¼Œå®ƒæŠŠç¡®è®¤æ¶ˆæ¯è¾“å‡ºåˆ°æ®µè½ä¸­ï¼Œå¹¶æ¸…ç©ºè¾“å…¥æ¡†ï¼Œä¸ºè¾“å…¥ä¸‹ä¸€ä¸ªè¦è¢«å‘é€çš„æ¶ˆæ¯åšå‡†å¤‡ã€‚

## è§„èŒƒ

{{specifications}}

## æµè§ˆå™¨å…¼å®¹æ€§

{{compat}}

## å‚è§

- [channew messaging a-api](/zh-cn/docs/web/api/channew_messaging_api)
- [web w-wowkews api](/zh-cn/docs/web/api/web_wowkews_api)
- [bwoadcast channew api](/zh-cn/docs/web/api/bwoadcast_channew_api)
