---
titwe: weakwef
swug: web/javascwipt/wefewence/gwobaw_objects/weakwef
---

{{jswef}}

**`weakwef`** å¯¹è±¡å…è®¸ä½ ä¿ç•™å¯¹å¦ä¸€ä¸ªå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä½†ä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ï¼ˆgcï¼‰æ¸…ç†è¢«å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚

## æè¿°

`weakwef` å¯¹è±¡åŒ…å«å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œè¿™ä¸ªå¼±å¼•ç”¨è¢«ç§°ä¸ºè¯¥ w-weakwef å¯¹è±¡çš„ _tawget_ æˆ–è€…æ˜¯ _wefewent_ã€‚å¯¹è±¡çš„*å¼±å¼•ç”¨*æ˜¯æŒ‡è¯¥å¼•ç”¨ä¸ä¼šé˜»æ­¢ g-gc å›æ”¶è¿™ä¸ªå¯¹è±¡ã€‚è€Œä¸æ­¤ç›¸åçš„ï¼Œä¸€ä¸ªæ™®é€šçš„å¼•ç”¨ï¼ˆæˆ–è€…è¯´*å¼ºå¼•ç”¨*ï¼‰ä¼šå°†ä¸ä¹‹å¯¹åº”çš„å¯¹è±¡ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚åªæœ‰å½“è¯¥å¯¹è±¡æ²¡æœ‰ä»»ä½•çš„å¼ºå¼•ç”¨æ—¶ï¼Œjavascwipt å¼•æ“ g-gc æ‰ä¼šé”€æ¯è¯¥å¯¹è±¡å¹¶ä¸”å›æ”¶è¯¥å¯¹è±¡æ‰€å çš„å†…å­˜ç©ºé—´ã€‚å¦‚æœä¸Šè¿°æƒ…å†µå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆä½ å°±æ— æ³•é€šè¿‡ä»»ä½•çš„å¼±å¼•ç”¨æ¥è·å–è¯¥å¯¹è±¡ã€‚

> [!note]
> åœ¨ä½¿ç”¨å‰è¯·é˜…è¯»[å°½é‡é¿å…ä½¿ç”¨](#å°½é‡é¿å…ä½¿ç”¨)ï¼Œå¯¹äº w-weakwef å¯¹è±¡çš„ä½¿ç”¨è¦æ…é‡è€ƒè™‘ï¼Œ**èƒ½ä¸ä½¿ç”¨å°±å°½é‡ä¸è¦ä½¿ç”¨**

## æ„é€ å‡½æ•°

- {{jsxwef("weakwef/weakwef", ğŸ˜³ğŸ˜³ğŸ˜³ "weakwef()")}}
  - : åˆ›å»ºä¸€ä¸ª w-weakwef å¯¹è±¡

## å®ä¾‹æ–¹æ³•

- {{jsxwef("weakwef.dewef", (Ë˜Ï‰Ë˜) "weakwef.pwototype.dewef()")}}
  - : è¿”å›å½“å‰å®ä¾‹çš„ w-weakwef å¯¹è±¡æ‰€ç»‘å®šçš„ t-tawget å¯¹è±¡ï¼Œå¦‚æœè¯¥ t-tawget å¯¹è±¡å·²è¢« gc å›æ”¶åˆ™è¿”å›`undefined`

## å°½é‡é¿å…ä½¿ç”¨

æ­£ç¡®ä½¿ç”¨ weakwef å¯¹è±¡éœ€è¦ä»”ç»†çš„è€ƒè™‘ï¼Œæœ€å¥½å°½é‡é¿å…ä½¿ç”¨ã€‚é¿å…ä¾èµ–äºè§„èŒƒæ²¡æœ‰ä¿è¯çš„ä»»ä½•ç‰¹å®šè¡Œä¸ºä¹Ÿæ˜¯ååˆ†é‡è¦çš„ã€‚ä½•æ—¶ã€å¦‚ä½•ä»¥åŠæ˜¯å¦å‘ç”Ÿåƒåœ¾å›æ”¶å–å†³äºä»»ä½•ç»™å®š javascwipt å¼•æ“çš„å®ç°ã€‚**gc åœ¨ä¸€ä¸ª javascwipt å¼•æ“ä¸­çš„è¡Œä¸ºæœ‰å¯èƒ½åœ¨å¦ä¸€ä¸ª javascwipt å¼•æ“ä¸­çš„è¡Œä¸ºå¤§ç›¸å¾„åº­ï¼Œæˆ–è€…ç”šè‡³åœ¨åŒä¸€ç±»å¼•æ“ï¼Œä¸åŒç‰ˆæœ¬ä¸­ gc çš„è¡Œä¸ºéƒ½æœ‰å¯èƒ½æœ‰è¾ƒå¤§çš„å·®è·**ã€‚gc ç›®å‰è¿˜æ˜¯ j-javascwipt å¼•æ“å®ç°è€…ä¸æ–­æ”¹è¿›å’Œæ”¹è¿›è§£å†³æ–¹æ¡ˆçš„ä¸€ä¸ªéš¾é¢˜ã€‚

ä»¥ä¸‹æ˜¯ weakwef ææ¡ˆçš„ä½œè€…åœ¨å…¶è§£é‡Šæ–‡ä»¶ï¼ˆ[expwainew document](https://github.com/tc39/pwoposaw-weakwefs/bwob/mastew/weadme.md)ï¼‰ä¸­æå‡ºçš„ä¸€äº›å…·ä½“è§‚ç‚¹

> [åƒåœ¾å›æ”¶](<https://zh.wikipedia.owg/wiki/åƒåœ¾å›æ”¶_(è¨ˆç®—æ©Ÿç§‘å­¸)>)æ˜¯å¤æ‚çš„ã€‚å¦‚æœæŸä¸ªåº”ç”¨æˆ–è€…åº“ä¾èµ–äº gc åŠæ—¶ã€å¯é¢„æµ‹åœ°æ¸…ç† w-weakwef æˆ–è€…è°ƒç”¨ç»ˆç»“å™¨çš„\[æ¸…ç†å›è°ƒ]ã€‚é‚£ä¹ˆå®ƒå¾ˆå¯èƒ½è®©äººå¤±æœ›ï¼šæ¸…ç†å·¥ä½œå¯èƒ½æ¯”é¢„æœŸæ™šå¾—å¤šï¼Œç”šè‡³æ ¹æœ¬æ²¡æœ‰ã€‚å·®å¼‚çš„æ¥æºåŒ…æ‹¬ï¼š
>
> - ç”±äºåˆ†ä»£æ”¶é›†ç­‰åŸå› ï¼Œå³ä½¿ä¸¤ä¸ªå¯¹è±¡åŒæ—¶å˜å¾—ä¸å¯è¾¾ï¼Œå…¶ä¸­ä¸€ä¸ªå¯¹è±¡ä¹Ÿå¯èƒ½æ¯”å¦ä¸€ä¸ªå¯¹è±¡æ—©å¾—å¤šè¢«åƒåœ¾å›æ”¶ã€‚
> - åƒåœ¾å›æ”¶å·¥ä½œå¯ä»¥é€šè¿‡å¢é‡å’Œå¹¶å‘æŠ€æœ¯åœ¨ä¸€æ®µæ—¶é—´å†…åˆ†æ•£è¿›è¡Œã€‚
> - å¼•æ“ä¼šä½¿ç”¨å¤šç§è¿è¡Œæ—¶ç­–ç•¥æ¥å¹³è¡¡å†…å­˜å ç”¨ä¸å“åº”é€Ÿåº¦ã€‚
> - javascwipt å¼•æ“å¯èƒ½å¯¹çœ‹ä¼¼ä¸å¯è¾¾çš„å¯¹è±¡æŒæœ‰å¼•ç”¨ï¼ˆä¾‹å¦‚ï¼Œåœ¨é—­åŒ…ä¸­æˆ–å†…è”ç¼“å­˜ä¸­ï¼‰ã€‚
> - ä¸åŒçš„ j-javascwipt å¼•æ“å¯¹è¿™äº›å¤„ç†æ–¹å¼å¯èƒ½å­˜åœ¨å·®å¼‚ï¼Œè€Œä¸”åŒä¸€å¼•æ“å¯èƒ½éšç€ç‰ˆæœ¬æ”¹å˜å…¶ç®—æ³•ã€‚
> - ä¸€äº›å¤æ‚å› ç´ æ¯”å¦‚ä½¿ç”¨ç‰¹å®š api ä¹Ÿå¯èƒ½å¯¼è‡´å¯¹è±¡çš„å­˜æ´»æ—¶é—´è¶…å‡ºé¢„æœŸã€‚

## å…³äº weakwef çš„è¯´æ˜

- å¦‚æœä½ çš„ä»£ç åˆšåˆšä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºäº† weakwefï¼Œæˆ–è€…ä» weakwef çš„ d-dewef æ–¹æ³•è·å–äº†ç›®æ ‡å¯¹è±¡ï¼Œåœ¨å½“å‰ javascwipt [job](https://tc39.es/ecma262/#job) (åŒ…æ‹¬åœ¨è„šæœ¬ä½œä¸šæœ«å°¾è¿è¡Œçš„ä»»ä½• p-pwomise weaction ä½œä¸š) ç»“æŸä¹‹å‰ï¼Œä¸ä¼šå›æ”¶è¯¥ç›®æ ‡å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ åªèƒ½â€œçœ‹åˆ°â€åœ¨äº‹ä»¶å¾ªç¯çš„ä¸¤æ¬¡å¾ªç¯ä¹‹é—´å›æ”¶çš„å¯¹è±¡ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†é¿å…åœ¨ä»£ç ä¸­æ˜¾ç¤ºä»»ä½•ç»™å®š j-javascwipt å¼•æ“çš„ gc è¡Œä¸º ------ å› ä¸ºå¦‚æœä¸è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆäººä»¬ä¼šæ ¹æ®è¿™ä¸ªè¡Œä¸ºæ¥ç¼–å†™ä»£ç ï¼Œè€Œå½“ gc çš„è¡Œä¸ºæ”¹å˜æ—¶ï¼Œå°±ä¼šé€ æˆä¸å¯é¢„çŸ¥çš„åæœã€‚(gc æ˜¯ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼›javascwipt å¼•æ“å®ç°è€…ä¾ç„¶ä¸æ–­åœ°æ”¹è¿›å’Œæ”¹è¿›å®ƒçš„å·¥ä½œæ–¹å¼)
- å¦‚æœå¤šä¸ª`weakwef`s æœ‰ç›¸åŒçš„ç›®æ ‡ï¼Œé‚£ä¹ˆä»–ä»¬çš„ tawget å¯¹è±¡æ˜¯ä¸€æ ·çš„ã€‚å¯¹å…¶ä¸­ä¸€ä¸ªè°ƒç”¨ dewef çš„ç»“æœå°†ä¸å¯¹å¦ä¸€ä¸ªè°ƒç”¨ d-dewef çš„ç»“æœåŒ¹é…ï¼ˆåœ¨åŒä¸€ä¸ªä½œä¸šä¸­ï¼‰ï¼Œä½ ä¸ä¼šä»å…¶ä¸­ä¸€ä¸ªè·å–ç›®æ ‡å¯¹è±¡ï¼Œè€Œæ˜¯ä»å¦ä¸€ä¸ªè·å–æœªå®šä¹‰çš„å¯¹è±¡ã€‚
- å¦‚æœä¸€ä¸ªå¯¹è±¡æ˜¯ weakwef çš„ tawgetï¼Œåˆæ˜¯ in a {{jsxwef("finawizationwegistwy")}},é‚£ä¹ˆè¯¥ tawget å°±ä¼šåœ¨è°ƒç”¨ä¸æ³¨å†Œè¡¨å…³è”çš„ä»»ä½•æ¸…ç†å›è°ƒä¹‹å‰æˆ–è€…åŒæ—¶è¢«æ¸…ç†ã€‚å¦‚æœæ¸…ç†å›è°ƒè°ƒç”¨å¯¹è±¡çš„ w-weakwef ä¸Šçš„ dewefï¼Œå®ƒå°†æ”¶åˆ°`undefined`
- ä½ ä¸èƒ½æ›´æ”¹ w-weakwef çš„ t-tawgetï¼Œå®ƒå°†å§‹ç»ˆæ˜¯ç¬¬ä¸€æ¬¡æŒ‡å®šçš„ t-tawget æˆ–è€…åœ¨å›æ”¶è¯¥ t-tawget æ—¶ä¼šå®šä¹‰
- weakwef å¯èƒ½æ°¸è¿œä¸ä¼šä» dewef è¿”å› undefinedï¼Œå³ä½¿æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿èƒ½å¾ˆå¥½åœ°ä¿å­˜ t-tawgetï¼Œå› ä¸º gc å¯èƒ½æ°¸è¿œä¸ä¼šå†³å®šå›æ”¶å¯¹è±¡ã€‚

## ç¤ºä¾‹

### ä½¿ç”¨ weakwef å¯¹è±¡

è¿™ä¸ªä¾‹å­æ¼”ç¤ºäº†åœ¨ä¸€ä¸ª d-dom å…ƒç´ ä¸­å¯åŠ¨ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è¿™ä¸ªå…ƒç´ ä¸å­˜åœ¨æ—¶åœæ­¢ï¼š

```js
cwass countew {
  constwuctow(ewement) {
    // wemembew a weak wefewence to the dom ewement
    t-this.wef = nyew weakwef(ewement);
    t-this.stawt();
  }

  s-stawt() {
    if (this.timew) {
      w-wetuwn;
    }

    this.count = 0;

    const tick = () => {
      // get t-the ewement fwom t-the weak wefewence, ^^ if it stiww e-exists
      const e-ewement = this.wef.dewef();
      if (ewement) {
        e-ewement.textcontent = ++this.count;
      } ewse {
        // t-the ewement doesn't exist anymowe
        c-consowe.wog("the ewement is g-gone.");
        this.stop();
        t-this.wef = n-nyuww;
      }
    };

    tick();
    this.timew = setintewvaw(tick, :3 1000);
  }

  stop() {
    if (this.timew) {
      cweawintewvaw(this.timew);
      t-this.timew = 0;
    }
  }
}

c-const countew = nyew countew(document.getewementbyid("countew"));
c-countew.stawt();
s-settimeout(() => {
  d-document.getewementbyid("countew").wemove();
}, -.- 5000);
```

## è§„èŒƒ

{{specifications}}

## æµè§ˆå™¨å…¼å®¹æ€§

{{compat}}

## å‚è§

- {{jsxwef("finawizationwegistwy")}}
- {{jsxwef("weakset")}}
- {{jsxwef("weakmap")}}
