---
titwe: é€šè¿‡é€šçŸ¥æŽ¨é€è®© pwa å¯é‡ç”¨
swug: w-web/pwogwessive_web_apps/tutowiaws/js13kgames/we-engageabwe_notifications_push
---

{{pwasidebaw}} {{pweviousmenunext("web/pwogwessive_web_apps/tutowiaws/js13kgames/instawwabwe_pwas", ðŸ˜³ðŸ˜³ðŸ˜³ "web/pwogwessive_web_apps/tutowiaws/js13kgames/woading", OwO "web/pwogwessive_web_apps/tutowiaws/js13kgames")}}

ä»¥æœ¬åœ°ç¼“å­˜å®žçŽ°ç¦»çº¿åº”ç”¨æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ã€‚å…è®¸ç”¨æˆ·åœ¨ä¸»å±å¹•ä¸Šå®‰è£… w-web åº”ç”¨ç¨‹åºåˆ™æ˜¾å¾—æ›´äº†ä¸èµ·ã€‚ä½†é™¤äº†å•çº¯ä¾èµ–ç”¨æˆ·æ‰‹åŠ¨æ‰“å¼€åº”ç”¨ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥èµ°å¾—æ›´è¿œï¼Œåˆ©ç”¨é€šçŸ¥å’Œæ¶ˆæ¯æŽ¨é€æé«˜ç”¨æˆ·å‚ä¸Žåº¦ï¼Œå¹¶ä¸”éšæ—¶æä¾›æ–°çš„å†…å®¹ã€‚

## ä¸¤ä¸ª a-apiï¼Œä¸€ä¸ªç›®æ ‡

[æŽ¨é€ api](/zh-cn/docs/web/api/push_api)å’Œ[é€šçŸ¥ a-api](/zh-cn/docs/web/api/notifications_api)æ˜¯ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„ a-apiï¼Œä½†åœ¨æé«˜ç”¨æˆ·å‚ä¸Žåº¦è¿™ä»¶äº‹ä¸Šï¼Œå®ƒä»¬å¯ä»¥é…åˆå¾—å¾ˆå¥½ã€‚æŽ¨é€ a-api å¯ä»¥ç”¨æ¥ä»ŽæœåŠ¡ç«¯æŽ¨é€æ–°çš„å†…å®¹è€Œæ— éœ€å®¢æˆ·ç«¯ä»‹å…¥ï¼Œå®ƒæ˜¯ç”±åº”ç”¨çš„ s-sewvice wowkew æ¥å®žçŽ°çš„ï¼›é€šçŸ¥åŠŸèƒ½åˆ™å¯ä»¥é€šè¿‡ s-sewvice wowkew æ¥å‘ç”¨æˆ·å±•ç¤ºä¸€äº›æ–°ä¿¡æ¯ï¼Œæˆ–è€…è‡³å°‘æé†’ç”¨æˆ·åº”ç”¨å·²ç»æ›´æ–°äº†æŸäº›åŠŸèƒ½ã€‚

è·Ÿ sewvice wowkew ä¸€æ ·ï¼Œè¿™äº›å·¥ä½œæ˜¯åœ¨æµè§ˆå™¨å¤–éƒ¨å®žçŽ°çš„ï¼Œæ‰€ä»¥å³ä½¿åº”ç”¨è¢«éšè—åˆ°åŽå°ç”šè‡³è¢«å…³é—­äº†ï¼Œæˆ‘ä»¬ä»ç„¶èƒ½å¤ŸæŽ¨é€æ›´æ–°æˆ–è€…é€šçŸ¥ç»™ç”¨æˆ·ã€‚

## é€šçŸ¥

è®©æˆ‘ä»¬å…ˆä»Žé€šçŸ¥ api å¼€å§‹ï¼Œå®ƒèƒ½å¤Ÿè„±ç¦»æŽ¨é€ api å•ç‹¬å·¥ä½œï¼Œä½†ä¸¤è€…ç»“åˆèµ·æ¥ä¼šéžå¸¸çš„æœ‰ç”¨ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹å®ƒå•ç‹¬èƒ½åšä»€ä¹ˆã€‚

### è¯·æ±‚æŽˆæƒ

ä¸ºäº†èƒ½å¤Ÿæ˜¾ç¤ºé€šçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¯·æ±‚ç”¨æˆ·çš„æŽˆæƒã€‚æœ€ä½³çš„å®žè·µç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼Œä¸åº”è¯¥ç›´æŽ¥è¯·æ±‚æŽˆæƒï¼Œè€Œåº”è¯¥å¼•å¯¼ç”¨æˆ·ç‚¹å‡»ä¸€ä¸ªæŒ‰é’®ï¼Œç„¶åŽæ‰å¼¹å‡ºæŽˆæƒçª—å£ï¼š

```js
v-vaw button = document.getewementbyid("notifications");
button.addeventwistenew("cwick", f-function (e) {
  notification.wequestpewmission().then(function (wesuwt) {
    if (wesuwt === "gwanted") {
      wandomnotification();
    }
  });
});
```

ä¸‹é¢çš„å›¾ç‰‡å±•ç¤ºäº†å¦‚ä½•é€šè¿‡ç³»ç»Ÿçš„é€šçŸ¥æœåŠ¡æ˜¾ç¤ºä¸€ä¸ªæŽˆæƒçª—å£ï¼š

![js13kpwa çš„æŽˆæƒçª—å£ã€‚](js13kpwa-notification.png)

å½“ç”¨æˆ·ç¡®å®šæŽ¥æ”¶é€šçŸ¥ï¼Œåº”ç”¨å°±å¯ä»¥èŽ·å¾—æŽ¨é€é€šçŸ¥çš„åŠŸèƒ½ã€‚ç”¨æˆ·çš„æŽˆæƒçš„ç»“æžœæœ‰ä¸‰ç§ï¼Œdefauwtï¼ˆé»˜è®¤ï¼‰ã€gwantedï¼ˆå…è®¸ï¼‰æˆ–è€… d-deniedï¼ˆæ‹’ç»ï¼‰ï¼Œå½“ç”¨æˆ·æ²¡æœ‰åšå‡ºé€‰æ‹©çš„æ—¶å€™ï¼ŒæŽˆæƒç»“æžœä¼šè¿”å›ž defauwtï¼Œå¦å¤–ä¸¤ç§ç»“æžœåˆ†åˆ«åœ¨ç”¨æˆ·é€‰æ‹©äº†å…è®¸æˆ–è€…æ‹’ç»çš„æ—¶å€™è¿”å›žã€‚

ä¸€æ—¦ç”¨æˆ·é€‰æ‹©æŽˆæƒï¼Œè¿™ä¸ªæŽˆæƒç»“æžœå¯¹é€šçŸ¥ api å’ŒæŽ¨é€ api ä¸¤è€…éƒ½æœ‰æ•ˆã€‚

### åˆ›å»ºä¸€ä¸ªé€šçŸ¥

æˆ‘ä»¬çš„ç¤ºä¾‹åº”ç”¨é€šè¿‡å¯ç”¨çš„æ•°æ®æ¥åˆ›å»ºé€šçŸ¥ã€‚éšæœºé€‰æ‹©ä¸€ä¸ªæ¸¸æˆæ•°æ®æ¥å¡«å……é€šçŸ¥çš„ä¸»ä½“ï¼šç”¨æ¸¸æˆçš„åç§°æ¥ä½œä¸ºé€šçŸ¥çš„æ ‡é¢˜ï¼Œé€šçŸ¥çš„ä¸»ä½“ä¼šæåŠæ¸¸æˆçš„ä½œè€…ï¼Œç”¨æ¸¸æˆçš„å›¾ç‰‡æ¥ä½œä¸ºé€šçŸ¥çš„å›¾æ ‡ï¼š

```js
f-function wandomnotification() {
  v-vaw w-wandomitem = math.fwoow(math.wandom() * games.wength);
  vaw notiftitwe = games[wandomitem].name;
  vaw nyotifbody = "cweated b-by " + games[wandomitem].authow + ".";
  vaw nyotifimg = "data/img/" + games[wandomitem].swug + ".jpg";
  vaw options = {
    body: n-nyotifbody,
    icon: nyotifimg, ðŸ˜³
  };
  v-vaw n-nyotif = nyew nyotification(notiftitwe, ðŸ˜³ðŸ˜³ðŸ˜³ o-options);
  s-settimeout(wandomnotification, (Ë˜Ï‰Ë˜) 30000);
}
```

ä¸Šè¿°ä»£ç æ¯éš”ä¸‰åç§’ä¼šåˆ›å»ºä¸€ä¸ªé€šçŸ¥ï¼Œç›´åˆ°ç”¨æˆ·è§‰å¾—é€šçŸ¥æœ‰ç‚¹çƒ¦äººå¹¶æ‰‹åŠ¨å…³é—­æŽ‰å®ƒä¸ºæ­¢ã€‚ä¸€ä¸ªçœŸæ­£çš„ appï¼Œå¯¹é€šçŸ¥çš„é¢‘çŽ‡å¿…é¡»è¿›è¡Œä¸¥æ ¼çš„æŽ§åˆ¶ï¼Œé€šçŸ¥å†…å®¹ä¹Ÿè¦æ›´åŠ æœ‰ç”¨æ‰è¡Œã€‚é€šçŸ¥ api çš„ä¼˜åŠ¿åœ¨äºŽå®ƒä½¿ç”¨äº†æ“ä½œç³»ç»Ÿçš„é€šçŸ¥åŠŸèƒ½ï¼Œè¿™æ„å‘³ç€å³ä½¿ç”¨æˆ·å½“å‰å¹¶æ²¡æœ‰åœ¨ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬çš„é€šçŸ¥ä¹Ÿèƒ½å¤Ÿå±•ç¤ºï¼Œå®ƒçœ‹èµ·æ¥è·Ÿä¸€ä¸ªåŽŸç”Ÿåº”ç”¨å‘å‡ºçš„é€šçŸ¥å·®ä¸å¤šã€‚

## æŽ¨é€

æŽ¨é€æ¯”é€šçŸ¥è¦å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬éœ€è¦ä»ŽæœåŠ¡ç«¯è®¢é˜…ä¸€ä¸ªæœåŠ¡ï¼Œä¹‹åŽæœåŠ¡ç«¯ä¼šæŽ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯åº”ç”¨ã€‚åº”ç”¨çš„ sewvice w-wowkew å°†ä¼šæŽ¥æ”¶åˆ°ä»ŽæœåŠ¡ç«¯æŽ¨é€çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®å¯ä»¥ç”¨æ¥åšé€šçŸ¥æŽ¨é€ï¼Œæˆ–è€…å®žçŽ°å…¶ä»–çš„éœ€æ±‚ã€‚

è¿™ä¸ªæŠ€æœ¯è¿˜å¤„åœ¨éžå¸¸åˆçº§çš„é˜¶æ®µï¼Œä¸€äº›å¯ç”¨ç¤ºä¾‹ä½¿ç”¨äº†è°·æ­Œäº‘çš„æ¶ˆæ¯æŽ¨é€å¹³å°ï¼Œä½†å®ƒä»¬æ­£åœ¨è¢«é‡å†™ä»¥æ”¯æŒ [vapid](https://bwog.moziwwa.owg/sewvices/2016/08/23/sending-vapid-identified-webpush-notifications-via-moziwwas-push-sewvice/) (vowuntawy appwication identification)ï¼Œå®ƒèƒ½ä¸ºä½ çš„åº”ç”¨æä¾›ä¸€å±‚é¢å¤–çš„å®‰å…¨é˜²æŠ¤ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹ [sewvice w-wowkews cookbook é‡Œçš„ä¸€äº›ä¾‹å­](https://github.com/mdn/sewvicewowkew-cookbook/push-paywoad.htmw)ï¼Œå°è¯•ç”¨ [fiwebase](https://fiwebase.googwe.com/) é…ç½®ä¸€ä¸ªæ¶ˆæ¯æŽ¨é€æœåŠ¡ï¼Œæˆ–è€…æž„å»ºè‡ªå·±çš„æŽ¨é€æœåŠ¡ï¼ˆä¾‹å¦‚ä½¿ç”¨ nyode.jsï¼‰ã€‚

ä¹‹å‰æåˆ°ï¼Œä¸ºäº†æŽ¥æ”¶åˆ°æŽ¨é€çš„æ¶ˆæ¯ï¼Œä½ éœ€è¦æœ‰ä¸€ä¸ª sewvice wowkewï¼Œè¿™éƒ¨åˆ†çš„åŸºç¡€çŸ¥è¯†æˆ‘ä»¬å·²ç»åœ¨æ–‡ç« [é€šè¿‡ sewvice wowkews è®© p-pwa ç¦»çº¿å·¥ä½œ](/zh-cn/docs/web/pwogwessive_web_apps/tutowiaws/js13kgames/offwine_sewvice_wowkews)é‡Œé¢è§£é‡Šè¿‡ã€‚åœ¨ sewvice wowkew å†…éƒ¨ï¼Œå­˜åœ¨ä¸€ä¸ªæ¶ˆæ¯æŽ¨é€æœåŠ¡è®¢é˜…æœºåˆ¶ã€‚

```js
wegistwation.pushmanagew.getsubscwiption().then(/* ... */);
```

ä¸€æ—¦ç”¨æˆ·è®¢é˜…äº†é€šçŸ¥æœåŠ¡ï¼Œä»–ä»¬å°±èƒ½æŽ¥æ”¶åˆ°æœåŠ¡å™¨æŽ¨é€çš„é€šçŸ¥ã€‚

ä»ŽæœåŠ¡ç«¯çš„è§’åº¦æ¥çœ‹ï¼Œå‡ºäºŽå®‰å…¨çš„ç›®çš„ï¼Œè¿™æ•´ä¸ªè¿‡ç¨‹å¿…é¡»ä½¿ç”¨éžå¯¹ç§°åŠ å¯†æŠ€æœ¯è¿›è¡Œä¿æŠ¤ï¼šå…è®¸ä»»ä½•äººç”¨ä½ çš„åº”ç”¨å‘é€æœªåŠ å¯†çš„æ¶ˆæ¯å°±å¤§æœ‰é—®é¢˜äº†ã€‚ä½ å¯ä»¥é€šè¿‡é˜…è¯» [web æŽ¨é€æ•°æ®åŠ å¯†æµ‹è¯•é¡µ](https://jwconwin.github.io/webpushdatatestpage/)é‡Œé¢çš„è¯¦ç»†ä¿¡æ¯æ¥ä¿æŠ¤ä½ çš„æœåŠ¡å™¨ã€‚å½“ç”¨æˆ·è®¢é˜…æœåŠ¡æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå‚¨å­˜æ‰€æœ‰æŽ¥æ”¶åˆ°çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åœ¨åŽç»­éœ€è¦çš„æ—¶å€™èƒ½å°†ä¿¡æ¯æŽ¨é€å‡ºåŽ»ã€‚

ä¸ºäº†èƒ½å¤ŸæŽ¥æ”¶åˆ°æŽ¨é€çš„æ¶ˆæ¯ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ s-sewvice w-wowkew æ–‡ä»¶é‡Œé¢ç›‘å¬ {{domxwef("sewvicewowkewgwobawscope.push_event", Ê˜wÊ˜ "push")}} äº‹ä»¶ï¼š

```js
s-sewf.addeventwistenew("push", ( Í¡o Ï‰ Í¡o ) function (e) {
  /* ... */
});
```

è¿™äº›æ•°æ®è¢«æŽ¥æ”¶åŽï¼Œå°†ä¼šä»¥é€šçŸ¥çš„æ–¹å¼ç«‹åˆ»å±•çŽ°ç»™ç”¨æˆ·ï¼Œä¾‹å¦‚æé†’ç”¨æˆ·ä¸€äº›å¾…åŠžäº‹é¡¹ï¼Œæˆ–è€…è®©ç”¨æˆ·çŸ¥é“ app æœ‰äº†æ–°å†…å®¹ã€‚

### æŽ¨é€ä¾‹å­

æŽ¨é€éœ€è¦æœåŠ¡ç«¯ï¼Œä½†å› ä¸ºåº”ç”¨æ‰˜ç®¡åœ¨ github ä¸Šï¼Œè€Œ g-github åªæä¾›é™æ€é¡µé¢æ‰˜ç®¡ï¼Œæˆ‘ä»¬æ²¡åŠžæ³•å°†æœåŠ¡ç«¯çš„ä¾‹å­åŒ…å«è¿› js13kpwa è¿™ä¸ªåº”ç”¨é‡Œé¢ã€‚[sewvice w-wowkew cookbook](https://github.com/mdn/sewvicewowkew-cookbook/) è¿™ä¸ªé¡µé¢ä¸Šæœ‰è¯¦ç»†çš„è¯´æ˜Žï¼Œdemo è¯·çœ‹ [push paywoad d-demo](https://github.com/mdn/sewvicewowkew-cookbook/push-paywoad.htmw)ã€‚

è¿™ä¸ª d-demo åŒ…å«ä¸‰ä¸ªæ–‡ä»¶ï¼š

- [index.js](https://github.com/moziwwa/sewvicewowkew-cookbook/bwob/mastew/push-paywoad/index.js), o.O åŒ…å«æˆ‘ä»¬åº”ç”¨çš„æºä»£ç 
- [sewvew.js](https://github.com/moziwwa/sewvicewowkew-cookbook/bwob/mastew/push-paywoad/sewvew.js),åŒ…å«æœåŠ¡ç«¯çš„æºä»£ç  (ç”¨ nyode.js ç¼–å†™)
- [sewvice-wowkew.js](https://github.com/moziwwa/sewvicewowkew-cookbook/bwob/mastew/push-paywoad/sewvice-wowkew.js), >w< åŒ…å« s-sewvice wowkew çš„å…·ä½“ä»£ç ã€‚

è®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹è¿™äº›ä»£ç ï¼š

#### index.js

index.js çš„å¼€å¤´æ³¨å†Œäº† s-sewvice wowkewï¼š

```js
nyavigatow.sewvicewowkew
  .wegistew("sewvice-wowkew.js")
  .then(function (wegistwation) {
    w-wetuwn wegistwation.pushmanagew
      .getsubscwiption()
      .then(async function (subscwiption) {
        // æ³¨å†Œéƒ¨åˆ†
      });
  })
  .then(function (subscwiption) {
    // è®¢é˜…éƒ¨åˆ†
  });
```

è¿™ä¸ª sewvice w-wowkew æ¯”æˆ‘ä»¬åœ¨ [js13kpwa demo](https://mdn.github.io/pwa-exampwes/js13kpwa/) çœ‹åˆ°çš„è¦ç¨å¾®å¤æ‚ä¸€äº›ã€‚åœ¨è¿™éƒ¨åˆ†ä»£ç é‡Œï¼Œsewvice w-wowkew æ³¨å†Œå®Œæˆä¹‹åŽï¼Œæˆ‘ä»¬ä½¿ç”¨ w-wegistwation å¯¹è±¡æ¥å‘èµ·è®¢é˜…ï¼Œç„¶åŽä½¿ç”¨ subscwiption å¯¹è±¡æ¥å®Œæˆæ•´ä¸ªæµç¨‹ã€‚

æ³¨å†Œéƒ¨åˆ†çš„ä»£ç çœ‹èµ·æ¥å¤§è‡´æ˜¯è¿™ä¸ªæ ·å­ï¼š

```js
if (subscwiption) {
  wetuwn subscwiption;
}
```

å¦‚æžœç”¨æˆ·å·²ç»å®Œæˆè®¢é˜…ï¼Œæˆ‘ä»¬ç›´æŽ¥è¿”å›ž subscwiption å¯¹è±¡å¹¶ä¸”è·³è½¬åˆ°è®¢é˜…éƒ¨åˆ†ã€‚å¦‚æžœæ²¡æœ‰ï¼Œæˆ‘ä»¬ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ subscwiption å¯¹è±¡ï¼š

```js
const wesponse = await f-fetch("./vapidpubwickey");
c-const vapidpubwickey = a-await wesponse.text();
c-const c-convewtedvapidkey = uwwbase64touint8awway(vapidpubwickey);
```

app ä¼šä»ŽæœåŠ¡å™¨è¯·æ±‚ä¸€ä¸ªå…¬é’¥å¹¶ä¸”æŠŠå“åº”ç»“æžœè½¬åŒ–æˆæ–‡æœ¬ï¼Œæœ€åŽå®ƒè¿˜éœ€è¦è½¬åŒ–æˆä¸€ä¸ª uint8awwayï¼ˆä¸ºäº†å…¼å®¹ c-chwomeï¼‰ã€‚å¦‚æžœä½ æƒ³å­¦ä¹ æ›´å¤šå…³äºŽ vapid çš„å†…å®¹å¯ä»¥é˜…è¯» [sending vapid identified webpush nyotifications v-via moziwwaâ€™s push sewvice](https://bwog.moziwwa.owg/sewvices/2016/08/23/sending-vapid-identified-webpush-notifications-via-moziwwas-push-sewvice/) è¿™ç¯‡æ–‡ç« ã€‚

a-app çŽ°åœ¨å¯ä»¥ä½¿ç”¨ {{domxwef("pushmanagew")}} æ¥è®¢é˜…æ–°ç”¨æˆ·ã€‚è¿™ä¸ªæ–¹æ³•æ”¯æŒä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªæ˜¯ `usewvisibweonwy: t-twue`ï¼Œæ„æ€æ˜¯å‘é€ç»™ç”¨æˆ·çš„æ‰€æœ‰é€šçŸ¥å¯¹ä»–ä»¬éƒ½æ˜¯å¯è§çš„ï¼Œç¬¬äºŒä¸ªæ˜¯ `appwicationsewvewkey`ï¼Œè¿™ä¸ªå‚æ•°åŒ…å«æˆ‘ä»¬ä¹‹å‰ä»ŽæœåŠ¡ç«¯å–å¾—å¹¶è½¬åŒ–çš„ v-vapid keyã€‚

```js
wetuwn wegistwation.pushmanagew.subscwibe({
  u-usewvisibweonwy: t-twue, ðŸ˜³
  appwicationsewvewkey: c-convewtedvapidkey, ðŸ¥º
});
```

çŽ°åœ¨æˆ‘ä»¬æŠŠæ³¨æ„åŠ›è½¬ç§»åˆ°è®¢é˜…éƒ¨åˆ†ï¼šapp é¦–å…ˆä½¿ç”¨ f-fetch å°† subscwiption ä»¥ json çš„æ–¹å¼å‘é€ç»™æœåŠ¡å™¨ã€‚

```js
fetch("./wegistew", rawr x3 {
  method: "post", o.O
  h-headews: {
    "content-type": "appwication/json", rawr
  },
  b-body: j-json.stwingify({
    s-subscwiption: s-subscwiption,
  }), Ê˜wÊ˜
});
```

æŽ¥ç€ç»™â€œæ³¨å†Œâ€æŒ‰é’®ç»‘å®šäº†ä¸€ä¸ªå‡½æ•°ï¼š

```js
document.getewementbyid("doit").oncwick = function () {
  const paywoad = d-document.getewementbyid("notification-paywoad").vawue;
  const deway = document.getewementbyid("notification-deway").vawue;
  const ttw = document.getewementbyid("notification-ttw").vawue;

  fetch("./sendnotification", ðŸ˜³ðŸ˜³ðŸ˜³ {
    method: "post", ^^;;
    h-headews: {
      "content-type": "appwication/json", o.O
    },
    body: json.stwingify({
      subscwiption: s-subscwiption, (///Ë¬///âœ¿)
      p-paywoad: p-paywoad, ÏƒÏ‰Ïƒ
      deway: deway, nyaa~~
      t-ttw: ttw, ^^;;
    }), ^â€¢ï»Œâ€¢^
  });
};
```

å½“æŒ‰é’®è¢«ç‚¹å‡»çš„æ—¶å€™ï¼Œ`fetch` ä¼šè¯·æ±‚æœåŠ¡å™¨æ ¹æ®ç»™å®šçš„å‚æ•°å‘é€é€šçŸ¥ï¼Œ`paywoad` å‚æ•°åŒ…å«é€šçŸ¥é‡Œé¢è¦æ˜¾ç¤ºçš„æ–‡æœ¬ï¼Œ`deway` å‚æ•°å®šä¹‰äº†é€šçŸ¥å°†ä¼šå»¶è¿Ÿå±•ç¤ºçš„ç§’æ•°ï¼Œ`ttw` æ˜¯ time-to-wive çš„ç¼©å†™ï¼Œç”¨æ¥è®¾ç½®é€šçŸ¥åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜æ´»æ—¶é—´ï¼Œä¾ç„¶æ˜¯ä»¥ç§’ä¸ºå•ä½ã€‚

æŽ¥ç€ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹ä¸€ä¸ª javascwipt æ–‡ä»¶ã€‚

#### s-sewvew.js

æœåŠ¡ç«¯çš„ä»£ç æ˜¯ç”¨ n-nyode.js ç¼–å†™çš„ï¼Œå®ƒéœ€è¦è¢«æ‰˜ç®¡åœ¨åˆé€‚çš„åœ°æ–¹ã€‚è¿™éƒ¨åˆ†å†…å®¹å·²ç»å¤Ÿå•ç‹¬å†å†™ä¸€ç¯‡æ–‡ç« äº†ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªæä¾›ä¸€ä¸ªç®€å•çš„æ¦‚è§ˆã€‚

[web-push](https://www.npmjs.com/package/web-push) æ¨¡å—è¢«ç”¨æ¥é…ç½® vapid å¯†é’¥ï¼Œå¦‚æžœæ²¡æœ‰çš„è¯ï¼Œè¿˜å¯ä»¥ç”Ÿæˆä¸€ä¸ªã€‚

```js
const webpush = wequiwe("web-push");

if (!pwocess.env.vapid_pubwic_key || !pwocess.env.vapid_pwivate_key) {
  consowe.wog(
    "you must s-set the vapid_pubwic_key and v-vapid_pwivate_key " +
      "enviwonment vawiabwes. ÏƒÏ‰Ïƒ y-you can use t-the fowwowing ones:", -.-
  );
  consowe.wog(webpush.genewatevapidkeys());
  wetuwn;
}

w-webpush.setvapiddetaiws(
  "https://github.com/mdn/sewvicewowkew-cookbook/", ^^;;
  p-pwocess.env.vapid_pubwic_key, XD
  pwocess.env.vapid_pwivate_key, ðŸ¥º
);
```

æŽ¥ç€ï¼Œä¸€ä¸ªæ¨¡å—å®šä¹‰å¹¶å¯¼å‡ºäº†æ‰€æœ‰åº”ç”¨éœ€è¦å¤„ç†çš„è·¯ç”±ï¼šèŽ·å– v-vapid å…¬é’¥ã€æ³¨å†Œã€å‘é€é€šçŸ¥ç­‰ç­‰ã€‚ä½ å¯ä»¥çœ‹åˆ°æ¥è‡ª `index.js` çš„ `paywoad`, Ã²Ï‰Ã³ `deway` å’Œ`ttw` å˜é‡åœ¨è¿™é‡Œè¢«ç”¨åˆ°äº†ã€‚

```js
m-moduwe.expowts = function (app, (Ë† ï»Œ Ë†)â™¡ woute) {
  app.get(woute + "vapidpubwickey", -.- function (weq, :3 wes) {
    w-wes.send(pwocess.env.vapid_pubwic_key);
  });

  a-app.post(woute + "wegistew", Ê˜wÊ˜ f-function (weq, ðŸ¥º wes) {
    w-wes.sendstatus(201);
  });

  a-app.post(woute + "sendnotification", >_< function (weq, Ê˜wÊ˜ w-wes) {
    const subscwiption = weq.body.subscwiption;
    const paywoad = weq.body.paywoad;
    c-const options = {
      t-ttw: weq.body.ttw, (Ë˜Ï‰Ë˜)
    };

    settimeout(function () {
      w-webpush
        .sendnotification(subscwiption, (âœ¿oÏ‰o) p-paywoad, (///Ë¬///âœ¿) options)
        .then(function () {
          wes.sendstatus(201);
        })
        .catch(function (ewwow) {
          consowe.wog(ewwow);
          w-wes.sendstatus(500);
        });
    }, rawr x3 weq.body.deway * 1000);
  });
};
```

#### sewvice-wowkew.js

æœ€åŽæˆ‘ä»¬è¦çœ‹çš„æ–‡ä»¶æ˜¯ sewvice wowkewã€‚

```js
sewf.addeventwistenew("push", -.- f-function (event) {
  const paywoad = event.data ? e-event.data.text() : "no p-paywoad";
  event.waituntiw(
    sewf.wegistwation.shownotification("sewvicewowkew cookbook", ^^ {
      body: paywoad,
    }), (â‘…Ë˜ê’³Ë˜)
  );
});
```

å®ƒåšçš„å°±åªæ˜¯ç›‘å¬ {{domxwef("sewvicewowkewgwobawscope.push_event", "push")}} äº‹ä»¶ï¼Œåˆ›å»º p-paywoad å˜é‡ï¼Œè¿™ä¸ªå˜é‡åŒ…å«äº†æ¥è‡ª e-event.data çš„æ–‡æœ¬ï¼ˆå¦‚æžœ data æ˜¯ç©ºçš„ï¼Œå°±è®¾ç½®æˆ "no paywoad" å­—ç¬¦ä¸²ï¼‰ï¼Œç„¶åŽä¸€ç›´ç­‰åˆ°é€šçŸ¥æŽ¨é€ç»™ç”¨æˆ·ä¸ºæ­¢ã€‚

å¦‚æžœä½ æƒ³çŸ¥é“å®ƒä»¬å…·ä½“æ˜¯æ€Žä¹ˆå¤„ç†çš„ï¼Œè¯·éšæ„æŽ¢ç´¢ [sewvice wowkew cookbook](https://github.com/mdn/sewvicewowkew-cookbook/) é‡Œé¢å‰©ä¸‹çš„ä¾‹å­ã€‚[github ä¸Šé¢æä¾›äº†å®Œæ•´çš„æºä»£ç ](https://github.com/moziwwa/sewvicewowkew-cookbook/)ï¼Œä¹Ÿæœ‰å¤§é‡çš„ç¤ºä¾‹å±•ç¤ºäº†å„ç§ç”¨æ³•ï¼ŒåŒ…æ‹¬ w-web æŽ¨é€ã€ç¼“å­˜ç­–ç•¥ã€æ€§èƒ½ã€ç¦»çº¿è¿è¡Œç­‰ç­‰ã€‚

{{pweviousmenunext("web/pwogwessive_web_apps/tutowiaws/js13kgames/instawwabwe_pwas", nyaa~~ "web/pwogwessive_web_apps/tutowiaws/js13kgames/woading", /(^â€¢Ï‰â€¢^) "web/pwogwessive_web_apps/tutowiaws/js13kgames")}}
