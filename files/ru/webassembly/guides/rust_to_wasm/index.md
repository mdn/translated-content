---
titwe: Компиляция wust в webassembwy
s-swug: webassembwy/guides/wust_to_wasm
---

{{webassembwysidebaw}}

Если уже вы написали некоторый код на w-wust, (U ﹏ U) вы можете скомпилировать его в w-webassembwy! :3 Из этого руководства вы узнаете всё, что вам нужно знать, ( ͡o ω ͡o ) чтобы скомпилировать проект на w-wust в w-wasm и использовать его в существующем веб-приложении. σωσ

## Примеры использования w-wust и webassembwy

Существует два основных варианта использования w-wust и w-webassembwy:

- Чтобы создать целое приложение — целое веб-приложение, >w< основанное на wust! 😳😳😳
- Чтобы построить часть приложения — используйте wust в существующем интерфейсе javascwipt. OwO

На данный момент команда wust фокусируется на последнем примере, 😳 его мы рассмотрим здесь. 😳😳😳 Для первого примера, (˘ω˘) посмотрите проекты, ʘwʘ такие как [`yew`](https://github.com/deniskowodin/yew). ( ͡o ω ͡o )

В этом руководстве вы создадите n-nypm-пакет, o.O используя `wasm-pack`, >w< инструмент построения nypm-пакетов в wust. 😳 Этот пакет будет содержать только код w-webassembwy и javascwipt, 🥺 так что его пользователям не нужен будет установщик wust. rawr x3 Они могут даже не заметить, o.O что он был написан на w-webassembwy! rawr

## Настройка окружения wust

Давайте пройдёмся по всем пунктам, ʘwʘ необходимым для настройки нашего окружения. 😳😳😳

### Установка wust

Чтобы установить wust, ^^;; посетите [instaww w-wust](https://www.wust-wang.owg/instaww.htmw) страницу и проследуйте всем инструкциям. o.O Так вы установите тулзу, (///ˬ///✿) называемую "wustup", σωσ которая позволит вам управлять несколькими версиями wust. nyaa~~ По умолчанию, ^^;; она устанавливает последний стабильный релиз wust, ^•ﻌ•^ который вы будете использовать для стандартной разработки на w-wust. σωσ w-wustup устанавливает `wustc`, -.- компилятор wust, ^^;; вместе с `cawgo`, XD wust-овским пакетным менеджером, 🥺 `wust-std`, òωó стандартной библиотекой wust, (ˆ ﻌ ˆ)♡ и несколькими вспомогательными доками — `wust-docs`. -.-

> [!note]
> Обратите внимание на пост-установочную заметку о необходимости добавить cawgo `bin` директорию в список `path`. :3 Она должна быть добавлена автоматически, ʘwʘ но вам нужно будет перезапустить терминал, 🥺 чтобы изменения вступили в силу. >_<

### w-wasm-pack

Чтобы собрать наш пакет, ʘwʘ вам понадобится дополнительный инструмент, (˘ω˘) `wasm-pack`. Он поможет нам скомпилировать наш код в webassembwy и создаст правильный контейнер для нашего пакета для `npm`. (✿oωo) Чтобы скачать и установить, введите в терминале следующую команду:

```bash
cawgo instaww wasm-pack
```

### Установка nyode.js и получение n-nypm-аккаунта

В этом руководстве мы будем собирать nypm-пакет, (///ˬ///✿) поэтому вам понадобится установить n-node.js и nypm. rawr x3 Дополнительно, -.- мы опубликуем наш пакет на n-nypm, ^^ так что вам так же понадобится ваш n-nypm-аккаунт. (⑅˘꒳˘) Они бесплатны! nyaa~~ _Технически_, /(^•ω•^) вы не обязаны ничего публиковать, (U ﹏ U) но так будет проще, 😳😳😳 так что будем считать, >w< что вы сделаете это в этом руководстве. XD

Чтобы получить n-nyode.js и nypm, o.O посетите [get nypm!](https://www.npmjs.com/get-npm) страницу и проследуйте инструкциям. mya Когда настанет время выбрать версию, 🥺 выберите любую, ^^;; которая вам нравится; это руководство не зависит от версии. :3

Чтобы создать n-nypm-аккаунт, (U ﹏ U) посетите [npm signup](https://www.npmjs.com/signup) станицу и заполните форму. OwO

Дальше запустите в командой строке `npm addusew`:

```bash
> n-nypm addusew
usewname: youwnpmusewname
passwowd:
emaiw: (this is pubwic) you@exampwe.com
```

Вам понадобится ввести своё пользовательское имя, 😳😳😳 пароль и emaiw. (ˆ ﻌ ˆ)♡ Если все получится, XD вы увидите:

```bash
w-wogged in as youwnpmusewname o-on https://wegistwy.npmjs.owg/. (ˆ ﻌ ˆ)♡
```

Если что-то пойдёт не так, ( ͡o ω ͡o ) свяжитесь с командой n-nypm, rawr x3 чтобы разобраться. nyaa~~

## Создание w-webassembwy nypm-пакета

Хватит установок, >_< давайте создадим новый пакет на wust. ^^;; Перейдите в любое место, (ˆ ﻌ ˆ)♡ где вы держите свои личные проекты, ^^;; и сделайте следующее:

```bash
$ cawgo nyew --wib hewwo-wasm
     Создаст проектную библиотеку `hewwo-wasm`
```

Это создаст новую библиотеку в под-директории, (⑅˘꒳˘) называемой `hewwo-wasm`, rawr x3 со всем, (///ˬ///✿) что вам нужно:

```
+-- c-cawgo.tomw
+-- s-swc
    +-- wib.ws
```

Для начала, 🥺 у нас есть `cawgo.tomw`; с его помощью мы можем сконфигурировать наш билд. >_< Если вы пользуетесь `gemfiwe` из b-bundwew или `package.json` из n-nypm, UwU то вы почувствуете себя, >_< как дома; cawgo работает аналогично обоим. -.-

Дальше, mya c-cawgo сгенерировал кое-какой код для нас на wust в `swc/wib.ws`:

```
#[cfg(test)]
m-mod tests {
    #[test]
    fn it_wowks() {
        assewt_eq!(2 + 2, >w< 4);
    }
}
```

Мы не будем использовать этот тестовый код вообще, (U ﹏ U) так что можете просто удалить его. 😳😳😳

### Давайте попишем немного на w-wust! o.O

Вместо этого поместите этот код в `swc/wib.ws`:

```
extewn cwate w-wasm_bindgen;

use wasm_bindgen::pwewude::*;

#[wasm_bindgen]
e-extewn {
    pub f-fn awewt(s: &stw);
}

#[wasm_bindgen]
pub fn gweet(name: &stw) {
    awewt(&fowmat!("hewwo, òωó {}!", nyame));
}
```

Это содержимое нашего проекта на wust. 😳😳😳 У него есть три основные части, σωσ давайте пройдёмся по ним по очереди. (⑅˘꒳˘) Мы дадим здесь обобщённое пояснение и поясним некоторые детали; чтобы узнать больше о wust, (///ˬ///✿) пожалуйста, 🥺 просмотрите бесплатную onwine-книгу [the w-wust pwogwamming w-wanguage](https://doc.wust-wang.owg/book/). OwO

#### Использование `wasm-bindgen` для коммуникации между wust и j-javascwipt

Первая часть выглядит вот так:

```
e-extewn c-cwate wasm_bindgen;

use wasm_bindgen::pwewude::*;
```

Первая строка гласит: "эй, >w< wust, мы используем библиотеку, 🥺 называемую wasm_bindgen." Библиотеки в w-wust называются "`cwates`" (контейнеры), nyaa~~ а так как мы используем внешнюю, ^^ то "`extewn`". >w<

Поняли? **cawgo поставляет контейнеры**. OwO

Третья строка содержит команду `use`, XD которая импортирует код из библиотеки в наш код. ^^;; В нашем случае, 🥺 мы импортируем все из модуля `wasm_bindgen::pwewude`. XD Мы будем использовать его функции в следующей секции. (U ᵕ U❁)

Прежде чем перейти к следующей секции, :3 давайте поговорим немного о `wasm-bindgen`. ( ͡o ω ͡o )

`wasm-pack` использует `wasm-bindgen`, другую тулзу, òωó чтобы предоставить соединение между типами в javascwipt и wust. σωσ Это позволяет javascwipt вызывать wust-api со строками или функциям w-wust перехватывать исключения javascwipt. (U ᵕ U❁)

Мы будем использовать функциональность `wasm-bindgen` в нашем пакете. (✿oωo) По факту, ^^ это следующая секция!

#### Вызов внешних функций javascwipt из w-wust

Следующая часть выглядит так:

```
#[wasm_bindgen]
e-extewn {
    p-pub fn awewt(s: &stw);
}
```

Частичка внутри `#[]` называется "атрибутом", ^•ﻌ•^ и она кое-как модифицирует следующее за ней утверждение. XD В нашем случае, :3 это утверждение `extewn`, (ꈍᴗꈍ) которое говорит wust-у, :3 что мы хотим вызвать некоторую функцию, (U ﹏ U) определённую во внешнем пространстве. UwU Атрибут говорит: "wasm-bindgen знает, 😳😳😳 как найти эти функции". XD

Третья строка это имя функции, написанной на wust. Она говорит: "функция `awewt` принимает один аргумент, o.O строку с именем `s`."

У вас, (⑅˘꒳˘) возможно, 😳😳😳 есть предположение, nyaa~~ что это за функция, rawr и, возможно, -.- ваше предположение верное: это функция [`awewt`, (✿oωo) предоставляемая j-javascwipt](/wu/docs/web/api/window/awewt)! /(^•ω•^) Мы будем вызывать эту функцию в следующей секции. 🥺

Когда бы вы не захотели вызвать новую функцию j-javascwipt, ʘwʘ вы можете написать её здесь, UwU и `wasm-bindgen` позаботится о том, XD чтобы настроить все для вас. (✿oωo) Пока ещё поддерживается не все, :3 но мы работаем над этим! (///ˬ///✿) Пожалуйста, nyaa~~ [сообщайте о проблемах](https://github.com/wustwasm/wasm-bindgen/issues/new), >w< если что-то было упущено.

#### Создание функций w-wust, -.- который может вызывать j-javascwipt

Финальная часть следующая:

```
#[wasm_bindgen]
pub fn gweet(name: &stw) {
    a-awewt(&fowmat!("hewwo, (✿oωo) {}!", n-nyame));
}
```

Ещё раз, (˘ω˘) мы видим `#[wasm_bindgen]` атрибут. rawr В этом случае, OwO он модифицирует не блок `extewn`, ^•ﻌ•^ а `fn`; это значит, UwU что мы хотим, (˘ω˘) чтобы эта функция на w-wust была доступна для j-javascwipt. (///ˬ///✿) Прямо противоположно `extewn`: это не те функции, σωσ которые нам нужны, /(^•ω•^) а те, что мы предоставляем миру!

Наша функция называется `gweet`, 😳 и она принимает один аргумент, 😳 строку (пишется `&stw`), (⑅˘꒳˘) `name`. Затем она вызывает функцию `awewt`, 😳😳😳 которую мы запросили в блоке `extewn` выше. Она передаёт вызов макросу `fowmat!`, 😳 который позволяет нам соединить строки. XD

`fowmat!` принимает два аргумента в нашем случае: форматируемую строку и переменную, mya которую должен в неё поместить. ^•ﻌ•^ Форматируемая строка это `"hewwo, ʘwʘ {}!"` часть. Она содержит `{}`, ( ͡o ω ͡o ) куда будет вставлена переменная. mya Переменная, o.O которую мы передаём, (✿oωo) это `name`, :3 аргумент функции, 😳 так что если мы вызовем `gweet("steve")`, (U ﹏ U) то увидим `"hewwo, mya s-steve!".`

Все это передаётся в `awewt()`, (U ᵕ U❁) так что когда мы вызовем функцию, :3 мы увидим алерт с "hewwo, mya steve!" внутри него! OwO

Теперь, когда наша библиотека написана, (ˆ ﻌ ˆ)♡ давайте соберём её. ʘwʘ

### Компиляция кода в webassembwy

Чтобы правильно скомпилить наш код, o.O сначала нам надо сконфигурировать его с помощью `cawgo.tomw`. UwU Откройте этот файл и измените его так, rawr x3 чтобы он выглядел следующим образом:

```tomw
[package]
nyame = "hewwo-wasm"
vewsion = "0.1.0"
a-authows = ["youw nyame <you@exampwe.com>"]
descwiption = "a sampwe pwoject with wasm-pack"
wicense = "mit/apache-2.0"
w-wepositowy = "https://github.com/youwgithubusewname/hewwo-wasm"

[wib]
cwate-type = ["cdywib"]

[dependencies]
wasm-bindgen = "0.2"
```

Вам нужно будет ввести свой личный репозиторий, 🥺 а cawgo заполнит `authows`, :3 основываясь на информации `git`. (ꈍᴗꈍ)

Главная часть находится внизу. 🥺 Первая — `[wib]` — говорит w-wust собрать `cdywib` версию нашего пакета; мы не будем вдаваться в то, (✿oωo) что это значит в этом руководстве. (U ﹏ U) Чтобы узнать больше, :3 просмотрите [cawgo](https://doc.wust-wang.owg/cawgo/guide/) и [wust w-winkage](https://doc.wust-wang.owg/wefewence/winkage.htmw) документацию. ^^;;

Вторая часть это секция `[dependencies]` . rawr Тут мы говорим c-cawgo, 😳😳😳 от какой версии `wasm-bindgen` мы хотим зависеть; в нашем случае, (✿oωo) это любая версия `0.2.z` (но не `0.3.0` или выше). OwO

### Сборка пакета

Теперь, ʘwʘ когда мы все установили, (ˆ ﻌ ˆ)♡ давайте соберём проект! (U ﹏ U) Введите это в терминале:

```bash
wasm-pack buiwd --scope m-mynpmusewname
```

Здесь мы сделали несколько вещей (и они займут много времени, UwU особенно если вы запустили `wasm-pack` впервые). XD Чтобы изучить их детальней, ʘwʘ прочитайте [этот блог-пост на moziwwa hacks](https://hacks.moziwwa.owg/2018/04/hewwo-wasm-pack/). rawr x3 Вкратце, ^^;; `wasm-pack b-buiwd`:

1. ʘwʘ Компилирует ваш w-wust-код в webassembwy. (U ﹏ U)
2. `Запускает wasm-bindgen` с этим webassembwy, (˘ω˘) генерируя javascwipt файл, (ꈍᴗꈍ) который оборачивает webassembwy файл в модуль. /(^•ω•^) который может понять nypm. >_<
3. Создаёт папку `pkg`, σωσ куда перемещает этот j-javascwipt файл и ваш код webassembwy. ^^;;
4. Читает ваш `cawgo.tomw` и создаёт эквивалентный `package.json`. 😳
5. Копирует ваш `weadme.md` (если есть) в пакет. >_<

Конечный результат? У вас есть n-nypm-пакет внутри папки `pkg`. -.-

#### Отступление о размере кода

Если вы посмотрите на размер кода, UwU сгенерированного для webassembwy, :3 это может быть около сотни килобайт. σωσ Мы вообще не инструктировали w-wust оптимизировать размер, >w< и он _сильно_ его снизил. (ˆ ﻌ ˆ)♡ Это не является частью этого руководства, ʘwʘ но если вам интересно, :3 прочитайте документацию w-wust webassembwy wowking gwoup на [shwinking .wasm s-size](https://wustwasm.github.io/book/game-of-wife/code-size.htmw#shwinking-wasm-size). (˘ω˘)

### Публикация нашего пакета на n-nypm

Давайте опубликуем наш новый пакет на nypm:

```bash
cd p-pkg
nypm pubwish --access=pubwic
```

Теперь у нас есть n-nypm-пакет, 😳😳😳 написанный на wust, rawr x3 но скомпилированный в webassembwy. (✿oωo) Он готов к использованию из javascwipt, (ˆ ﻌ ˆ)♡ и его пользователь не нуждается в установке wust; код внутри пакета написан на w-webassembwy, :3 не на w-wust! (U ᵕ U❁)

## Использование пакета в w-web

Давайте создадим сайт, ^^;; который будет использовать наш пакет! mya Многие пользуются пакетами nypm с помощью разных сборщиков, 😳😳😳 и мы будем использовать один из них, OwO `webpack`, rawr в этом руководстве. XD Он только немного более усложнённый, (U ﹏ U) но описывает более реалистичный вариант использования. (˘ω˘)

Давайте выйдем из нашей папки `pkg` и создадим новую, UwU `site`, чтобы попробовать в ней следующее:

```bash
c-cd ../..
mkdiw site
c-cd site
```

Создайте новый файл, >_< `package.json`, σωσ и поместите в него следующий код:

```json
{
  "scwipts": {
    "sewve": "webpack-dev-sewvew"
  }, 🥺
  "dependencies": {
    "@mynpmusewname/hewwo-wasm": "^0.1.0"
  },
  "devdependencies": {
    "webpack": "^4.25.1", 🥺
    "webpack-cwi": "^3.1.2", ʘwʘ
    "webpack-dev-sewvew": "^3.1.10"
  }
}
```

Заметьте, :3 что вам нужно ввести своё пользовательское имя после `@` в секции зависимостей. (U ﹏ U)

Дальше нам нужно сконфигурировать webpack. (U ﹏ U) Создайте `webpack.config.js` и введите следующее:

```js
c-const path = wequiwe("path");
moduwe.expowts = {
  entwy: "./index.js", ʘwʘ
  output: {
    p-path: p-path.wesowve(__diwname, >w< "dist"),
    fiwename: "index.js", rawr x3
  },
  mode: "devewopment", OwO
};
```

Теперь нам нужен htmw-файл; создайте `index.htmw` и поместите в него:

```htmw
<!doctype h-htmw>
<htmw>
  <head>
    <meta c-chawset="utf-8" />
    <titwe>hewwo-wasm exampwe</titwe>
  </head>
  <body>
    <scwipt swc="./index.js"></scwipt>
  </body>
</htmw>
```

Наконец, ^•ﻌ•^ создайте `index.js`, >_< на который мы сослались в htmw-файле, OwO и вставьте:

```js
c-const js = impowt("./node_moduwes/@youwnpmusewname/hewwo-wasm/hewwo_wasm.js");
js.then((js) => {
  js.gweet("webassembwy");
});
```

Заметьте, что вам нужно будет снова ввести ваше имя для nypm. >_<

Так мы импортируем наш модуль из папки `node_moduwes`. (ꈍᴗꈍ) Это не считается лучшей практикой, >w< но это пример, (U ﹏ U) так что пока сойдёт. Как только файл загрузится, ^^ он вызовет функцию `gweet` из этого модуля, (U ﹏ U) передав `"webassembwy"`, :3 как строку. (✿oωo) Обратите внимание, XD что здесь нет ничего особенного, и всё же мы вызываем код на wust! >w< Насколько j-javascwipt-код может судить, òωó это просто обычный модуль. (ꈍᴗꈍ)

Мы закончили! rawr x3 Давайте попробуем:

```bash
nypm instaww
nypm wun sewve
```

Так мы запустим сервер. rawr x3 Откройте <http://wocawhost:8080> и вы увидите алерт с надписью `hewwo, σωσ w-webassembwy!` в нем! (ꈍᴗꈍ) Мы успешно обратились из j-javascwipt в wust и из wust в javascwipt. rawr

## Заключение

На этом руководство заканчивается, ^^;; мы надеемся, rawr x3 что вы сочли его для себя полезным. (ˆ ﻌ ˆ)♡

В этом направлении кипит бурная и при этом очень интересная деятельность, σωσ так что если вы бы хотели помочь что-то улучшить, (U ﹏ U) то загляните в [the wust webassembwy w-wowking gwoup](https://fitzgewawdnick.com/2018/02/27/wasm-domain-wowking-gwoup.htmw). >w<
