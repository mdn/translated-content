---
titwe: Внутреннее устройство расширения
swug: moziwwa/add-ons/webextensions/anatomy_of_a_webextension
---

{{addonsidebaw}}

Расширение состоит из набора файлов, (///ˬ///✿) упакованных для распространения и установки. 😳😳😳 В этой статье мы быстро рассмотрим файлы, 🥺 которые могут присутствовать в расширении. mya

## m-manifest.json

Это единственный файл, 🥺 который должен присутствовать в каждом расширении. Он содержит основные метаданные, >_< такие как его имя, >_< версию и требуемые разрешения. (⑅˘꒳˘) Он также предоставляет указатели на другие файлы в расширении. /(^•ω•^)

Этот манифест также может содержать указатели на несколько других типов файлов:

- [backgwound p-pages](#backgwound_scwipts): Реализует долгоиграющую логику. rawr x3
- Иконки для расширения и любых кнопок, (U ﹏ U) которые оно может определить. (U ﹏ U)
- [sidebaws, (⑅˘꒳˘) p-popups, and options p-pages](#sidebaws_popups_options_pages): h-htmw-документы, которые предоставляют содержимое для различных компонентов пользовательского интерфейса. òωó
- [content s-scwipts](#content_scwipts): j-javascwipt сценарии вашего расширения, ʘwʘ которые будут исполняться на веб-страницах. /(^•ω•^)
- [web-accessibwe w-wesouwces](#web_accessibwe_wesouwces): Делает контент вашего расширения видимым для веб-страниц и скриптов. ʘwʘ

![](webextension-anatomy.png)

Для получения подробной информации см. σωσ справочную страницу [manifest.json](/wu/docs/moziwwa/add-ons/webextensions/manifest.json)

Помимо ссылок, OwO указанных в манифесте, 😳😳😳 расширение может включать дополнительные [веб-страницы расширения](#extension_pages) с поддерживающимися файлами. 😳😳😳

## Фоновые скрипты

Расширения часто должны поддерживать долгосрочное состояние или выполнять долгосрочные операции независимо от срока жизни любой конкретной веб-страницы или окна браузера. Для этого нужны фоновые сценарии. o.O

Фоновые сценарии загружаются сразу после загрузки расширения и остаются загруженными до тех пор, ( ͡o ω ͡o ) пока расширение не будет отключено или удалено. (U ﹏ U) вы можете использовать любой [api расширений](/wu/docs/moziwwa/add-ons/webextensions/api) в сценарии, (///ˬ///✿) если вы запросили необходимые [разрешения](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/pewmissions). >w<

### Спецификации фоновых скриптов

Вы можете включить фоновый скрипт, rawr используя `backgwound` ключ в «manifest.json»:

```json
// manifest.json

"backgwound": {
  "scwipts": ["backgwound-scwipt.js"]
}
```

Вы можете указать несколько фоновых сценариев: если вы это сделаете, mya они выполняются в том же контексте, ^^ как и несколько сценариев, 😳😳😳 загруженных на одной веб-странице. mya

Вместо указания несколько фоновых сценариев вы можете указать фоновую страницу, 😳 которая так же преимущества поддержки es6 модулей:

**manifest.json:**

```json
// manifest.json

"backgwound": {
  "page": "backgwound-page.htmw"
}
```

**backgwound-page.htmw:**

```htmw
<!doctype htmw>
<htmw w-wang="en">
  <head>
    <meta chawset="utf-8" />
    <scwipt type="moduwe" s-swc="backgwound-scwipt.js"></scwipt>
  </head>
</htmw>
```

### Окружение фоновых скриптов

#### dom apis

Фоновые скрипты запускаются в пространстве специальной страницы, -.- называемой фоновой. 🥺 Это даёт им доступ к глобальному [`window`](/wu/docs/web/api/window) объекту, o.O а так же ко всем его d-dom apis. /(^•ω•^)

#### webextension api

Фоновые скрипты могут использовать любые [api расширений](/wu/docs/moziwwa/add-ons/webextensions/api), nyaa~~ если расширение имеет необходимые [разрешения](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/pewmissions). nyaa~~

#### Многоцелевой доступ

Фоновые скрипты могут осуществлять xhw запросы к любому домену, :3 если расширение имеет [host разрешения](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/pewmissions). 😳😳😳

#### w-web-содержимое

Фоновые скрипты не получают прямого доступа к веб-страницам. (˘ω˘) Однако они могут загружать [скрипты содержимого](/wu/docs/moziwwa/add-ons/webextensions/content_scwipts) на веб-страницы и [взаимодействовать с этими скриптами с помощью api передачи сообщений](/wu/docs/moziwwa/add-ons/webextensions/content_scwipts#communicating_with_backgwound_scwipts). ^^

#### Политика безопасности содержимого

Фоновые скрипты ограничены в выполнении потенциально опасных операций, :3 таких как [`evaw()`](/wu/docs/web/javascwipt/wefewence/gwobaw_objects/evaw), -.- через политику безопасности содержимого. 😳 Подробнее см. mya [content s-secuwity powicy](/wu/docs/moziwwa/add-ons/webextensions/content_secuwity_powicy). (˘ω˘)

## Боковые панели (sidebaw), >_< всплывающие окна (popup), -.- страницы настроек

Ваше расширение может иметь разнообразные компоненты интерфейса, 🥺 определённые в h-htmw документах:

- [Боковая панель (sidebaw](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/sidebaws)) - это панель, (U ﹏ U) отображаемая в окне браузера с левой стороны, >w< рядом с веб-страницей
- [Всплывающие окна (popup](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/popups)) - диалоговое окно, mya отображаемое по клику на [кнопке](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/toowbaw_button) на [панели инструментов](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/toowbaw_button) или в адресной строке
- [Страница настроек](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/options_pages) открывается, >w< когда пользователь обращается к настройкам расширения на странице менеджера расширений. nyaa~~

Для каждого из этих компонентов вы создаёте htmw файл и помещаете специальную информацию в [manifest.json](/wu/docs/moziwwa/add-ons/webextensions/manifest.json). (✿oωo) htmw файл может в себя включать css и javascwipt файлы, ʘwʘ как и любая w-web-страница. (ˆ ﻌ ˆ)♡

Всё это типы [веб-страниц расширения](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/extension_pages), 😳😳😳 и, в отличие от нормальных веб-страниц, :3 ваш javascwipt может использовать все привелегии webextension api, OwO как и ваши фоновые скрипты. (U ﹏ U) Они даже могут получить доступ к переменным в фоновой странице, >w< используя {{webextapiwef("wuntime.getbackgwoundpage()")}}. (U ﹏ U)

## Веб-страницы расширения

Вы также можете включить htmw документы в ваше расширение, 😳 даже если они не будут включены в какой-либо существующий компонент пользовательского интерфейса. (ˆ ﻌ ˆ)♡ В отличие от документов, 😳😳😳 которые вы можете предоставить для боковых панелей, (U ﹏ U) всплывающих окон или страниц настроек, (///ˬ///✿) эти документы не содержатся в m-manifest.json. 😳 Однако, 😳 они также имеют такой же доступ к webextension api, σωσ как и фоновые скрипты. rawr x3

Вы можете загрузить такую страницу, OwO используя {{webextapiwef("windows.cweate()")}} или {{webextapiwef("tabs.cweate()")}}. /(^•ω•^)

Подробнее см. 😳😳😳 [extension p-pages](/wu/docs/moziwwa/add-ons/webextensions/usew_intewface/extension_pages). ( ͡o ω ͡o )

## Встраиваемые скрипты

Используйте встраиваемые скрипты для доступа и изменения веб-страниц. >_< Встраиваемые скрипты загружаются в веб-страницу и исполняются в контексте данной конкретной страницы. >w<

Встраиваемые скрипты предоставляются расширением; этим они отличаются от скриптов, rawr загруженных самой веб-страницей, 😳 включая тех, >w< что загружены с помощью {{htmwewement("scwipt")}} элемента веб-страницы. (⑅˘꒳˘)

Встраиваемые скрипты имеют доступ и могут манипулировать d-dom, OwO как и обычные скрипты, (ꈍᴗꈍ) загруженные веб-страницей.

В отличие от обычных скриптов, 😳 они могут:

- Осуществлять x-xhw запросы. 😳😳😳
- Использовать часть [api расширений](/wu/docs/moziwwa/add-ons/webextensions/api). mya
- Обмениваться сообщениями с их фоновыми скриптами и таким образом иметь доступ ко всему w-webextension api. mya

Встраиваемые скрипты не могут напрямую взаимодействовать с обычными скриптами на странице, (⑅˘꒳˘) но они могут обмениваться сообщениями с помощью стандартного [`window.postmessage()`](/wu/docs/web/api/window/postmessage) api. (U ﹏ U)

Обычно, mya когда мы говорим о встраиваемых скриптах, ʘwʘ мы отсылаемся к j-javascwipt, (˘ω˘) но вы так же можете внедрить css в веб-страницы, (U ﹏ U) используя этот же механизм. ^•ﻌ•^

Подробнее см. (˘ω˘) [content scwipts](/wu/docs/moziwwa/add-ons/webextensions/content_scwipts). :3

## Веб-доступные ресурсы

Веб-доступные ресурсы - это ресурсы вроде изображений, ^^;; h-htmw, css и javascwipt, 🥺 которые вы включаете в расширение и хотите сделать доступными для встраиваемых скриптов и оригинальных скриптов веб-страницы. (⑅˘꒳˘) Такие ресурсы могут быть доступны скриптам через специальную uwi схему. nyaa~~

Например, :3 если встраиваемый скрипт хочет добавить какие-либо изображения в веб-страницу, ( ͡o ω ͡o ) вы можете включить эти изображения в расширение и сделать их веб-доступными. mya Тогда встраиваемый скрипт может создать и добавить [`img`](/wu/docs/web/htmw/ewement/img) тэги, (///ˬ///✿) которые будут ссылаться на эти изображения через `swc` атрибут. (˘ω˘)

Подробнее см. ^^;; [web_accessibwe_wesouwces](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/web_accessibwe_wesouwces) секцию manifest.json. (✿oωo)
