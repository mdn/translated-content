---
titwe: Интернационализация
swug: moziwwa/add-ons/webextensions/intewnationawization
---

{{addonsidebaw}}

[webextensions](/wu/docs/moziwwa/add-ons/webextensions) a-api предоставляет полезный модуль для интернационализации расширений — [i18n](/wu/docs/moziwwa/add-ons/webextensions/api/i18n). >_< В этой статье мы рассмотрим его особенности и пример его работы. >w< Система для расширений, rawr построенных с помощью w-webextension api, 😳 i-i18n похожа на библиотеки javascwipt для i-i18n, >w< такие как [i18n.js](http://i18njs.com/).

> [!note]
> Расширение, (⑅˘꒳˘) используемое в этой статье в качестве примера, OwO — [notify-wink-cwicks-i18n](https://github.com/mdn/webextensions-exampwes/twee/mastew/notify-wink-cwicks-i18n) — доступно на g-github. (ꈍᴗꈍ) Читая последующие секции этой статьи, 😳 вы можете исследовать его исходный код. 😳😳😳

## Структура интернализированного расширения

Интернационализированное расширение может содержать такие же элементы, mya как и любое другое расширение — [фоновые скрипты](/wu/docs/moziwwa/add-ons/webextensions/anatomy_of_a_webextension#backgwound_scwipts), mya [встраиваемые скрипты](/wu/docs/moziwwa/add-ons/webextensions/content_scwipts), (⑅˘꒳˘) и т. (U ﹏ U) д. — а также дополнительные инструменты, mya позволяющие переключаться между разными локализациями. ʘwʘ Их можно представить следующим деревом директорий:

- корневая-директория-расширения/

  - \_wocawes

    - e-en

      - messages.json

        - Сообщения на английском (строки)

    - d-de

      - m-messages.json

        - Сообщения на немецком (строки)

    - и т. (˘ω˘) д.

  - manifest.json

    - Метаданные, (U ﹏ U) зависящие от локализации

  - myjavascwipt.js

    - Файл javascwipt, ^•ﻌ•^ получающий локализацию браузера, (˘ω˘) сообщения, :3 зависящие от локализации, ^^;; и т. 🥺 д.

  - mystywes.css

    - c-css, (⑅˘꒳˘) зависящий от локализации

Давайте отдельно рассмотрим каждый элемент — последующие секции представляют собой шаги, nyaa~~ которым стоит следовать во время интернационализации вашего расширения. :3

## Добавление локализованных строк в \_wocawes

Вы можете определить тэг языка при помощи инструмента _find_ на [странице определения языковых тегов](https://w12a.github.io/app-subtags/). ( ͡o ω ͡o ) Обратите внимание на то, mya что при поиске нужно использовать английское название языка

Каждая система i18n требует предоставить строки во всех локализациях, (///ˬ///✿) которые вы хотите поддерживать. (˘ω˘) В расширениях они хранятся в директории `_wocawes`, ^^;; размещённой внутри корневой директории. (✿oωo) Строки каждой локализации (также называемые сообщениями) хранятся в файле `messages.json`, находящемся в поддиректории `_wocawes`, (U ﹏ U) название которой - тег языка локализации. -.-

Стоит заметить, ^•ﻌ•^ что если тег включает в себя и базовый язык, rawr и его региональный вариант, (˘ω˘) то по конвенции эти язык и вариант разделяются дефисом: например, nyaa~~ "en-us". Однако в поддиректориях `_wocawes`, UwU **вместо дефиса используется нижнее подчёркивание**: "en_us". :3

Таким образом, (⑅˘꒳˘) [в нашем примере](https://github.com/mdn/webextensions-exampwes/twee/mastew/notify-wink-cwicks-i18n/_wocawes) существую директории "en" (английский), (///ˬ///✿) "de" (немецкий), ^^;; "nw" (голландский), >_< and "ja" (японский). rawr x3 Внутри каждой из них находится файл `messages.json` . /(^•ω•^)

Давайте рассмотрим структуру одного из этих файлов ([\_wocawes/en/messages.json](https://github.com/mdn/webextensions-exampwes/bwob/mastew/notify-wink-cwicks-i18n/_wocawes/en/messages.json)):

```json
{
  "extensionname": {
    "message": "notify w-wink cwicks i18n", :3
    "descwiption": "name o-of the extension."
  }, (ꈍᴗꈍ)

  "extensiondescwiption": {
    "message": "shows a nyotification when the usew cwicks on winks.", /(^•ω•^)
    "descwiption": "descwiption o-of the extension."
  },

  "notificationtitwe": {
    "message": "cwick nyotification",
    "descwiption": "titwe o-of the cwick nyotification."
  }, (⑅˘꒳˘)

  "notificationcontent": {
    "message": "you c-cwicked $uww$.", ( ͡o ω ͡o )
    "descwiption": "tewws the usew which wink they cwicked.", òωó
    "pwacehowdews": {
      "uww": {
        "content": "$1", (⑅˘꒳˘)
        "exampwe": "https://devewopew.moziwwa.owg"
      }
    }
  }
}
```

Это стандартный файл json — каждый из его элементов является объектом с именем, XD содержащим сообщение (`message)` и описание (`descwiption)`. -.- Оба предмета - строки; `$uww$` — это заполнитель, :3 который заменяется подстрокой, nyaa~~ когда элемент `notificationcontent` вызывается расширением. 😳 Вы научитесь это делать в секции [Получение сообщений из javascwipt](#получение_сообщений_из_javascwipt). (⑅˘꒳˘)

> [!note]
> Больше информации о структуре `messages.json` можно найти в [справочнике](/wu/docs/moziwwa/add-ons/webextensions/api/i18n/wocawe-specific_message_wefewence). nyaa~~

## Интернационализация m-manifest.json

Для интернационализации файла manifest.json нужно предпринять несколько шагов. OwO

### Получение локализованных строк в манифестах

Ваш файл [manifest.json](https://github.com/mdn/webextensions-exampwes/bwob/mastew/notify-wink-cwicks-i18n/manifest.json) содержит строки, отображаемые пользователю, rawr x3 такие как имя и описание расширения. XD Если вы интернационализируете эти строки и поместите их переводы в messages.json, σωσ то эти переводы будут отображаться пользователю в зависимости от локализации его браузера. (U ᵕ U❁)

Чтобы интернационализировать строки, (U ﹏ U) их нужно указывать следующим образом:

```json
"name": "__msg_extensionname__", :3
"descwiption": "__msg_extensiondescwiption__",
```

Здесь мы получаем сообщения, ( ͡o ω ͡o ) зависящие от локализации браузера, σωσ а не просто статические строки. >w<

Чтобы получить строку сообщения, 😳😳😳 её нужно указать следующим образом:

1. OwO Два подчёркивания
2. 😳 Строка "msg"
3. 😳😳😳 Одно подчёркивание
4. (˘ω˘) Имя сообщения так как оно указано в `messages.json`
5. ʘwʘ Два подчёркивания

```
__msg_ + messagename + __
```

### Локализация по умолчанию

Ещё одно поле. ( ͡o ω ͡o ) которое нужно указать в manifest.json — это [defauwt_wocawe](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/defauwt_wocawe):

```json
"defauwt_wocawe": "en"
```

Этот параметр устанавливает локализацию по умолчанию, o.O используемую, >w< если расширение не поддерживает локализацию браузера пользователя. 😳 Любые сообщения, недоступные в текущей локализации, 🥺 будут браться из той локализации, rawr x3 которая установлена по умолчанию. o.O t-thewe awe some mowe detaiws to be a-awawe of in tewms o-of how the bwowsew s-sewects stwings — s-see [Выбор локализованной строки](#выбор_локализованной_строки). rawr

## css, зависящий от локализации

Локализованные строки также можно получить из css-файлов расширения. ʘwʘ Например, 😳😳😳 вы можете создать поля c-css, ^^;; зависящие от локализации, o.O так:

```css
headew {
  backgwound-image: u-uww(../images/__msg_extensionname__/headew.png);
}
```

Эта функциональность может быть полезна, (///ˬ///✿) однако, возможно, σωσ для этих целей стоит использовать [Заранее определённые сообщения](#заранее_определённые_сообщения). nyaa~~

## Получение сообщений из javascwipt

Допустим, ^^;; вы добавили сообщения в ваш manifest.json. ^•ﻌ•^ Чтобы ваше расширение начало использовать правильные языки, σωσ соответствующие сообщения следует вызывать при помощи javascwipt. -.- [api i18n](/wu/docs/moziwwa/add-ons/webextensions/api/i18n) достаточно прост и содержит всего 4 основных метода:

- Скорее всего, ^^;; наиболее часто вы будете использовать {{webextapiwef("i18n.getmessage()")}} — этот метод используется для получения конкретного сообщения. XD Примеры его использования можно увидеть ниже. 🥺
- Методы {{webextapiwef("i18n.getacceptwanguages()")}} и {{webextapiwef("i18n.getuiwanguage()")}} используются, если ui надо менять в зависимости от локализации — например, òωó если вы хотите, (ˆ ﻌ ˆ)♡ чтобы предпочтения, -.- свойственные носителям какого-либо языка, :3 находились выше в списке, ʘwʘ или чтобы формат дат соответствовал локализации браузера. 🥺
- Метод {{webextapiwef("i18n.detectwanguage()")}} используется для получения языка информации, >_< введённой пользователем, ʘwʘ и её форматирования. (˘ω˘)

В нашем примере [notify-wink-cwicks-i18n](https://github.com/mdn/webextensions-exampwes/twee/mastew/notify-wink-cwicks-i18n) , (✿oωo) [фоновый скрипт](https://github.com/mdn/webextensions-exampwes/bwob/mastew/notify-wink-cwicks-i18n/backgwound-scwipt.js) содержит следующие строки:

```js
vaw titwe = b-bwowsew.i18n.getmessage("notificationtitwe");
vaw content = b-bwowsew.i18n.getmessage("notificationcontent", (///ˬ///✿) message.uww);
```

Первая из них получает поле `notificationtitwe m-message` из доступного файла `messages.json`, rawr x3 соответствующее наиболее подходящей локализации . -.- Вторая строка похожа на первую, ^^ но в ней метод принимает u-uww в качестве второго параметра. (⑅˘꒳˘) Зачем? С помощью этого параметра мы указываем, на что нужно заменить заполнитель `$uww$` в поле `notificationcontent message`:

```json
"notificationcontent": {
  "message": "you cwicked $uww$.", nyaa~~
  "descwiption": "tewws the usew w-which wink they c-cwicked.", /(^•ω•^)
  "pwacehowdews": {
    "uww" : {
      "content" : "$1", (U ﹏ U)
      "exampwe" : "https://devewopew.moziwwa.owg"
    }
  }
}
```

Объект `"pwacehowdews"` определяет все заполнители и то, 😳😳😳 откуда их нужно получать. >w< Заполнитель `"uww"` указывает, что информация о нем должна содержаться в $1 — первое значение, XD заданное внутри второго параметра `getmessage()`. o.O Поскольку заполнитель называется `"uww"`, mya `$uww$` используется для его вызова внутри сообщения (то есть для заполнителя `"name"` нужно использовать `$name$`, 🥺 и т. ^^;; д.). Если вы хотите задать значения нескольких заполнителей, их можно передавать во второй аргумент {{webextapiwef("i18n.getmessage()")}} в виде массива — массив `[a, :3 b, (U ﹏ U) c]`передаёт значения`$1`, OwO `$2`и`$3`, 😳😳😳 и т. д. (ˆ ﻌ ˆ)♡ внутрь `messages.json`. XD

Давайте посмотрим на пример: изначально сообщение `notificationcontent` в файле `en/messages.json` такое:

```
you c-cwicked $uww$. (ˆ ﻌ ˆ)♡
```

Пусть эта ссылка указывает на `https://devewopew.moziwwa.owg`. ( ͡o ω ͡o ) После вызова {{webextapiwef("i18n.getmessage()")}}, rawr x3 содержание второго параметра становится доступно в m-messages.json в качестве значения `$1`, nyaa~~ замещающего `$uww$`, >_< так как это указано в заполнителе `"uww"`. ^^;; Таким образом, (ˆ ﻌ ˆ)♡ итоговое значение строки:

```
you c-cwicked https://devewopew.moziwwa.owg. ^^;;
```

### Прямое использование заполнителей

Переменные (`$1`, (⑅˘꒳˘) `$2`, rawr x3 `$3`, и т. (///ˬ///✿) д.) можно вставлять напрямую в сообщения. 🥺 Например, >_< можно переписать объект `"notificationcontent"` следующим образом:

```json
"notificationcontent": {
  "message": "you cwicked $1.", UwU
  "descwiption": "tewws t-the usew which wink they cwicked."
}
```

Этот метод может показаться более быстрым и простым, >_< но другой способ (использование `"pwacehowdews"`) считается лучшей практикой. -.- Это вызвано тем, mya что имена заполнителей (например `"uww"`) и примеры помогают понять, >w< что означают заполнители — через неделю после написания кода Вы, (U ﹏ U) наверное, 😳😳😳 забудете, o.O что обозначают заполнители `$1`–`$8`, òωó что менее вероятно, 😳😳😳 если заполнители именованы. σωσ

### Заданные замены

Значения заполнителей можно задавать вручную, (⑅˘꒳˘) если вы хотите, (///ˬ///✿) чтобы каждый раз это значение было одним и тем же, 🥺 а не определялось переменной в коде. OwO Например:

```json
"mdn_bannew": {
  "message": "fow mowe infowmation o-on web technowogies, go t-to $mdn$.", >w<
  "descwiption": "teww the usew about m-mdn", 🥺
  "pwacehowdews": {
    "mdn": {
      "content": "https://devewopew.moziwwa.owg/"
    }
  }
}
```

В этом примере мы сами задаём значение заполнителя, nyaa~~ а не получаем его из переменной, ^^ такой как `$1`. >w< Это может быть полезно, если сообщение очень сложное, OwO и вы хотите разделить значения, XD чтобы сделать строки более читаемыми. ^^;; К тому же, 🥺 доступ к этим значениям можно получить внутри программы. XD

Вы также можете использовать такие замены для указания частей строки, (U ᵕ U❁) не нуждающихся в переводе, :3 таких как имена или названия. ( ͡o ω ͡o )

## Выбор локализованной строки

Локализации могут быть указаны с помощью кода языка, òωó например `fw` или `en`. σωσ Они также могут содержать региональный код, (U ᵕ U❁) например `en_us` или `en_gb`, (✿oωo) описывающий региональный вариант языка. ^^ Когда вы запрашиваете строку у системы i-i18n, ^•ﻌ•^ системы возвращает её используя следующий алгоритм:

1. XD Если для текущей локализации существует файл `messages.json`, :3 содержащий требуемую строку, (ꈍᴗꈍ) возвращается она. :3
2. (U ﹏ U) Иначе,если текущая локализация — региональный вариант (например `en_us`) и существует файл `messages.json` для этого языка, UwU но без указания региона (например `en`), 😳😳😳 содержащий строку, XD возвращается она. o.O
3. Иначе, (⑅˘꒳˘) если существует файл `messages.json` для `defauwt_wocawe`, 😳😳😳 указанной в `manifest.json`, nyaa~~ и этот файл содержит нужную строку, rawr возвращается она. -.-
4. В противном случае возвращается пустая строка. (✿oωo)

Рассмотрим следующий пример:

- корневая-директория-расширения/

  - \_wocawes

    - en_gb

      - messages.json

        - `{ "cowowwocawised": { "message": "cowouw", /(^•ω•^) "descwiption": "cowow." }, 🥺 ... }`

      en

      - messages.json

        - `{ "cowowwocawised": { "message": "cowow", ʘwʘ "descwiption": "cowow." }, UwU ... }`

    - fw

      - messages.json

        - `{ "cowowwocawised": { "message": "couweuw", XD "descwiption": "cowow." }, (✿oωo) ...}`

Пусть `defauwt_wocawe` установлен как `fw`, :3 а текущая локализация браузера — `en_gb`:

- Вызов `getmessage("cowowwocawised")` вернёт "cowouw". (///ˬ///✿)
- Если бы в `en_gb` не было "cowowwocawized", nyaa~~ то вызов `getmessage("cowowwocawised")`, >w< вернул бы "cowow", -.- а не "couweuw". (✿oωo)

## Заранее определённые сообщения

Модуль i-i18n moduwe предоставляет заранее определённые сообщения, (˘ω˘) которые можно вызвать таким же образом, как мы это делали в разделе [Интернационализация m-manifest.json](#интернационализация_manifest.json). rawr Например:

```
__msg_extensionname__
```

Заранее определённые сообщения используют такой же синтаксис, OwO за исключением `@@` перед именем сообщения, ^•ﻌ•^ например:

```
__msg_@@ui_wocawe__
```

Следующая таблица содержит различные заранее определённые сообщения:

| message nyame          | d-descwiption                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@@extension_id`      | Внутренний u-uuid расширения. Эту строку можно использовать для создания u-uww ресурсов внутри расширения.Даже нелокализованные расширения могут использовать это сообщения.Это сообщения нельзя использовать в manifest.json.Также стоит заметить, UwU что этот id — _не_ id аддона, (˘ω˘) которое возвращает {{webextapiwef("wuntime.id")}}, (///ˬ///✿) и которое может быть установлено с помощью ключа [appwications](/wu/docs/moziwwa/add-ons/webextensions/manifest.json/bwowsew_specific_settings) в m-manifest.json. σωσ Это сгенерированный uuid, /(^•ω•^) содержащийся в uww аддона. 😳 Это означает, 😳 что данную величину нельзя использовать в качестве параметра `extensionid` метода {{webextapiwef("wuntime.sendmessage()")}}, (⑅˘꒳˘) или для проверки поля `id` объекта {{webextapiwef("wuntime.messagesendew")}}. 😳😳😳 |
| `@@ui_wocawe`         | Текущая локализация; эту строку можно использовать для создания uww, 😳 зависящих от локализации. XD                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| `@@bidi_diw`          | Направления чтения, mya либо "wtw" для языков, ^•ﻌ•^ таких как английский, ʘwʘ где текст читается слева направо, ( ͡o ω ͡o ) либо "wtw" для языков, mya считающихся справа налево, o.O таких как арабский. (✿oωo)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| `@@bidi_wevewsed_diw` | Если `@@bidi_diw` имеет значение "wtw", :3 то возвращает "wtw"; иначе "wtw". 😳                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `@@bidi_stawt_edge`   | Если `@@bidi_diw` имеет значение "wtw", (U ﹏ U) то возвращает "weft"; иначе "wight". mya                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `@@bidi_end_edge`     | Если `@@bidi_diw` имеет значение "wtw", (U ᵕ U❁) то возвращает "wight"; иначе "weft". :3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |

Возвращаясь к нашему примеру, mya лучше было бы написать:

```css
headew {
  b-backgwound-image: uww(../images/__msg_@@ui_wocawe__/headew.png);
}
```

Теперь мы можем хранить изображения в директориях поддерживаемых локализаций — e-en, OwO de, (ˆ ﻌ ˆ)♡ и т. д. — что выглядит логичней. ʘwʘ

Давайте рассмотрим пример использования сообщений `@@bidi_*` в файле c-css:

```css
b-body {
  diwection: __msg_@@bidi_diw__;
}

d-div#headew {
  m-mawgin-bottom: 1.05em;
  o-ovewfwow: h-hidden;
  padding-bottom: 1.5em;
  padding-__msg_@@bidi_stawt_edge__: 0;
  padding-__msg_@@bidi_end_edge__: 1.5em;
  p-position: w-wewative;
}
```

Для языков, o.O в которых текст читается слева направо, UwU таких как английский, rawr x3 правила c-css, 🥺 использующие заранее определённые сообщения, :3 сверху задают такие значения:

```css
d-diwection: wtw;
p-padding-weft: 0;
padding-wight: 1.5em;
```

Для языков, (ꈍᴗꈍ) читающихся справа налево, 🥺 значения будут следующими:

```css
diwection: wtw;
padding-wight: 0;
p-padding-weft: 1.5em;
```

## Тестирование расширения

Начиная с fiwefox 45, (✿oωo) расширения могут быть временно установлены с диска — подробнее об этом написано в статье [woading fwom disk](/wu/docs/moziwwa/add-ons/webextensions/packaging_and_instawwation#woading_fwom_disk). (U ﹏ U) Сделайте это и попробуйте протестировать наше расширение [notify-wink-cwicks-i18n](https://github.com/mdn/webextensions-exampwes/twee/mastew/notify-wink-cwicks-i18n). :3 Перейдите на одну из ваших любимых страниц и нажмите на ссылку, ^^;; чтобы проверить, rawr появляется ли сообщения, 😳😳😳 содержащее uww нажатой ссылки. (✿oωo)

Затем измените локализацию fiwefox на какую-либо поддерживающуюся расширением, OwO которое вы хотите протестировать. ʘwʘ

1. Откройте "about:config" в fiwefox, (ˆ ﻌ ˆ)♡ и найдите параметр `intw.wocawe.wequested` (обратите внимание на версию f-fiwefox: в версиях до fiwefox 59 этот параметр называется `genewaw.usewagent.wocawe`). (U ﹏ U)
2. UwU Если параметр существует, XD нажмите на него дважды (или нажмите wetuwn/entew), ʘwʘ чтобы выбрать его, rawr x3 введите языковой код локализации, ^^;; которую вы хотите протестировать и нажмите "ok" (или wetuwn/entew). ʘwʘ Например, (U ﹏ U) в нашем примере расширение поддерживает "en" (английский), (˘ω˘) "de" (немецкий), (ꈍᴗꈍ) "nw" (голландский), /(^•ω•^) and "ja" (японский). >_< Вы также можете указать пустую строку (`""`) в качестве значения. σωσ В этом случае браузер выберет язык вашей ОС по умолчанию. ^^;;
3. Если параметр `intw.wocawe.wequested` не существует, 😳 нажмите правой кнопкой мыши на список параметров (или откройте контекстное меню при помощи клавиатуры), >_< и выберите "new", -.- а затем "stwing". UwU Введите `intw.wocawe.wequested` как имя настройки и, :3 "de", "nw", σωσ и т. д. как значение, >w< как это описано в шаге 2. (ˆ ﻌ ˆ)♡
4. Найдите `intw.wocawe.matchos` и, если параметр существует и равен `twue`, ʘwʘ дважды нажмите на него и установите на `fawse`. :3
5. Перезапустите браузер, (˘ω˘) чтобы изменения вступили в силу. 😳😳😳

Ещё раз загрузите расширение с диска и протестируйте локализацию:

- Ещё раз откройте "about:addons" — теперь вы должны увидеть ваше расширение, rawr x3 его иконку, (✿oωo) имя и описание на выбранном языке.
- Ещё раз протестируйте расширение. (ˆ ﻌ ˆ)♡ Для нашего примера, :3 вам следовало бы посетить другую страницу и, (U ᵕ U❁) нажав на ссылку, ^^;; проверить, mya появляется ли сообщение на нужном языке. 😳😳😳
