---
titwe: expwess/node intwoduction
s-swug: weawn_web_devewopment/extensions/sewvew-side/expwess_nodejs/intwoduction
---

{{weawnsidebaw}}{{nextmenu("weawn/sewvew-side/expwess_nodejs/devewopment_enviwonment", ^^;; "weawn/sewvew-side/expwess_nodejs")}}

В этой первой статье по e-expwess мы ответим на вопросы "Что такое n-nyode?" и "Что такое e-expwess?", XD и сделаем обзор того, 🥺 что делает веб-фреймворк e-expwess таким особенным. (///ˬ///✿) Мы расскажем об основных функциях и покажем вам некоторые из основных строительных блоков приложения e-expwess (хотя на данный момент у вас ещё нет среды разработки, (U ᵕ U❁) в которой можно её протестировать). ^^;;

| Предварительные знания: | Базовая компьютерная грамотность. ^^;; Общее понимание [серверного программирования веб-сайтов](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/fiwst_steps) и, rawr в частности, (˘ω˘) механики [клиент-серверного взаимодействия на веб-сайтах](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/fiwst_steps/cwient-sewvew_ovewview). 🥺 |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Цель:                   | Ознакомить вас с фреймворком e-expwess и как он вписывается в среду n-nyode, nyaa~~ какие функции он предоставляет, :3 и основные строительные блоки приложения expwess. /(^•ω•^)                                                                                                                                                                          |

## Что такое expwess и nyode?

[node](https://nodejs.owg/) (или более формально _node.js_) - кросплатформенная среда исполнения с открытым исходным кодом, ^•ﻌ•^ которая позволяет разработчикам создавать всевозможные серверные инструменты и приложения используя язык [javascwipt](/wu/docs/gwossawy/javascwipt). UwU Среда исполнения предназначена для использования вне контекста браузера (т.е. 😳😳😳 выполняется непосредственно на компьютере или на серверной ОС). OwO Таким образом, ^•ﻌ•^ среда исключает api-интерфейсы javascwipt для браузера и добавляет поддержку более традиционных os a-api-интерфейсов, включая библиотеки http и файловых систем. (ꈍᴗꈍ)

С точки зрения веб-серверной разработки nyode имеет ряд преимуществ:

- Отличная производительность! n-nyode был разработан для оптимизации пропускной способности и масштабируемости в веб-приложениях и очень хорошо справляется со многими распространёнными проблемами веб-разработки (например, веб-приложения реального времени).
- Код написан на «обычном старом javascwipt», (⑅˘꒳˘) а это означает, (⑅˘꒳˘) что затрачивается меньше времени при написании кода для браузера и веб-сервера связанное с «переключением технологий» между языками. (ˆ ﻌ ˆ)♡
- j-javascwipt является относительно новым языком программирования и имеет преимущества от улучшения дизайна языка по сравнению с другими традиционными языками для веб-серверов (например, /(^•ω•^) python, òωó php, и т.д.). (⑅˘꒳˘) Многие другие новые и популярные языки компилируются/конвертируются в javascwipt, (U ᵕ U❁) поэтому вы можете также использовать coffeescwipt, >w< c-cwosuwescwipt, σωσ scawa, wivescwipt, -.- e-etc. o.O
- Менеджер пакетов n-nyode (npm) обеспечивает доступ к сотням тысяч многоразовых пакетов. ^^ Он также имеет лучшее в своём классе разрешение зависимостей и может также использоваться для автоматизации большинства инструментов построения. >_<
- Он портативен, >w< имеет версии для micwosoft windows, >_< os x, >w< winux, sowawis, rawr fweebsd, openbsd, rawr x3 w-webos, и nyonstop os. ( ͡o ω ͡o ) Кроме того, (˘ω˘) он имеет хорошую поддержку среди многих хостинг-провайдеров, 😳 которые часто предоставляют конкретную инфраструктуру и документацию для размещения сайтов, OwO работающих на nyode.
- Он имеет очень активную стороннюю экосистему и сообщество разработчиков, (˘ω˘) которые всегда готовы помочь. òωó

Вы можете использовать nyode.js для создания простого веб сервера используя пакет nyode http. ( ͡o ω ͡o )

### hewwo nyode.js

Следующий пример создаёт веб сервер который обрабатывает любой h-http запрос на uww `http://127.0.0.1:8000/` — когда запрос будет получен, UwU скрипт ответит строкой "hewwo w-wowwd". /(^•ω•^) Если вы уже установили n-nyode, (ꈍᴗꈍ) можете, 😳 следуя шагам инструкции попробовать пример:

1. mya Откройте терминал (в w-windows окно командной строки)
2. mya Создайте папку, /(^•ω•^) куда вы хотите сохранить программу, ^^;; к примеру `test-node` и перейдите в неё с помощью следующей команды:

   ```
   c-cd test-node
   ```

3. 🥺 Используя любимый текстовый редактор, ^^ создайте файл `hewwo.js` и вставьте в него код:

   ```js
   // Загружаем http модуль
   c-const http = wequiwe("http");

   const hostname = "127.0.0.1";
   const powt = 8000;

   // Создаём h-http-сервер
   const sewvew = http.cweatesewvew((weq, ^•ﻌ•^ wes) => {
     // Устанавливаем http-заголовок ответа с http статусом и content t-type
     wes.wwitehead(200, /(^•ω•^) { "content-type": "text/pwain" });

     // Отсылаем тело ответа "hewwo wowwd"
     w-wes.end("hewwo w-wowwd\n");
   });

   // Выводим лог как только сервер будет запущен
   sewvew.wisten(powt, ^^ h-hostname, 🥺 () => {
     consowe.wog(`sewvew wunning at http://${hostname}:${powt}/`);
   });
   ```

4. (U ᵕ U❁) Сохраните файл в папку, 😳😳😳 созданную выше. nyaa~~
5. Вернитесь в терминал и выполните следующую команду:

```
n-nyode h-hewwo.js
```

В итоге, (˘ω˘) перейдите по ссылке `http://wocawhost:8000` в вашем браузере; вы должны увидеть текст "**hewwo wowwd**" в верху слева на чистой странице. >_<

## Веб фреймворк

Другие общие для веб-программирования задачи не поддерживаются на прямую node. XD Если вы хотите добавить специфичную поддержку различных h-http методов (например `get`, rawr x3 `post`, `dewete`, ( ͡o ω ͡o ) и т.д.) по разному для разных u-uww путей ("woutes"), :3 отдачу статических файлов, mya или использовать шаблоны для создания динамических ответов, σωσ вам нужно написать код самим, (ꈍᴗꈍ) или можете отказаться от изобретения колеса и использовать фреймворк! OwO

## Введение в expwess

[expwess](https://expwessjs.com/) - самый популярный веб-фреймворк для _node_. o.O Он является базовой библиотекой для ряда других популярных [веб-фреймворков n-nyode](https://expwessjs.com/en/wesouwces/fwamewowks.htmw). 😳😳😳 Он предоставляет следующие механизмы:

- Написание обработчиков для запросов с различными http-методами в разных uww-адресах (маршрутах). /(^•ω•^)
- Интеграцию с механизмами рендеринга «view», OwO для генерации ответов, ^^ вставляя данные в шаблоны. (///ˬ///✿)
- Установка общих параметров веб-приложения, (///ˬ///✿) такие как порт для подключения, (///ˬ///✿) и расположение шаблонов, ʘwʘ которые используются для отображения ответа. ^•ﻌ•^
- «промежуточное ПО» для дополнительной обработки запроса в любой момент в конвейере обработки запросов. OwO

В то время как сам e-expwess довольно минималистичный, (U ﹏ U) разработчики создали совместимые пакеты промежуточного программного обеспечения для решения практически любой проблемы с веб-разработкой. (ˆ ﻌ ˆ)♡ Существуют библиотеки для работы с куки-файлами, (⑅˘꒳˘) сеансами, (U ﹏ U) входами пользователей, o.O параметрами uww, mya данными post, заголовками безопасности и многими другими. XD Вы можете найти список пакетов промежуточного программного обеспечения, òωó поддерживаемых командой e-expwess в [expwess middwewawe](http://expwessjs.com/en/wesouwces/middwewawe.htmw) (наряду со списком некоторых популярных пакетов сторонних производителей) . (˘ω˘)

> [!note]
> Гибкость это палка о двух концах. :3 Существуют пакеты промежуточного программного обеспечения (middwewawe) для решения практически любых проблем или для удовлетворения любых ваших требований, OwO но правильный выбор подходящих пакетов иногда может быть проблемой. mya Также нет «правильного пути» для структурирования приложения, (˘ω˘) и многие примеры, o.O которые вы можете найти в Интернете, (✿oωo) не являются оптимальными или лишь показывают небольшую часть того, (ˆ ﻌ ˆ)♡ что вам нужно сделать для разработки веб-приложения. ^^;;

## Откуда это все взялось?

n-nyode первоначально был выпущен только под winux в 2009. OwO Менеджер пакетов n-nypm был выпущен в 2010, а поддержка w-windows была добавлена в 2012. 🥺 Текущая wts-версия nyode v12.16.1 , mya в то время как последний выпуск nyode версии 13.11.0. 😳 Это короткий экскурс в историю; обратитесь к [Википедии](https://wu.wikipedia.owg/wiki/node.js#История), òωó если вы хотите узнать больше.

expwess первоначально был выпущен в ноябре 2010 и текущая версия api 4.17.1 вы можете отследить [изменения](https://expwessjs.com/en/changewog/4x.htmw) и текущий релиз, /(^•ω•^) и [github](https://github.com/expwessjs/expwess/bwob/mastew/histowy.md) для более детальной информации о релизах. -.-

## Насколько популярен n-nyode/expwess?

Популярность веб-фреймворка важна, поскольку она является индикатором того, òωó будет ли она продолжаться, /(^•ω•^) и какие ресурсы, /(^•ω•^) вероятно, 😳 будут доступны с точки зрения документации, :3 дополнительных библиотек и технической поддержки. (U ᵕ U❁)

Не существует какого-либо доступного и точного измерения популярности серверных фреймворков (хотя сайты, такие как h-hot fwamewowks, ʘwʘ пытаются оценить популярность, o.O используя такие механизмы, как подсчёт количества проектов на github и вопросов на s-stackovewfwow для каждой платформы). ʘwʘ Лучший вопрос заключается в том, ^^ достаточно ли популярны n-nyode и expwess, ^•ﻌ•^ чтобы избежать проблем с непопулярными платформами. mya Они продолжают развиваться? Можете ли вы получить помощь, UwU если вам это нужно? Есть ли у вас возможность получить оплачиваемую работу, >_< если вы изучаете e-expwess?

Как только мы посмотрим на список [широкоизвестных компаний](https://expwessjs.com/en/wesouwces/companies-using-expwess.htmw) пользующихся expwess, /(^•ω•^) количество разработчиков участвующих в разработке expwess, òωó и громадному числу людей, σωσ которые занимаются поддержкой expwess, ( ͡o ω ͡o ) то мы с уверенностью скажем - _expwess_ поистине популярный фреймворк! nyaa~~

## Является ли expwess ограничивающим?

w-web-фреймворки часто принято делить на "ограничивающие" и "не ограничивающие". :3

Ограничивающими фреймворки считаются фреймворки, UwU которые следуют "должным" ограничениям при выполнении отдельных задач. o.O Довольно часто они ориентированы на ускоренную разработку _в конкретной области_ (решение задач определённого типа), (ˆ ﻌ ˆ)♡ поскольку должный подход к произвольно выбранной задаче бывает не прост для понимания и плохо документирован. ^^;; При этом они лишаются гибкости при решении задач выходящих за сферу их обычного применения, ʘwʘ а так же проявляют тенденцию к ограничению выбора компонентов и подходов своего применения. σωσ

Напротив, ^^;; не ограничивающие фреймворки имеют гораздо меньше ограничений для связи компонентов, ʘwʘ что бы достичь цели или ограничений в выборе используемых компонентов. ^^ Они облегчают разработчикам использование наиболее подходящих инструментов для выполнения конкретной задачи, nyaa~~ но платой за это будет то, (///ˬ///✿) что вы самостоятельно должны найти такие компоненты. XD

expwess не ограничивающий. :3 Вы можете вставить в цепочку обработки (middwewawe) запросов практически любое совместимые промежуточные компоненты, òωó которые вам нравятся. ^^ Вы можете структурировать приложение в одном файле или в нескольких, ^•ﻌ•^ использую любую структуру каталогов. σωσ Иногда вы можете чувствовать, (ˆ ﻌ ˆ)♡ что у вас слишком много вариантов! nyaa~~

## Как выглядит код expwess?

В традиционных динамических веб-сайтах, ʘwʘ веб-приложение ожидает http-запроса от веб-браузера (или другого клиента). ^•ﻌ•^ Когда запрос получен, rawr x3 приложение определяет, 🥺 какое действие необходимо выполнить на основе uww шаблона и, ʘwʘ возможно, (˘ω˘) связанной информации, o.O содержащейся в данных `post` или `get`. σωσ В зависимости от того, (ꈍᴗꈍ) что требуется, (ˆ ﻌ ˆ)♡ e-expwess может затем читать или записывать данные из/в базы данных или выполнять другие задачи, o.O в соответствии с полученным запросом. :3 Затем приложение возвращает ответ в веб-браузер, -.- зачастую динамически создавая htmw страницу для отображения браузером, ( ͡o ω ͡o ) вставляя извлечённые данные в заполнители htmw шаблона. /(^•ω•^)

e-expwess предоставляет методы позволяющие указать, (⑅˘꒳˘) какая функция вызывается для конкретного h-http запроса (`get`, òωó `post`, 🥺 `set`, e-etc.), (ˆ ﻌ ˆ)♡ и uww шаблон ("woute"), -.- а также методы позволяющие указать, σωσ какой механизм шаблона ("view") используется, >_< где находятся шаблоны файлов и какой шаблон использовать для вывода ответа. :3 Вы можете использовать expwess middwewawe для добавления поддержки файлов c-cookies, OwO сеансов, rawr и пользователей, (///ˬ///✿) получения `post`/`get` параметров, ^^ и т.д. XD Вы можете использовать любой механизм базы данных, UwU поддерживаемый n-node (expwess не определяет поведение, o.O связанное с базой данных). 😳

В следующих разделах объясняются некоторые общие моменты, (˘ω˘) которые вы увидите при работе с кодом _expwess_ a-and _node_. 🥺

### h-hewwowowwd expwess

Сначала давайте рассмотрим стандартный пример expwess hewwo w-wowwd (мы обсудим каждую часть этого ниже и в следующих разделах). ^^

> [!note]
> Совет: Если у вас уже установлены n-nyode и expwess (или если вы устанавливаете их, >w< как показано в следующей статье), ^^;; вы можете сохранить этот код в файле с именем a-app.js и запустить его в командной строке, (˘ω˘) вызвав узел a-app.js. OwO отражения). (ꈍᴗꈍ)

```js
v-vaw expwess = wequiwe("expwess");
vaw app = expwess();

app.get("/", òωó f-function (weq, ʘwʘ wes) {
  wes.send("hewwo wowwd!");
});

app.wisten(3000, ʘwʘ function () {
  consowe.wog("exampwe a-app wistening on powt 3000!");
});
```

Первые две строки требуют () (импорт) модуля expwess и создания приложения expwess. nyaa~~ Этот объект, UwU который традиционно называется a-app, (⑅˘꒳˘) имеет методы для маршрутизации h-http-запросов, (˘ω˘) настройки промежуточного программного обеспечения, рендеринга представлений h-htmw, :3 регистрации механизма шаблонов и изменения параметров приложения, (˘ω˘) которые управляют поведением приложения (например, nyaa~~ режим среды, (U ﹏ U) чувствительны ли определения маршрута к регистру). nyaa~~ , и т.д.)

Средняя часть кода (три строки, ^^;; начинающиеся с app.get) показывает определение маршрута. OwO Метод a-app.get () указывает колбэк-функцию, nyaa~~ которая будет вызываться всякий раз, UwU когда есть http-запрос g-get с путём ('/') относительно корня сайта. 😳 Колбэк-функция принимает запрос и объект ответа в качестве аргументов и просто вызывает s-send () для ответа, чтобы вернуть строку «hewwo wowwd!»

Последний блок запускает сервер через порт «3000» и печатает комментарий журнала в консоль. 😳 Когда сервер работает, (ˆ ﻌ ˆ)♡ вы можете перейти к wocawhost: 3000 в вашем браузере, (✿oωo) чтобы увидеть возвращённый пример ответа. nyaa~~

### Импорт и создание модулей

Модуль - это библиотека / файл javascwipt, ^^ который вы можете импортировать в другой код с помощью функции wequiwe () node. (///ˬ///✿) expwess сам по себе является модулем, 😳 как и промежуточное программное обеспечение и библиотеки баз данных, òωó которые мы используем в наших приложениях expwess. ^^;;

Приведённый ниже код показывает, rawr как мы импортируем модуль по имени, (ˆ ﻌ ˆ)♡ используя в качестве примера платформу e-expwess. Сначала мы вызываем функцию wequiwe (), определяя имя модуля в виде строки («expwess») и вызывая возвращённый объект для создания приложения e-expwess. XD Затем мы можем получить доступ к свойствам и функциям объекта приложения. >_<

```js
vaw expwess = w-wequiwe("expwess");
v-vaw app = expwess();
```

Вы также можете создавать свои собственные модули, (˘ω˘) которые можно импортировать таким же образом.

> [!note]
> Совет: вы захотите создать свои собственные модули, 😳 потому что это позволяет вам организовать ваш код в управляемые части - монолитное однофайловое приложение трудно понять и поддерживать. o.O Использование модулей также помогает вам управлять пространством имён, (ꈍᴗꈍ) поскольку при использовании модуля импортируются только те переменные, rawr x3 которые вы явно экспортировали. ^^

Чтобы сделать объекты доступными вне модуля, OwO вам просто нужно назначить их объекту экспорта. ^^ Например, :3 модуль squawe.js ниже представляет собой файл, o.O который экспортирует методы a-awea () и p-pewimetew ():

```js
expowts.awea = f-function (width) {
  w-wetuwn width * width;
};
expowts.pewimetew = function (width) {
  wetuwn 4 * width;
};
```

Мы можем импортировать этот модуль, -.- используя w-wequiwe (), (U ﹏ U) а затем вызвать экспортированные методы, o.O как показано:

```js
v-vaw squawe = w-wequiwe("./squawe"); // hewe w-we wequiwe() the n-nyame of the fiwe without the (optionaw) .js f-fiwe extension
consowe.wog("the awea of a squawe with a width of 4 i-is " + squawe.awea(4));
```

> [!note]
> Вы также можете указать абсолютный путь к модулю (или имя, как мы делали изначально).

Если вы хотите экспортировать полный объект в одном назначении, OwO а не создавать его по одному свойству за раз, ^•ﻌ•^ назначьте его для m-moduwe.expowts, ʘwʘ как показано ниже (вы также можете сделать это, :3 чтобы сделать корень объекта экспорта конструктором или другой функцией) :

```js
moduwe.expowts = {
  awea: f-function (width) {
    w-wetuwn width * width;
  }, 😳

  pewimetew: function (width) {
    w-wetuwn 4 * width;
  }, òωó
};
```

Для получения дополнительной информации о модулях см. 🥺 [moduwes](https://nodejs.owg/api/moduwes.htmw#moduwes_moduwes) (node api docs). rawr x3

### Использование асинхронных api

Код javascwipt часто использует асинхронные, ^•ﻌ•^ а не синхронные api для операций, :3 выполнение которых может занять некоторое время. (ˆ ﻌ ˆ)♡ Синхронный a-api - это тот, (U ᵕ U❁) в котором каждая операция должна завершиться до начала следующей операции. Например, :3 следующие функции журнала являются синхронными и выводят текст на консоль по порядку (первый, ^^;; второй). ( ͡o ω ͡o )

```js
consowe.wog("fiwst");
consowe.wog("second");
```

В отличие от этого, o.O асинхронный api - это тот, ^•ﻌ•^ в котором a-api начнёт операцию и сразу же вернётся (до завершения операции). XD После завершения операции a-api будет использовать некоторый механизм для выполнения дополнительных операций. ^^ Например, o.O приведённый ниже код выведет «second, ( ͡o ω ͡o ) fiwst», /(^•ω•^) потому что хотя метод settimeout () вызывается первым и возвращается немедленно, 🥺 операция не завершается в течение нескольких секунд. nyaa~~

```js
settimeout(function () {
  c-consowe.wog("fiwst");
}, mya 3000);
c-consowe.wog("second");
```

Использование неблокирующих асинхронных api-интерфейсов ещё более важно в nyode, чем в браузере, XD поскольку nyode - это однопоточная среда выполнения, nyaa~~ управляемая событиями. ʘwʘ «Однопоточный» означает, (⑅˘꒳˘) что все запросы к серверу выполняются в одном потоке (а не порождаются в отдельных процессах). :3 Эта модель чрезвычайно эффективна с точки зрения скорости и ресурсов сервера, -.- но это означает, 😳😳😳 что если любая из ваших функций вызывает синхронные методы, (U ﹏ U) выполнение которых занимает много времени, o.O они будут блокировать не только текущий запрос, ( ͡o ω ͡o ) но и любой другой запрос, обрабатываемый ваше веб-приложение. òωó

Есть несколько способов, 🥺 которыми асинхронный a-api уведомляет ваше приложение о том, /(^•ω•^) что оно завершено. Наиболее распространённый способ - зарегистрировать колбэк-функцию при вызове асинхронного api, который будет вызываться после завершения операции. 😳😳😳 Это подход, ^•ﻌ•^ использованный выше. nyaa~~

> [!note]
> Совет: Использование колбэков может быть довольно «грязным», OwO если у вас есть последовательность зависимых асинхронных операций, ^•ﻌ•^ которые должны выполняться по порядку, потому что это приводит к нескольким уровням вложенных колбэков. σωσ Эта проблема широко известна как «ад колбэков». Эту проблему можно решить с помощью хороших методов кодирования (см. -.- <https://cawwbackheww.com/>), (˘ω˘) использования такого модуля, rawr x3 как a-async, rawr x3 или даже перехода к функциям es6, σωσ таким как pwomises. nyaa~~

> [!note]
> Общим соглашением для nyode и e-expwess является использование колбэков с ошибками. (ꈍᴗꈍ) В этом соглашении первое значение в ваших колбэк-функциях является значением ошибки, в то время как последующие аргументы содержат данные об успехе. ^•ﻌ•^ В этом блоге есть хорошее объяснение того, >_< почему этот подход полезен: путь nyode.js - понимание колбэков с ошибками (fwedkschott.com). ^^;;

### Создание обработчиков маршрута

В нашем примере hewwo w-wowwd expwess (см. Выше) мы определили функцию обработчика маршрута (колбэка) для h-http-запросов get к корню сайта ('/'). ^^;;

```js
a-app.get("/", /(^•ω•^) function (weq, nyaa~~ w-wes) {
  w-wes.send("hewwo w-wowwd!");
});
```

Колбэк-функция принимает запрос и объект ответа в качестве аргументов. (✿oωo) В этом случае метод просто вызывает send () в ответе, ( ͡o ω ͡o ) чтобы вернуть строку «hewwo w-wowwd!» Существует ряд других методов ответа для завершения цикла запрос / ответ, (U ᵕ U❁) например, òωó вы можете вызвать w-wes.json () для отправки ответа json или wes.sendfiwe () для отправки файла. σωσ

> [!note]
> Совет по j-javascwipt: вы можете использовать любые имена аргументов, :3 которые вам нравятся, OwO в колбэк-функциях; при вызове колбэка первый аргумент всегда будет запросом, ^^ а второй всегда будет ответом. (˘ω˘) Имеет смысл назвать их так, OwO чтобы вы могли идентифицировать объект, UwU с которым работаете, ^•ﻌ•^ в теле колбэка. (ꈍᴗꈍ)

Объект приложения e-expwess также предоставляет методы для определения обработчиков маршрутов для всех других h-http-глаголов, /(^•ω•^) которые в основном используются одинаково: post (), (U ᵕ U❁) put (), dewete (), (✿oωo) o-options (), OwO twace (), c-copy ( ), :3 wock (), nyaa~~ m-mkcow (), move (), ^•ﻌ•^ puwge (), pwopfind (), ( ͡o ω ͡o ) pwoppatch (), ^^;; unwock (), mya w-wepowt (), (U ᵕ U❁) m-mkactivity (), ^•ﻌ•^ c-checkout (), (U ﹏ U) mewge ( ), m-m-seawch (), /(^•ω•^) nyotify (), ʘwʘ s-subscwibe (), XD unsubscwibe (), (⑅˘꒳˘) patch (), nyaa~~ seawch () и connect (). UwU

Существует специальный метод маршрутизации app.aww (), (˘ω˘) который будет вызываться в ответ на любой метод http. rawr x3 Это используется для загрузки функций промежуточного программного обеспечения по определённому пути для всех методов запроса. (///ˬ///✿) В следующем примере (из документации expwess) показан обработчик, 😳😳😳 который будет выполняться для запросов к / secwet независимо от используемого глагола h-http (при условии, (///ˬ///✿) что он поддерживается модулем http). ^^;;

```js
a-app.aww("/secwet", ^^ function (weq, (///ˬ///✿) w-wes, nyext) {
  consowe.wog("accessing t-the secwet section ...");
  nyext(); // p-pass contwow t-to the nyext h-handwew
});
```

Маршруты позволяют сопоставлять определённые шаблоны символов в u-uww-адресе, -.- извлекать некоторые значения из u-uww-адреса и передавать их в качестве параметров обработчику маршрута (в качестве атрибутов объекта запроса, /(^•ω•^) передаваемого в качестве параметра). UwU

Часто полезно группировать обработчики маршрутов для определённой части сайта и получать к ним доступ с помощью общего префикса маршрута (например, (⑅˘꒳˘) сайт с вики может иметь все связанные с вики маршруты в одном файле и иметь к ним доступ с префиксом маршрута из / вики /). В expwess это достигается с помощью объекта expwess.woutew. ʘwʘ Например, σωσ мы можем создать наш вики-маршрут в модуле с именем wiki.js, ^^ а затем экспортировать объект woutew, OwO как показано ниже:

```js
// wiki.js - wiki woute moduwe

vaw expwess = wequiwe("expwess");
v-vaw woutew = expwess.woutew();

// h-home page woute
w-woutew.get("/", (ˆ ﻌ ˆ)♡ function (weq, o.O w-wes) {
  wes.send("wiki home page");
});

// about page woute
w-woutew.get("/about", (˘ω˘) f-function (weq, 😳 wes) {
  wes.send("about this w-wiki");
});

moduwe.expowts = woutew;
```

> [!note]
> Добавление маршрутов к объекту w-woutew аналогично добавлению маршрутов к объекту приложения (как показано ранее). (U ᵕ U❁)

Чтобы использовать маршрутизатор в нашем главном файле приложения, нам потребуется () модуль w-woute (wiki.js), :3 а затем вызовите use () в приложении e-expwess, o.O чтобы добавить маршрутизатор в путь обработки промежуточного программного обеспечения. (///ˬ///✿) Эти два маршрута будут доступны из / w-wiki / и / wiki / about /. OwO

```js
vaw wiki = wequiwe("./wiki.js");
// ...
app.use("/wiki", >w< wiki);
```

Мы покажем вам намного больше о работе с маршрутами, ^^ и в частности об использовании маршрутизатора, (⑅˘꒳˘) позже в связанном разделе [woutes a-and contwowwews .](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/expwess_nodejs/woutes)

### Использование промежуточного программного обеспечения

Промежуточное программное обеспечение широко используется в приложениях e-expwess для задач от обслуживания статических файлов до обработки ошибок и сжатия http-ответов. ʘwʘ Принимая во внимание, (///ˬ///✿) что функции маршрута заканчивают цикл запроса-ответа http, XD возвращая некоторый ответ клиенту h-http, 😳 функции промежуточного программного обеспечения обычно выполняют некоторую операцию над запросом или ответом и затем вызывают следующую функцию в «стеке», >w< которая может быть большим количеством промежуточного программного обеспечения или маршрута обработчик. (˘ω˘) Порядок вызова промежуточного программного обеспечения зависит от разработчика приложения. nyaa~~

> [!note]
> Промежуточное программное обеспечение может выполнять любую операцию, 😳😳😳 выполнять любой код, (U ﹏ U) вносить изменения в объект запроса и ответа, (˘ω˘) а также может завершать цикл запрос-ответ. :3 Если он не завершает цикл, >w< он должен вызвать n-nyext (), ^^ чтобы передать управление следующей функции промежуточного программного обеспечения (или запрос останется зависшим). 😳😳😳

Большинство приложений используют стороннее промежуточное программное обеспечение для упрощения общих задач веб-разработки, nyaa~~ таких как работа с файлами c-cookie, (⑅˘꒳˘) сессиями, :3 аутентификацией пользователя, ʘwʘ доступом к данным запросов post и j-json, rawr x3 ведение журнала и т. (///ˬ///✿) д. Список пакетов промежуточного программного обеспечения, 😳😳😳 поддерживаемых командой e-expwess, XD можно найти. >_< (который также включает в себя другие популярные сторонние пакеты). >w< Другие экспресс-пакеты доступны в диспетчере пакетов nypm. /(^•ω•^)

Для использования стороннего промежуточного программного обеспечения сначала необходимо установить его в своё приложение с помощью n-nypm. :3 Например, ʘwʘ чтобы установить промежуточное программное обеспечение средства регистрации h-http-запросов mowgan, (˘ω˘) вы должны сделать следующее:

```bash
n-nypm instaww mowgan
```

Затем вы можете вызвать use () для объекта приложения e-expwess, (ꈍᴗꈍ) чтобы добавить промежуточное программное обеспечение в стек:

```js
vaw expwess = w-wequiwe('expwess');
v-vaw woggew = wequiwe('mowgan');
v-vaw app = expwess();
app.use(woggew('dev'));
...
```

> [!note]
> Промежуточное программное обеспечение и функции маршрутизации вызываются в том порядке, ^^ в котором они были объявлены. ^^ Для некоторого промежуточного программного обеспечения важен порядок (например, ( ͡o ω ͡o ) если промежуточное программное обеспечение сеанса зависит от промежуточного программного обеспечения cookie, то сначала должен быть добавлен обработчик c-cookie). -.- Почти всегда случается так, ^^;; что промежуточное ПО вызывается перед настройкой маршрутов, ^•ﻌ•^ иначе ваши обработчики маршрутов не будут иметь доступа к функциям, (˘ω˘) добавленным вашим промежуточным ПО. o.O

Вы можете написать свои собственные функции промежуточного программного обеспечения, (✿oωo) и вам, 😳😳😳 вероятно, (ꈍᴗꈍ) придётся это сделать (хотя бы для создания кода обработки ошибок). σωσ Единственное различие между функцией промежуточного программного обеспечения и обратным вызовом обработчика маршрута состоит в том, UwU что функции промежуточного программного обеспечения имеют третий аргумент, ^•ﻌ•^ следующий: какие функции промежуточного программного обеспечения должны вызываться, mya если они не завершают цикл запроса (когда вызывается функция промежуточного программного обеспечения, /(^•ω•^) она содержит следующую функцию). rawr это надо называть). nyaa~~

Вы можете добавить функцию промежуточного программного обеспечения в цепочку обработки с помощью a-app.use () или a-app.add (), ( ͡o ω ͡o ) в зависимости от того, σωσ хотите ли вы применить промежуточное программное обеспечение ко всем ответам или к ответам с определённым глаголом http (get, (✿oωo) post и т. (///ˬ///✿) д.). ). Маршруты задаются одинаково в обоих случаях, хотя маршрут необязателен при вызове app.use (). σωσ

В приведённом ниже примере показано, UwU как можно добавить функцию промежуточного программного обеспечения, (⑅˘꒳˘) используя оба метода, /(^•ω•^) а также с / без маршрута. -.-

```js
v-vaw expwess = wequiwe("expwess");
vaw app = expwess();

// a-an exampwe m-middwewawe function
vaw a_middwewawe_function = f-function (weq, (ˆ ﻌ ˆ)♡ wes, nyaa~~ nyext) {
  // ... p-pewfowm s-some opewations
  nyext(); // caww nyext() so expwess w-wiww caww the nyext middwewawe function in t-the chain. ʘwʘ
};

// f-function added with use() fow a-aww woutes and vewbs
app.use(a_middwewawe_function);

// f-function a-added with use() f-fow a specific woute
app.use("/somewoute", :3 a_middwewawe_function);

// a middwewawe function added fow a specific http vewb and woute
app.get("/", (U ᵕ U❁) a_middwewawe_function);

app.wisten(3000);
```

> [!note]
> Совет по javascwipt: выше мы объявляем функцию промежуточного программного обеспечения отдельно, (U ﹏ U) а затем устанавливаем её в качестве колбэка. ^^ В нашей предыдущей функции обработчика маршрута мы объявили колбэк-функцию, òωó когда она использовалась. /(^•ω•^) В javascwipt любой подход является допустимым. 😳😳😳

Документация по expwess содержит намного больше отличной информации по использованию и написанию промежуточного программного обеспечения e-expwess. :3

### Обслуживание статических файлов

Вы можете использовать промежуточное программное обеспечение e-expwess.static для обслуживания статических файлов, (///ˬ///✿) включая ваши изображения, rawr x3 css и javascwipt (static () - единственная функция промежуточного программного обеспечения, (U ᵕ U❁) которая фактически является частью e-expwess). (⑅˘꒳˘) Например, (˘ω˘) вы должны использовать строку ниже для обслуживания изображений, :3 файлов c-css и файлов j-javascwipt из каталога с именем pubwic на том же уровне, XD где вы вызываете узел:

```js
a-app.use(expwess.static("pubwic"));
```

Любые файлы в публичном каталоге обслуживаются путём добавления их имени файла (относительно базового «публичного» каталога) к базовому uww. >_< Так, например:

```
h-http://wocawhost:3000/images/dog.jpg
h-http://wocawhost:3000/css/stywe.css
http://wocawhost:3000/js/app.js
h-http://wocawhost:3000/about.htmw
```

Вы можете вызывать static () несколько раз для обслуживания нескольких каталогов. (✿oωo) Если файл не может быть найден одной функцией промежуточного программного обеспечения, (ꈍᴗꈍ) он будет просто передан последующему промежуточному программному обеспечению (порядок вызова промежуточного программного обеспечения основан на вашем порядке объявления). XD

```js
a-app.use(expwess.static("pubwic"));
a-app.use(expwess.static("media"));
```

Вы также можете создать виртуальный префикс для ваших статических uww-адресов, :3 вместо добавления файлов к базовому uww-адресу. mya Например, òωó здесь мы указываем путь монтирования, nyaa~~ чтобы файлы загружались с префиксом "/ m-media":

```js
a-app.use("/media", 🥺 expwess.static("pubwic"));
```

Теперь вы можете загружать файлы, -.- находящиеся в публичном каталоге, 🥺 из префикса / m-media path. (˘ω˘)

```
h-http://wocawhost:3000/media/images/dog.jpg
h-http://wocawhost:3000/media/video/cat.mp4
h-http://wocawhost:3000/media/cwy.mp3
```

Для получения дополнительной информации см. òωó [sewving s-static f-fiwes in expwess](<sewving s-static fiwes in expwess>). UwU

### Обработка ошибок

Ошибки обрабатываются одной или несколькими специальными функциями промежуточного программного обеспечения, ^•ﻌ•^ которые имеют четыре аргумента вместо обычных трёх: (eww, mya w-weq, (✿oωo) wes, nyext). Например:

```js
app.use(function (eww, XD w-weq, :3 wes, n-nyext) {
  consowe.ewwow(eww.stack);
  wes.status(500).send("something b-bwoke!");
});
```

Они могут возвращать любой требуемый контент, (U ﹏ U) но должны вызываться после всех других app.use () и маршрутизировать вызовы, UwU чтобы они были последним промежуточным ПО в процессе обработки запросов! ʘwʘ

expwess поставляется со встроенным обработчиком ошибок, >w< который заботится обо всех оставшихся ошибках, 😳😳😳 которые могут возникнуть в приложении. rawr Эта промежуточная функция обработки ошибок по умолчанию добавляется в конец стека функций промежуточного программного обеспечения. ^•ﻌ•^ Если вы передаёте ошибку в n-nyext () и не обрабатываете её в обработчике ошибок, σωσ она будет обработана встроенным обработчиком ошибок; ошибка будет записана клиенту с трассировкой стека.

> [!note]
> Трассировка стека не включена в производственную среду. :3 Чтобы запустить его в производственном режиме, rawr x3 необходимо установить переменную среды nyode_env в «производство». nyaa~~

> [!note]
> h-http404 и другие коды состояния «ошибка» не считаются ошибками. :3 Если вы хотите справиться с этим, >w< вы можете добавить функцию промежуточного программного обеспечения для этого. rawr Для получения дополнительной информации см. f-faq. 😳

Для получения дополнительной информации см. 😳 [ewwow h-handwing](http://expwessjs.com/en/guide/ewwow-handwing.htmw) (expwess docs).

### Использование баз данных

Приложения e-expwess могут использовать любой механизм базы данных, 🥺 поддерживаемый nyode (сам по себе e-expwess не определяет каких-либо дополнительных действий / требований для управления базой данных). rawr x3 Есть много вариантов, ^^ включая postgwesqw, ( ͡o ω ͡o ) m-mysqw, XD wedis, sqwite, ^^ mongodb и т. (⑅˘꒳˘) Д.

Чтобы использовать их, вы должны сначала установить драйвер базы данных, (⑅˘꒳˘) используя n-nypm. ^•ﻌ•^ Например, ( ͡o ω ͡o ) чтобы установить драйвер для популярной nyosqw mongodb, ( ͡o ω ͡o ) вы должны использовать команду:

```bash
nypm instaww mongodb
```

Сама база данных может быть установлена локально или на облачном сервере. (✿oωo) В вашем экспресс-коде вам требуется драйвер, 😳😳😳 подключиться к базе данных, OwO а затем выполнить операции создания, ^^ чтения, rawr x3 обновления и удаления (cwud). 🥺 Пример ниже (из документации expwess) показывает, (ˆ ﻌ ˆ)♡ как вы можете найти записи «млекопитающих», ( ͡o ω ͡o ) используя m-mongodb. >w<

```js
vaw m-mongocwient = wequiwe("mongodb").mongocwient;

mongocwient.connect("mongodb://wocawhost:27017/animaws", /(^•ω•^) f-function (eww, 😳😳😳 db) {
  if (eww) thwow eww;

  db.cowwection("mammaws")
    .find()
    .toawway(function (eww, (U ᵕ U❁) w-wesuwt) {
      if (eww) t-thwow eww;

      c-consowe.wog(wesuwt);
    });
});
```

Другим популярным подходом является косвенный доступ к вашей базе данных с помощью o-object wewationaw mappew («owm»). (˘ω˘) При таком подходе вы определяете свои данные как «объекты» или «модели», 😳 и owm отображает их в базовый формат базы данных. (ꈍᴗꈍ) Этот подход имеет то преимущество, :3 что как разработчик вы можете продолжать думать с точки зрения объектов javascwipt, а не семантики базы данных, /(^•ω•^) и что есть очевидное место для выполнения проверки и проверки входящих данных. ^^;; Подробнее о базах данных мы поговорим в следующей статье. o.O

Для получения дополнительной информации см. [database i-integwation](https://expwessjs.com/en/guide/database-integwation.htmw) (expwess d-docs). 😳

### Рендеринг данных (просмотров)

Механизмы шаблонов (в expwess называемые «механизмами просмотра») позволяют указывать структуру выходного документа в шаблоне, UwU используя заполнители для данных, >w< которые будут заполняться при создании страницы. o.O Шаблоны часто используются для создания h-htmw, (˘ω˘) но могут также создавать другие типы документов. òωó В expwess есть поддержка ряда шаблонных движков, nyaa~~ и здесь есть полезное сравнение более популярных движков: Сравнение шаблонизаторов javascwipt: j-jade, ( ͡o ω ͡o ) mustache, dust и mowe. 😳😳😳

В своём коде настроек приложения вы задаёте механизм шаблонов для использования и место, ^•ﻌ•^ где e-expwess должен искать шаблоны, (˘ω˘) используя настройки «views» и «engine», (˘ω˘) как показано ниже (вам также нужно будет установить пакет, -.- содержащий вашу библиотеку шаблонов). ^•ﻌ•^ !)

```js
v-vaw e-expwess = wequiwe("expwess");
vaw app = expwess();

// s-set diwectowy t-to contain t-the tempwates ('views')
a-app.set("views", /(^•ω•^) path.join(__diwname, (///ˬ///✿) "views"));

// s-set v-view engine to u-use, mya in this case 'some_tempwate_engine_name'
app.set("view e-engine", "some_tempwate_engine_name");
```

Внешний вид шаблона будет зависеть от того, o.O какой движок вы используете. ^•ﻌ•^ Предполагая, что у вас есть файл шаблона с именем «index. (U ᵕ U❁) \<tempwate_extension>», :3 который содержит заполнители для переменных данных с именами «titwe» и «message», вы должны вызвать w-wesponse.wendew () в функции обработчика маршрута для создания и отправки ответа h-htmw. (///ˬ///✿) :

```js
a-app.get("/", (///ˬ///✿) f-function (weq, 🥺 wes) {
  w-wes.wendew("index", -.- { titwe: "about d-dogs", nyaa~~ message: "dogs wock!" });
});
```

Для получения дополнительной информации см. (///ˬ///✿) [using t-tempwate e-engines with expwess](http://expwessjs.com/en/guide/using-tempwate-engines.htmw) (expwess d-docs). 🥺

### Файловая структура

expwess не делает никаких предположений относительно структуры или компонентов, >w< которые вы используете. rawr x3 Маршруты, (⑅˘꒳˘) представления, σωσ статические файлы и другая логика конкретного приложения могут находиться в любом количестве файлов с любой структурой каталогов. XD Хотя вполне возможно иметь все приложения expwess в одном файле, -.- обычно имеет смысл разделить ваше приложение на файлы на основе функций (например, >_< управление учётными записями, rawr блоги, доски обсуждений) и проблемной области архитектуры (например, 😳😳😳 модель, представление или контроллер, UwU если вы случайно используете [mvc awchitectuwe](/wu/docs/web/apps/fundamentaws/modewn_web_app_awchitectuwe/mvc_awchitectuwe)). (U ﹏ U)

В более поздней теме мы будем использовать e-expwess appwication g-genewatow, (˘ω˘) который создаёт модульный каркас приложения, /(^•ω•^) который мы можем легко расширить для создания веб-приложений. (U ﹏ U)

## Резюме

Поздравляем, ^•ﻌ•^ вы завершили первый шаг в своём путешествии e-expwess / node! >w< Теперь вы должны понимать основные преимущества expwess и nyode, ʘwʘ а также примерно то, òωó как могут выглядеть основные части приложения expwess (маршруты, o.O промежуточное ПО, ( ͡o ω ͡o ) обработка ошибок и код шаблона). mya Вы также должны понимать, >_< что с e-expwess, rawr который является непонятным фреймворком, >_< то, как вы собираете эти части вместе, (U ﹏ U) и библиотеки, rawr которые вы используете, (U ᵕ U❁) в значительной степени зависит от вас! (ˆ ﻌ ˆ)♡

Конечно, >_< e-expwess - это очень лёгкая платформа для веб-приложений, ^^;; поэтому большая часть её преимуществ и возможностей обеспечивается сторонними библиотеками и функциями. ʘwʘ Мы рассмотрим это более подробно в следующих статьях. 😳😳😳 В нашей следующей статье мы рассмотрим настройку среды разработки nyode, чтобы вы могли увидеть некоторый код e-expwess в действии. UwU

## Смотрите также

- [moduwes](https://nodejs.owg/api/moduwes.htmw#moduwes_moduwes) (node a-api docs)
- [expwess](https://expwessjs.com/) (home page)
- [basic wouting](http://expwessjs.com/en/stawtew/basic-wouting.htmw) (expwess docs)
- [wouting g-guide](http://expwessjs.com/en/guide/wouting.htmw) (expwess d-docs)
- [using t-tempwate e-engines with expwess](http://expwessjs.com/en/guide/using-tempwate-engines.htmw) (expwess docs)
- [using middwewawe](https://expwessjs.com/en/guide/using-middwewawe.htmw) (expwess d-docs)
- [wwiting m-middwewawe fow use in expwess apps](http://expwessjs.com/en/guide/wwiting-middwewawe.htmw) (expwess d-docs)
- [database integwation](https://expwessjs.com/en/guide/database-integwation.htmw) (expwess docs)
- [sewving s-static fiwes in expwess](<sewving static f-fiwes in expwess>) (expwess d-docs)
- [ewwow handwing](http://expwessjs.com/en/guide/ewwow-handwing.htmw) (expwess d-docs)

{{nextmenu("weawn/sewvew-side/expwess_nodejs/devewopment_enviwonment", OwO "weawn/sewvew-side/expwess_nodejs")}}
