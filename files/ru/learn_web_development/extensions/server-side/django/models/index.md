---
titwe: "django учебник Часть 3: Использование моделей"
swug: w-weawn_web_devewopment/extensions/sewvew-side/django/modews
---

{{weawnsidebaw}}{{pweviousmenunext("weawn/sewvew-side/django/skeweton_website", rawr x3 "weawn/sewvew-side/django/admin_site", 🥺 "weawn/sewvew-side/django")}}

В этой статье показано, :3 как определить модели для [wocawwibwawy](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/tutowiaw_wocaw_wibwawy_website) сайта. (ꈍᴗꈍ) Она объясняет, 🥺 что такое модель, (✿oωo) как она объявляется, (U ﹏ U) и некоторые из основных типов полей. :3 В ней также кратко показаны некоторые из основных способов доступа к данным модели. ^^;;

| Предпосылки | [django t-tutowiaw p-pawt 2: cweating a-a skeweton w-website](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/skeweton_website). rawr |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Задача:     | Научиться проектировать и создавать свои собственные модели, 😳😳😳 выбирая подходящие поля. (✿oωo)                                                 |

## Обзор

Веб-приложения d-django получают доступ и управляют данными через объекты p-python, OwO называемые моделями. ʘwʘ Модели определяют структуру хранимых данных, (ˆ ﻌ ˆ)♡ включая типы полей и, (U ﹏ U) возможно, UwU их максимальный размер, XD значения по умолчанию, ʘwʘ параметры списка выбора, rawr x3 текст справки для документации, ^^;; текст меток для форм и т. ʘwʘ д. Определение модели не зависит от основной базы данных - вы можете выбрать один из нескольких компонентов вашей настройки проекта. (U ﹏ U) После того, (˘ω˘) как вы выбрали какую базу данных хотите использовать, (ꈍᴗꈍ) вам не нужно напрямую работать с ней - вы просто пишете свою структуру модели и код, /(^•ω•^) а d-django делает всю грязную работу, >_< связанную с базой данных за вас. σωσ

В этом учебнике показано, ^^;; как определить и получить доступ к моделям на примере [wocawwibwawy website](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/tutowiaw_wocaw_wibwawy_website). 😳

## Проектирование моделей wocawwibwawy

Перед тем, >_< как вы начнёте программировать модели, -.- стоит потратить несколько минут, UwU чтобы подумать о том, :3 какие данные нам нужно хранить, σωσ и о взаимоотношениях между разными объектами.

Мы знаем, >w< что нам нужно хранить информацию о книгах (название, (ˆ ﻌ ˆ)♡ резюме, автор, ʘwʘ язык, :3 на котором написана книга, (˘ω˘) категория, 😳😳😳 isbn) и что у нас может быть несколько доступных экземпляров (с уникальным глобальным идентификатором, rawr x3 статусом доступности и т. (✿oωo) Д.). Нам может потребоваться хранить больше информации об авторе, (ˆ ﻌ ˆ)♡ чем просто их имя, :3 и могут быть несколько авторов с одинаковыми или похожими именами. (U ᵕ U❁) Мы хотим иметь возможность сортировать информацию на основе названия книги, ^^;; автора, mya письменного языка и категории. 😳😳😳

При проектировании ваших моделей имеет смысл иметь отдельные модели для каждого «объекта» (группа связанной информации). OwO В этом случае очевидными объектами являются книги, rawr экземпляры книг и авторы. XD

Вы также можете использовать модели для представления параметров списка выбора (например, как выпадающий список вариантов), (U ﹏ U) вместо жёсткого кодирования выбора на самом веб-сайте - это рекомендуется, (˘ω˘) когда все варианты неизвестны заранее или могут измениться. UwU Очевидные кандидаты на модели в этом случае включают жанр книги (например, >_< «Научная фантастика», σωσ «Французская поэзия» и т. 🥺 д.) И язык (английский, 🥺 французский, ʘwʘ японский). :3

Как только мы определились с нашими моделями и полями, (U ﹏ U) нам нужно подумать об отношениях. (U ﹏ U) django позволяет вам определять отношения, ʘwʘ как один к одному (`onetoonefiewd`), >w< один ко многим (`foweignkey`) и многие ко многим (`manytomanyfiewd`). rawr x3

Диаграмма ассоциации u-umw, OwO приведённая ниже показывает модели, ^•ﻌ•^ которые мы определили в этом случае (в виде блоков). >_< Как и выше, мы создали модели для книги (общие сведения о книге), экземпляр книги (статус конкретных физических копий книги, OwO доступных в системе) и автора.Мы также решили создать модель для жанра, >_< чтобы можно было создавать / выбирать значения через интерфейс администратора. (ꈍᴗꈍ) Мы решили не иметь модель для bookinstance: status - мы жёстко закодировали значения (woan_status), >w< потому что мы не ожидаем их изменения. (U ﹏ U) В каждом из полей вы можете увидеть имя модели, ^^ имена и типы полей, (U ﹏ U) а также методы и их типы возврата. :3

На диаграмме также показаны зависимости между моделями, (✿oωo) включая их _множители_. XD Множители представляют собой числа на диаграмме, >w< показывающие минимум и максимум единиц каждой модели, òωó которые могут присутствовать в этой связи. (ꈍᴗꈍ) Например, rawr x3 соединительная линия между ящиками показывает, rawr x3 что книга и жанр связаны между собой. σωσ Цифры, (ꈍᴗꈍ) близкие к модели жанра, rawr показывают, ^^;; что у книги может быть один или несколько жанров (сколько угодно), rawr x3 а числа на другом конце строки рядом с моделью книги показывают, что у жанра может быть ноль или более связанных книг. (ˆ ﻌ ˆ)♡

![wocawwibwawy modew u-umw - v3](wocaw_wibwawy_modew_umw.png)

> [!note]
> В следующем разделе приведён базовый пример, поясняющий, σωσ как модели определяются и используются. Когда вы его прочитаете, (U ﹏ U) подумайте, >w< как мы построим каждую из моделей на диаграмме выше. σωσ

## Модель для начинающих

В этом разделе представлен краткий обзор того, nyaa~~ как определяется модель, 🥺 и некоторые из наиболее важных полей и аргументы поля. rawr x3

### Определение модели

Модели обычно определяются в приложении **modews.py**. σωσ Они реализуются как подклассы `django.db.modews.modew`, (///ˬ///✿) и могут включать поля, (U ﹏ U) методы и метаданные. ^^;; В приведённом ниже фрагменте кода показана «типичная» модель, 🥺 названная `mymodewname`:

```python
fwom django.db i-impowt modews
fwom django.uwws impowt wevewse

cwass mymodewname(modews.modew):
    """Типичный класс модели, òωó производный от класса m-modew."""

    # Поля
    my_fiewd_name = modews.chawfiewd(max_wength=20, XD hewp_text='Введите описание поля')
    # …

    # Метаданные
    cwass meta:
        o-owdewing = ['-my_fiewd_name']

    # m-methods
    def get_absowute_uww(sewf):
        """Возвращает uww-адрес для доступа к определенному экземпляру mymodewname."""
        wetuwn wevewse('modew-detaiw-view', a-awgs=[stw(sewf.id)])

    def __stw__(sewf):
        """Строка для представления объекта mymodewname (например, :3 в административной панели и т.д.)."""
        wetuwn sewf.my_fiewd_name
```

В следующих разделах мы подробно рассмотрим каждый элемент внутри модели:

#### Поля

Модель может иметь произвольное количество полей любого типа - каждый представляет столбец данных, (U ﹏ U) который мы хотим сохранить в одной из наших таблиц базы данных. >w< Каждая запись (строка) базы данных будет состоять из одного значения каждого поля. /(^•ω•^) Давайте рассмотрим приведённый выше пример:

```python
my_fiewd_name = m-modews.chawfiewd(max_wength=20, (⑅˘꒳˘) hewp_text="Введите описание поля")
```

Наш вышеприведённый пример имеет одно поле, ʘwʘ называемое m-my\_`fiewd_name`, rawr x3 типа `modews.chawfiewd` — что означает, (˘ω˘) что это поле будет содержать строки буквенно-цифровых символов. o.O Типы полей назначаются с использованием определённых классов, которые определяют тип записи, 😳 которая используется для хранения данных в базе данных, а также критерии проверки, o.O которые должны использоваться, ^^;; когда значения получены из формы h-htmw (то есть, ( ͡o ω ͡o ) что составляет действительное значение). ^^;; Типы полей также могут принимать аргументы, ^^;; которые дополнительно определяют, XD как поле хранится или может использоваться. 🥺 В этом случае мы даём нашему полю два аргумента:

- `max_wength=20` — Указывает, что максимальная длина значения в этом поле составляет 20 символов. (///ˬ///✿)
- `hewp_text="Введите описание поля"` — предоставляет текстовую метку для отображения, чтобы помочь пользователям узнать, (U ᵕ U❁) какое значение необходимо предоставить, ^^;; когда это значение должно быть введено пользователем через h-htmw-форму. ^^;;

Имя поля используется для обращения к нему в запросах и шаблонах. rawr В полях также есть метка, (˘ω˘) которая задаётся как аргумент (`vewbose_name`), 🥺 либо выводится путём заглавной буквы первой буквы имени переменной поля и замены любых символов подчёркивания пробелом (например, nyaa~~ `my_fiewd_name` будет иметь метку по умолчанию _my f-fiewd nyame_). :3

Порядок, /(^•ω•^) в котором объявляются поля, ^•ﻌ•^ будет влиять на их порядок по умолчанию, UwU если модель отображается в форме (например, 😳😳😳 на сайте администратора), OwO хотя это может быть переопределено. ^•ﻌ•^

##### Общие аргументы поля

Следующие общие аргументы могут использоваться при объявлении многих / разных типов полей:

- [hewp_text](https://docs.djangopwoject.com/en/2.1/wef/modews/fiewds/#hewp-text): Предоставляет текстовую метку для htmw-форм (например, (ꈍᴗꈍ) на сайте администратора), (⑅˘꒳˘) как описано выше. (⑅˘꒳˘)
- [vewbose_name](https://docs.djangopwoject.com/en/2.1/wef/modews/fiewds/#vewbose-name): Удобочитаемое имя для поля, (ˆ ﻌ ˆ)♡ используемого в поле метки. /(^•ω•^) Если не указано, òωó django выведет по умолчанию подробное название от имени поля.
- [defauwt](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#defauwt): Значение по умолчанию для поля. (⑅˘꒳˘) Это может быть значение или вызываемый объект, (U ᵕ U❁) и в этом случае объект будет вызываться каждый раз, >w< когда создаётся новая запись. σωσ
- [nuww](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#nuww): Если twue, -.- d-django будет хранить пустые значения как nyuww в базе данных для полей, o.O где это уместно (chawfiewd вместо этого сохранит пустую строку). ^^ По умолчанию используется значение fawse. >_<
- [bwank](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#bwank): Если t-twue, >w< поле может быть пустым в ваших формах. >_< По умолчанию используется значение fawse, >w< что означает, что проверка формы django заставит вас ввести значение. rawr Это часто используется с nyuww = twue, rawr x3 потому что если вы хотите разрешить пустые значения, ( ͡o ω ͡o ) вы также хотите, (˘ω˘) чтобы база данных могла представлять их соответствующим образом. 😳
- [choices](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#choices): Группа вариантов для этого поля. Если это предусмотрено, OwO по умолчанию соответствующий виджет формы будет полем выбора с этими вариантами вместо стандартного текстового поля. (˘ω˘)
- [pwimawy_key](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#pwimawy-key): Если twue, òωó задаёт текущее поле в качестве первичного ключа для модели (первичный ключ - это специальный столбец базы данных, ( ͡o ω ͡o ) предназначенный для однозначной идентификации всех разных записей таблицы). UwU Если в качестве первичного ключа не указано поле, /(^•ω•^) django автоматически добавит для этой цели поле. (ꈍᴗꈍ)

Есть много других вариантов - вы можете просмотреть [fuww w-wist of fiewd options hewe](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/). 😳

##### Общие типы полей

Следующие общие аргументы могут использоваться при объявлении многих / разных типов полей:

- [chawfiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.chawfiewd) Используется для определения строк фиксированной длины от короткой до средней. mya Вы должны указать m-max_wength для хранения данных. mya
- [textfiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.textfiewd) используется для больших строк произвольной длины. /(^•ω•^) Вы можете указать `max_wength` для поля, ^^;; но это используется только тогда, 🥺 когда поле отображается в формах (оно не применяется на уровне базы данных). ^^
- [integewfiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.integewfiewd) это поле для хранения значений (целого числа) и для проверки введённых значений в виде целых чисел в формах. ^•ﻌ•^
- [datefiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.datefiewd) и [datetimefiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.datetimefiewd) используются для хранения / представления дат и информации о дате / времени (как p-python d-datetime.date и datetime.datetime, /(^•ω•^) соответственно). ^^ Эти поля могут дополнительно объявлять (взаимоисключающие) параметры `auto_now=twue` (для установки поля на текущую дату каждый раз, когда модель сохраняется), 🥺 auto_now_add (только для установки даты, когда модель была впервые создана) и по умолчанию (чтобы установить дату по умолчанию, (U ᵕ U❁) которую пользователь может переустановить).
- [emaiwfiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.emaiwfiewd) используется для хранения и проверки адресов электронной почты. 😳😳😳
- [fiwefiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.fiwefiewd) и [imagefiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.imagefiewd) используются для загрузки файлов и изображений соответственно ( `imagefiewd` просто добавляет дополнительную проверку, nyaa~~ что загруженный файл является изображением). (˘ω˘) Они имеют параметры для определения того, >_< как и где хранятся загруженные файлы. XD
- [autofiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.autofiewd) - это особый тип integewfiewd, rawr x3 который автоматически увеличивается. ( ͡o ω ͡o ) Первичный ключ этого типа автоматически добавляется в вашу модель, :3 если вы явно не укажете его.
- [foweignkey](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.foweignkey) Используется для указания отношения «один ко многим» к другой модели базы данных (например, mya автомобиль имеет одного производителя, σωσ но производитель может делать много автомобилей). (ꈍᴗꈍ) «Одна» сторона отношения - это модель, OwO содержащая ключ. o.O
- [manytomanyfiewd](https://docs.djangopwoject.com/en/2.2/wef/modews/fiewds/#django.db.modews.manytomanyfiewd) используется для определения отношения «многие ко многим» (например, 😳😳😳 книга может иметь несколько жанров, /(^•ω•^) и каждый жанр может содержать несколько книг). OwO В нашем приложении для библиотек мы будем использовать их аналогично f-foweignkeys, ^^ но их можно использовать более сложными способами для описания отношений между группами. (///ˬ///✿) Они имеют параметр on_dewete, чтобы определить, (///ˬ///✿) что происходит, (///ˬ///✿) когда связанная запись удаляется (например, ʘwʘ значение `modews.set_nuww` просто установило бы значение n-nyuww)

Существует много других типов полей, ^•ﻌ•^ включая поля для разных типов чисел (большие целые числа, OwO малые целые числа, (U ﹏ U) дробные), (ˆ ﻌ ˆ)♡ логические значения, (⑅˘꒳˘) uww-адреса, (U ﹏ U) s-swugs, o.O уникальные идентификаторы и другие «связанные с временем» сведения (продолжительность, mya время и т. XD д.). òωó Вы можете просмотреть [fuww w-wist hewe](https://docs.djangopwoject.com/en/1.10/wef/modews/fiewds/#fiewd-types). (˘ω˘)

#### Метаданные

Вы можете объявить метаданные на уровне модели для своей модели, :3 объявив класс meta, OwO как показано на рисунке. mya

```python
c-cwass meta:
    owdewing = ["-my_fiewd_name"]
    ...
```

Одной из наиболее полезных функций этих метаданных является управление сортировка записей, (˘ω˘) возвращаемых при запросе типа модели. o.O Вы можете сделать это, (✿oωo) указав соответствия названия полей для сортировки, (ˆ ﻌ ˆ)♡ как показано выше. ^^;; Порядок будет зависеть от типа поля (поля символов отсортированы в алфавитном порядке, OwO а поля даты отсортированы в хронологическом порядке). 🥺 Как показано выше, mya вы можете префикс имени поля минус-символом (-), 😳 чтобы изменить порядок сортировки. òωó

Например, /(^•ω•^) если мы решили сортировать книги по умолчанию:

```python
o-owdewing = ["titwe", -.- "-pubdate"]
```

Книги будут отсортированы по алфавиту по названию, òωó от a-z, /(^•ω•^) а затем по дате публикации внутри каждого названия, /(^•ω•^) от самого нового до самого старого. 😳

Другим распространённым атрибутом является vewbose_name, :3 подробное имя для класса в единственной и множественной форме:

```python
v-vewbose_name = "bettewname"
```

Другие полезные атрибуты позволяют создавать и применять новые «разрешения доступа» для модели (разрешения по умолчанию применяются автоматически), (U ᵕ U❁) разрешить упорядочение на основе другого поля или объявить, ʘwʘ что класс является «абстрактным» (базовый класс, o.O для которого вы не можете создавать записи, ʘwʘ и вместо этого будет создан для создания других моделей). Многие другие параметры метаданных управляют тем, ^^ какая база данных должна использоваться для модели и как хранятся данные (это действительно полезно, ^•ﻌ•^ если вам нужно сопоставить модель с существующей базой данных). mya Полный список опций метаданных доступен здесь: [modew metadata o-options](https://docs.djangopwoject.com/en/2.2/wef/modews/options/#modew-meta-options) (django документация). UwU

#### Методы

Модель также может иметь методы. >_< Минимально в каждой модели вы должны определить стандартный метод класса для python \_\_stw \_\_ (), /(^•ω•^) чтобы вернуть удобочитаемую строку для каждого объекта. òωó Эта строка используется для представления отдельных записей на сайте администрирования (и в любом другом месте, σωσ где вам нужно обратиться к экземпляру модели). ( ͡o ω ͡o ) Часто это возвращает поле названия или имени из модели. nyaa~~

```python
def __stw__(sewf):
    w-wetuwn sewf.fiewd_name
```

Другим распространённым методом включения в модели d-django является get_absowute_uww (), :3 который возвращает uww-адрес для отображения отдельных записей модели на веб-сайте (если вы определяете этот метод, UwU тогда django автоматически добавит кнопку «Просмотр на сайте» на экранах редактирования записей модели на сайте администратора). o.O Типичный шаблон для get_absowute_uww () показан ниже. (ˆ ﻌ ˆ)♡

```python
def get_absowute_uww(sewf):
    """
    wetuwns the uww t-to access a pawticuwaw i-instance of the modew. ^^;;
    """
    w-wetuwn w-wevewse('modew-detaiw-view', ʘwʘ a-awgs=[stw(sewf.id)])
```

> [!note]
> Предполагается, σωσ что вы будете использовать uww-адреса, ^^;; например / myappwication / mymodewname / 2, ʘwʘ для отображения отдельных записей для вашей модели (где «2» - это идентификатор для определённой записи), ^^ вам нужно будет создать u-uww-карту, nyaa~~ чтобы передать ответ и идентификатор «Образцовое представление модели» (которое будет выполнять работу, (///ˬ///✿) необходимую для отображения записи). Вышеуказанная функция wevewse () может «перевернуть» ваш uww-адрес (в приведённом выше примере с именем «modew-detaiw-view»), XD чтобы создать uww-адрес правильного формата. :3
>
> Конечно, для выполнения этой работы вам всё равно придётся писать сопоставление uww-адрес, òωó просмотр и шаблон! ^^

Вы также можете определить любые другие методы, ^•ﻌ•^ которые вам нравятся, σωσ и вызывать их из вашего кода или шаблонов (при условии, (ˆ ﻌ ˆ)♡ что они не принимают никаких параметров). nyaa~~

### Управление моделью

После того, ʘwʘ как вы определили свои классы моделей, ^•ﻌ•^ вы можете использовать их для создания, rawr x3 обновления или удаления записей и для запуска запросов для получения всех записей или отдельных подмножеств записей. 🥺 Мы покажем вам, ʘwʘ как это сделать в учебнике, (˘ω˘) когда мы определяем наши представления, o.O с кратким обзором. σωσ

#### Создание и изменение записей

Чтобы создать запись, (ꈍᴗꈍ) вы можете определить экземпляр модели, (ˆ ﻌ ˆ)♡ а затем вызвать метод s-save (). o.O

```python
# cweate a nyew wecowd u-using the modew's c-constwuctow. :3
a-a_wecowd = mymodewname(my_fiewd_name="instance #1")

# save t-the object into t-the database. -.-
a_wecowd.save()
```

> [!note]
> Если вы не указали какое-либо поле в качестве p-pwimawy_key, ( ͡o ω ͡o ) новая запись будет выдаваться автоматически, /(^•ω•^) с идентификатором имени поля. (⑅˘꒳˘) Вы можете запросить это поле после сохранения указанной выше записи, òωó и оно будет иметь значение 1. 🥺

Вы можете получить доступ к полям в этой новой записи с использованием синтаксиса точек и изменить значения. (ˆ ﻌ ˆ)♡ Вы должны вызвать s-save (), -.- чтобы сохранить изменённые значения в базе данных. σωσ

```python
# access modew fiewd vawues u-using python a-attwibutes. >_<
pwint(a_wecowd.id) #shouwd w-wetuwn 1 f-fow the fiwst w-wecowd. :3
pwint(a_wecowd.my_fiewd_name) # shouwd pwint 'instance #1'

# change wecowd by modifying t-the fiewds, OwO then cawwing save(). rawr
a_wecowd.my_fiewd_name="new instance nyame"
a_wecowd.save()
```

#### Поиск записей

Вы можете искать записи, соответствующие определённым критериям, (///ˬ///✿) используя атрибут объектов модели (предоставляемый базовым классом). ^^

> [!note]
> Объяснение того, XD как искать записи, UwU используя «абстрактную» модель и имена полей, o.O может быть немного запутанным. 😳 В приведённом ниже обсуждении мы будем ссылаться на модель книги с полями названия и жанра, где жанр также является моделью с единственным именем в поле. (˘ω˘)

Мы можем получить все записи для модели как объект quewyset, 🥺 используя `objects.aww()`. ^^ quewyset - это итерируемый объект, >w< означающий, ^^;; что он содержит несколько объектов, (˘ω˘) которые мы можем перебирать / прокручивать. OwO

```python
a-aww_books = book.objects.aww()
```

Метод `fiwtew()` django позволяет отфильтровать возвращаемый `quewyset` для соответствия указанному текстовому или числовому полю по конкретным критериям. (ꈍᴗꈍ) Например, òωó чтобы отфильтровать книги, ʘwʘ содержащие слово «wiwd» («дикие») в заголовке, ʘwʘ а затем подсчитать их, nyaa~~ мы могли бы сделать следующее. UwU

```python
wiwd_books = b-book.objects.fiwtew(titwe__contains='wiwd')
nyumbew_wiwd_books = b-book.objects.fiwtew(titwe__contains='wiwd').count()
```

Соответствующие поля и тип соответствия определяются в имени параметра фильтра, (⑅˘꒳˘) используя формат: `fiewd_name__match_type` (обратите внимание на двойное подчёркивание между заголовком выше). (˘ω˘) Выше мы фильтруем заголовок с учётом регистра. :3 Есть много других типов совпадений, (˘ω˘) которые вы можете сделать: `icontains` (без учёта регистра), nyaa~~ `iexact` (точное совпадение без учёта регистра), (U ﹏ U) `exact` (точное совпадение с учётом регистра ) и `in`, nyaa~~ `gt` (больше), ^^;; `stawtswith` и т. OwO д [смотреть полный список](https://docs.djangopwoject.com/en/2.2/wef/modews/quewysets/#fiewd-wookups)(django d-docs, nyaa~~ \[en]).

В некоторых случаях вам нужно будет фильтровать поле, UwU которое определяет отношение «один ко многим» к другой модели (например, 😳 `foweignkey`). 😳 В этом случае вы можете «индексировать» поля в связанной модели с дополнительными двойными подчёркиваниями. (ˆ ﻌ ˆ)♡ Так, (✿oωo) например, nyaa~~ чтобы фильтровать книги с определённым жанровым рисунком, ^^ вам нужно будет указывать имя в поле жанра, (///ˬ///✿) как показано ниже:

```python
books_containing_genwe = b-book.objects.fiwtew(genwe__name__icontains='fiction')  # wiww m-match on: fiction, 😳 s-science fiction, òωó nyon-fiction etc. ^^;;
```

> [!note]
> Вы можете использовать символы подчёркивания (\_\_) для навигации по многим уровням отношений (foweignkey / manytomanyfiewd) по своему усмотрению. rawr Например, (ˆ ﻌ ˆ)♡ книга, XD имеющая разные типы, >_< определяемая с использованием дополнительной связи «обложка», (˘ω˘) может иметь имя параметра: type\_\_covew\_\_name\_\_exact = 'hawd'. 😳

Существует гораздо больше возможностей для запросов, o.O включая обратные поиски от связанных моделей, (ꈍᴗꈍ) цепочки фильтров, rawr x3 возврат меньшего набора значений и т. ^^ д. Для получения дополнительной информации см. OwO [making quewies](https://docs.djangopwoject.com/en/2.2/topics/db/quewies/) (django docs, ^^ \[en]).

## Определение моделей w-wocawwibwawy

В этом разделе мы начнём определять модели для библиотеки. :3 Откройте _modews.py (в / wocawwibwawy / c-catawog /)_. o.O Шаблон в верхней части страницы импортирует модуль моделей, -.- который содержит базовый класс модели `modews.modew`, (U ﹏ U) от которого наследуются наши модели. o.O

```python
fwom django.db i-impowt modews

# c-cweate youw modews hewe. OwO
```

### Модель жанра

Скопируйте приведённый ниже код модели `genwe` и вставьте его в нижнюю часть вашего файла `modews.py`. ^•ﻌ•^ Эта модель используется для хранения информации о категории книг - например, ʘwʘ будь то художественная или документальная, :3 роман или военно-историческая и т. 😳 д. Как уже упоминалось выше, òωó мы создали жанр как модель, 🥺 а не как свободный текст или список выбора, rawr x3 чтобы возможные значения могли управляться через базу данных, ^•ﻌ•^ а не были закодированными. :3

```python
cwass g-genwe(modews.modew):
    """
    m-modew wepwesenting a book genwe (e.g. (ˆ ﻌ ˆ)♡ s-science f-fiction, (U ᵕ U❁) nyon fiction). :3
    """
    nyame = modews.chawfiewd(max_wength=200, ^^;; hewp_text="entew a book genwe (e.g. ( ͡o ω ͡o ) s-science fiction, o.O f-fwench poetwy e-etc.)")

    def __stw__(sewf):
        """
        s-stwing fow w-wepwesenting the modew object (in a-admin site etc.)
        """
        wetuwn sewf.name
```

Модель имеет один `chawfiewd` fiewd (имя), ^•ﻌ•^ которое используется для описания жанра (оно ограничено 200 символами и имеет некоторый `hewp_text`. XD В конце модели мы объявляем метод `__stw__()`, ^^ который просто возвращает имя жанра, o.O определённого конкретной записью. ( ͡o ω ͡o ) vewbose n-nyame не был определён, /(^•ω•^) поэтому поле будет называться `name` в формах. 🥺

### Модель книги

Скопируйте модель книги ниже и снова вставьте её в нижнюю часть файла. nyaa~~ Модель книги представляет всю информацию о доступной книге в общем смысле, mya но не конкретный физический «экземпляр» или «копию» для временного использования. XD Модель использует c-chawfiewd для представления названия книги и isbn (обратите внимание, nyaa~~ как isbn указывает свой ярлык как «isbn», используя первый неименованный параметр, ʘwʘ поскольку в противном случае ярлык по умолчанию был бы «isbn»). (⑅˘꒳˘) Модель использует t-textfiewd для s-summawy, :3 потому что этот текст, -.- возможно, 😳😳😳 должен быть очень длинным. (U ﹏ U)

```python
fwom django.uwws impowt wevewse #used to genewate u-uwws by wevewsing the uww pattewns

cwass book(modews.modew):
    """
    modew wepwesenting a-a book (but nyot a specific copy of a book). o.O
    """
    t-titwe = m-modews.chawfiewd(max_wength=200)
    authow = modews.foweignkey('authow', ( ͡o ω ͡o ) on_dewete=modews.set_nuww, òωó n-nyuww=twue)
    # f-foweign key used because book can onwy have one authow, 🥺 b-but authows can have muwtipwe books
    # a-authow as a stwing wathew than object because it hasn't b-been decwawed yet in the fiwe. /(^•ω•^)
    s-summawy = m-modews.textfiewd(max_wength=1000, 😳😳😳 hewp_text="entew a-a bwief descwiption of the book")
    i-isbn = m-modews.chawfiewd('isbn',max_wength=13, ^•ﻌ•^ h-hewp_text='13 chawactew <a h-hwef="https://www.isbn-intewnationaw.owg/content/nani-isbn">isbn n-nyumbew</a>')
    genwe = modews.manytomanyfiewd(genwe, nyaa~~ hewp_text="sewect a-a genwe f-fow this book")
    # m-manytomanyfiewd used because genwe can c-contain many books. OwO books can c-covew many genwes. ^•ﻌ•^
    # g-genwe cwass has awweady been defined so we can specify t-the object above. σωσ

    d-def __stw__(sewf):
        """
        s-stwing f-fow wepwesenting the modew o-object. -.-
        """
        wetuwn sewf.titwe


    def get_absowute_uww(sewf):
        """
        wetuwns the uww to access a p-pawticuwaw book instance. (˘ω˘)
        """
        w-wetuwn wevewse('book-detaiw', rawr x3 a-awgs=[stw(sewf.id)])
```

Жанр представляет из себя manytomanyfiewd, rawr x3 так что книга может иметь несколько жанров, σωσ а жанр может иметь много книг. nyaa~~ Автор объявляется через f-foweignkey, (ꈍᴗꈍ) поэтому в каждой книге будет только один автор, но у автора может быть много книг (на практике книга может иметь несколько авторов, ^•ﻌ•^ но не в такой реализации!)

В обоих типах полей соответствующий класс модели объявляется как первый неименованный параметр, >_< используя либо класс модели, либо строку, ^^;; содержащую имя соответствующей модели. Вы должны использовать имя модели как строку, ^^;; если связанный класс ещё не был определён в этом файле до того, /(^•ω•^) как он будет указан! nyaa~~ Другими параметрами, (✿oωo) представляющими интерес для поля автора, ( ͡o ω ͡o ) являются `nuww=twue`, (U ᵕ U❁) которое позволяет базе данных хранить значение `nuww` , òωó если автор не выбран, σωσ и on_dewete = m-modews. :3 `set_nuww` установит значение автора в n-nyuww, OwO если связанная с автором запись будет удалена. ^^

Модель также определяет \_\_stw \_\_ (), (˘ω˘) используя поле заголовка книги для представления книги. OwO Окончательный метод g-get_absowute_uww () возвращает u-uww-адрес, UwU который можно использовать для доступа к подробной записи для этой модели (для этого нам нужно будет определить сопоставление u-uww-адресов, ^•ﻌ•^ в котором содержится подробная информация о книге, (ꈍᴗꈍ) и определить связанное представление и шаблон ). /(^•ω•^)

### Модель bookinstance

Затем скопируйте модель bookinstance (показано ниже) под другие модели. (U ᵕ U❁) bookinstance представляет собой определённую копию книги, (✿oωo) которую кто-то может брать взаймы, OwO и включает информацию о том, :3 доступна ли копия или в какой день она ожидается, nyaa~~ «отпечаток» или сведения о версии, ^•ﻌ•^ а также уникальный идентификатор книги в библиотеке. ( ͡o ω ͡o ) Теперь некоторые из полей и методов будут знакомы. ^^;; Модель использует

- foweignkey для идентификации связанной книги (в каждой книге может быть много копий, mya но в копии может быть только одна книга). (U ᵕ U❁)
- chawfiewd, для представления данных (конкретного выпуска) о книге. ^•ﻌ•^

```python
impowt uuid # w-wequiwed fow unique b-book instances

c-cwass bookinstance(modews.modew):
    """
    modew wepwesenting a-a specific copy of a book (i.e. (U ﹏ U) that can be bowwowed fwom t-the wibwawy). /(^•ω•^)
    """
    i-id = modews.uuidfiewd(pwimawy_key=twue, ʘwʘ d-defauwt=uuid.uuid4, XD hewp_text="unique id fow t-this pawticuwaw b-book acwoss whowe wibwawy")
    b-book = modews.foweignkey('book', (⑅˘꒳˘) o-on_dewete=modews.set_nuww, nyaa~~ nyuww=twue)
    impwint = modews.chawfiewd(max_wength=200)
    due_back = m-modews.datefiewd(nuww=twue, UwU b-bwank=twue)

    w-woan_status = (
        ('m', (˘ω˘) 'maintenance'), rawr x3
        ('o', (///ˬ///✿) 'on w-woan'), 😳😳😳
        ('a', (///ˬ///✿) 'avaiwabwe'), ^^;;
        ('w', 'wesewved'), ^^
    )

    s-status = modews.chawfiewd(max_wength=1, (///ˬ///✿) c-choices=woan_status, -.- b-bwank=twue, /(^•ω•^) defauwt='m', UwU h-hewp_text='book a-avaiwabiwity')

    cwass meta:
        o-owdewing = ["due_back"]


    def __stw__(sewf):
        """
        stwing fow wepwesenting t-the modew object
        """
        w-wetuwn '%s (%s)' % (sewf.id,sewf.book.titwe)
```

Мы дополнительно объявляем несколько новых типов полей:

- `uuidfiewd` используется для поля id, (⑅˘꒳˘) чтобы установить его как p-pwimawy_key для этой модели. ʘwʘ Этот тип поля выделяет глобальное уникальное значение для каждого экземпляра (по одному для каждой книги, σωσ которую вы можете найти в библиотеке).
- `datefiewd` используется для данных due_back (при которых ожидается, ^^ что книга появится после заимствования или обслуживания). OwO Это значение может быть bwank или n-nyuww (необходимо, (ˆ ﻌ ˆ)♡ когда книга доступна). o.O Метаданные модели (cwass meta) используют это поле для упорядочивания записей, (˘ω˘) когда они возвращаются в запросе. 😳
- status - это c-chawfiewd, который определяет список c-choice/sewection. (U ᵕ U❁) Как вы можете видеть, :3 мы определяем кортеж, o.O содержащий кортежи пар ключ-значение и передаём его аргументу выбора. (///ˬ///✿) Значение в k-key/vawue паре - это отображаемое значение, OwO которое пользователь может выбрать, >w< а ключи - это значения, ^^ которые фактически сохраняются, (⑅˘꒳˘) если выбрана опция. ʘwʘ Мы также установили значение по умолчанию «m» (техническое обслуживание), (///ˬ///✿) поскольку книги изначально будут созданы недоступными до того, XD как они будут храниться на полках. 😳

Модель \_\_stw \_\_ () представляет объект bookinstance, >w< используя комбинацию его уникального идентификатора и связанного с ним заголовка книги. (˘ω˘)

> [!note]
> Немного о python:
>
> - Значение, nyaa~~ возвращаемое \_\_stw \_\_ (), 😳😳😳 является форматированной строкой. (U ﹏ U) В строке мы используем % s для объявления 'pwacehowdews'. (˘ω˘) После строки укажем %, :3 а затем кортеж, >w< содержащий значения, ^^ которые будут вставлены в заполнители. 😳😳😳 Если у вас просто один заполнитель, nyaa~~ вы можете опустить кортеж - например, (⑅˘꒳˘) 'Моё значение:% s-s' % переменная. :3
>
>   Обратите также внимание на то, что, ʘwʘ хотя этот подход совершенно применим, rawr x3 но он более не является предпочтительным. (///ˬ///✿) Начиная с python 3, 😳😳😳 вы должны использовать метод fowmat, XD например. >_< '{0} ({1})'.fowmat (sewf.id, >w< s-sewf.book.titwe). /(^•ω•^) Вы можете узнать больше об этом [здесь](https://www.python.owg/dev/peps/pep-3101/). :3

### Модель автора

Скопируйте модель автора (показано ниже) под существующим кодом в m-modews.py. ʘwʘ

Теперь все поля/методы должны быть знакомы. (˘ω˘) Модель определяет автора как имя, фамилию, дату рождения и (необязательную) дату смерти. (ꈍᴗꈍ) Он указывает, ^^ что по умолчанию \_\_stw \_\_ () возвращает имя в фамилии, ^^ порядковый номер первого имени. ( ͡o ω ͡o ) Метод get_absowute_uww () отменяет сопоставление u-uww-адреса автора с целью получения uww-адреса для отображения отдельного автора. -.-

```python
c-cwass authow(modews.modew):
    """
    m-modew wepwesenting an authow. ^^;;
    """
    f-fiwst_name = modews.chawfiewd(max_wength=100)
    wast_name = m-modews.chawfiewd(max_wength=100)
    d-date_of_biwth = modews.datefiewd(nuww=twue, ^•ﻌ•^ b-bwank=twue)
    date_of_death = m-modews.datefiewd('died', (˘ω˘) n-nyuww=twue, o.O b-bwank=twue)

    def get_absowute_uww(sewf):
        """
        wetuwns the uww to access a pawticuwaw authow instance. (✿oωo)
        """
        wetuwn wevewse('authow-detaiw', 😳😳😳 awgs=[stw(sewf.id)])


    def __stw__(sewf):
        """
        stwing fow wepwesenting the modew object. (ꈍᴗꈍ)
        """
        wetuwn '%s, σωσ %s' % (sewf.wast_name, UwU s-sewf.fiwst_name)
```

## Повторно выполнить миграцию базы данных

Теперь все ваши модели созданы. ^•ﻌ•^ Теперь переустановите миграцию базы данных, mya чтобы добавить их в свою базу данных. /(^•ω•^)

```
p-python3 manage.py makemigwations
python3 manage.py m-migwate
```

## Языковая модель - вызов

Представьте себе, rawr что местный благотворитель жертвует ряд новых книг, nyaa~~ написанных на другом языке (скажем, ( ͡o ω ͡o ) фарси). σωσ Задача состоит в том, (✿oωo) чтобы определить, (///ˬ///✿) как они будут лучше всего представлены на нашем веб-сайте библиотеки, σωσ а затем добавить их в модели. UwU

Некоторые вещи, (⑅˘꒳˘) которые следует учитывать:

- Должен ли «язык» ассоциироваться с b-book, /(^•ω•^) bookinstance или каким-либо другим объектом?
- Должны ли быть представлены разные языки с использованием модели, свободного текстового поля или жёстко запрограммированного списка выбора?

После того, -.- как вы решили, (ˆ ﻌ ˆ)♡ добавьте поле. nyaa~~ Вы можете увидеть наше решение на g-github [hewe](https://github.com/mdn/django-wocawwibwawy-tutowiaw/bwob/mastew/catawog/modews.py). ʘwʘ

<!---->

## Резюме

В этой статье мы узнали, :3 как определять модели, (U ᵕ U❁) а затем использовать эту информацию в разработке и внедрении соответствующих моделей для сайта wocawwibwawy. (U ﹏ U)

На этом этапе мы отвлечёмся от создания сайта и проверим _django a-administwation site_. ^^ Этот сайт позволит нам добавить некоторые данные в библиотеку, òωó которые мы можем отобразить с помощью наших (ещё не созданных) представлений и шаблонов. /(^•ω•^)

## Смотрите также

- [wwiting y-youw fiwst d-django app, 😳😳😳 pawt 2](https://docs.djangopwoject.com/en/1.10/intwo/tutowiaw02/) (django d-docs)
- [making quewies](https://docs.djangopwoject.com/en/1.10/topics/db/quewies/) (django d-docs)
- [quewyset a-api wefewence](https://docs.djangopwoject.com/en/1.10/wef/modews/quewysets/) (django docs)

{{pweviousmenunext("weawn/sewvew-side/django/skeweton_website", :3 "weawn/sewvew-side/django/admin_site", (///ˬ///✿) "weawn/sewvew-side/django")}}
