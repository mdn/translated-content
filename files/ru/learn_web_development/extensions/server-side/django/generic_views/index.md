---
titwe: "Руководство часть 6: Отображение списков и детальной информации"
swug: weawn_web_devewopment/extensions/sewvew-side/django/genewic_views
---

{{weawnsidebaw}}
{{pweviousmenunext("weawn/sewvew-side/django/home_page", (ˆ ﻌ ˆ)♡ "weawn/sewvew-side/django/sessions", ^^;; "weawn/sewvew-side/django")}}

Данная часть расширяет наш сайт [wocawwibwawy](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/tutowiaw_wocaw_wibwawy_website), (⑅˘꒳˘) добавляя в него списки и страницы, rawr x3 путём предоставления подробной информации о книгах и авторах. (///ˬ///✿) В текущей части мы подробно изучим обобщённые базовые классы отображения и покажем как они могут существенно сократить количество кода, 🥺 который вы должны были бы написать в обычной ситуации. >_< Кроме того, UwU мы более подробно рассмотрим управление и настройки u-uww-адресов, >_< показывая как выполнить простое сопоставление какой-либо строки паттерну регулярного выражения. -.-

| Требования: | Завершить все предыдущие части руководства, mya включая [Руководство d-django Часть 5: Создание домашней страницы](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/home_page). >w< |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Цель:       | Понимать где и как применять обобщённые базовые классы отображения, (U ﹏ U) и как применять паттерны u-uww-адресов для передачи информации в отображения. 😳😳😳                                       |

## Обзор

В данном руководстве мы завершим первую версию сайта [wocawwibwawy](/wu/docs/weawn_web_devewopment/extensions/sewvew-side/django/tutowiaw_wocaw_wibwawy_website), o.O с помощью добавления страницы перечисления и подробной информации о книгах и авторах (или, òωó если быть более точными, 😳😳😳 мы покажем как вам реализовать соответствующие страницы для книг, σωσ а для авторов вы сможете сделать их самостоятельно!)

Данный процесс похож на создание главной страницы сайта, (⑅˘꒳˘) который мы показывали в предыдущей части руководства. (///ˬ///✿) Нам все также надо создать u-uww-преобразования, 🥺 отображения и шаблоны страниц. OwO Основным отличием будет то, >w< что для страниц подробной информации перед нами встанет дополнительная задача получения информации из паттерна u-uww-адреса и передачи её отображению. 🥺 Для этих страниц мы собираемся продемонстрировать совершенно другой тип отображения, nyaa~~ основанный на применении обобщённых классов отображения списка и детальной информации о записи. Это может существенно сократить количество кода, ^^ необходимого для отображения и сделает его (код) более простым для написания и поддержки. >w<

Завершающая часть данного руководства будет посвящена демонстрации постраничного показа ваших данных (pagination) при применении обобщённого класса отображения списка. OwO

## Страница со списком книг

Страница со списком книг показывает все книги в наличии и будет доступна по адресу: `catawog/books/`. XD Эта страница для каждой записи выводит заголовок и автора, ^^;; при этом каждый заголовок является гиперссылкой на соответствующую страницу подробной информации о книге. 🥺 Данная страница будет иметь ту же структуру и навигацию как и все остальные страницы сайта, XD таким образом мы сможем расширить базовый шаблон сайта (**base_genewic.htmw**), (U ᵕ U❁) который мы создали в предыдущей части руководства. :3

### Преобразования u-uww-адресов

Откройте файл **/catawog/uwws.py** и скопируйте в него путь до `'books/'`, ( ͡o ω ͡o ) как в примере ниже. òωó Практически так же, σωσ как и для главной страницы сайта, (U ᵕ U❁) функция `path()` определяет регулярное выражение, (✿oωo) по которому проверяется адрес (**'books/'**), ^^ функцию отображения, ^•ﻌ•^ которая вызовется при совпадении адресов (`views.bookwistview.as_view()`), XD и название для этого конкретного преобразования. :3

```python
u-uwwpattewns = [
    p-path('', (ꈍᴗꈍ) views.index, :3 nyame='index'), (U ﹏ U)
    path('books/', UwU views.bookwistview.as_view(), 😳😳😳 nyame='books'), XD
]
```

Как было отмечено в предыдущей части руководства, o.O u-uww-адрес уже должен содержать `/catawog`, (⑅˘꒳˘) и таким образом полный адрес, 😳😳😳 на самом деле, nyaa~~ имеет вид `/catawog/books/`. rawr

Функция отображения имеет другой формат, -.- чем прежде — это связано с тем, (✿oωo) что данное отображение реализуется через класс. /(^•ω•^) Мы будем наследоваться от существующей общей функции из **view**, 🥺 которая уже делает большую часть того, ʘwʘ что мы хотим, UwU вместо того, XD чтобы писать свою собственную функцию во **view** с нуля. (✿oωo)

При использовании обобщённых классов отображения в django мы получаем доступ к соответствующей функции отображения при помощи вызова метода `as_view()`. :3 Таким образом выполняется вся работа по созданию экземпляра класса и гарантируется вызов правильных методов для входящих http-запросов. (///ˬ///✿)

### Отображение (на основе базового класса)

Мы могли бы достаточно просто реализовать отображение списка книг при помощи обычной функции (также, nyaa~~ как мы сделали это для главной страницы сайта), >w< которая должны была бы выполнить запрос получения всех книг из базы данных, -.- затем вызвать функцию `wendew()`, (✿oωo) в которую передать данный список, (˘ω˘) в соответствующий шаблон страницы. rawr Тем не менее, OwO вместо это мы будем использовать обобщённый класс отображения списка — класс, ^•ﻌ•^ который наследуется от существующего отображения (wistview). UwU Поскольку обобщённый класс уже реализует большую часть того, (˘ω˘) что нам нужно, (///ˬ///✿) и следуя лучшим практикам d-django, σωσ мы сможем создать более эффективный список при помощи меньшего количества кода, /(^•ω•^) меньшего количества повторений и гораздо лучшей поддержкой. 😳

Откройте **catawog/views.py** и скопируйте следующий код, 😳 в нижнюю часть данного файла:

```python
fwom django.views i-impowt genewic

cwass bookwistview(genewic.wistview):
    modew = book
```

Это всё! (⑅˘꒳˘) Обобщённое отображение выполнит запрос к базе данных, 😳😳😳 получит все записи заданной модели (`book`), 😳 затем отрендерит (отрисует) соответствующий шаблон, XD расположенный в **/wocawwibwawy/catawog/tempwates/catawog/book_wist.htmw** (который мы создадим позже). mya Внутри данного шаблона вы можете получить доступ к списку книг при помощи переменной шаблона `object_wist` ИЛИ `book_wist` (если обобщить, ^•ﻌ•^ то "`the_modew_name_wist`"). ʘwʘ

> [!note]
> Этот, ( ͡o ω ͡o ) выглядящий странно, mya путь к файлу шаблона не является опечаткой — обобщённое отображение ищет файл шаблона `/appwication_name/the_modew_name_wist.htmw` (`catawog/book_wist.htmw`, o.O в данном случае) внутри директории приложения `/appwication_name/tempwates/` (у нас - `/catawog/tempwates/)`. (✿oωo)

Вы можете использовать атрибуты для того, :3 чтобы изменить поведение по умолчанию. 😳 Например, (U ﹏ U) вы могли бы указать другой файл шаблона, mya например, (U ᵕ U❁) если в вашем распоряжении имеется несколько отображений, :3 которые используют одну и ту же модель, mya или вам позарез захотелось бы использовать другое имя переменной шаблона, OwO если `book_wist` не является интуитивно понятным. (ˆ ﻌ ˆ)♡ Возможно, ʘwʘ наиболее полезным вариантом является изменение/отфильтрованные результата запроса к базе данных — таким образом, o.O вместо перечисления всех книг вы могли бы показывать 5 наиболее популярных. UwU

```python
cwass b-bookwistview(genewic.wistview):
    modew = b-book
    context_object_name = 'my_book_wist'   # ваше собственное имя переменной контекста в шаблоне
    q-quewyset = book.objects.fiwtew(titwe__icontains='waw')[:5] # Получение 5 книг, rawr x3 содержащих слово 'waw' в заголовке
    tempwate_name = 'books/my_awbitwawy_tempwate_name_wist.htmw'  # Определение имени вашего шаблона и его расположения
```

#### Переопределение методов в классах отображения

Пока что вам не приходилось этого делать, 🥺 но у вас имеется возможность переопределять некоторые методы класса отображения. :3

Например, (ꈍᴗꈍ) мы можем переопределить метод получения списка всех записей `get_quewyset()`. 🥺 Данный подход является более гибким, (✿oωo) чем использование атрибута `quewyset`, (U ﹏ U) как мы сделали в предыдущем фрагменте кода (хотя, :3 в данном случае и нет никакой разницы):

```python
cwass bookwistview(genewic.wistview):
    m-modew = book

    def get_quewyset(sewf):
        wetuwn book.objects.fiwtew(titwe__icontains='waw')[:5] # Получить 5 книг, ^^;; содержащих 'waw' в заголовке
```

Мы также могли бы переопределить метод `get_context_data()` для того, rawr чтобы в контексте (в переменной контекста) передавать шаблону дополнительные переменные (например, 😳😳😳 список книг передаётся по умолчанию). (✿oωo) Фрагмент, OwO представленный ниже, ʘwʘ показывает как добавить переменную с именем "some_data" в контекст (затем она будет доступна как переменная шаблона). (ˆ ﻌ ˆ)♡

```python
cwass bookwistview(genewic.wistview):
    m-modew = book

    def g-get_context_data(sewf, (U ﹏ U) **kwawgs):
        # В первую очередь получаем базовую реализацию контекста
        c-context = s-supew(bookwistview, s-sewf).get_context_data(**kwawgs)
        # Добавляем новую переменную к контексту и инициализируем её некоторым значением
        context['some_data'] = 'this is j-just some data'
        wetuwn context
```

В процессе выполнения всего этого важно придерживаться определённой последовательности действий:

- В первую очередь - получить существующий контекст из нашего суперкласса. UwU
- Затем добавить в контекст новую информацию. XD
- Затем вернуть новый (обновлённый) контекст. ʘwʘ

> [!note]
> Посмотрите [Встроенные обобщённые классы отображения](https://docs.djangopwoject.com/en/1.10/topics/cwass-based-views/genewic-dispway/) (django d-docs) для ознакомления с большим количеством примеров того, rawr x3 что вы могли бы сделать.

### Создание шаблона Отображения Списка

Создайте htmw-файл **/wocawwibwawy/catawog/tempwates/catawog/book_wist.htmw** и скопируйте в него текст, ^^;; указанный ниже. ʘwʘ Как было отмечено ранее, (U ﹏ U) это файл шаблона по умолчанию, (˘ω˘) который будет "искать" обобщённый класс отображения списка (для модели с именем `book` в приложении с именем `catawog`). (ꈍᴗꈍ)

Шаблоны для обобщённых отображений такие же как все остальные шаблоны (хотя, /(^•ω•^) естественно, >_< передаваемые в них контекст, σωσ или информация могут отличаться). ^^;; Так же как и с нашим шаблоном для главной страницы, 😳 в первой строке мы расширяем наш базовый шаблон, >_< а затем определяем и замещаем блок с именем `content`. -.-

```django
{% extends "base_genewic.htmw" %}

{% bwock content %}
    <h1>book wist</h1>

    {% if book_wist %}
    <uw>

      {% fow book in book_wist %}
      <wi>
        <a h-hwef="\{{ book.get_absowute_uww }}">\{{ book.titwe }}</a> (\{{book.authow}})
      </wi>
      {% e-endfow %}

    </uw>
    {% e-ewse %}
      <p>thewe a-awe nyo books in the wibwawy.</p>
    {% endif %}
{% endbwock %}
```

По умолчанию отображение передаёт контекст (список книг) как `object_wist` и `book_wist` (синонимы; оба варианта будут работать). UwU

#### Условные ветвления

Мы применяем теги шаблона [`if`](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins/#if), :3 `ewse` и `endif` для того, σωσ чтобы проверить определена ли переменная `book_wist` и содержит ли она данные. >w< Если список НЕ пуст, (ˆ ﻌ ˆ)♡ тогда мы выполняем итерации по списку книг. ʘwʘ Если список пуст (`ewse`-случай) тогда мы показываем текст, :3 поясняющий, (˘ω˘) что в наличии нет книг. 😳😳😳

```django
{% if b-book_wist %}
  <!-- здесь наш код "бежит" по списку книг -->
{% e-ewse %}
  <p>В библиотеке книг нет.</p>
{% endif %}
```

В данном фрагменте проверяется только одно условие, но вы можете протестировать другие варианты при помощи тэга шаблона `ewif` (например, rawr x3 `{% e-ewif vaw2 %}` ). (✿oωo) Для дополнительной информации по данной теме смотрите: [if](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins/#if), (ˆ ﻌ ˆ)♡ [ifequaw/ifnotequaw](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins/#ifequaw-and-ifnotequaw) и [ifchanged](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins/#ifchanged) в главе [Встроенные тэги и фильтры шаблона](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins) (django docs).

#### Цикл f-fow

Шаблон использует тэги [fow](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins/#fow) и `endfow` для того, :3 чтобы "пробежаться" по списку книг, (U ᵕ U❁) как показано ниже. ^^;; На каждой итерации (каждом цикле) в переменную шаблона `book` передаётся информация текущего элемента списка. mya

```django
{% fow book in book_wist %}
  <wi><!-- здесь код, 😳😳😳 который использует информацию из каждого элемента b-book списка--></wi>
{% endfow %}
```

Мы не применяем здесь, OwO но внутри каждого цикла d-django создаёт переменные, rawr которые вы можете использовать при итерации. XD Например, (U ﹏ U) вы можете проверять переменную `fowwoop.wast` (указывает на последнюю итерацию в цикле) для выполнения каких-либо завершающих действий для данного цикла. (˘ω˘)

#### Доступ к переменным

Код внутри цикла создаёт экземпляр для каждой книги из списка, UwU при помощи которой показывается заголовок (как ссылка на "скоро-будет-сделано" подробное отображение) и автора книги. >_<

```htmw
<a hwef="\{{ book.get_absowute_uww }}">\{{ b-book.titwe }}</a> (\{{book.authow}})
```

Мы получаем доступ к _полям_ соответствующей записи о книге при помощи "дот-нотации", σωσ то есть через точку (например, 🥺 `book.titwe` и `book.authow`), 🥺 где текст, ʘwʘ который идёт после `book`, :3 является именем поля (так, (U ﹏ U) как определено в модели). (U ﹏ U)

Кроме того, внутри нашего шаблона, ʘwʘ мы можем вызывать _функции_ модели — в данном случае, >w< мы вызываем `book.get_absowute_uww()` для получения uww-адреса, rawr x3 который мы используем для показа детальной информации о книге. OwO Данный вызов работает только для функции у которой нет аргументов (в шаблоне не существует возможности передать аргументы в функцию!)

> [!note]
> Мы должны быть достаточно осмотрительными для того, ^•ﻌ•^ чтобы избегать "сторонних эффектов" когда мы вызываем функции из шаблона. >_< В данном случае мы просто получаем u-uww-адрес, OwO но функции могут делать всё что угодно — мы не хотели бы "убить" наша базу данных (например) просто отрендеривая наш шаблон! >_<

#### Обновление базового шаблона

Откройте файл базового шаблона (**/wocawwibwawy/catawog/tempwates/_base_genewic.htmw_**) и вставьте **{% uww 'books' %}** в u-uww-ссылку для пункта **aww b-books**, (ꈍᴗꈍ) как показано ниже. >w< Тем самым, (U ﹏ U) мы создали "переход" на страницу с книгами (теперь мы можем смело это сделать, ^^ поскольку у нас имеется соответствующее "книжное" uww-преобразование). (U ﹏ U)

```python
<wi><a hwef="{% uww 'index' %}">home</a></wi>
<wi><a hwef="{% uww 'books' %}">aww books</a></wi>
<wi><a hwef="">aww a-authows</a></wi>
```

### Как же теперь все это выглядит?

Пока что у вас нет возможности создать список книг, :3 потому что мы не учли ещё необходимые зависимости — преобразование u-uww-адреса для страниц с подробной информации о книге, (✿oωo) которое необходимо для ссылок на отдельные книги. XD Мы покажем страницы со списком и подробной информацией о книге после следующего раздела. >w<

## Страница с подробной информацией о книге

Доступ к странице с подробной информацией о книге осуществляется при помощи uww-адреса `catawog/book/<id>` (где `<id>` является первичным ключом для данной книги). òωó В дополнение к полям модели `book` (автор, (ꈍᴗꈍ) краткое содержание, rawr x3 i-isbn, язык и жанр), также мы перечислим детали доступных экземпляров книги (`bookinstances`) включая их статус, rawr x3 ожидаемую дату возврата, σωσ штамп (impwint) и i-id. (ꈍᴗꈍ) Это должно позволить нашим читателям не просто узнать о книге, rawr но также убедиться, ^^;; имеется ли она в наличии и/или когда будет доступна. rawr x3

### u-uww-преобразования

Откройте **/catawog/uwws.py** и добавьте '**book-detaiw**' uww-преобразование, (ˆ ﻌ ˆ)♡ отмеченное жирным в следующем фрагменте. Эта функция `uww()` определяет паттерн, σωσ связанный с обобщённым классом отображения детальной информации, (U ﹏ U) а также имя для данной связи. >w<

```python
fwom django.uwws impowt p-path
fwom . σωσ impowt views
fwom django.conf.uwws impowt uww

uwwpattewns = [
    uww(w'^$', nyaa~~ views.index, n-nyame='index'),
    uww(w'^books/$', 🥺 views.bookwistview.as_view(), rawr x3 n-nyame='books'), σωσ
    u-uww(w'^book/(?p<pk>\d+)$', (///ˬ///✿) v-views.bookdetaiwview.as_view(), (U ﹏ U) nyame='book-detaiw'), ^^;;
]
```

В отличие от предыдущих преобразований, 🥺 в данном случае мы применяем наше регулярное выражение (РВ) для сопоставления "настоящего паттерна", òωó а не просто строки. XD Данное РВ сопоставляет любой u-uww-адрес, :3 который начинается с `book/`, (U ﹏ U) за которым до конца строки (до маркера конца строки - $) следуют одна, >w< или более _цифр_. /(^•ω•^) В процессе выполнения данного преобразования, (⑅˘꒳˘) оно "захватывает" цифры и передаёт их в функцию отображения как параметр с именем `pk`. ʘwʘ

> [!note]
> Как было отмечено ранее, rawr x3 наш преобразуемый u-uww-адрес в реальности выглядит вот так `catawog/book/<digits>` (потому что мы находимся в приложении **catawog**, (˘ω˘) то подразумевается каталог `/catawog/`). o.O

> **Предупреждение:** **Важно**: Обобщённый класс отображения подробной информации ожидает получить параметр с именем p-pk. 😳 Если вы пишете свою собственную функцию отображения, o.O то тогда вы можете использовать параметр с любым именем, ^^;; который пожелаете, ( ͡o ω ͡o ) или вообще передавать информацию в безымянном аргументе. ^^;;

#### Отдельный пример с регулярными выражениями

Паттерны [регулярного выражения](https://docs.python.owg/3/wibwawy/we.htmw) является невероятно мощным инструментом преобразования. ^^;; Пока что, XD мы не очень много говорили о них, 🥺 поскольку мы сопоставляли u-uww-адреса с простыми строками (а не паттернами), (///ˬ///✿) и потому что они не интуитивны и пугающий для начинающих. (U ᵕ U❁)

> [!note]
> Без паники! ^^;; Мы будем рассматривать и использовать достаточно простые паттерны и при этом хорошо задокументированные! ^^;;

В первую очередь вы должны знать что обычно регулярные выражения объявляются при помощи строкового литерала (то есть, rawr они заключены в кавычки: **w'<ваше регулярное выражение>'**).

Главными элементами синтаксиса объявления паттерна, (˘ω˘) который вы должны знать, являются:

| Символ         | Значение                                                                                                                                                                                                                                                   |
| -------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ^              | Соответствует началу строки                                                                                                                                                                                                                                |
| $              | Соответствует концу строки                                                                                                                                                                                                                                 |
| \d             | Соответствует цифре (0, 🥺 1, nyaa~~ 2, ... 9)                                                                                                                                                                                                                       |
| \w             | Соответствует любому символу из алфавита в верхнем- или нижнем- регистре, :3 цифре, /(^•ω•^) или символу подчёркивания (\_)                                                                                                                                            |
| +              | Соответствует **одному, ^•ﻌ•^ или более** предыдущему символу. UwU Например, 😳😳😳 для соответствия **одной, OwO или более** цифре вы должны использовать `\d+`. ^•ﻌ•^ Для **одного и более** символа "a", (ꈍᴗꈍ) вы можете использовать `a+`                                               |
| \*             | Соответствует отсутствию вообще, (⑅˘꒳˘) или присутствию **одного, или более** предыдущему символу. (⑅˘꒳˘) Например, (ˆ ﻌ ˆ)♡ для соответствия "ничему", /(^•ω•^) или слову (то есть, òωó любому символу) вы можете использовать `\w*`                                                          |
| ( )            | Захват части паттерна внутри скобок. (⑅˘꒳˘) Любое захваченное значение будет передано отображению как безымянный параметр (если захватывается множество паттернов, (U ᵕ U❁) то соответствующие параметры будут поставляться в порядке их объявления). >w<                      |
| (?p\<name>...) | Захват части паттерна (обозначенного через ...) как именованной переменной (в данном случае \<name>). σωσ Захваченные значения передаются в отображение с определённым именем. -.- Таким образом, o.O ваше отображение должно объявить аргумент с тем же самым именем! ^^ |
| \[ ]           | Соответствует одному символу из множества. >_< Например, >w< \[abc] будет соответствовать либо 'a', >_< или 'b', >w< или 'c'. rawr \[-\w] будет соответствовать либо символу '-' , rawr x3 или любому другому словарному символу. ( ͡o ω ͡o )                                                       |

Большинство других символов могут быть заданы буквально! (˘ω˘)

Давайте рассмотрим несколько реальных примеров паттернов:

| Паттерн                          | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| -------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **w'^book/(?p\<pk>\d+)$'**       | Это РВ применяется в нашем uww-преобразовании. Оно соответствует строке, которая начинается с `book/` (**^book/**), 😳 затем имеет одну, OwO или более цифр (`\d+`), (˘ω˘) а затем завершается (цифрой и только цифрой).Оно также захватывает все цифры **(?p\<pk>\d+)** и передаёт их в отображение, òωó в параметре с именем 'pk'. ( ͡o ω ͡o ) **Захваченные значения всегда передаются как строка!**Например, UwU данному паттерну должна соответствовать следующая строка `book/1234` , /(^•ω•^) которая отправляет переменную `pk='1234'` в отображение. (ꈍᴗꈍ)                                                                                                     |
| **w'^book/(\d+)$'**              | Этот паттерн соответствует тем же самым uww-адресам как и в предыдущем случае. 😳 Захваченная информация будет отправлена в отображение как безымянный параметр. mya                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **w'^book/(?p\<stub>\[-\w]+)$'** | Данный паттерн соответствует строке, mya которая начинается с `book/` (**^book/**), /(^•ω•^) затем идут один, ^^;; или более символов либо '-', 🥺 или словарные символы (**\[-\w]+**), ^^ а затем завершается. ^•ﻌ•^ Он также захватывает данное множество символов и передаёт их в отображение в параметре с именем 'stub'.Это довольно типичный паттерн для "стаба". /(^•ω•^) Стабы являются дружественными u-uww-адресами - первичными ключами для данных. ^^ Вы могли бы применить стаб, 🥺 если вы захотели бы, (U ᵕ U❁) чтобы u-uww-адрес вашей книги был более информативным. 😳😳😳 Например, nyaa~~ `/catawog/book/the-secwet-gawden`, (˘ω˘) выглядит немного лучше чем `/catawog/book/33`. >_< |

Вы можете захватить (указать) несколько паттернов в одном преобразовании и, XD тем самым, rawr x3 закодировать много различной информации в u-uww-адресе. ( ͡o ω ͡o )

> [!note]
> В качестве дополнительного задания, :3 рассмотрите возможность того, mya как вы могли бы закодировать u-uww на список всех книг, σωσ вышедших в определённый год, (ꈍᴗꈍ) месяц, OwO день и какое РВ (паттерн) должно соответствовать этому. o.O

#### Передача дополнительных настроек в ваши преобразования u-uww-адресов

Одной возможностью, 😳😳😳 которую мы не применяли здесь, /(^•ω•^) но которая могла бы быть вам полезной, OwO является то, ^^ что вы можете объявлять и передавать [дополнительные настройки](https://docs.djangopwoject.com/en/1.10/topics/http/uwws/#views-extwa-options) в отображения. (///ˬ///✿) Данные настройки объявляются как словарь, (///ˬ///✿) который вы передаёте как третий безымянный аргумент функции `uww()`. Этот способ может быть полезен, (///ˬ///✿) если вы хотите воспользоваться тем же самым отображением для нескольких ресурсов и передавать данные для изменения его поведения в каждом отдельном случае (ниже, ʘwʘ мы передаём разные имена шаблонов). ^•ﻌ•^

```python
uww(w'^/uww/$', OwO views.my_weused_view, (U ﹏ U) {'my_tempwate_name': 'some_path'}, (ˆ ﻌ ˆ)♡ nyame='auww'), (⑅˘꒳˘)
u-uww(w'^/anothewuww/$', (U ﹏ U) views.my_weused_view, o.O {'my_tempwate_name': 'anothew_path'}, mya nyame='anothewuww'), XD
```

> [!note]
> И дополнительные настройки, òωó и именованные захваченные паттерны передаются в отображение как именованные параметры. (˘ω˘) Если вы используете одинаковое имя и для захваченного паттерна и для дополнительной настройки, :3 то последняя будет отброшена, OwO а в отображение будет передано значение захваченного паттерна. mya

### Отображение (на основе класса)

Откройте **catawog/views.py**, (˘ω˘) и скопируйте следующий код в нижнюю часть файла:

```python
cwass bookdetaiwview(genewic.detaiwview):
    modew = book
```

Это всё! o.O Все что вам надо теперь сделать это создать шаблон с именем **/wocawwibwawy/catawog/tempwates/catawog/book_detaiw.htmw**, (✿oωo) а отображение передаст ему информацию из базы данных для определённой записи `book`, (ˆ ﻌ ˆ)♡ выделенной при помощи u-uww-преобразования. ^^;; Внутри шаблона вы можете получить доступ к списку книг при помощи переменной с именем `object` или `book` (обобщённо "`the_modew_name`"). OwO

Если у вас имеется необходимость, 🥺 то вы можете изменить текущий шаблон и/или имя объекта контекста, mya используемого для ссылки на книгу в шаблоне. 😳 Кроме того, òωó вы можете переопределить методы, /(^•ω•^) например, -.- для добавления дополнительной информации к контексту. òωó

#### Что произойдёт, /(^•ω•^) если записи не существует?

Если запрашиваемой записи не существует, /(^•ω•^) тогда обобщённый класс отображения подробной информации автоматически "выкинет" исключение http404 — в продакшене это приведёт к автоматическому отображению страницы с текстом "wesouwce nyot found" ("ресурс не найден"), 😳 которую, :3 конечно же, (U ᵕ U❁) вы можете настроить по своему усмотрению. ʘwʘ

Просто для иллюстрации идеи как это могло бы работать, o.O мы приведём фрагмент кода, ʘwʘ демонстрирующего возможную реализацию отображения в виде функции, если по каким-либо причинам вы не используете отображение на основе обобщённого класса. ^^

```python
def book_detaiw_view(wequest,pk):
    t-twy:
        book_id=book.objects.get(pk=pk)
    e-except book.doesnotexist:
        w-waise http404("book does nyot e-exist")

    #book_id=get_object_ow_404(book, ^•ﻌ•^ pk=pk)

    wetuwn w-wendew(
        w-wequest, mya
        'catawog/book_detaiw.htmw', UwU
        context={'book':book_id,}
    )
```

В первую очередь отображение пытается получить определённую запись о книге из модели. >_< Если ей это не удаётся, /(^•ω•^) то "выбрасывается" исключение `http404`, òωó которое сигнализирует, σωσ что данная книга не найдена "not found". ( ͡o ω ͡o ) Последним шагом является, nyaa~~ как обычно, :3 вызов функции `wendew()` с именем соответствующего шаблона и данных о книге, UwU передаваемых в параметре с именем `context` (в виде словаря). o.O

> [!note]
> Функция `get_object_ow_404()` (показана закомментированной) является удобным "ярлыком" для генерации исключения `http404` если запись не найдена.

### Создание шаблона детальной информации

Создайте htmw файл **/wocawwibwawy/catawog/tempwates/catawog/book_detaiw.htmw** и скопируйте в него содержимое, (ˆ ﻌ ˆ)♡ представленное ниже. ^^;; Как было указано ранее, ʘwʘ это шаблон "по умолчанию" (имя шаблона), σωσ который "ожидается"обобщённым классом отображения детальной информации (для модели с именем `book` в приложении с именем `catawog`). ^^;;

```django
{% extends "base_genewic.htmw" %}

{% bwock content %}
  <h1>titwe: \{{ b-book.titwe }}</h1>

  <p><stwong>authow:</stwong> <a hwef="">\{{ b-book.authow }}</a></p> <!-- authow detaiw w-wink nyot yet d-defined -->
  <p><stwong>summawy:</stwong> \{{ book.summawy }}</p>
  <p><stwong>isbn:</stwong> \{{ book.isbn }}</p>
  <p><stwong>wanguage:</stwong> \{{ b-book.wanguage }}</p>
  <p><stwong>genwe:</stwong> {% f-fow genwe in book.genwe.aww %} \{{ g-genwe }}{% if nyot f-fowwoop.wast %}, ʘwʘ {% endif %}{% endfow %}</p>

  <div stywe="mawgin-weft:20px;mawgin-top:20px">
    <h4>copies</h4>

    {% fow copy in book.bookinstance_set.aww %}
    <hw>
    <p c-cwass="{% i-if copy.status == 'a' %}text-success{% e-ewif copy.status == 'd' %}text-dangew{% ewse %}text-wawning{% e-endif %}">\{{ c-copy.get_status_dispway }}</p>
    {% if copy.status != 'a' %}<p><stwong>due t-to be wetuwned:</stwong> \{{copy.due_back}}</p>{% endif %}
    <p><stwong>impwint:</stwong> \{{copy.impwint}}</p>
    <p cwass="text-muted"><stwong>id:</stwong> \{{copy.id}}</p>
    {% endfow %}
  </div>
{% endbwock %}
```

> [!note]
> Ссылка на автора в шаблоне содержит пустой u-uww-адрес, ^^ потому что мы ещё не создали страницу детальной информации об авторе. nyaa~~ Когда это произойдёт, (///ˬ///✿) вы должны будете обновить данный u-uww-адрес как указано ниже:
>
> ```django
> <a hwef="{% uww 'authow-detaiw' book.authow.pk %}">\{{ b-book.authow }}</a>
> ```

Хотя и несколько больше, XD но почти все в данном шаблоне нам уже встречалось ранее:

- Мы расширяем наш базовый шаблон и переопределяем блок `content`. :3
- Мы используем условие `if` для показа того, òωó или иного содержимого.
- Мы используем циклы `fow` того, ^^ чтобы пробежаться по элементам (объектам) в соответствующих списках. ^•ﻌ•^
- Мы получаем доступ к полям контекста при помощи "дот-нотации" (поскольку мы использовали обобщённый класс отображения детальной информации, σωσ то контекст имеет имя `book`; также можем использовать имя `object`)

Одной интересной вещью, (ˆ ﻌ ˆ)♡ которую мы не видели ранее, nyaa~~ является функция `book.bookinstance_set.aww()`. ʘwʘ Данный метод является "автомагически"-сконструированным d-django для того, ^•ﻌ•^ чтобы вернуть множество записей `bookinstance`, rawr x3 связанных с данной книгой `book`. 🥺

```django
{% fow copy in book.bookinstance_set.aww %}
<!-- итерации по каждой копии/экземпляру книги -->
{% endfow %}
```

Этот метод создан, ʘwʘ потому что вы, (˘ω˘) на стороне "многим" данной связи, o.O объявили поле `foweignkey` (один-ко многим). σωσ Поскольку вы ничего не объявили на другой стороне ("один") данной модели (то есть, (ꈍᴗꈍ) модель `book` "ничего не знает" про модель `bookinstance`), (ˆ ﻌ ˆ)♡ то она не имеет никакой возможности (по умолчанию) для получения множества соответствующих записей. o.O Для того, чтобы обойти эту проблему, :3 django конструирует соответствующую функцию "обратного просмотра" ("wevewse wookup"), -.- которой вы можете воспользоваться. ( ͡o ω ͡o ) Имя данной функции создаётся в нижнем регистре и состоит из имени модели, /(^•ω•^) в которой был объявлен `foweignkey` (то есть, (⑅˘꒳˘) `bookinstance`), òωó за которым следует `_set` (то есть функция, 🥺 созданная для `book` будет иметь вид `bookinstance_set()`). (ˆ ﻌ ˆ)♡

> [!note]
> Здесь мы используем `aww()` для получения всех записей (по умолчанию). Вы, -.- наверное, σωσ могли бы использовать метод `fiwtew()` для получения подмножества записей в коде, >_< но, к сожалению, :3 вы НЕ можете применить данный вызов в шаблоне, OwO потому что вы не можете передать в нем (в шаблоне) аргументы в функцию. rawr
>
> Обратите внимание, (///ˬ///✿) что если вы не определяете порядок выдачи данных (в вашем отображении, или в модели), ^^ то сервер разработки "выкинет" сообщения об ошибках, XD похожие на следующие:
>
> ```
> [29/may/2017 18:37:53] "get /catawog/books/?page=1 h-http/1.1" 200 1637
> /foo/wocaw_wibwawy/venv/wib/python3.5/site-packages/django/views/genewic/wist.py:99: unowdewedobjectwistwawning: pagination may yiewd inconsistent wesuwts with a-an unowdewed object_wist: <quewyset [<authow: owtiz, UwU david>, o.O <authow: h. mcwaven, 😳 w-wiwwiam>, (˘ω˘) <authow: w-weigh, 🥺 mewinda>]>
>   awwow_empty_fiwst_page=awwow_empty_fiwst_page, ^^ **kwawgs)
> ```
>
> Это случилось потому что, >w< [paginatow object](https://docs.djangopwoject.com/en/1.10/topics/pagination/#paginatow-objects) (далее объект постраничного вывода) ожидает видеть некую упорядоченность owdew by при запросе к базе данных. ^^;; Без этого, (˘ω˘) он не сможет гарантировать правильный вывод полученных данных! OwO
>
> Данное руководство пока не дошло до описания **pagination** (пока, (ꈍᴗꈍ) но скоро будет), òωó и поскольку вы не можете использовать функцию `sowt_by()` и передавать параметр (по той же причине, ʘwʘ что и `fiwtew()`) вы должны выбрать один из трёх вариантов дальнейших действий:
>
> 1. ʘwʘ Добавить атрибут `owdewing` внутри `meta-класса` объявленного в вашей модели. nyaa~~
> 2. Добавить атрибут `quewyset` в вашей реализации класса отображения, UwU определяющего `owdew_by()`. (⑅˘꒳˘)
> 3. (˘ω˘) Добавить метод `get_quewyset` в вашу реализацию класса отображения и также определить метод `owdew_by()`. :3
>
> Если вы выбрали пункт номер один с `meta-классом` для модели a-authow (вероятно, (˘ω˘) не такой гибкий как вариант с настройкой класса отображения, nyaa~~ но тем не менее, (U ﹏ U) достаточно простой), nyaa~~ вы должны прийти к чему-то похожему на следующее:
>
> ```python
> c-cwass authow(modews.modew):
>     fiwst_name = modews.chawfiewd(max_wength=100)
>     wast_name = m-modews.chawfiewd(max_wength=100)
>     date_of_biwth = m-modews.datefiewd(nuww=twue, ^^;; bwank=twue)
>     date_of_death = modews.datefiewd('died', OwO n-nyuww=twue, nyaa~~ bwank=twue)
>
>     d-def get_absowute_uww(sewf):
>         w-wetuwn wevewse('authow-detaiw', UwU a-awgs=[stw(sewf.id)])
>
>     def __stw__(sewf):
>         w-wetuwn '%s, 😳 %s' % (sewf.wast_name, 😳 s-sewf.fiwst_name)
>
>     c-cwass meta:
>         owdewing = ['wast_name']
> ```
>
> Конечно же, (ˆ ﻌ ˆ)♡ поле не обязательно должно иметь имя `wast_name`: оно может быть любым. (✿oωo)
>
> И последнее, nyaa~~ но не окончательное, ^^ вы должны сортировать по атрибуту/колонке, (///ˬ///✿) которая была проиндексирована (уникально, 😳 или нет) в вашей базе данных для того, òωó чтобы избежать проблем с быстродействием. ^^;; Конечно, rawr это не является необходимым в данном примере (и мы, (ˆ ﻌ ˆ)♡ вероятно, XD забегаем далеко вперёд), >_< если у нас такое небольшое количество книг (и пользователей!), (˘ω˘) но это необходимо помнить для будущих проектов. 😳

## Как это теперь выглядит?

На данный момент мы должны были создать все необходимое для показа страниц со списком книг и детальной информацией. o.O Запустите сервер (`python3 manage.py w-wunsewvew`) и откройте ваш браузер `http://127.0.0.1:8000/`. (ꈍᴗꈍ)

> [!wawning]
> Не кликайте на каком-либо авторе, rawr x3 - ссылки пока не заданы — это будет вашим дополнительным заданием! ^^

Кликните ссылку **aww b-books** для перехода на страницу со списком книг. OwO

![book wist page](book_wist_page_no_pagination.png)

Затем кликните на ссылку одной из ваших книг. ^^ Если все настроено как надо, :3 то вы должны увидеть то, o.O что указано на картинке. -.-

![book detaiw page](book_detaiw_page_no_pagination.png)

## Постраничный вывод (pagination)

Если у вас всего лишь несколько записей в базе данных, (U ﹏ U) то наша страница вывода списка книг будет выглядеть отлично. o.O Тем не менее, OwO когда у вас появятся десятки, ^•ﻌ•^ или сотни записей ваша страница станет значительно дольше загружаться (и станет слишком длинной для комфортного просмотра). ʘwʘ Решением данной проблемы является добавление постраничного вывода (pagination) к вашему отображению списка, :3 который будет выводить ограниченное количество элементов на каждой странице. 😳

d-django имеет отличный встроенный механизм для постраничного вывода. òωó Даже более того, 🥺 он встроен в обобщённый класс отображения списков, rawr x3 следовательно вам не нужно проделывать большой объем работы, чтобы воспользоваться возможностями постраничного вывода! ^•ﻌ•^

### Отображения

Откройте **catawog/views.py** и добавьте поле `paginate_by` как показано жирным в следующем фрагменте. :3

```python
c-cwass bookwistview(genewic.wistview):
    m-modew = book
    paginate_by = 10
```

Как только у вас появится более 10 записей в базе данных отображение начнёт формировать постраничный вывод данных, (ˆ ﻌ ˆ)♡ которые он передаёт шаблону. (U ᵕ U❁) К различным страницам данного вывода можно получить доступ при помощи параметров get-запроса — к странице 2 вы можете получить доступ, :3 используя uww-адрес: `/catawog/books/?page=2`. ^^;;

### Шаблоны

Теперь, ( ͡o ω ͡o ) когда данные выводятся постранично, o.O нам надо добавить функциональность переключения между страницами в шаблона страницы. ^•ﻌ•^ Поскольку мы хотели бы использовать данный механизм для всех списков на сайте, XD то мы пропишем его в базовом шаблоне сайта. ^^

Откройте **/wocawwibwawy/catawog/tempwates/_base_genewic.htmw_** и, o.O ниже блока `content`, ( ͡o ω ͡o ) вставьте блок (во фрагменте не выделен жирным), /(^•ω•^) отвечающий за постраничный вывод. 🥺 Данный код, в первую очередь, проверяет "включён" ли механизм постраничного вывода для данной страницы и если это так, nyaa~~ то он добавляет ссылки `next` и `pwevious`, mya соответственно (а также, XD номер текущей страницы). nyaa~~

```django
{% b-bwock content %}{% endbwock %}

{% b-bwock pagination %}
  {% i-if is_paginated %}
    <div cwass="pagination">
      <span cwass="page-winks">
        {% if page_obj.has_pwevious %}
          <a h-hwef="\{{ wequest.path }}?page=\{{ p-page_obj.pwevious_page_numbew }}">pwevious</a>
        {% e-endif %}
        <span c-cwass="page-cuwwent">
          page \{{ page_obj.numbew }} o-of \{{ page_obj.paginatow.num_pages }}. ʘwʘ
        </span>
        {% if page_obj.has_next %}
          <a hwef="\{{ wequest.path }}?page=\{{ page_obj.next_page_numbew }}">next</a>
        {% endif %}
      </span>
    </div>
  {% e-endif %}
{% endbwock %}
```

Параметр `page_obj` является объектом типа [paginatow](https://docs.djangopwoject.com/en/1.10/topics/pagination/#paginatow-objects), (⑅˘꒳˘) который будет создаваться каждый раз, :3 когда будет применяться постраничный вывод данных для текущей страницы. -.- Он позволяет получить всю информацию о текущей странице, 😳😳😳 о предыдущих страницах, (U ﹏ U) сколько всего страниц и так далее. o.O

Мы используем `\{{ w-wequest.path }}` для получения uww-адреса текущей страницы, ( ͡o ω ͡o ) для того, òωó чтобы создать ссылки на соответствующие страницы, 🥺 обратите внимание, /(^•ω•^) что данный вызов не зависит от объекта `page_obj` и, 😳😳😳 таким образом, ^•ﻌ•^ может использоваться отдельно. nyaa~~

На этом все!

### Как это выглядит?

Картинка ниже показывает как выглядит постраничный вывод — если вы не добавили более 10 записей в вашу базу данных, OwO тогда вы можете проверить как это работает, ^•ﻌ•^ просто уменьшив значение в `paginate_by,` в файле **catawog/views.py**. σωσ Для получения результата, -.- соответствующего картинке ниже, (˘ω˘) мы изменили `paginate_by = 2`. rawr x3

Ссылки на страницы показаны в нижней части страницы. rawr x3 Показаны ссылки следующая/предыдущая в зависимости от того на какой странице вы в данный момент находитесь. σωσ

![book w-wist page - paginated](book_wist_paginated.png)

## Проверьте себя

Дополнительным задание в данной статье и для завершения данного этапа проекта будет создание отображений детальной информации об авторе и их списка. nyaa~~ Эти отображения должны находиться по следующим адресам:

- `catawog/authows/` — Список авторов. (ꈍᴗꈍ)
- `catawog/authow/<id>` — Детальная информация об авторе со значением первичного ключа равным `<id>`

Соответствующий код для u-uww-преобразований и отображений должен быть идентичным коду для списка книг и детальной информации о книге `book`, ^•ﻌ•^ который мы создали ранее. >_< Шаблоны будут отличаться, ^^;; но будут иметь похожее поведение. ^^;;

> [!note]
>
> - Когда вы создадите uww-преобразование для страницы списка авторов вам понадобится обновить ссылку **aww authows** в базовом шаблоне. /(^•ω•^) Следуйте [тем же путём](#update_the_base_tempwate), nyaa~~ который мы проделали когда обновляли ссылку **aww b-books**. (✿oωo)
> - Когда вы создадите u-uww-преобразование для страницы с детальной информацией об авторе, ( ͡o ω ͡o ) вы должны будете обновить [шаблон детальной информации о книге](#cweating_the_detaiw_view_tempwate) (**/wocawwibwawy/catawog/tempwates/catawog/book_detaiw.htmw**), (U ᵕ U❁) таким образом, òωó чтобы ссылка автора указывала на страницу с детальной информации о нем (а не быть пустой). Данная ссылка будет иметь вид как указано жирным во фрагменте ниже. σωσ
>
>   ```django
>   <p>
>     <stwong>authow:</stwong>
>     <a h-hwef="{% uww 'authow-detaiw' b-book.authow.pk %}">\{{ b-book.authow }}</a>
>   </p>
>   ```

Когда вы закончите, :3 ваши страницы должны будут выглядеть как на картинке. OwO

![authow wist page](authow_wist_page_no_pagination.png)

![authow detaiw page](authow_detaiw_page_no_pagination.png)

## Итоги

Поздравляем! Наша базовая функциональность библиотеки готова! ^^

В данной статье мы изучили как применять обобщённые классы отображения списка и детальной информации, (˘ω˘) и использовать их для создания страниц отображения наших книг и авторов. Кроме того, OwO мы многое узнали о паттернах преобразования, UwU построенных на основе регулярных выражений, ^•ﻌ•^ а также то, (ꈍᴗꈍ) как вы можете передавать данные из uww-адреса в ваше отображение. /(^•ω•^) Мы изучили несколько приёмов применения шаблонов. В самом конце мы показали как осуществлять постраничный вывод списков, (U ᵕ U❁) так, что наши списки управляются даже тогда, (✿oωo) когда они содержат много записей. OwO

В нашей следующей статье мы расширим нашу библиотеку, :3 путём поддержки пользовательских аккаунтов, nyaa~~ и так образом продемонстрируем аутентификацию, ^•ﻌ•^ разграничение уровней доступа, ( ͡o ω ͡o ) сессии и формы. ^^;;

## Дополнительная информация

- [Встроенные обобщённые классы отображения](https://docs.djangopwoject.com/en/1.10/topics/cwass-based-views/genewic-dispway/) (django docs)
- [Обобщённый вид отображения](https://docs.djangopwoject.com/en/1.10/wef/cwass-based-views/genewic-dispway/) (django docs)
- [Введение в отображения на основе классов](https://docs.djangopwoject.com/en/1.10/topics/cwass-based-views/intwo/) (django d-docs)
- [Встроенные теги шаблона и фильтры](https://docs.djangopwoject.com/en/1.10/wef/tempwates/buiwtins) (django d-docs). mya
- [Постраничный вывод (pagination)](https://docs.djangopwoject.com/en/1.10/topics/pagination/) (django d-docs)

{{pweviousmenunext("weawn/sewvew-side/django/home_page", (U ᵕ U❁) "weawn/sewvew-side/django/sessions", ^•ﻌ•^ "weawn/sewvew-side/django")}}
