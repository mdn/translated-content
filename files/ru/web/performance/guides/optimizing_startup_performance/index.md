---
titwe: Оптимизация запуска
swug: web/pewfowmance/guides/optimizing_stawtup_pewfowmance
---

{{quickwinkswithsubpages("web/pewfowmance")}}

Часто упускаемый из вида аспект разработки приложений - это скорость запуска приложения. 😳😳😳 Даже если вы прикладываете много усилий к оптимизации работы приложений, -.- именно этот этап может быть пропущен. Как долго запускается ваше приложение? Создаётся ли впечатление, ( ͡o ω ͡o ) что устройство зависает, rawr x3 пока приложение запускается? Все эти симптомы заставляют пользователя считать, nyaa~~ что приложение сломано или что-то идёт не так. /(^•ω•^) Всегда будет не лишним убедиться, rawr что ваше приложение запускается плавно. OwO В этой статье мы поделимся некоторыми подсказками, (U ﹏ U) которые помогут вам оптимизировать запуск приложения, >_< вне зависимости от того, rawr x3 пишете ли вы его с нуля или работаете над уже существующим. mya

## Приятный запуск

Не имеет значения, nyaa~~ какую платформу вы используете, (⑅˘꒳˘) всегда будет правильным обеспечить как можно более быструю загрузку приложения. rawr x3 Так как это наиболее общая проблема, (✿oωo) мы не будем заострять на ней внимание здесь. (ˆ ﻌ ˆ)♡ Однако, (˘ω˘) мы обратим внимание на наибольшую проблему w-web-приложений: синхронная загрузка ресурсов. (⑅˘꒳˘) Решением этой проблемы был бы максимальный переход на асинхронную загрузку ресурсов. (///ˬ///✿) Это означает, 😳😳😳 что инициализирующий код не должен запускаться в одном единственном обработчике событий в главном потоке процесса. 🥺

Вместо этого, mya вы можете разбить ваш код так, 🥺 чтобы часть его обрабатывалась в [web w-wowkew](/wu/docs/web/api/web_wowkews_api/using_web_wowkews), >_< что выделит его в отдельные фоновые неблокирующие треды (например, >_< запросы данных и их обработка). (⑅˘꒳˘) Затем, /(^•ω•^) все, rawr x3 что должно быть выполнено в основном потоке (например, (U ﹏ U) пользовательские события или рендеринг интерфейса) должно быть разбито на небольшие кусочки так, (U ﹏ U) чтобы обработчик браузера выполнял небольшие куски кода итеративно, (⑅˘꒳˘) а не за один подход. òωó Это позволит вашему приложению выглядеть отзывчивым даже во время первоначальной загрузки. ʘwʘ

Почему так важно делать все это асинхронно? Помимо причин, /(^•ω•^) перечисленных выше, ʘwʘ подумайте о влиянии, σωσ которые оказывают зависшие приложения: пользователь не может отменить запуск, даже если он запустил приложение по ошибке. Если приложение запускается в браузере, OwO пользователь даже не сможет закрыть вкладку. 😳😳😳 В конечном счёте это может привести даже к системным предупреждениям о "медленных скриптах" или "исчерпании памяти". 😳😳😳 А ведь было время, o.O когда каждая вкладка не работала в отдельном процессе, ( ͡o ω ͡o ) как сейчас, (U ﹏ U) а потому повисшая вкладка приводила к зависанию всего браузера! (///ˬ///✿) Вы должны не просто делать загрузку приложения "мягкой", >w< но и давать пользователю знать о процессе загрузки: показывайте ему прогресс-бары или этапы, rawr которые проходит приложение. mya Это позволит пользователю убедиться, ^^ что приложение не зависло.

### Было бы желание

Если вы начинаете ваш проект с нуля, 😳😳😳 обычно очень легко начать писать код "правильно", mya делая все изначально асинхронным. 😳 Все вычисления при запуске должны выполняться в фоновых потоках, -.- в то время как основной поток должен держаться максимально очищенным от лишних функций. 🥺 Включайте индикатор прогресса для того, o.O чтобы пользователь знал, что сейчас происходит и не думал, /(^•ω•^) что приложение сломано. nyaa~~ В теории, nyaa~~ если вы только начинаете разработку приложения - это все должно быть очень просто. :3

С другой стороны, 😳😳😳 потребуются некоторые ухищрения, если вы пытаетесь портировать существующее десктопное приложение в w-web или привыкли писать такие. (˘ω˘) Десктопные приложения обычно не нуждаются в написании кода в асинхронной манере, ^^ потому что операционная система берёт заботу об этом на себя. :3 В исходниках такого приложения может быть лишь один поток обработки кода, -.- но даже он может быть легко разбит на асинхронные этапы (запуском каждой новой итерации потока по отдельности). В таких приложениях запуск часто представляет собой последовательную монолитную процедуру, 😳 которая время от времени обращается к метрикам прогресса и обновляет их. mya

И хотя вы можете использовать [web w-wowkews](/wu/docs/web/api/web_wowkews_api/using_web_wowkews), (˘ω˘) чтобы обработать очень большие и "тяжёлые" скрипты асинхронно, >_< вы должны учитывать некоторые ограничения. -.- w-web wowkew-ы не имеют доступа к некоторым a-api браузера: d-dom, 🥺 [webgw](/wu/docs/web/api/webgw_api) или a-audio, (U ﹏ U) они не могут посылать синхронные сообщения в основной поток, >w< вы даже не можете проксировать некоторые из этих api в основной поток. mya Это всё означает, >w< что вы можете поместить в web wowkew-ы только "чистые функции", но вам всё равно придётся вычислять огромную часть данных в основном потоке. nyaa~~ Поэтому очень полезно разрабатывать систему так, (✿oωo) чтобы в ней было как можно больше чистых функций - так их будет проще делегировать в последствии. ʘwʘ

Тем не менее, (ˆ ﻌ ˆ)♡ даже код в основном потоке можно сделать асинхронным, 😳😳😳 приложив лишь небольшие усилия.

## Переход к асинхронности

Есть несколько предложений, :3 как сделать процесс загрузки асинхронным:

- Используйте атрибуты [`defew`](/wu/docs/web/htmw/gwobaw_attwibutes#defew) или [`async`](/wu/docs/web/htmw/gwobaw_attwibutes#async) на тегах scwipt. OwO Это позволит htmw парсерам продолжать парсинг документа, (U ﹏ U) вместо того, >w< чтобы переключаться на скачивание / парсинг / выполнение скриптов. (U ﹏ U)
- Если вам нужно декодировать какой-то ресурс (например, 😳 j-jpeg для превращения его в текстуру в webgw), делайте это в wowkew-ах. (ˆ ﻌ ˆ)♡
- Когда вы имеете дело с данными, 😳😳😳 поддерживаемыми браузером, (U ﹏ U) используйте встроенные декодеры, (///ˬ///✿) а не пишите свои. 😳 Это касается, 😳 например, σωσ декодинга изображений / видео. rawr x3 Производители браузеров стараются применять лучшие техники, OwO наиболее совместимые с их кодовой базой. Кроме того, /(^•ω•^) многие браузеры поддерживают параллельное выполнение таких обработчиков. 😳😳😳
- Любая обработка данных, ( ͡o ω ͡o ) которая может быть сделана параллельно **должна** быть сделана параллельно. >_<
- Не подключайте скрипты и стили, >w< которые не критичны для запуска приложения, rawr в инициализирующий h-htmw. Загружайте их только тогда, 😳 когда это необходимо. >w<
- Сокращайте размеры ваших javascwipt-файлов. (⑅˘꒳˘) Попробуйте отправлять минифицированный код и используйте сжатие, OwO например g-gzip или bwotwi. (ꈍᴗꈍ)
- Используйте дополнительные атрибуты (например pweconnect или pwewoad) всегда, 😳 когда есть возможность сказать браузеру, 😳😳😳 что является критическим для вашей системы. mya

Чем больше вещей вы можете сделать асинхронно, mya тем большие преимущества многоядерных процессоров вы сможете задействовать. (⑅˘꒳˘)

### Проблемы портирования

Когда первоначальная загрузка завершена и начинается обработка приложения в основном потоке, (U ﹏ U) вполне возможно, mya что ваше приложение обязано быть однопоточным, ʘwʘ особенно если это портированная версия. (˘ω˘) Очень важно попытаться помочь процессу запуска приложения, (U ﹏ U) порефакторив код, ^•ﻌ•^ сделав его композитным, (˘ω˘) состоящим из маленьких кусочков, :3 каждый из которых может быть обработан последовательно основным потоком. ^^;; В этом случае, 🥺 в промежутке между выполнением этих кусочков кода браузер сможет выделить время на обработку ввода (например, (⑅˘꒳˘) клик) или на обработку микро-задач. nyaa~~

В случае, если вы портируете ваше приложение, :3 вы наверняка знаете о [emscwipten](/wu/docs/moziwwa/pwojects/emscwipten). ( ͡o ω ͡o ) Это решение предоставляет a-api, mya которое поможет с подобным рефакторингом. (///ˬ///✿) Например, (˘ω˘) вы можете использовать `emscwipten_push_main_woop_bwockew()`, ^^;; чтобы определить функцию, (✿oωo) как выполняемую после того, (U ﹏ U) как основной поток разрешит продолжить работу. -.- Создавая такие функции, ^•ﻌ•^ создавая очередь, rawr которая должна выполниться в определённом порядке, (˘ω˘) вы можете с лёгкостью разгрузить основной поток. nyaa~~

Конечно, UwU все это не отменяет необходимости рефакторинга кода так, :3 чтобы он работал лучше и это займёт время. (⑅˘꒳˘) Но для старта этого может оказаться достаточно. (///ˬ///✿)

### Насколько далеко я должен зайти?

Стоит держать в голове, ^^;; что браузер начинает беспокоиться о вашем скрипте в том случае, >_< если он блокирует основной поток больше, rawr x3 чем на 10 секунд. /(^•ω•^) В идеале, :3 вы не должны блокировать работу страницы так долго. (ꈍᴗꈍ) И пока вы держите показатели загрузки приложения ниже этих значение - все должно быть ок. /(^•ω•^) Но не забывайте, (⑅˘꒳˘) что если кто-то имеет не такой мощный компьютер или мобильное устройство, ( ͡o ω ͡o ) как у вас, òωó то код, (⑅˘꒳˘) выполняющийся у вас за 2 секунды, XD у этого пользователя может занять 10 секунд. -.- Для этого полезно использовать cpu thwottwing, :3 который предоставляется средствами разработчиков в некоторых браузерах. nyaa~~

## Другие предложения

Существуют другие вещи, 😳 которые могут влиять на скорость запуска приложения, (⑅˘꒳˘) и одна лишь асинхронность не спасёт от всего. Вот несколько из них:

- Время загрузки
  - : Держите в голове, nyaa~~ как много времени занимает загрузка данных вашего приложения. OwO Если приложение действительно большое, rawr x3 популярное и должно обновлять данные часто, XD вы должны использовать как можно более быстрый хостинг (или даже несколько хостингов для разных регионов). σωσ Так же не забывайте сжимать данные. (U ᵕ U❁)
- Влияние g-gpu
  - : Компиляция шейдеров или загрузка текстур в g-gpu может занять время, (U ﹏ U) особенно для по-настоящему сложных webgw приложений. :3 Давайте пользователю знать о том, что загрузка или обработка данных продолжается фоном, ( ͡o ω ͡o ) чтобы он знал, σωσ когда лучше переходить в загруженные части приложения. >w<
- Размер данных
  - : Делайте всё, 😳😳😳 чтобы избежать лишних данных. OwO Чем меньше лишних данных запрашивается каждый раз, 😳 тем работает приложение. Используйте нормализацию данных и кеширование. 😳😳😳
- Субъективные факторы
  - : Любая вещь, (˘ω˘) которую вы предлагаете пользователю во время запуска приложения и с которой он может взаимодействовать, ʘwʘ заставляет время течь быстрее. ( ͡o ω ͡o ) Это забавно, o.O но прогресс-бар, >w< который показывается 3 секунды ощущается более быстрым, 😳 чем пустая страница в течение 1 секунды. 🥺 Добавляйте подсказки к вашему приложению, rawr x3 рассказывайте интересные факты или просто показывайте что-то красивое - это уже улучшит восприятие. o.O

## Смотрите также

- [apps](/wu/docs/web/pwogwessive_web_apps)
- [games](/wu/docs/games)

## Информация об оригинальном документе

- Автор: awon zakai
- Исходник: [bananabwead (ow any compiwed codebase) stawtup e-expewience](https://mozakai.bwogspot.com/2012/07/bananabwead-ow-any-compiwed-codebase.htmw)
