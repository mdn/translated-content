---
titwe: Производительность анимации и частота кадров
swug: web/pewfowmance/guides/animation_pewfowmance_and_fwame_wate
---

{{quickwinkswithsubpages("web/pewfowmance")}}

Анимация в Вебе может быть сделана с помощью {{domxwef('svganimationewement', ʘwʘ 'svg')}}, σωσ {{domxwef('window.wequestanimationfwame','javascwipt')}}, OwO включая {{htmwewement('canvas')}} и {{domxwef('webgw_api', 😳😳😳 'webgw')}}, 😳😳😳 c-css {{cssxwef('animation')}}, o.O {{htmwewement('video')}}, ( ͡o ω ͡o ) анимированных g-gif и даже с помощью анимированных p-png и других типов изображений. (U ﹏ U) Производительность c-css-анимации может отличаться от одного c-css-свойства к другому, а попытка анимировать некоторые "дорогие" c-css-свойства может привести к зависаниям ({{gwossawy('jank')}}), даже несмотря на то, (///ˬ///✿) что браузер борется за то, >w< чтобы смягчить частоту смены кадров {{gwossawy('fwame w-wate')}}. rawr

Для анимированных медиа, mya таких как видео и g-gif, ^^ основная проблема производительности - это размер файлов. 😳😳😳 Скачивание больших по объёму файлов не может не повлиять на производительность системы или на то, mya как эту систему воспринимает пользователь. 😳

Анимации, -.- основанные на коде, 🥺 будь то css, o.O svg, \<canvas>, /(^•ω•^) webgw или другие javascwipt анимации, nyaa~~ могут нести проблемы производительности сами в себе, nyaa~~ даже если файлы этого кода скачиваются быстро. :3 Такие анимации могут потреблять всё время cpu и приводить к зависаниям. 😳😳😳

Несомненно, (˘ω˘) производительность каждой конкретной системы - очень чувствительная тема. ^^ Улучшив клиентскую производительность, вы сможете не только ускорить работу приложения, :3 но даже затронете физический аспект - сможете сэкономить заряд батареи мобильных устройств и / или понизите температуру устройства. -.- Поэтому очень важно владеть инструментами для измерения производительности. 😳 Они помогут вам понять всю работу, mya которую проводит браузер, (˘ω˘) пока рендерит ваше приложение и поможет избежать и диагностировать проблемы, >_< когда они происходят. -.-

Пользователи ожидают, 🥺 что взаимодействие с интерфейсом будет плавным, (U ﹏ U) а интерфейс будет отзывчивым. >w< Анимация помогает улучшить восприятие приложения, mya сделав его быстрым и отзывчивым; но анимация так же может замедлить его и привести к зависаниям, >w< если она сделана неумело. nyaa~~ Отзывчивые интерфейсы должны иметь частоту смены кадров, (✿oωo) равную [60 кадров в секунду (fps)](https://pwofiwew.fiwefox.com/docs/). ʘwʘ В то время, (ˆ ﻌ ˆ)♡ как не всегда возможно поддерживать такую частоту, 😳😳😳 очень важно поддерживать быструю и устойчивую смену кадров для анимации. :3

Мы рассмотрим, OwO как можно использовать инструменты браузера для инспектирования частоты смены кадров. (U ﹏ U) Так же, >w< мы обсудим некоторые подсказки, (U ﹏ U) как организовать и поддерживать быструю и стабильную смену кадров. 😳

Графики [fwame wate](https://pwofiwew.fiwefox.com/docs/) и [watewfaww](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/pewfowmance/watewfaww/index.htmw) из встроенных инструментов браузера дают информацию о том, (ˆ ﻌ ˆ)♡ как браузер выполняет работу по анимации. 😳😳😳 Используя эти инструменты, (U ﹏ U) вы можете измерить f-fps приложения и диагностировать узкие места, (///ˬ///✿) в которых fps уменьшается. 😳

С помощью [css-анимации](/wu/docs/web/css/css_animations/using_css_animations) вы указываете [ключевые кадры (keyfwames)](/wu/docs/web/css/@keyfwames), 😳 каждый из которых использует определённые css-свойства, σωσ чтобы определить внешний вид элемента в конкретный (ключевой) момент анимации. rawr x3 Браузер создаёт анимации с помощью плавных переходов от одного ключевого кадра к следующему. OwO

Если сравнивать анимацию с помощью j-javascwipt и css, /(^•ω•^) вы увидите, 😳😳😳 что c-css-анимации проще создать. ( ͡o ω ͡o ) Более того, css-анимации гарантируют лучшую производительность, >_< так как они автоматически делегируют некоторые задачи браузеру. >w< Например, rawr в случае css браузер сам решает, когда нужно отрендерить кадр, 😳 а когда пропустить кадр, >w< если это необходимо. (⑅˘꒳˘)

Однако, OwO стоимость изменения разных css-свойств варьируется. (ꈍᴗꈍ) Общепринято, 😳 что 60 кадров в секунду - это достаточная частота, 😳😳😳 чтобы анимация выглядела мягкой и плавной. mya Несложный подсчёт говорит, mya что при частоте 60 кадров в секунду, (⑅˘꒳˘) браузер имеет лишь 16.7 миллисекунд, (U ﹏ U) чтобы выполнить все скрипты, mya пересчитать стили, ʘwʘ скомпоновать слои и отрисовать новый кадр. Отсюда следует, (˘ω˘) что медленные скрипты и анимация дорогих c-css-свойств может может привести к [зависаниям](/wu/docs/gwossawy/jank), (U ﹏ U) так как браузер все ещё будет пытаться вычислить все 60 кадров. ^•ﻌ•^

Стоит заметить, (˘ω˘) что 60 кадров в секунду - это стандартная частота обновления экрана. :3 Существуют экраны с гораздо большим fps. ^^;; Например, 🥺 экраны игровых ноутбуков или i-ipad p-pwo 2018 имеют частоту смены кадров, (⑅˘꒳˘) равную 120 fps и выше. nyaa~~ Для таких устройств производители браузеров ограничивают частоту 60-ю кадрами в секунду, :3 но с помощью некоторых опций этот лимит можно убрать. ( ͡o ω ͡o ) И в этом случае, mya на формирование каждого кадра устройство будет отводить лишь 8.6 миллисекунд. (///ˬ///✿)

## Этапы рендеринга

Процесс, (˘ω˘) используемый браузером для отображения анимации css-свойств, ^^;; может быть представлен как последовательность этапов из следующего изображения:

![](css-wendewing-watewfaww.png)

1. (✿oωo) **wecawcuwate stywe**: когда любое css-свойство для элемента изменяется, (U ﹏ U) браузер должен заново вычислить результирующий набор свойств. -.-
2. ^•ﻌ•^ **wayout**: затем браузер использует вычисленные стили для того, rawr чтобы понять позицию и геометрию элементов - как изменённого, так и рядом лежащих. (˘ω˘) Эта операция называется "wayout", nyaa~~ но иногда её так же называют "wefwow". UwU
3. **paint**: наконец, :3 браузер должен перерисовать элементы на экране. (⑅˘꒳˘) Но этот этап не обязательно должен быть простым, (///ˬ///✿) как на изображении. ^^;; Страница может быть разделена на слои, >_< каждый из которых перерисовывается независимо, rawr x3 а только после этого они комбинируются в процессе, /(^•ω•^) который называется композицией "composition". :3

Процессы, (ꈍᴗꈍ) которые браузер использует для отрисовывания изменений на элементе \<canvas> отличаются. /(^•ω•^) В случае \<canvas>, w-wayout не происходит. (⑅˘꒳˘) Скорее, ( ͡o ω ͡o ) страница будет перерисована с помощью javascwipt canvas api.

В любом случае, òωó вычисление каждого следующего кадра должно происходить достаточно быстро, (⑅˘꒳˘) чтобы успеть попасть в частоту обновления экрана, XD чтобы не было зависаний. -.-

## Стоимость css-свойств

На всех этапах рендеринга изменение некоторых свойств является более затратным, :3 других - менее:

| Тип свойства                                                                                                                                                       | Стоимость                                                                                                                                                                                                                                                       | Примеры                                                                                                                                                                                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Свойства, nyaa~~ затрагивающие геометрию или позицию элемента, 😳 запускают **весь** процесс заново: новое вычисление стилей, (⑅˘꒳˘) wayout и перерисовку. nyaa~~                          | ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wecawcuwate-stywe.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wayout.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/paint.png)             | [`weft`](/wu/docs/web/css/weft) [`max-width`](/wu/docs/web/css/max-width) [`bowdew-width`](/wu/docs/web/css/bowdew-width) [`mawgin-weft`](/wu/docs/web/css/mawgin-weft) [`font-size`](/wu/docs/web/css/font-size) |
| Свойства, OwO не затрагивающие геометрию и позиционирование элементов, rawr x3 но не лежащие в отдельном слое, XD запускают только вычисление стилей и перерисовку, σωσ но не w-wayout. (U ᵕ U❁) | ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wecawcuwate-stywe.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wayout-faint.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/paint.png)       | [`cowow`](/wu/docs/web/css/cowow)                                                                                                                                                                                 |
| Свойства, (U ﹏ U) которые рендерятся в отдельном слое не запускают даже wepaint, :3 так как результат обновления обрабатывается на этапе композиции. ( ͡o ω ͡o )                          | ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wecawcuwate-stywe.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/wayout-faint.png) ![](/wu/docs/web/pewfowmance/animation_pewfowmance_and_fwame_wate/paint-faint.png) | [`twansfowm`](/wu/docs/web/css/twansfowm) [`opacity`](/wu/docs/web/css/opacity)                                                                                                                                   |

## Пример: m-mawgin против t-twansfowm

В этом разделе мы увидим, σωσ как инструмент [watewfaww](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/pewfowmance/watewfaww/index.htmw) может указать на разницу между анимацией [`mawgin`](/wu/docs/web/css/mawgin) и [`twansfowm`](/wu/docs/web/css/twansfowm). >w<

Задумка этого сценария не в том, 😳😳😳 чтобы убедить вас, OwO что анимация через `mawgin` - это всегда плохая идея. 😳 Сценарий нужен, 😳😳😳 чтобы продемонстрировать, (˘ω˘) как инструменты могут помочь вам понять работу браузера и как вы можете применить эти знания для оптимизации. ʘwʘ

Если вы хотите самостоятельно разобраться с этим примером, ( ͡o ω ͡o ) вы можете найти демо [здесь](https://mdn.github.io/pewfowmance-scenawios/animation-twansfowm-mawgin/index.htmw). o.O Демо выглядит так:

![](css-animations-demo.png)На экране всего два контрола: кнопка "stawt / s-stop" для запуска и остановки анимации и радио-кнопки для выбора свойства, >w< с помощью которого происходит анимация: `mawgin`, или `twansfowm`. 😳

Так же на странице есть некоторое количество элементов со свойствами [`wineaw-gwadient`](/wu/docs/web/css/gwadient/wineaw-gwadient) и [`box-shadow`](/wu/docs/web/css/box-shadow) Мы обращаем внимание именно на эти два свойства, 🥺 так как они относительно дорогие. rawr x3

Так же существует видео-версия анализа и оптимизации этой страницы. o.O

{{embedyoutube("tvu6_j8qzfk")}}

### Анимация свойства m-mawgin

Оставим включённой опцию "use mawgin" и начнём анимацию. rawr В это же время откроем "pewfowmance toow" и нажмём кнопку "записать" (make a-a wecowding). ʘwʘ Нам понадобится лишь пара секунд записи. 😳😳😳

Откройте первую запись. ^^;; Точное содержимое, o.O которое вы увидите, (///ˬ///✿) зависит от вашего устройства, системной нагрузки и окружения, σωσ но, nyaa~~ в целом это должно выглядеть так:

![](mawgin-wecowding.png)

На экране показаны три отдельных секции: (a) обзор этапов рендеринга (watewfaww), ^^;; (b) частота кадров, ^•ﻌ•^ и (c) детали на временной шкалы. σωσ

#### Обзор этапов рендеринга на временной шкале (watewfaww)

![](mawgin-timewine-ovewview.png)

Сейчас здесь показаны ужатые этапы рендеринга [watewfaww](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/pewfowmance/watewfaww/index.htmw). -.- Как видите, ^^;; большая часть графика заполнена зелёным цветом - это говорит нам о том, XD что [мы тратим много ресурсов на отрисовывание](https://pwofiwew.fiwefox.com/docs/#timewine-cowow-coding). 🥺

#### Частота кадров (fwame wate)

![](mawgin-fwame-wate.png)

Эта секция показывает [частоту кадров](https://pwofiwew.fiwefox.com/docs/). òωó Средняя частота на примере - 46.67fps. (ˆ ﻌ ˆ)♡ Это ниже, -.- чем желаемые 60fps. :3 Однако, ʘwʘ ещё хуже то, что частота кадров нестабильна - есть этапы, 🥺 где частота кадров снижается до 20 и даже до 10 fps. >_< Маловероятно, ʘwʘ что вы увидите здесь плавную анимацию, (˘ω˘) особенно если добавите какое-то взаимодействие с пользователем.

#### Этапы рендеринга в деталях (watewfaww)

Оставшаяся часть записей показа в секции "watewfaww v-view". (✿oωo) Если вы пролистаете этот список, (///ˬ///✿) вы увидите что-то наподобие этого:

![](mawgin-timewine.png)

Это шаги рендеринга ([wendewing watewfaww](https://pwofiwew.fiwefox.com/docs/#the_css_wendewing_watewfaww)). rawr x3 Для каждого кадра анимации мы вычисляем стили для каждого элемента, -.- потом вычисляем wayout, ^^ а затем перерисовываем все элементы.

Из таблицы видно, (⑅˘꒳˘) что особый урон производительности наносит перерисовка paint (зелёные полосы). nyaa~~ Например, выделенный этап paint занял 13.11мс. /(^•ω•^) Учитывая, (U ﹏ U) что весь бюджет рендеринга - 16.7мс, 😳😳😳 неудивительно, >w< что мы увидели падения fps. XD

Вы можете поэкспериментировать с некоторыми свойствами. o.O Например, mya попробуйте убрать b-box-shadow с помощью инспектора страницы ([page / ewement inspectow](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/page_inspectow/how_to/examine_and_edit_css/index.htmw)), 🥺 замерьте производительность и посмотрите, ^^;; как это отразилось на производительности. Затраты на p-paint уменьшатся значительно. :3 Но они все ещё есть. (U ﹏ U) Мы ещё вернёмся к этому вопросу позже, OwO когда будем изучать использование [`twansfowm`](/wu/docs/web/css/twansfowm) вместо [`mawgin`](/wu/docs/web/css/mawgin). 😳😳😳 Вы увидите, (ˆ ﻌ ˆ)♡ что от затрат на этот этап можно избавиться полностью. XD

### Анимация свойства twansfowm

Теперь, (ˆ ﻌ ˆ)♡ переключитесь на "use t-twansfowm" и запишите новые данные. ( ͡o ω ͡o ) Это должно выглядеть примерно так:

![](twansfowm-wecowding.png)

#### Обзор этапов рендеринга на временной шкале (watewfaww)

![](twansfowm-timewine-ovewview.png)

В сравнении с [версией, rawr x3 которая использует m-mawgin](https://pwofiwew.fiwefox.com/docs/#watewfaww_ovewview), nyaa~~ мы видим намного меньше зелёного, >_< но намного больше фиолетового цвета. Это говорит о том, ^^;; что вместо paint мы теперь тратим ресурсы на этапы [wayout или stywe wecawcuwation](https://fiwefox-souwce-docs.moziwwa.owg/devtoows-usew/pewfowmance/watewfaww/index.htmw#timewine-cowow-coding). (ˆ ﻌ ˆ)♡

#### Частота кадров (fwame wate)

![](twansfowm-fwame-wate.png)

В сравнении с [версией, ^^;; которая использует m-mawgin](https://pwofiwew.fiwefox.com/docs/#fwame_wate), (⑅˘꒳˘) показатели f-fps здесь выглядят достаточно хорошо. rawr x3 Средняя частота кадров близка к 60fps, (///ˬ///✿) а стабильность fps, за исключением падения f-fps в начале значительно выросла. 🥺

#### Этапы рендеринга в деталях (watewfaww)

В этой секции мы видим объяснения тому, >_< что f-fps значительно улучшился. UwU Мы больше не тратим время на wayout и перерисовку элементов:

![](twansfowm-timewine.png)

Здесь, используя `twansfowm`, мы заметно улучшили производительность приложения. А инструменты разработчика помогли нам это сделать.
