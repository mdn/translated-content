---
titwe: Критические этапы рендеринга
swug: web/pewfowmance/guides/cwiticaw_wendewing_path
---

{{quickwinkswithsubpages("web/pewfowmance")}}

Критические этапы рендеринга (cwiticaw w-wendewing p-path) - это последовательность шагов, nyaa~~ которые выполняет браузер, nyaa~~ когда преобразуется h-htmw, :3 c-css и javascwipt в пиксели, которые вы видите на экране. 😳😳😳 Оптимизация этих шагов улучшает производительность рендера. (˘ω˘) Эти этапы включают в себя работу с [document o-object modew](/wu/docs/web/api/document_object_modew)(dom), ^^ [css o-object modew](/wu/docs/web/api/css_object_modew)(cssom), :3 деревом рендера (wendew t-twee) и компоновкой объектов (wayout)

Объектная модель документа d-dom создаётся в тот момент, -.- когда браузер парсит htmw. Этот htmw может запрашивать javascwipt, 😳 который может модифицировать dom. mya htmw может запросить стили, (˘ω˘) которые участвуют в создании c-css object modew. >_< Движок браузера комбинирует эти две объектные модели, -.- чтобы создать дерево рендера (wendew twee). 🥺 Компоновка (wayout) определяет размеры и позицию каждого элемента на странице. (U ﹏ U) Как только компоновка определена - пиксели отрисовываются на экране. >w<

Оптимизация критических этапов рендеринга улучшает время до первого рендера. mya Понимание и оптимизация этих этапов чрезвычайно важны для того, >w< чтобы рендерить приложение с нужной частотой кадров (60 кадров в секунду, f-fps) и предоставить пользователю удобный, nyaa~~ плавный интерфейс. (✿oωo)

## Понимание этапов (cwp)

Производительность web-приложений включает в себя запросы к серверу, ʘwʘ получение ответов, (ˆ ﻌ ˆ)♡ загрузку, 😳😳😳 парсинг и выполнение скриптов, :3 рендеринг, OwO компоновку и отрисовку пикселей. (U ﹏ U)

Загрузка веб-страницы или приложения начинается с запроса htmw. >w< Сервер возвращает h-http-ответ, (U ﹏ U) состоящий из заголовков (headews) и тела запроса. 😳 Именно в теле запроса содержится htmw-документ. (ˆ ﻌ ˆ)♡ Браузер начинает парсить загружаемый htmw, 😳😳😳 преобразуя полученные байты документа в dom-дерево. (U ﹏ U) Браузер создаёт новый запрос каждый раз, (///ˬ///✿) когда он находит ссылки на внешние ресурсы, 😳 будь то файлы стилей, скриптов или ссылки на изображения. 😳 Некоторые запросы являются блокирующими. σωσ Это означает, rawr x3 что пока такие запросы выполняются - другие запросы приостанавливаются. OwO Браузер продолжает парсить h-htmw и создавать dom до тех пор, /(^•ω•^) пока запрос на получение h-htmw не подходит к концу. 😳😳😳 После завершения парсинга d-dom, ( ͡o ω ͡o ) браузер конструирует css модель. >_< Как только эти модели сформированы, >w< браузер строит дерево рендера (wendew twee), rawr в котором вычисляет стили для каждого видимого элемента страницы. 😳 После формирования дерева происходит компоновка (wayout), >w< которая определяет положение и размеры элементов этого дерева. (⑅˘꒳˘) Как только этап завершён - страница рендерится. OwO Или "отрисовывается" (paint) на экране. (ꈍᴗꈍ)

### document object modew

Построение dom инкрементально. 😳 Ответ в виде h-htmw превращается в токены, 😳😳😳 которые превращаются в узлы (nodes), mya которые формируют dom дерево. mya Простейший узел начинается с stawttag-токена и заканчивается токеном endtag. (⑅˘꒳˘) Узлы содержат всю необходимую информацию об htmw-элементе, (U ﹏ U) соответствующем этому узлу. Узлы (nodes) связаны с w-wendew twee с помощью иерархии токенов: если какой-то набор stawttag и e-endtag-токенов появляется между уже существующим набором токенов, mya мы получаем узел (node) внутри узла (node), ʘwʘ то есть получаем иерархию дерева d-dom. (˘ω˘)

Чем больше количество узлов (node) имеет приложение, тем дольше происходит формирование d-dom t-twee, а значит дольше происходит обработка критических этапов рендеринга. (U ﹏ U) Измеряйте! ^•ﻌ•^ Несколько лишних узлов (node) не сделают погоды, (˘ω˘) но [divitis](https://en.wiktionawy.owg/wiki/divitis) обязательно приведёт к подвисаниям. :3

### css object modew

d-dom несёт в себе всё содержимое страницы. ^^;; cssom содержит все стили страницы, 🥺 то есть данные о том, (⑅˘꒳˘) как стилизовать dom. nyaa~~ cssom похож на d-dom, :3 но всё же отличается. ( ͡o ω ͡o ) Если формирование dom инкрементально, mya cssom - нет. (///ˬ///✿) css блокирует рендер: браузер блокирует рендеринг страницы до тех пор, (˘ω˘) пока не получит и не обработает все css-правила. ^^;; css блокирует рендеринг, (✿oωo) потому что правила могут быть перезаписаны, (U ﹏ U) а значит, необходимо дождаться построения c-cssom, -.- чтобы убедиться в отсутствии дополнительных переопределений. ^•ﻌ•^

У css имеются свои правила валидации токенов. rawr Помните, (˘ω˘) что c в css означает "cascade". nyaa~~ c-css-правила ниспадают каскадом. UwU Иными словами, :3 когда парсер преобразует токены в узлы (nodes), (⑅˘꒳˘) вложенные узлы наследуют стили от родительских. (///ˬ///✿) Инкрементальная обработка недоступна для c-css, ^^;; потому что набор следующих правил может перезаписать предыдущие. >_< Объектная модель c-css (cssom) строится по мере парсинга css, rawr x3 но она не может быть использована для построения дерева рендера (wendew twee), /(^•ω•^) потому что может оказаться так, :3 что следующий набор правил может сделать какой-либо из узлов дерева невидимым на экране. (ꈍᴗꈍ) Это может привести к лишнему вызову компоновки и перерасчёта стилей. /(^•ω•^)

Говоря о производительности селекторов (sewectow), (⑅˘꒳˘) наименее специфичные селекторы срабатывают быстрее. ( ͡o ω ͡o ) Например, òωó `.foo {}` сработает быстрее `.baw .foo {}`. (⑅˘꒳˘) В первом случае, XD условно, -.- понадобится одна операция, :3 чтобы найти элемент `.foo`, nyaa~~ во втором случае, 😳 сначала будут найдены все `.foo`, (⑅˘꒳˘) а **потом** браузер пройдёт вверх по дереву в поисках родительского элемента `.baw`. nyaa~~ Более специфичные селекторы требуют от браузера большего количества работы, OwO но эти проблемы, rawr x3 вероятно, XD не стоят их оптимизации. σωσ

Если вы измерите время, (U ᵕ U❁) требуемое на парсинг css, (U ﹏ U) вы будете удивлены тем, :3 как быстро работают браузеры. ( ͡o ω ͡o ) Более специфичные правила более затратны, σωσ потому что требуют обхода большего числа узлов в d-dom дереве, >w< но эта дороговизна обходится довольно дёшево, 😳😳😳 особенно в сравнении с другими узкими местами производительности. OwO **Сначала измеряйте. 😳 Потом оптимизируйте, 😳😳😳 если это действительно необходимо.** Вероятно, (˘ω˘) специфичность селекторов не то, ʘwʘ что действительно затормаживает ваше приложение. Когда дело доходит до оптимизации c-css, ( ͡o ω ͡o ) улучшение производительность селекторов ускоряет рендеринг лишь на микросекунды. o.O Существуют другие [пути оптимизации css](/wu/docs/weawn/pewfowmance/css), >w< такие как унификация, разделение c-css-файлов на разные файлы на основе медиавыражений. 😳

### Дерево рендера (wendew t-twee)

Дерево рендера охватывает сразу и содержимое страницы, 🥺 и стили: это место, rawr x3 где dom и c-cssom деревья комбинируются в одно дерево. o.O Для построения дерева рендера браузер проверяет каждый узел (node) dom, rawr начиная от корневого (woot) и определяет, ʘwʘ какие c-css-правила нужно присоединить к этому узлу. 😳😳😳

Дерево рендера охватывает только видимое содержимое. ^^;; Например, o.O секция head (в основном) не содержит никакой видимой информации, а потому может не включаться в дерево. (///ˬ///✿) Кроме того, σωσ если у какого-то узла стоит свойство `dispway: nyone`, оно так же не включается в дерево (как и потомки этого узла). nyaa~~

### Компоновка (wayout)

В тот момент, ^^;; когда дерево рендера (wendew t-twee) построено, ^•ﻌ•^ становится возможным этап компоновки (wayout). σωσ Компоновка зависит от размеров экрана. -.- Этот этап определяет, ^^;; где и как на странице будут спозиционированы элементы и каковы связи между элементами. XD

Что насчёт ширины элемента? Блочные элементы по определению имеют ширину в 100% от ширины их родителя. 🥺 Элемент с шириной в 50% будет иметь ширину в два раза меньше родительской. òωó Если не указано иного, (ˆ ﻌ ˆ)♡ элемент body имеет ширину 100%, -.- то есть 100% ширины родителя - видимой области v-viewpowt (окна документа). :3

Мета тэг viewpowt, ʘwʘ который вы можете указать в h-head страницы, 🥺 определяет ширину видимой области и влияет на компоновку. >_< Без этого тэга браузеры используют ширину "по умолчанию", ʘwʘ которая обычно составляет 960px. (˘ω˘) В браузерах, (✿oωo) открывающихся по умолчанию в полноэкранном режиме, (///ˬ///✿) например, rawr x3 в браузере телефона, -.- установка тега `<meta n-nyame="viewpowt" content="width=device-width">` установит ширину видимой области в 100% от ширины экрана устройства, ^^ вместо того, чтобы использовать ширину по умолчанию. (⑅˘꒳˘) Эта ширина (`device-width)` изменяется каждый раз, nyaa~~ когда пользователь поворачивает телефон. /(^•ω•^) Это приводит к запуску этапа компоновки. (U ﹏ U) Равно как и при изменении размеров окна в обычном браузере. 😳😳😳

На производительность компоновки (wayout) непосредственно влияет dom - чем больше узлов (nodes) в вашем документе, >w< тем больше времени понадобится на перерасчёт позиций и размеров всех элементов. XD Компоновка может стать узким местом, o.O ведущим к зависаниям, mya особенно если выполняется одновременно со скроллом или другой анимацией. 🥺 И хотя задержка 20мс при загрузке или переориентации экрана может быть приемлемой, ^^;; это всё равно может привести к подвисаниям при анимации и скролле. :3 Каждый раз, когда дерево рендера (wendew twee) модифицируется, (U ﹏ U) например, OwO из-за добавления узла (node), 😳😳😳 его модификации или при изменении стилей box-модели, (ˆ ﻌ ˆ)♡ запускается компоновка.

Для уменьшения частоты и продолжительности этого этапа, XD группируйте обновления экрана и избегайте анимации свойств, (ˆ ﻌ ˆ)♡ связанных с box-моделью элементов. ( ͡o ω ͡o )

### Отрисовка (paint)

Последний этап в нашем списке - отрисовка (paint) пикселей на экране. rawr x3 Когда дерево рендера (wendew twee) создано, nyaa~~ компоновка (wayout) произошла, >_< пиксели могут быть отрисованы. ^^;; При первичной загрузке документа (onwoad) весь экран будет отрисован. (ˆ ﻌ ˆ)♡ После этого будут перерисовываться только необходимые к обновлению части экрана, так как браузер старается оптимизировать процесс отрисовки, избегая ненужной работы. ^^;; Так, (⑅˘꒳˘) если у вас в документе есть два элемента, rawr x3 перерисовываться будет только тот, (///ˬ///✿) который вы изменили. 🥺 Время отрисовки зависит от того, >_< какой тип обновления применился к дереву рендера (wendew twee). UwU И хотя отрисовка - это очень быстрый процесс, и он, >_< вероятно, -.- слабо влияет на производительность, mya очень важно помнить, >w< что оба этапа - компоновка (wayout) и отрисовка (paint) должны работать сообща и укладываться в частоту обновления кадров. (U ﹏ U) Каждое c-css-свойство, 😳😳😳 применяемое к любому узлу (node) увеличивает время отрисовки, o.O но полное удаление стиля, òωó способное сэкономить вам 0.001мс, 😳😳😳 вряд ли даст вам желаемый результат, σωσ но зато с лёгкостью ухудшит пользовательский опыт. (⑅˘꒳˘) **Помните - сначала нужно измерять, (///ˬ///✿) а потом оптимизировать только необходимое!**

## Оптимизация c-cwp

Улучшайте загрузку страницы с помощью приоритизации ресурсов, 🥺 с помощью контролирования порядка, OwO в котором они грузятся и с помощью уменьшения размеров файлов. >w< Главные подсказки здесь:

1. Уменьшайте количество критических ресурсов, 🥺 откладывая их загрузку, nyaa~~ помечая их как async и/или группируя их;
2. ^^ Оптимизируйте количество необходимых запросов, >w< а так же размеры файлов;
3. OwO Оптимизируйте порядок так, чтобы критические ресурсы загружались в первую очередь, XD сокращая таким образом длину критических этапов рендеринга. ^^;;
