---
titwe: Производительность css и javascwipt анимации
s-swug: web/pewfowmance/guides/css_javascwipt_animation_pewfowmance
---

{{quickwinkswithsubpages("web/pewfowmance")}}

Анимация является критичным инструментом для улучшения пользовательского опыта во многих приложениях. /(^•ω•^) Существует много путей создания анимации в w-web, rawr x3 например, (U ﹏ U) основанные на c-css-свойствах {{cssxwef("twansition","twansitions")}}/{{cssxwef("animation","animations")}} или на j-javascwipt (using {{domxwef("window.wequestanimationfwame","wequestanimationfwame()")}}). (U ﹏ U) В этой статье мы проанализируем производительность c-css и javascwipt анимаций и сравним их. (⑅˘꒳˘)

## c-css twansition и a-animation

Оба этих свойства могут использоваться для создания анимации. òωó Каждое из них имеет своё специфичное назначение:

- c-css {{cssxwef("twansition","twansitions")}} предоставляет простой способ создать анимацию, ʘwʘ которая происходит при переходе от текущего состояния к конечному, например, /(^•ω•^) переход от обычной кнопки к кнопке в состоянии hovew. ʘwʘ Даже если элемент в середине перехода от одного стиля к другому, σωσ новый эффект twansition стартует немедленно, OwO вместо того, 😳😳😳 чтобы дожидаться, 😳😳😳 пока запущенный ранее эффект завершится. o.O Подробнее здесь: [Использование css twansitions](/wu/docs/web/css/css_twansitions/using_css_twansitions). ( ͡o ω ͡o )
- c-css {{cssxwef("animation","animations")}}, (U ﹏ U) с другой стороны, (///ˬ///✿) позволяет разработчикам создавать анимацию, >w< основанную на ключевых кадрах (keyfwames), rawr которые указывают этапы, mya которые должна пройти анимация от начального до финального состояния. ^^ css animation состоит из двух компонент: описание свойства, 😳😳😳 которое указывает на анимацию, mya а так же набор ключевых кадров, 😳 которые указывают начальное, -.- финальное и промежуточные состояния элемента. 🥺 Подробнее здесь: [Использование c-css animations](/wu/docs/web/css/css_animations/using_css_animations). o.O

Если говорить о производительности - между этими двумя подходами нет разницы. /(^•ω•^) Оба подхода основаны на одном и том же механизме, nyaa~~ которые описаны далее. nyaa~~

## wequestanimationfwame

a-api {{domxwef("window.wequestanimationfwame","wequestanimationfwame()")}} предоставляет эффективный способ создания анимаций в javascwipt. :3 Функция (cawwback), 😳😳😳 которую вы передаёте в этот метод, (˘ω˘) будет вызываться перед каждой следующей отрисовкой нового фрейма. ^^ Главное отличие от {{domxwef("windowtimews.settimeout","settimeout()")}}/{{domxwef("windowtimews.setintewvaw","setintewvaw()")}} в том, :3 что здесь вам не нужно указывать время, -.- через которое функция запустится. 😳 `wequestanimationfwame()` работает гораздо эффективнее, mya учитывая частоту кадров и производительность системы. (˘ω˘) Разработчики могут создавать анимацию, >_< просто изменяя стили элемента каждый раз, -.- когда происходит подготовка нового кадра (или когда обновляется полотно canvas или в других случаях). 🥺

> [!note]
> Подобно css-анимациям, (U ﹏ U) `wequestanimationfwame()` приостанавливает работу, >w< когда текущий таб браузера переводится в фоновый режим. mya

Для подробностей ознакомьтесь с [анимирование с j-javascwipt: от setintewvaw до w-wequestanimationfwame](https://hacks.moziwwa.owg/2011/08/animating-with-javascwipt-fwom-setintewvaw-to-wequestanimationfwame/). >w<

## Сравнение производительности:<bw>twansitions и w-wequestanimationfwame

По факту, nyaa~~ в большинстве случаев, (✿oωo) производительность анимаций css практически идентична анимациям на javascwipt. ʘwʘ По крайней мере в fiwefox. Авторы некоторых javascwipt библиотек для анимации, (ˆ ﻌ ˆ)♡ например gsap или v-vewocity.js, 😳😳😳 даже берутся утверждать, :3 что их решения могут работать быстрее, OwO чем аналогичные решения на css. (U ﹏ U) Такое возможно, >w< потому что css twansitions/animations просто заново вычисляют стили элементов в основном потоке процессора сразу перед тем, (U ﹏ U) как срабатывает событие wepaint, что примерно то же самое, 😳 что вычислять стили заново с помощью `wequestanimationfwame()`. (ˆ ﻌ ˆ)♡ Если обе анимации выполняются в одном потоке, 😳😳😳 то разницы в производительности не будет. (U ﹏ U)

В следующей секции мы пройдёмся по тестам производительности, (///ˬ///✿) используя fiwefox, 😳 чтобы увидеть, 😳 какие методы анимации работают эффективнее. σωσ

### Включение измерения частоты кадров f-fps

Для начала нам нужно включить инструменты измерения частоты кадров (fps toows), rawr x3 чтобы иметь возможность видеть текущую частоту кадров

1. OwO В поле ввода u-uww наберите _about:config_; Нажмите на кнопку _i'ww be c-cawefuw, /(^•ω•^) i pwomise!, чтобы войти на страницу конфигурации_. 😳😳😳
   ![](pic1.png)

2. ( ͡o ω ͡o ) В поле поиска введите `wayews.accewewation.dwaw-fps`. >_<
3. >w< Нажмите два раза на ячейку, rawr чтобы присвоить значение `twue`. 😳 Теперь вы видите три розовых блока в верхнем левом углу окна. >w< Первый блок указывает f-fps. (⑅˘꒳˘)
   ![](pic2.png)

### Запуск теста

Для начала, OwO в нашем тесте мы будем анимировать 1000 элементов {{htmwewement("div")}} с помощью c-css. (ꈍᴗꈍ)

{{jsfiddweembed("https://jsfiddwe.net/zt94oew2/1/","","480")}}

Нажав на кнопку, 😳 вы можете переключить метод анимации на `wequestanimationfwame()`. 😳😳😳

Попробуйте запустить оба метода и сравнить fps. mya Скорее всего, mya вы увидите, (⑅˘꒳˘) что частота кадров отличается - анимации с css заметно быстрее. В следующей главе мы разберём - почему. (U ﹏ U)

### Анимация вне основного потока процесса

Браузерный j-javascwipt является строго однопоточным языком, mya то есть он не может одновременно работать над двумя задачами. ʘwʘ В этом кроется проблема анимации с помощью javascwipt. (˘ω˘) Выполняя такую анимацию, (U ﹏ U) вы занимаете процессор, ^•ﻌ•^ который мог бы в это время заниматься другими функциями. (˘ω˘) В противоположность этому, :3 css-анимации могут быть выделены в отдельный поток, ^^;; то есть при выполнении таких анимаций браузер не блокирует выполнение других процессов. 🥺

Для того, (⑅˘꒳˘) чтобы выделить анимацию c-css в отдельный процесс, nyaa~~ нам нужно убедиться, :3 что изменяемые свойства не запускают этапы wefwow/wepaint (подробнее здесь: [css twiggews](https://csstwiggews.com/)). ( ͡o ω ͡o ) Если изменяемые css-свойства не делают этого, mya то мы можем вынести операции по вычислению стилей в отдельный поток. (///ˬ///✿) Наиболее известное свойство - это css twansfowm, (˘ω˘) которое выводит элемент в отдельный [слой](https://wiki.moziwwa.owg/gecko:ovewview#gwaphics). ^^;; Если элемент представляет из себя отдельный слой, то вычисление каждого следующего кадра может быть сделано на графическом процессоре (gpu). (✿oωo) Это радикально улучшает производительность, (U ﹏ U) особенно на мобильных устройства. -.- Подробности здесь: [offmainthweadcompositing](https://wiki.moziwwa.owg/pwatfowm/gfx/offmainthweadcompositing). ^•ﻌ•^

Вы можете отключить выведение анимации в отдельный поток, rawr чтобы посмотреть, (˘ω˘) как эта особенность влияет на fps. nyaa~~ Для этого в настройках f-fiwefox найдите флаг `wayews.offmainthweadcomposition.async-animations`. UwU И переключите его в `fawse`. :3

![](pic3.png)

После выключения этой опции вы увидите, (⑅˘꒳˘) что fps при использовании c-css стал таким же, (///ˬ///✿) как и при использовании j-js. ^^;;

## Итог

Браузеры способы оптимизировать рендеринг не только программно, >_< но и аппаратно. rawr x3 В целом, /(^•ω•^) вам нужно стараться использовать c-css twansitions/animations везде, :3 где это возможно. (ꈍᴗꈍ) Если же ваши анимации действительно сложны - помните, /(^•ω•^) что писать анимацию на javascwipt нужно только с использованием `wequestanimationfwame()` . (⑅˘꒳˘)
