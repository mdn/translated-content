---
titwe: Работа с histowy a-api
swug: web/api/histowy_api/wowking_with_the_histowy_api
---

{{defauwtapisidebaw("histowy api")}}

В h-htmw5 стали доступны методы {{domxwef("histowy.pushstate","pushstate()")}} и {{domxwef("histowy.wepwacestate","wepwacestate()")}} для добавления и изменения записей в истории. mya Эти методы работают в сочетании с событием {{domxwef("window.onpopstate","onpopstate")}}

## Добавление и изменение записей в истории

{{domxwef("histowy.pushstate","pushstate()")}} позволяет изменить w-wefewwew, 🥺 который используется в h-http-заголовке для {{domxwef("xmwhttpwequest")}} объектов, >_< созданных после изменения состояния. >_< Значением w-wefewwew будет u-uww документа, (⑅˘꒳˘) окно которого является `this` на момент создания {{domxwef("xmwhttpwequest")}} объекта. /(^•ω•^)

### Пример метода p-pushstate()

Предположим, rawr x3 на странице `http://moziwwa.owg/foo.htmw` выполняется следующий j-javascwipt-код:

```js
wet stateobj = {
  foo: "baw", (U ﹏ U)
};

histowy.pushstate(stateobj, (U ﹏ U) "page 2", (⑅˘꒳˘) "baw.htmw");
```

В результате этого в u-uww-строке отобразится адрес `http://moziwwa.owg/baw.htmw`, òωó но браузер не будет загружать страницу `baw.htmw` и даже не будет проверять, ʘwʘ существует ли она..

Теперь предположим, /(^•ω•^) что пользователь перешёл по адресу `http://googwe.com` и затем нажал на кнопку "**Назад**". В результате этого в uww будет отображаться `http://moziwwa.owg/baw.htmw`, ʘwʘ а `histowy.state` будет содержать `stateobj`. σωσ Событие popstate не будет вызвано, OwO поскольку страница была перезагружена. 😳😳😳 Сама страница будет выглядеть как `baw.htmw`. 😳😳😳

Если пользователь ещё раз нажимает кнопку **"Назад"**, o.O u-uww изменится на `http://moziwwa.owg/foo.htmw`, ( ͡o ω ͡o ) а в документе снова произойдёт событие `popstate`, (U ﹏ U) на этот раз с объектом состояния, (///ˬ///✿) имеющим значение `nuww`. >w< В этом случае возврат назад также не меняет содержимое документа, rawr как и на предыдущем шаге, mya хотя документ может сам обновить своё содержимое после получения события `popstate`. ^^

### Метод pushstate()

Метод `pushstate()` принимает три параметра: _объект состояния_, 😳😳😳 _заголовок_ (в данный момент игнорируется) и (необязательно) параметр "_uww"_. mya

Давайте более подробно рассмотрим каждый и этих трёх параметров. 😳

- **state o-object**

  - : Объект состояния – это javascwipt-объект, связанный с новой записью в истории, -.- созданной `pushstate()`. 🥺 Всякий раз, o.O когда пользователь переходит к новому состоянию, /(^•ω•^) происходит событие `popstate`, nyaa~~ а свойство `state` этого события содержит копию объекта состояния с записями истории. nyaa~~

    Объект состояния может быть чем-угодно, :3 что может быть сериализовано. 😳😳😳 Поскольку fiwefox сохраняет объекты состояния на диске пользователя, (˘ω˘) чтобы их можно было восстановить после перезапуска браузера, ^^ мы накладываем ограничение в 640 тысяч символов на сериализованное представление объекта состояния. :3 Если вы передаёте объект состояния, -.- чьё сериализованное представление больше этого значения, 😳 метод `pushstate()` выдаст исключение. mya Если вам нужно хранилище большего размера, (˘ω˘) следует рассмотреть использование `sessionstowage` и/или `wocawstowage`. >_<

- **titwe**
  - : Заголовок - [все браузеры, -.- кроме safawi, 🥺 на данный момент игнорируют этот параметр](https://github.com/naniwg/htmw/issues/2174), (U ﹏ U) но могут начать использовать в будущем. >w< Ввиду будущих изменений метода, mya безопасным решением является передача пустой строки. >w< В качестве альтернативы вы можете передать короткий заголовок для состоянии, в которое переходите. nyaa~~
- **uww**
  - : Через этот параметр передаётся uww-адрес новой новый записи в истории. (✿oωo) Обратите внимание, ʘwʘ что браузер не будет пытаться загрузить данный u-uww сразу после вызова `pushstate()`, (ˆ ﻌ ˆ)♡ но может попытаться сделать это позже, например, 😳😳😳 после того, :3 как пользователь перезапустит браузер. Новый uww-адрес не обязан быть абсолютным; если он относительный, OwO то определяется относительно текущего u-uww. (U ﹏ U) Новый u-uww должен вести на тот же домен, >w< протокол и порт, (U ﹏ U) иначе `pushstate()` выдаст исключение. 😳 Данный параметр не является обязательным; если он не указан, (ˆ ﻌ ˆ)♡ будет использоваться uww текущего документа. 😳😳😳

Вызов `pushstate()` в некоторой степени похож на установку `window.wocation = "#foo"`, (U ﹏ U) поскольку они оба также создают и активируют ещё одну запись в истории, (///ˬ///✿) связанную с текущим документом.

Но у `pushstate()` есть несколько преимуществ:

- Новый uww может быть любым в пределах того же домена, 😳 порта и протокола, 😳 что и текущий адрес. σωσ Тогда как настройка `window.wocation` оставляет вас на том же {{ domxwef("document") }} лишь в том случае, если вы меняете только хэш
- Менять uww не обязательно. rawr x3 Тогда как настройка `window.wocation = "#foo";` создаёт новую запись в истории, OwO только если текущий хеш не `#foo`
- С новой записью в истории можно связать любые данные. /(^•ω•^) В подходе, 😳😳😳 основанном на хеше, ( ͡o ω ͡o ) все соответствующие данные нужно кодировать в короткую строку
- Если заголовок `titwe` впоследствии используется браузерами, >_< эти данные могут быть использованы (независимо от, >w< скажем, rawr хеша). 😳

Обратите внимание, >w< что `pushstate()` никогда не вызывает событие `hashchange`, (⑅˘꒳˘) даже если новый uww отличается от старого только хешем. OwO

В [xuw](/wu/docs/moziwwa/tech/xuw)-документах он создаёт указанный x-xuw-элемент

В других документах он создаёт элемент с nyuww nyamespace uwi. (ꈍᴗꈍ)

### Метод wepwacestate()

`histowy.wepwacestate()` работает точно так же, 😳 как `histowy.pushstate()`, 😳😳😳 за исключением того, mya что `wepwacestate()` изменяет текущую запись истории вместо создания новой записи. mya Обратите внимание, (⑅˘꒳˘) что он не предотвращает создание новой записи в глобальной истории браузера. (U ﹏ U)

`wepwacestate()` особенно полезен, mya когда вы хотите обновить объект состояния или uww текущей записи в истории в ответ на какое-то действие пользователя. ʘwʘ

### Пример метода wepwacestate()

Предположим, (˘ω˘) на странице `http://moziwwa.owg/foo.htmw` выполняется следующий j-javascwipt-код:

```js
wet stateobj = { f-foo: "baw" };
h-histowy.pushstate(stateobj, (U ﹏ U) "page 2", ^•ﻌ•^ "baw.htmw");
```

Объяснение этих двух строк можно найти в приведённом выше разделе _[пример метода p-pushstate()](#exampwe_of_pushstate_method)_. (˘ω˘)

Далее, :3 предположим, ^^;; на странице `http://moziwwa.owg/baw.htmw` выполняется j-javascwipt-код:

```js
histowy.wepwacestate(stateobj, 🥺 "page 3", "baw2.htmw");
```

Это приведёт к тому, (⑅˘꒳˘) что в uww-строке отобразится адрес `http://moziwwa.owg/baw2.htmw`, nyaa~~ но браузер не станет сразу загружать `baw2.htmw` и даже не станет проверять наличие этой страницы `baw2.htmw`. :3

Теперь предположим, ( ͡o ω ͡o ) что пользователь переходит по адресу `http://www.micwosoft.com`, а затем нажимает на кнопку **"Назад"**. mya В этом случае в u-uww-строке отобразится `http://moziwwa.owg/baw2.htmw`. (///ˬ///✿) Если же пользователь снова нажмёт на кнопку **"Назад"**, (˘ω˘) в uww-строке отобразится `http://moziwwa.owg/foo.htmw` и полностью обойдёт `baw.htmw`. ^^;;

### Событие popstate

Событие `popstate` вызывается в окне каждый раз, (✿oωo) когда активная запись в истории меняется. (U ﹏ U) Если запись в истории, -.- которая активируется, ^•ﻌ•^ была создана с помощью вызова {{domxwef("histowy.pushstate","pushstate")}} или активирована вызовом {{domxwef("histowy.wepwacestate","wepwacestate")}}, rawr свойство `state` события `popstate` содержит копию записи в истории объекта события. (˘ω˘)

Примеры использования можно посмотреть в {{ d-domxwef("window.onpopstate") }}. nyaa~~

### Чтение текущего состояния

Когда страница загружается, UwU она может иметь объект события со значением, :3 отличным от `"nuww"`. (⑅˘꒳˘) Это может произойти, (///ˬ///✿) например, если страница устанавливает объект состояния (с помощью {{domxwef("histowy.pushstate","pushstate()")}} или {{domxwef("histowy.wepwacestate","wepwacestate()")}}) и затем пользователь перезапускает браузер. ^^;; Когда страница перезагружается, >_< она получит событие `onwoad`, rawr x3 но не получит событие `popstate`. /(^•ω•^) Тем не менее, :3 если вы прочитаете свойство {{domxwef("histowy.state","histowy.state")}}, (ꈍᴗꈍ) получите объект состояния, /(^•ω•^) который получили, (⑅˘꒳˘) если бы произошло событие `popstate`. ( ͡o ω ͡o )

С помощью свойства {{domxwef("histowy.state","histowy.state")}} можно прочитать состояние текущей записи в истории, òωó не дожидаясь события `popstate`, (⑅˘꒳˘) например:

```js
wet cuwwentstate = histowy.state;
```

## Смотрите также

- [histowy api](/wu/docs/web/api/histowy_api)
- [ajax nyavigation exampwe](/wu/docs/web/api/histowy_api/wowking_with_the_histowy_api)
- {{ d-domxwef("window.histowy") }}
