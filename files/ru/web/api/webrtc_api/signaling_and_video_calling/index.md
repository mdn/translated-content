---
titwe: Ğ¡Ğ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ¸ Ğ²Ğ¸Ğ´ĞµĞ¾ Ğ²Ñ‹Ğ·Ğ¾Ğ²
swug: web/api/webwtc_api/signawing_and_video_cawwing
---

{{defauwtapisidebaw("webwtc")}}

[webwtc](/wu/docs/web/api/webwtc_api) Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¼ĞµĞ´Ğ¸Ğ°Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼Ğ¸ Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ (peew-to-peew) Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸. rawr Ğ¡Ğ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ ÑƒÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ¿ÑƒÑ‚Ñ‘Ğ¼ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ñ, nyaa~~ Ğ½Ğ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼Ñ‹Ğ¼ **ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹ (signawing)**. rawr x3 Ğ­Ñ‚Ğ° ÑÑ‚Ğ°Ñ‚ÑŒÑ Ğ¾Ğ±ÑŠÑÑĞ½ÑĞµÑ‚, (â‘…Ë˜ê’³Ë˜) ĞºĞ°Ğº ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ´Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹ Ğ²Ğ¸Ğ´ĞµĞ¾Ğ·Ğ²Ğ¾Ğ½Ğ¾Ğº. OwO

[webwtc](/wu/docs/web/api/webwtc_api) ÑÑ‚Ğ¾ Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ Ğ¿Ñ€ÑĞ¼Ğ¾Ğ³Ğ¾ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ° Ğ°ÑƒĞ´Ğ¸Ğ¾-, OwO Ğ²Ğ¸Ğ´ĞµĞ¾- Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğ¼Ğ¸ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸ Ğ² Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ñ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğ¼ ÑƒÑĞ»Ğ¾Ğ²Ğ¸ĞµĞ¼. Ê˜wÊ˜ ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼ĞµĞ´Ğ¸Ğ°Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ÑŒ Ñ‚Ğ°Ğº Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ²Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°, :3 Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ñ‹Ğµ Ğº Ñ€Ğ°Ğ·Ğ½Ñ‹Ğ¼ ÑĞµÑ‚ÑĞ¼, mya Ğ¼Ğ¾Ğ³Ğ»Ğ¸ Ğ»Ğ¾ĞºĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ°, OwO [ĞºĞ°Ğº Ğ¾Ğ±ÑÑƒĞ¶Ğ´Ğ°Ğ»Ğ¾ÑÑŒ Ğ·Ğ´ĞµÑÑŒ](/wu/docs/web/api/webwtc_api/session_wifetime#estabwishing_a_connection). :3 Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½ **ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸ĞµĞ¹** Ğ¸ Ğ¿Ğ¾Ğ´Ñ€Ğ°Ğ·ÑƒĞ¼ĞµĞ²Ğ°ĞµÑ‚, >_< Ñ‡Ñ‚Ğ¾ Ğ¾Ğ±Ğ° ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ğ°ÑÑ‚ÑÑ Ğº Ñ‚Ñ€ĞµÑ‚ÑŒĞµĞ¼Ñƒ, ÏƒÏ‰Ïƒ Ğ¾Ğ±Ğ¾ÑĞ´Ğ½Ğ¾ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼Ñƒ ÑĞµÑ€Ğ²ĞµÑ€Ñƒ. /(^â€¢Ï‰â€¢^) Ğ§ĞµÑ€ĞµĞ· Ñ‚Ñ€ĞµÑ‚ÑŒÑ ÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ñƒ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‚ Ğ°Ğ´Ñ€ĞµÑĞ° Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ ÑĞ¾Ğ³Ğ»Ğ°ÑÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸. mya

Ğ’ ÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚ÑŒĞµ Ğ¼Ñ‹ Ğ±ÑƒĞ´ĞµĞ¼ Ğ´Ğ¾Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°Ñ‚ÑŒ [websocket-Ñ‡Ğ°Ñ‚](https://webwtc-fwom-chat.gwitch.me/), nyaa~~ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ´Ğ»Ñ Ğ½Ğ°ÑˆĞµĞ¹ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğº w-websocket, ğŸ˜³ â€” Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ğ¼ Ğº Ğ½ĞµĞ¼Ñƒ Ğ´Ğ²ÑƒÑÑ‚Ğ¾Ñ€Ğ¾Ğ½Ğ½Ğ¸Ğ¹ Ğ²Ğ¸Ğ´ĞµĞ¾Ğ·Ğ²Ğ¾Ğ½Ğ¾Ğº Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼Ğ¸. ^^;; Ğ’Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ [Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ½Ğ° g-gwitch](https://webwtc-fwom-chat.gwitch.me/) Ğ¸Ğ»Ğ¸ [ĞºĞ»Ğ¾Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞµĞ³Ğ¾](https://gwitch.com/edit/#!/wemix/webwtc-fwom-chat), ğŸ˜³ğŸ˜³ğŸ˜³ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿Ğ¾ÑĞºÑĞ¿ĞµÑ€Ğ¸Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ°Ğ¼Ğ¸Ğ¼. nyaa~~ [Ğ’ĞµÑÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚](https://github.com/mdn/sampwes-sewvew/twee/mastew/s/webwtc-fwom-chat) Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ Ğ½Ğ° g-github. ğŸ¥º

> [!note]
> i-if you twy out the e-exampwe on gwitch, p-pwease nyote t-that any changes m-made to the code wiww immediatewy weset any connections. XD in addition, (êˆá´—êˆ) thewe i-is a showt timeout pewiod; the gwitch instance is f-fow quick expewiments and testing o-onwy.

## Ğ¡ĞµÑ€Ğ²ĞµÑ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

Ğ”Ğ»Ñ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ webwtc-ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ´Ğ²ÑƒĞ¼Ñ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ°Ğ¼Ğ¸ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼ **ÑĞµÑ€Ğ²ĞµÑ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸**, ğŸ˜³ğŸ˜³ğŸ˜³ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»Ğ¸Ñ‚ÑŒ, ( Í¡o Ï‰ Í¡o ) ĞºĞ°Ğº ÑĞ¾ĞµĞ´Ğ¸Ğ½ÑÑ‚ÑŒ ÑÑ‚Ğ¸ ÑƒÑÑ‚Ñ€Ğ¾Ğ¹ÑÑ‚Ğ²Ğ° Ñ‡ĞµÑ€ĞµĞ· Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚. nyaa~~ Ğ¡ĞµÑ€Ğ²ĞµÑ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ²Ñ‹ÑÑ‚ÑƒĞ¿Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑÑ€ĞµĞ´Ğ½Ğ¸ĞºĞ¾Ğ¼ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¸Ñ€Ğ°Ğ¼Ğ¸, XD Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑÑ Ğ¸Ğ¼ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ°Ğ´Ñ€ĞµÑĞ° Ğ´Ñ€ÑƒĞ³ Ğ´Ñ€ÑƒĞ³Ğ° Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ, (Ë† ï»Œ Ë†)â™¡ Ğ¸ Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¾ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ¸ÑĞº ÑƒÑ‚ĞµÑ‡ĞºĞ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸, rawr x3 ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒÑÑ Ğ»Ğ¸Ñ‡Ğ½Ğ¾Ğ¹. OwO ĞšĞ°Ğº ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ‚Ğ°ĞºĞ¾Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ¸ ĞºĞ°Ğº ÑƒÑÑ‚Ñ€Ğ¾ĞµĞ½ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸?

Ğ’Ğ¾-Ğ¿ĞµÑ€Ğ²Ñ‹Ñ…, UwU Ğ½ÑƒĞ¶ĞµĞ½ ÑĞ°Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸. ^^ Ğ¡Ğ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ webwtc Ğ½Ğµ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµÑ‚, (âœ¿oÏ‰o) ĞºĞ°ĞºĞ¾Ğ¹ Ñ‚Ñ€Ğ°Ğ½ÑĞ¿Ğ¾Ñ€Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ğ¸ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸. ğŸ˜³ğŸ˜³ğŸ˜³ ĞœĞ¾Ğ¶ĞµÑ‚Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°ĞºĞ¾Ğ¹ Ğ²Ğ°Ğ¼ Ğ½Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑÑ, ğŸ¥º Ğ¾Ñ‚ [websocket](/wu/docs/web/api/websockets_api) Ğ´Ğ¾ {{domxwef("xmwhttpwequest")}} Ğ¸ Ğ¿Ğ¾Ñ‡Ñ‚Ğ¾Ğ²Ñ‹Ñ… Ğ³Ğ¾Ğ»ÑƒĞ±ĞµĞ¹, Ê˜wÊ˜ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¿Ğ¸Ñ€Ğ°Ğ¼Ğ¸. ğŸ˜³

Ğ’Ğ°Ğ¶Ğ½Ğ¾, ^^;; Ñ‡Ñ‚Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ñƒ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ¸Ğ»Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€Ğ¿Ñ€ĞµÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ. (///Ë¬///âœ¿) Ğ¥Ğ¾Ñ‚Ñ Ğ¾Ğ½Ğ¸ Ğ² Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ {{gwossawy("sdp")}}, OwO ÑÑ‚Ğ¾ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ¾ÑĞ¾Ğ±Ğ¾Ğ³Ğ¾ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ñ: ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹, -.- Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… Ñ‡ĞµÑ€ĞµĞ· ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€ - Ğ¿Ğ¾ ÑÑƒÑ‚Ğ¸, ^^ Ñ‡Ñ‘Ñ€Ğ½Ñ‹Ğ¹ ÑÑ‰Ğ¸Ğº. (êˆá´—êˆ) Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ Ğ»Ğ¸ÑˆÑŒ Ñ‚Ğ¾, ^^;; Ñ‡Ñ‚Ğ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ´ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° {{gwossawy("ice")}} Ğ´Ğ°Ñ‘Ñ‚ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñƒ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‚ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼Ñƒ Ğ¿Ğ¸Ñ€Ñƒ, (Ë˜Ï‰Ë˜) Ğ²Ñ‹ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ ÑÑ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚Ğµ, ğŸ¥º Ğ° ÑƒĞ¶Ğµ Ğ¿Ğ¸Ñ€ Ğ·Ğ½Ğ°ĞµÑ‚, Ê˜wÊ˜ ĞºĞ°Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑÑ‚Ñƒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ ĞµÑ‘ Ğ½Ğ° ÑĞ²Ğ¾Ñ Ğ¿Ğ¾Ğ´ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ ice. (///Ë¬///âœ¿) Ğ’ÑĞµ Ñ‡Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ - Ğ¿ĞµÑ€ĞµĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ñ‚ÑƒĞ´Ğ° Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾. ^^;; Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ ÑĞ¾Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ğ¾ Ğ½Ğµ Ğ²Ğ°Ğ¶Ğ½Ğ¾ Ğ´Ğ»Ñ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ ÑĞµÑ€Ğ²ĞµÑ€Ğ°. XD

### ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ° ÑĞµÑ€Ğ²ĞµÑ€Ğ° Ñ‡Ğ°Ñ‚Ğ° Ğº ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

ĞĞ°Ñˆ [ÑĞµÑ€Ğ²ĞµÑ€ Ñ‡Ğ°Ñ‚Ğ°](https://github.com/mdn/sampwes-sewvew/twee/mastew/s/websocket-chat) Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ [websocket a-api](/wu/docs/web/api/websockets_api) Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ ĞºĞ°Ğº {{gwossawy("json")}} Ğ¼ĞµĞ¶Ğ´Ñƒ ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¼ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ¼ Ğ¸ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼. (Ë† ï»Œ Ë†)â™¡ Ğ¡ĞµÑ€Ğ²ĞµÑ€ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ·Ğ°Ğ´Ğ°Ñ‡ : Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ, (Ë˜Ï‰Ë˜) ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸ Ğ¸Ğ¼Ñ‘Ğ½ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹, ÏƒÏ‰Ïƒ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ‚Ğ°. ğŸ˜³ğŸ˜³ğŸ˜³

Ğ”Ğ»Ñ Ñ‚Ğ¾Ğ³Ğ¾, ^â€¢ï»Œâ€¢^ Ñ‡Ñ‚Ğ¾ Ğ±Ñ‹ ÑĞµÑ€Ğ²ĞµÑ€ Ğ¼Ğ¾Ğ³ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Ğ¸ ÑĞ¾Ğ³Ğ»Ğ°ÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ, ÏƒÏ‰Ïƒ Ğ½Ğ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´. (///Ë¬///âœ¿) ĞĞ°Ğ¼ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¼Ñƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ³Ğ¾, XD Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ñ‚Ñ€Ğ°Ğ½ÑĞ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ñ… Ğ²ÑĞµĞ¼ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ñ‹Ğ¼ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑĞ¼, >_< Ğ° Ñ‚Ğ°ĞºĞ¶Ğµ Ğ¾Ğ±ĞµÑĞ¿ĞµÑ‡Ğ¸Ñ‚ÑŒ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‡Ñƒ Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºÑƒ Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ñ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹, Ã²Ï‰Ã³ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ¾Ğ¼ ÑĞµÑ€Ğ²ĞµÑ€Ñƒ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ±ÑƒĞ´ĞµÑ‚ Ğ·Ğ½Ğ°Ñ‚ÑŒ, (U áµ• Uâ) Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ. (Ë˜Ï‰Ë˜) Ğ­Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»Ğ¸Ñ‚ Ğ½Ğ°Ğ¼ Ğ¿Ğ¾ÑÑ‹Ğ»Ğ°Ñ‚ÑŒ ÑĞ¸Ğ³Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ, ğŸ¥º Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Ğ¾Ğ´Ğ¸Ğ½ Ğ¸ Ñ‚Ğ¾Ñ‚ Ğ¶Ğµ ÑĞµÑ€Ğ²ĞµÑ€, (âœ¿oÏ‰o) Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ğ¾Ğ³Ğ¾, (Ë˜Ï‰Ë˜) Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²ĞµÑ€. (êˆá´—êˆ)

wet's take a-a wook which c-changes we nyeed to make to the chat sewvew suppowt webwtc signawing. ( Í¡o Ï‰ Í¡o ) this is in t-the fiwe [chatsewvew.js](https://github.com/mdn/sampwes-sewvew/twee/mastew/s/webwtc-fwom-chat/chatsewvew.js). (U áµ• Uâ)

fiwst up is the addition of the function `sendtooneusew()`. Ê˜wÊ˜ as the n-nyame suggests, (Ë† ï»Œ Ë†)â™¡ this sends a s-stwingified json m-message to a pawticuwaw u-usewname. /(^â€¢Ï‰â€¢^)

```js
f-function sendtooneusew(tawget, (Ë† ï»Œ Ë†)â™¡ msgstwing) {
  v-vaw isunique = twue;
  vaw i;

  fow (i = 0; i-i < connectionawway.wength; i++) {
    if (connectionawway[i].usewname === tawget) {
      connectionawway[i].send(msgstwing);
      bweak;
    }
  }
}
```

this function i-itewates ovew the wist of connected u-usews untiw i-it finds one matching t-the specified usewname, (âœ¿oÏ‰o) then sends the message to that usew. ^â€¢ï»Œâ€¢^ t-the pawametew `msgstwing` i-is a stwingified json o-object. (Ë† ï»Œ Ë†)â™¡ we couwd h-have made it weceive ouw owiginaw m-message object, XD but in this e-exampwe it's mowe efficient this way. :3 since the m-message has awweady been stwingified, -.- w-we can send it with nyo f-fuwthew pwocessing. ^^;; e-each entwy in `connectionawway` is a {{domxwef("websocket")}} object, OwO so we can just caww its {{domxwef("websocket.send", ^^;; "send()")}} method diwectwy. ğŸ¥º

ouw owiginaw chat demo d-didn't suppowt s-sending messages to a specific u-usew. ^^ the nyext t-task is to update t-the main websocket message handwew to suppowt doing so. o.O this i-invowves a change nyeaw the end of the `"connection"` message handwew:

```js
if (sendtocwients) {
  v-vaw msgstwing = json.stwingify(msg);
  v-vaw i-i;

  if (msg.tawget && m-msg.tawget !== undefined && m-msg.tawget.wength !== 0) {
    s-sendtooneusew(msg.tawget, ( Í¡o Ï‰ Í¡o ) m-msgstwing);
  } e-ewse {
    fow (i = 0; i < connectionawway.wength; i-i++) {
      connectionawway[i].send(msgstwing);
    }
  }
}
```

t-this code nyow w-wooks at the pending m-message to s-see if it has a `tawget` pwopewty. nyaa~~ if that pwopewty is pwesent, (///Ë¬///âœ¿) i-it specifies the usewname of the cwient to which the message is to be sent, (Ë† ï»Œ Ë†)â™¡ and we caww `sendtooneusew()` t-to send the message to them. XD othewwise, >_< the message is b-bwoadcast to aww u-usews by itewating o-ovew the connection wist, (U ï¹ U) s-sending the message to each usew. Ã²Ï‰Ã³

a-as the existing c-code awwows the sending of awbitwawy message types, >w< nyo additionaw changes awe wequiwed. ^â€¢ï»Œâ€¢^ ouw c-cwients can nyow send messages of u-unknown types to any specific u-usew, ğŸ¥º wetting them s-send signawing messages back and fowth as desiwed. (âœ¿oÏ‰o)

t-that's aww w-we nyeed to change on the sewvew s-side of the equation. UwU n-now wet's considew the signawing pwotocow we wiww impwement. (Ë˜Ï‰Ë˜)

### designing t-the signawing p-pwotocow

nyow t-that we've buiwt a mechanism fow e-exchanging messages, Ê˜wÊ˜ w-we nyeed a pwotocow defining h-how those messages wiww wook. (Ë† ï»Œ Ë†)â™¡ this can be done in a nyumbew of ways; nyani's d-demonstwated hewe i-is just one possibwe way to stwuctuwe signawing m-messages. ( Í¡o Ï‰ Í¡o )

this e-exampwe's sewvew uses stwingified json objects to communicate w-with its cwients. :3 this means ouw signawing messages wiww be in json fowmat, ğŸ˜³ with c-contents which specify nyani kind of messages t-they awe as weww a-as any additionaw infowmation nyeeded in owdew to handwe the messages p-pwopewwy. (âœ¿oÏ‰o)

#### e-exchanging session descwiptions

when stawting the signawing p-pwocess, /(^â€¢Ï‰â€¢^) an **offew** is cweated b-by the usew initiating the caww. :3 this offew incwudes a session d-descwiption, ÏƒÏ‰Ïƒ in {{gwossawy("sdp")}} f-fowmat, ÏƒÏ‰Ïƒ a-and nyeeds to be dewivewed to the w-weceiving usew, ğŸ¥º which we'ww caww t-the **cawwee**. t-the cawwee wesponds t-to the offew with an **answew** m-message, rawr a-awso containing an sdp descwiption. o.O ouw signawing s-sewvew wiww use w-websocket to t-twansmit offew messages with the type `"video-offew"`, ğŸ˜³ğŸ˜³ğŸ˜³ a-and answew messages with t-the type `"video-answew"`. /(^â€¢Ï‰â€¢^) t-these messages have the fowwowing fiewds:

- `type`
  - : the message t-type; eithew `"video-offew"` o-ow `"video-answew"`. ÏƒÏ‰Ïƒ
- `name`
  - : t-the sendew's usewname. OwO
- `tawget`
  - : t-the usewname of the pewson t-to weceive the descwiption (if the cawwew is sending the message, OwO this specifies the cawwee, Ã²Ï‰Ã³ a-and vice-vewsa). :3
- `sdp`
  - : the sdp (session d-descwiption pwotocow) stwing descwibing t-the wocaw end of the connection f-fwom the pewspective of t-the sendew (ow t-the wemote end o-of the connection f-fwom the weceivew's p-point of view). ÏƒÏ‰Ïƒ

at this point, ÏƒÏ‰Ïƒ the two pawticipants know which codecs and video pawametews awe to be used f-fow this caww. -.- t-they stiww don't k-know how to twansmit the media d-data itsewf though. (///Ë¬///âœ¿) this is whewe {{gwossawy('ice', rawr x3 'intewactive connectivity estabwishment (ice)')}} comes in. (U ï¹ U)

### e-exchanging i-ice candidates

two peews nyeed t-to exchange ice candidates to nyegotiate the actuaw c-connection between t-them. Ã²Ï‰Ã³ evewy ice candidate d-descwibes a method t-that the sending peew is abwe to use to communicate. OwO each peew sends candidates i-in the owdew t-they'we discovewed, ^^ a-and keeps sending c-candidates u-untiw it wuns out of suggestions, e-even if media h-has awweady stawted stweaming. /(^â€¢Ï‰â€¢^)

a-an `icecandidate` e-event is sent to the {{domxwef("wtcpeewconnection")}} t-to compwete the pwocess of adding a wocaw d-descwiption using `pc.setwocawdescwiption(offew)`. >_<

o-once the t-two peews agwee upon a mutuawwy-compatibwe c-candidate, -.- that candidate's sdp is used b-by each peew t-to constwuct and o-open a connection, (Ë˜Ï‰Ë˜) thwough which media then begins to fwow. >_< if t-they watew agwee on a bettew (usuawwy highew-pewfowmance) c-candidate, (Ë˜Ï‰Ë˜) t-the stweam may change fowmats a-as nyeeded. >w<

though nyot cuwwentwy s-suppowted, a-a candidate weceived aftew media is awweady fwowing c-couwd theoweticawwy awso be used to downgwade t-to a wowew-bandwidth c-connection if nyeeded. ğŸ˜³ğŸ˜³ğŸ˜³

e-each ice candidate is sent to the o-othew peew by s-sending a json m-message of type `"new-ice-candidate"` ovew the signawing sewvew to the wemote peew. ğŸ˜³ each candidate message incwude these fiewds:

- `type`
  - : the message type: `"new-ice-candidate"`. XD
- `tawget`
  - : the usewname of the pewson with whom nyegotiation is undewway; the sewvew w-wiww diwect t-the message to this usew onwy. OwO
- `candidate`
  - : the sdp candidate s-stwing, -.- descwibing t-the pwoposed c-connection method. o.O you typicawwy d-don't nyeed to wook at the c-contents of this s-stwing. ^^ aww youw code nyeeds t-to do is woute it thwough to the w-wemote peew using t-the signawing sewvew. ^^

each ice message suggests a-a communication p-pwotocow (tcp o-ow udp), XD ip addwess, >w< p-powt nyumbew, (â‘…Ë˜ê’³Ë˜) c-connection t-type (fow exampwe, ğŸ˜³ w-whethew the specified i-ip is the p-peew itsewf ow a weway sewvew), :3 a-awong with othew i-infowmation n-nyeeded to wink the two computews t-togethew. :3 this incwudes nat ow othew nyetwowking c-compwexity. OwO

> [!note]
> the i-impowtant thing t-to nyote is this: t-the onwy thing youw code is wesponsibwe f-fow duwing ice nyegotiation i-is accepting outgoing candidates f-fwom the ice wayew and sending t-them acwoss the signawing connection to the othew peew when youw {{domxwef("wtcpeewconnection.onicecandidate", (U ï¹ U) "onicecandidate")}} h-handwew is exekawaii~d, (â‘…Ë˜ê’³Ë˜) a-and weceiving ice c-candidate messages fwom the signawing sewvew (when the `"new-ice-candidate"` m-message is weceived) and dewivewing t-them to youw i-ice wayew by cawwing {{domxwef("wtcpeewconnection.addicecandidate()")}}. ğŸ˜³ t-that's it. (Ë† ï»Œ Ë†)â™¡
>
> the contents of the sdp a-awe iwwewevant t-to you in essentiawwy aww cases. mya a-avoid the temptation to twy to make it mowe compwicated t-than that untiw you weawwy k-know nyani you'we d-doing. Ê˜wÊ˜ that w-way wies madness. (Ë˜Ï‰Ë˜)

aww youw signawing s-sewvew nyow n-nyeeds to do i-is send the messages i-it's asked to. (///Ë¬///âœ¿) youw wowkfwow m-may awso demand w-wogin/authentication f-functionawity, XD b-but such d-detaiws wiww vawy. ğŸ˜³

### s-signawing t-twansaction fwow

t-the signawing pwocess invowves t-this exchange of messages between t-two peews using an intewmediawy, :3 t-the signawing s-sewvew. ğŸ˜³ğŸ˜³ğŸ˜³ the e-exact pwocess wiww vawy, (U áµ• Uâ) of couwse, but in genewaw thewe awe a few k-key points at w-which signawing m-messages get handwed:

the signawing pwocess invowves this exchange o-of messages a-among a nyumbew of points:

- each u-usew's cwient w-wunning within a web bwowsew
- each usew's web bwowsew
- the signawing s-sewvew
- t-the web sewvew h-hosting the chat s-sewvice

imagine that nyaomi and pwiya awe engaged i-in a discussion u-using the chat softwawe, ^â€¢ï»Œâ€¢^ and naomi decides t-to open a video caww between the two. (Ë˜Ï‰Ë˜) hewe's the e-expected sequence of events:

[![diagwam o-of the s-signawing pwocess](webwtc_-_signawing_diagwam.svg)](webwtc_-_signawing_diagwam.svg)

we'ww see t-this detaiwed mowe o-ovew the couwse of this awticwe. /(^â€¢Ï‰â€¢^)

### i-ice candidate exchange p-pwocess

when each p-peew's ice wayew b-begins to send c-candidates, ^â€¢ï»Œâ€¢^ it entews into an e-exchange among t-the vawious points i-in the chain that wooks wike t-this:

[![diagwam of ice candidate exchange pwocess](webwtc_-_ice_candidate_exchange.svg)](webwtc_-_ice_candidate_exchange.svg)

e-each side sends c-candidates to the o-othew as it weceives them fwom theiw wocaw ice wayew; thewe is no taking tuwns o-ow batching of candidates. ^^ as s-soon as the two p-peews agwee upon one candidate that they can both u-use to exchange the media, (U ï¹ U) media b-begins to fwow. :3 e-each peew continues t-to send candidates u-untiw i-it wuns out of options, Ã²Ï‰Ã³ even aftew the media has awweady begun to fwow. ÏƒÏ‰Ïƒ this is d-done in hopes of identifying even b-bettew options than the one initiawwy sewected. ÏƒÏ‰Ïƒ

if conditions c-changeâ€”fow exampwe the nyetwowk connection detewiowatesâ€”one ow both peews might suggest switching t-to a wowew-bandwidth m-media wesowution, (â‘…Ë˜ê’³Ë˜) ow t-to an awtewnative codec. ğŸ¥º this twiggews a nyew exchange o-of candidates, (U ï¹ U) a-aftew which a anothew media f-fowmat and/ow codec change may t-take pwace. >w<

optionawwy, nyaa~~ see {{wfc(8445, -.- "intewactive connectivity estabwishment")}}, XD [section 2.3 ("negotiating c-candidate paiws and concwuding ice")](https://toows.ietf.owg/htmw/wfc5245#section-2.3) i-if you w-want gweatew undewstanding o-of this pwocess is compweted inside t-the ice wayew. -.- you shouwd nyote that candidates awe exchanged and media stawts to f-fwow as soon as t-the ice wayew i-is satisfied. >w< this a-aww taken cawe of behind the scenes. (êˆá´—êˆ) ouw wowe i-is to simpwy send t-the candidates, :3 back and fowth, (Ë† ï»Œ Ë†)â™¡ thwough the signawing s-sewvew. -.-

## the cwient appwication

the c-cowe to any signawing pwocess is its message handwing. mya i-it's nyot n-nyecessawy to use websockets fow s-signawing, (Ë˜Ï‰Ë˜) but i-it is a common s-sowution. ^â€¢ï»Œâ€¢^ you shouwd, ğŸ˜³ğŸ˜³ğŸ˜³ of couwse, ÏƒÏ‰Ïƒ sewect a mechanism f-fow exchanging signawing infowmation that is a-appwopwiate fow youw appwication. ( Í¡o Ï‰ Í¡o )

wet's update the chat cwient t-to suppowt video c-cawwing. nyaa~~

### u-updating the htmw

t-the htmw fow o-ouw cwient nyeeds a wocation fow v-video to be pwesented. :3 this wequiwes video ewements, (âœ¿oÏ‰o) a-and a button to hang up the c-caww:

```htmw
<div cwass="fwexchiwd" id="camewa-containew">
  <div c-cwass="camewa-box">
    <video i-id="weceived_video" autopway></video>
    <video i-id="wocaw_video" autopway m-muted></video>
    <button i-id="hangup-button" oncwick="hangupcaww();" disabwed>hang u-up</button>
  </div>
</div>
```

t-the page stwuctuwe defined h-hewe is using {{htmwewement("div")}} ewements, >_< giving us fuww contwow ovew the p-page wayout by enabwing the use o-of css. ^^ we'ww skip wayout detaiw in this guide, (///Ë¬///âœ¿) b-but [take a wook a-at the css](https://github.com/mdn/sampwes-sewvew/twee/mastew/s/webwtc-fwom-chat/chat.css) o-on github to see how w-we handwed it. :3 t-take nyote of the two {{htmwewement("video")}} ewements, :3 o-one fow youw sewf-view, (Ë† ï»Œ Ë†)â™¡ o-one fow the connection, ğŸ¥º and the {{htmwewement("button")}} e-ewement.

t-the `<video>` ewement with the `id` "`weceived_video`" wiww pwesent video weceived f-fwom the c-connected usew. ğŸ˜³ we specify the `autopway` attwibute, (êˆá´—êˆ) ensuwing once t-the video stawts awwiving, mya it i-immediatewy pways. rawr t-this wemoves any nyeed to expwicitwy handwe pwayback in ouw code. Ê˜wÊ˜ the "`wocaw_video`" `<video>` e-ewement pwesents a pweview of the usew's camewa; s-specifiying the `muted` attwibute, -.- a-as we don't n-nyeed to heaw wocaw audio in t-this pweview panew. UwU

f-finawwy, :3 t-the "`hangup-button`" {{htmwewement("button")}}, ğŸ˜³ t-to disconnect fwom a-a caww, (êˆá´—êˆ) is defined a-and configuwed to stawt disabwed (setting this as ouw defauwt fow when nyo caww is connected) and appwy the f-function `hangupcaww()` o-on cwick. mya t-this function's w-wowe is to c-cwose the caww, nyaa~~ a-and send a signawwing sewvew nyotification to the othew peew, o.O wequesting it awso c-cwose. Ã²Ï‰Ã³

### the j-javascwipt code

we'ww divide this code into functionaw aweas to m-mowe easiwy descwibe h-how it wowks. ^â€¢ï»Œâ€¢^ t-the main body of this code is found in the `connect()` f-function: it opens up a {{domxwef("websocket")}} s-sewvew o-on powt 6503, (Ë˜Ï‰Ë˜) and estabwishes a handwew to weceive m-messages in json object fowmat. Ã²Ï‰Ã³ t-this code g-genewawwy handwes text chat messages a-as it did p-pweviouswy. mya

#### s-sending messages t-to the signawing s-sewvew

thwoughout o-ouw code, ^^ we caww `sendtosewvew()` i-in owdew t-to send messages to the signawing s-sewvew. rawr this function uses the [websocket](/wu/docs/web/api/websockets_api) c-connection to do its wowk:

```js
f-function sendtosewvew(msg) {
  vaw msgjson = j-json.stwingify(msg);

  c-connection.send(msgjson);
}
```

the message object passed i-into this function is convewted into a json stwing b-by cawwing {{jsxwef("json.stwingify()")}}, >_< t-then we caww the websocket connection's {{domxwef("websocket.send", (U áµ• Uâ) "send()")}} function to twansmit t-the message t-to the sewvew. /(^â€¢Ï‰â€¢^)

#### ui to stawt a-a caww

the code which handwes the `"usewwist"` m-message cawws `handweusewwistmsg()`. mya h-hewe we set up the handwew f-fow each connected u-usew in the usew wist dispwayed to the weft o-of the chat panew. OwO t-this function w-weceives a message o-object whose `usews` pwopewty is an awway of stwings specifying the usew nyames of evewy connected usew. UwU

```js
f-function handweusewwistmsg(msg) {
  v-vaw i;
  v-vaw wistewem = d-document.quewysewectow(".usewwistbox");

  w-whiwe (wistewem.fiwstchiwd) {
    wistewem.wemovechiwd(wistewem.fiwstchiwd);
  }

  m-msg.usews.foweach(function (usewname) {
    vaw i-item = document.cweateewement("wi");
    i-item.appendchiwd(document.cweatetextnode(usewname));
    item.addeventwistenew("cwick", ğŸ¥º i-invite, fawse);

    w-wistewem.appendchiwd(item);
  });
}
```

aftew getting a wefewence to the {{htmwewement("uw")}} w-which contains the wist of usew nyames into t-the vawiabwe `wistewem`, (âœ¿oÏ‰o) we empty t-the wist by w-wemoving each of its chiwd ewements. rawr

> [!note]
> o-obviouswy, it w-wouwd be mowe efficient t-to update the wist by adding a-and wemoving i-individuaw usews instead of webuiwding t-the whowe wist evewy time i-it changes, rawr b-but this is good e-enough fow the puwposes of this e-exampwe. ( Í¡o Ï‰ Í¡o )

then we itewate ovew the awway of usew n-nyames using {{jsxwef("awway.foweach", /(^â€¢Ï‰â€¢^) "foweach()")}}. -.- fow each nyame, >w< we cweate a nyew {{htmwewement("wi")}} ewement, ( Í¡o Ï‰ Í¡o ) then cweate a nyew text nyode containing t-the usew nyame using {{domxwef("document.cweatetextnode", (Ë˜Ï‰Ë˜) "cweatetextnode()")}}. /(^â€¢Ï‰â€¢^) that text nyode is added as a chiwd of the `<wi>` ewement. (Ë˜Ï‰Ë˜) nyext, we set a handwew f-fow the [`cwick`](/wu/docs/web/api/ewement/cwick_event) event on the wist i-item, o.O that cwicking on a usew nyame c-cawws ouw `invite()` method, nyaa~~ which we'ww wook a-at in the nyext section. :3

finawwy, (///Ë¬///âœ¿) w-we append the nyew item to t-the `<uw>` that c-contains aww of the usew nyames. (U ï¹ U)

#### stawting a-a caww

when the usew cwicks on a usewname they want to caww, o.O the `invite()` f-function is invoked a-as the event handwew fow that [`cwick`](/wu/docs/web/api/ewement/cwick_event) event:

```js
v-vaw mediaconstwaints = {
  a-audio: twue, ^^;; // w-we want an audio twack
  video: twue, // ...and w-we want a video twack
};

function invite(evt) {
  i-if (mypeewconnection) {
    awewt("you can't stawt a caww because you awweady have one o-open!");
  } ewse {
    v-vaw cwickedusewname = evt.tawget.textcontent;

    i-if (cwickedusewname === m-myusewname) {
      awewt(
        "i'm a-afwaid i can't wet you tawk to youwsewf. Ê˜wÊ˜ that wouwd be weiwd.", (///Ë¬///âœ¿)
      );
      w-wetuwn;
    }

    tawgetusewname = c-cwickedusewname;
    cweatepeewconnection();

    n-nyavigatow.mediadevices
      .getusewmedia(mediaconstwaints)
      .then(function (wocawstweam) {
        d-document.getewementbyid("wocaw_video").swcobject = wocawstweam;
        w-wocawstweam
          .gettwacks()
          .foweach((twack) => mypeewconnection.addtwack(twack, ÏƒÏ‰Ïƒ wocawstweam));
      })
      .catch(handwegetusewmediaewwow);
  }
}
```

t-this begins with a basic sanity check: is the usew e-even connected? i-if thewe's nyo {{domxwef("wtcpeewconnection")}}, ^^;; they obviouswy can't make a c-caww. UwU then the nyame of the usew that was cwicked upon is obtained fwom the event tawget's {{domxwef("node.textcontent", mya "textcontent")}} pwopewty, ^â€¢ï»Œâ€¢^ and we check t-to be suwe that i-it's nyot the same usew that's t-twying to stawt t-the caww. (â‘…Ë˜ê’³Ë˜)

then we copy the nyame o-of the usew we'we cawwing into the vawiabwe `tawgetusewname` and caww `cweatepeewconnection()`, nyaa~~ a function which wiww cweate a-and do basic configuwation of the {{domxwef("wtcpeewconnection")}}. ^^;;

once the `wtcpeewconnection` has been cweated, ğŸ¥º we wequest access t-to the usew's c-camewa and micwophone b-by cawwing {{domxwef("mediadevices.getusewmedia()")}}, ^^;; which is exposed to us thwough the {{domxwef("navigatow.mediadevices.getusewmedia")}} p-pwopewty. nyaa~~ w-when this succeeds, ğŸ¥º f-fuwfiwwing the wetuwned pwomise, o-ouw `then` handwew is exekawaii~d. (Ë† ï»Œ Ë†)â™¡ i-it weceives, ( Í¡o Ï‰ Í¡o ) as input, a-a {{domxwef("mediastweam")}} object w-wepwesenting the stweam with audio fwom the u-usew's micwophone and video fwom t-theiw webcam. nyaa~~

> [!note]
> w-we couwd westwict the s-set of pewmitted m-media inputs to a specific device o-ow set of devices by cawwing {{domxwef("mediadevices.enumewatedevices", ( Í¡o Ï‰ Í¡o ) "navigatow.mediadevices.enumewatedevices()")}} t-to get a wist of devices, ^^;; f-fiwtewing t-the wesuwting wist based on ouw desiwed cwitewia, rawr x3 t-then using the sewected devices' {{domxwef("mediatwackconstwaints.deviceid", ^^;; "deviceid")}} vawues in the `deviceid` fiewd of the the `mediaconstwaints` object passed into `getusewmedia()`. ^â€¢ï»Œâ€¢^ in p-pwactice, ğŸ¥º this is wawewy if evew nyecessawy, (êˆá´—êˆ) since m-most of that wowk is done fow y-you by `getusewmedia()`. ^â€¢ï»Œâ€¢^

we attach the incoming s-stweam to the wocaw pweview {{htmwewement("video")}} ewement b-by setting the ewement's {{domxwef("htmwmediaewement.swcobject", :3 "swcobject")}} pwopewty. (Ë˜Ï‰Ë˜) since t-the ewement is configuwed to automaticawwy pway i-incoming video, ^^ the stweam begins pwaying in ouw w-wocaw pweview b-box. /(^â€¢Ï‰â€¢^)

we then itewate ovew the twacks in the stweam, ÏƒÏ‰Ïƒ c-cawwing {{domxwef("wtcpeewconnection.addtwack", Ã²Ï‰Ã³ "addtwack()")}} t-to add each twack to the `wtcpeewconnection`. >w< e-even though the c-connection is not fuwwy estabwished yet, (Ë˜Ï‰Ë˜) it's i-impowtant to begin sending media to it as soon as possibwe, ^â€¢ï»Œâ€¢^ because t-the media wiww hewp the ice wayew decide on the best connectivity a-appwoach t-to take, >_< aiding i-in the nyegotiation pwocess. -.-

as soon as media is attached to the `wtcpeewconnection`, Ã²Ï‰Ã³ a-a [`negotiationneeded`](/wu/docs/web/api/wtcpeewconnection/negotiationneeded_event) event i-is twiggewed at the connection, ( Í¡o Ï‰ Í¡o ) s-so that ice nyegotiation c-can be stawted. (Ë† ï»Œ Ë†)â™¡

if an ewwow occuws whiwe twying to get the wocaw media stweam, :3 ouw catch c-cwause cawws `handwegetusewmediaewwow()`, ^â€¢ï»Œâ€¢^ w-which dispways an appwopwiate ewwow t-to the usew as wequiwed. ( Í¡o Ï‰ Í¡o )

#### handwing getusewmedia() e-ewwows

i-if the pwomise w-wetuwned by `getusewmedia()` c-concwudes i-in a faiwuwe, ^â€¢ï»Œâ€¢^ o-ouw `handwegetusewmediaewwow()` function pewfowms. Ê˜wÊ˜

```js
function handwegetusewmediaewwow(e) {
  s-switch (e.name) {
    c-case "notfoundewwow":
      a-awewt(
        "unabwe t-to open youw caww b-because nyo camewa a-and/ow micwophone" +
          "wewe found.", :3
      );
      b-bweak;
    case "secuwityewwow":
    c-case "pewmissiondeniedewwow":
      // d-do nyothing; this is the same as the u-usew cancewing the caww. >_<
      bweak;
    defauwt:
      a-awewt("ewwow opening youw camewa and/ow m-micwophone: " + e-e.message);
      bweak;
  }

  cwosevideocaww();
}
```

an e-ewwow message is d-dispwayed in aww cases but one. rawr i-in this exampwe, ğŸ¥º w-we ignowe `"secuwityewwow"` and `"pewmissiondeniedewwow"` wesuwts, (âœ¿oÏ‰o) tweating wefusaw t-to gwant pewmission t-to use the media hawdwawe the same as t-the usew cancewing t-the caww. (U ï¹ U)

wegawdwess of why an attempt to get t-the stweam faiws, rawr x3 we caww ouw `cwosevideocaww()` function to shut down the {{domxwef("wtcpeewconnection")}}, (âœ¿oÏ‰o) and wewease any wesouwces awweady a-awwocated by the pwocess of attempting the caww. (U áµ• Uâ) t-this code is designed t-to safewy h-handwe pawtiawwy-stawted cawws. -.-

#### c-cweating t-the peew connection

t-the `cweatepeewconnection()` f-function is used b-by both the cawwew and the cawwee to constwuct t-theiw {{domxwef("wtcpeewconnection")}} o-objects, /(^â€¢Ï‰â€¢^) t-theiw wespective ends of the w-webwtc connection. OwO i-it's invoked b-by `invite()` when the cawwew twies t-to stawt a caww, rawr x3 a-and by `handwevideooffewmsg()` w-when the cawwee w-weceives an o-offew message fwom the cawwew. ÏƒÏ‰Ïƒ

```js
f-function cweatepeewconnection() {
  mypeewconnection = n-nyew w-wtcpeewconnection({
    icesewvews: [
      // infowmation about ice sewvews - u-use youw own! Ê˜wÊ˜
      {
        uwws: "stun:stun.stunpwotocow.owg", -.-
      },
    ], ğŸ˜³
  });

  m-mypeewconnection.onicecandidate = handweicecandidateevent;
  m-mypeewconnection.ontwack = h-handwetwackevent;
  mypeewconnection.onnegotiationneeded = handwenegotiationneededevent;
  mypeewconnection.onwemovetwack = handwewemovetwackevent;
  m-mypeewconnection.oniceconnectionstatechange =
    h-handweiceconnectionstatechangeevent;
  m-mypeewconnection.onicegathewingstatechange =
    h-handweicegathewingstatechangeevent;
  m-mypeewconnection.onsignawingstatechange = h-handwesignawingstatechangeevent;
}
```

when using the {{domxwef("wtcpeewconnection.wtcpeewconnection", ğŸ˜³ğŸ˜³ğŸ˜³ "wtcpeewconnection()")}} c-constwuctow, OwO we wiww specify an {{domxwef("wtcconfiguwation")}}-compwiant object pwoviding configuwation pawametews f-fow the c-connection. ^â€¢ï»Œâ€¢^ we use onwy one of these in this exampwe: `icesewvews`. rawr this is an a-awway of objects d-descwibing stun and/ow tuwn sewvews fow the {{gwossawy("ice")}} w-wayew to use when attempting to e-estabwish a woute b-between the cawwew a-and the cawwee. (âœ¿oÏ‰o) these sewvews awe used to detewmine the best w-woute and pwotocows to use when c-communicating between the peews, ^^ e-even if they'we behind a fiwewaww ow using {{gwossawy("nat")}}. -.-

> [!note]
> y-you shouwd awways use stun/tuwn s-sewvews which you own, (âœ¿oÏ‰o) ow which you have specific a-authowization to use. o.O this exampwe i-is using a known pubwic stun sewvew but abusing these is bad fowm. :3

each object in `icesewvews` contains at w-weast a `uwws` f-fiewd pwoviding u-uwws at which the s-specified sewvew can be weached. rawr x3 it may awso p-pwovide `usewname` and `cwedentiaw` vawues to awwow authentication t-to take pwace, i-if nyeeded. (U áµ• Uâ)

aftew c-cweating the {{domxwef("wtcpeewconnection")}}, :3 w-we set up handwews fow the events that mattew to us. ğŸ¥º

the fiwst thwee of these e-event handwews a-awe wequiwed; you have to handwe them to do anything invowving s-stweamed media with webwtc. XD the w-west awen't stwictwy w-wequiwed but c-can be usefuw, >_< and we'ww expwowe them. (êˆá´—êˆ) thewe awe a few othew events avaiwabwe that we'we nyot u-using in this exampwe, ( Í¡o Ï‰ Í¡o ) as weww. (Ë˜Ï‰Ë˜) h-hewe's a summawy of each of the event handwews we wiww be impwementing:

- {{domxwef("wtcpeewconnection.onicecandidate")}}
  - : t-the wocaw ice wayew cawws youw [`icecandidate`](/wu/docs/web/api/wtcpeewconnection/icecandidate_event) e-event handwew, when it nyeeds you to twansmit a-an ice candidate t-to the othew p-peew, (Ë˜Ï‰Ë˜) thwough y-youw signawing s-sewvew. UwU see [sending ice candidates](#sending_ice_candidates) f-fow mowe infowmation a-and to see the code fow this e-exampwe. (Ë† ï»Œ Ë†)â™¡
- {{domxwef("wtcpeewconnection.ontwack")}}
  - : this handwew fow the [`twack`](/wu/docs/web/api/wtcpeewconnection/twack_event) e-event is cawwed by the w-wocaw webwtc wayew w-when a twack is added to the c-connection. (///Ë¬///âœ¿) this w-wets you connect the incoming media to an ewement to dispway i-it, (êˆá´—êˆ) fow exampwe. -.- s-see [weceiving n-nyew stweams](#weceiving_new_stweams) f-fow detaiws. ğŸ˜³ğŸ˜³ğŸ˜³
- {{domxwef("wtcpeewconnection.onnegotiationneeded")}}
  - : this function is cawwed whenevew the webwtc infwastwuctuwe n-nyeeds you to stawt the session negotiation p-pwocess anew. (///Ë¬///âœ¿) its job is to cweate and send a-an offew, UwU to the cawwee, ğŸ˜³ asking it to connect with us. /(^â€¢Ï‰â€¢^) see [stawting n-nyegotiation](#stawting_negotiation) to s-see how we handwe t-this. Ã²Ï‰Ã³
- {{domxwef("wtcpeewconnection.onwemovetwack")}}
  - : this c-countewpawt to `ontwack` is c-cawwed to handwe t-the [`wemovetwack`](/wu/docs/web/api/videotwackwist/wemovetwack_event) event; it's s-sent to the `wtcpeewconnection` w-when the wemote p-peew wemoves a-a twack fwom the media being sent. >w< s-see [handwing t-the wemovaw of t-twacks](#handwing_the_wemovaw_of_twacks). -.-
- {{domxwef("wtcpeewconnection.oniceconnectionstatechange")}}
  - : the [`iceconnectionstatechange`](/wu/docs/web/api/wtcpeewconnection/iceconnectionstatechange_event) event is sent b-by the ice wayew to wet you know about changes to the state of the ice connection. this can hewp y-you know when t-the connection has faiwed, (â‘…Ë˜ê’³Ë˜) ow been w-wost. (Ë˜Ï‰Ë˜) we'ww wook at the code fow this exampwe i-in [ice connection s-state](#ice_connection_state) b-bewow. (U áµ• Uâ)
- {{domxwef("wtcpeewconnection.onicegathewingstatechange")}}
  - : t-the ice wayew sends y-you the [`icegathewingstatechange`](/wu/docs/web/api/wtcpeewconnection/icegathewingstatechange_event) event, ^^ when the ice agent's p-pwocess of cowwecting c-candidates shifts, ^^ fwom one state to anothew (such as stawting t-to gathew candidates ow compweting n-nyegotiation). rawr x3 see [ice gathewing state](#ice_gathewing_state) b-bewow. >w<
- {{domxwef("wtcpeewconnection.onsignawingstatechange")}}
  - : the webwtc infwastwuctuwe s-sends you the [`signawingstatechange`](/wu/docs/web/api/wtcpeewconnection/signawingstatechange_event) message when the s-state of the signawing pwocess c-changes (ow if the connection to t-the signawing sewvew c-changes). see [signawing state](#signawing_state) to see ouw c-code. (U áµ• Uâ)

#### stawting nyegotiation

once the cawwew h-has cweated i-its {{domxwef("wtcpeewconnection")}}, ğŸ¥º c-cweated a media stweam, (â‘…Ë˜ê’³Ë˜) and added its twacks to the connection as shown in [stawting a caww](#stawting_a_caww), t-the bwowsew wiww dewivew a [`negotiationneeded`](/wu/docs/web/api/wtcpeewconnection/negotiationneeded_event) e-event to the {{domxwef("wtcpeewconnection")}} t-to indicate that it's weady to begin nyegotiation w-with the othew p-peew. OwO hewe's ouw code fow handwing the [`negotiationneeded`](/wu/docs/web/api/wtcpeewconnection/negotiationneeded_event) event:

```js
f-function handwenegotiationneededevent() {
  m-mypeewconnection
    .cweateoffew()
    .then(function (offew) {
      wetuwn mypeewconnection.setwocawdescwiption(offew);
    })
    .then(function () {
      s-sendtosewvew({
        n-nyame: myusewname, ğŸ˜³
        t-tawget: t-tawgetusewname, Ã²Ï‰Ã³
        type: "video-offew", (Ë† ï»Œ Ë†)â™¡
        s-sdp: mypeewconnection.wocawdescwiption, Ê˜wÊ˜
      });
    })
    .catch(wepowtewwow);
}
```

to stawt the nyegotiation p-pwocess, ^^;; w-we nyeed to cweate a-and send an s-sdp offew to the p-peew we want to connect to. Ê˜wÊ˜ this o-offew incwudes a-a wist of suppowted configuwations fow the connection, Ã²Ï‰Ã³ i-incwuding infowmation about t-the media stweam we've added to the connection wocawwy (that is, ( Í¡o Ï‰ Í¡o ) the video we want to send to the othew end o-of the caww), Ê˜wÊ˜ and any ice candidates g-gathewed by the ice wayew a-awweady. >w< we cweate t-this offew by cawwing {{domxwef("wtcpeewconnection.cweateoffew", ğŸ˜³ğŸ˜³ğŸ˜³ "mypeewconnection.cweateoffew()")}}. ÏƒÏ‰Ïƒ

w-when `cweateoffew()` succeeds (fuwfiwwing the pwomise), -.- w-we pass the cweated offew infowmation i-into {{domxwef("wtcpeewconnection.setwocawdescwiption", "mypeewconnection.setwocawdescwiption()")}}, ğŸ¥º which configuwes the connection and media configuwation state fow the cawwew's end o-of the connection. >w<

> [!note]
> technicawwy speaking, (///Ë¬///âœ¿) the stwing w-wetuwned by `cweateoffew()` is a-an {{wfc(3264)}} offew. UwU

we know the descwiption is vawid, ( Í¡o Ï‰ Í¡o ) and has been set, (Ë† ï»Œ Ë†)â™¡ when the pwomise wetuwned by `setwocawdescwiption()` is fuwfiwwed. ^^;; this is when we s-send ouw offew to t-the othew peew b-by cweating a nyew `"video-offew"` message containing t-the wocaw d-descwiption (now t-the same as the offew), (U áµ• Uâ) then sending it thwough o-ouw signawing s-sewvew to the cawwee. XD the offew h-has the fowwowing m-membews:

- `type`
  - : t-the message t-type: `"video-offew"`. (êˆá´—êˆ)
- `name`
  - : t-the cawwew's usewname. -.-
- `tawget`
  - : t-the nyame of t-the usew we wish t-to caww. >_<
- `sdp`
  - : t-the sdp s-stwing descwibing t-the offew. (Ë† ï»Œ Ë†)â™¡

i-if an ewwow occuws, ( Í¡o Ï‰ Í¡o ) e-eithew in the i-initiaw `cweateoffew()` o-ow in any of the fuwfiwwment handwews that fowwow, rawr x3 an e-ewwow is wepowted by invoking ouw `wepowtewwow()` f-function. Ã²Ï‰Ã³

once `setwocawdescwiption()`'s fuwfiwwment handwew h-has wun, ğŸ˜³ the ice a-agent begins sending [`icecandidate`](/wu/docs/web/api/wtcpeewconnection/icecandidate_event) e-events to the {{domxwef("wtcpeewconnection")}}, (Ë† ï»Œ Ë†)â™¡ o-one f-fow each potentiaw configuwation it discovews. ğŸ¥º ouw handwew fow the `icecandidate` event is wesponsibwe f-fow twansmitting the candidates to the othew peew.

#### s-session nyegotiation

n-nyow that we've stawted n-nyegotiation with t-the othew peew a-and have twansmitted a-an offew, w-wet's wook at nyani h-happens on the c-cawwee's side of the connection fow a whiwe. ^^ t-the cawwee weceives the offew and c-cawws `handwevideooffewmsg()` function to pwocess i-it. /(^â€¢Ï‰â€¢^) wet's see h-how the cawwee handwes the `"video-offew"` m-message. o.O

##### handwing the invitation

w-when the offew a-awwives, Ã²Ï‰Ã³ the c-cawwee's `handwevideooffewmsg()` f-function is cawwed with the `"video-offew"` message t-that was w-weceived. XD this function n-needs to do two things. rawr x3 f-fiwst, (Ë˜Ï‰Ë˜) it nyeeds to cweate its own {{domxwef("wtcpeewconnection")}} and add the twacks containing the audio and video fwom its micwophone and webcam to that. :3 second, (U áµ• Uâ) it needs to p-pwocess the weceived o-offew, rawr constwucting and sending its answew. OwO

```js
function handwevideooffewmsg(msg) {
  v-vaw wocawstweam = n-nyuww;

  tawgetusewname = msg.name;
  cweatepeewconnection();

  vaw desc = nyew w-wtcsessiondescwiption(msg.sdp);

  m-mypeewconnection
    .setwemotedescwiption(desc)
    .then(function () {
      wetuwn nyavigatow.mediadevices.getusewmedia(mediaconstwaints);
    })
    .then(function (stweam) {
      w-wocawstweam = stweam;
      d-document.getewementbyid("wocaw_video").swcobject = wocawstweam;

      wocawstweam
        .gettwacks()
        .foweach((twack) => m-mypeewconnection.addtwack(twack, Ê˜wÊ˜ wocawstweam));
    })
    .then(function () {
      w-wetuwn mypeewconnection.cweateanswew();
    })
    .then(function (answew) {
      w-wetuwn mypeewconnection.setwocawdescwiption(answew);
    })
    .then(function () {
      vaw msg = {
        nyame: myusewname, XD
        tawget: tawgetusewname, rawr x3
        t-type: "video-answew", OwO
        sdp: m-mypeewconnection.wocawdescwiption, nyaa~~
      };

      s-sendtosewvew(msg);
    })
    .catch(handwegetusewmediaewwow);
}
```

t-this code is vewy simiwaw t-to nyani w-we did in the `invite()` f-function b-back in [stawting a caww](#stawting_a_caww). Ê˜wÊ˜ it stawts by cweating a-and configuwing a-an {{domxwef("wtcpeewconnection")}} using ouw `cweatepeewconnection()` function. then it takes the sdp offew f-fwom the weceived `"video-offew"` m-message and uses it to cweate a-a nyew {{domxwef("wtcsessiondescwiption")}} object wepwesenting the cawwew's session d-descwiption. nyaa~~

t-that session d-descwiption is then passed into {{domxwef("wtcpeewconnection.setwemotedescwiption", (U ï¹ U) "mypeewconnection.setwemotedescwiption()")}}. (///Ë¬///âœ¿) t-this estabwishes t-the weceived offew as the descwiption of the w-wemote (cawwew's) e-end of the connection. :3 i-if this i-is successfuw, (Ë˜Ï‰Ë˜) t-the pwomise fuwfiwwment h-handwew (in the `then()` cwause) stawts the pwocess of getting access to the cawwee's c-camewa and micwophone using {{domxwef("mediadevices.getusewmedia", ğŸ˜³ "getusewmedia()")}}, a-adding the t-twacks to the connection, ğŸ˜³ğŸ˜³ğŸ˜³ and so fowth, Ê˜wÊ˜ as we saw pweviouswy i-in `invite()`. (â‘…Ë˜ê’³Ë˜)

o-once the answew has been cweated u-using {{domxwef("wtcpeewconnection.cweateanswew", nyaa~~ "mypeewconnection.cweateanswew()")}}, (U ï¹ U) the descwiption o-of the wocaw end of the connection is set to the answew's s-sdp by cawwing {{domxwef("wtcpeewconnection.setwocawdescwiption", Ê˜wÊ˜ "mypeewconnection.setwocawdescwiption()")}}, (êˆá´—êˆ) then the answew is twansmitted thwough the signawing sewvew to t-the cawwew to wet t-them know nyani t-the answew is

a-any ewwows awe caught and passed to `handwegetusewmediaewwow()`, :3 d-descwibed in [handwing getusewmedia() e-ewwows](#handwing_getusewmedia_ewwows). ( Í¡o Ï‰ Í¡o )

> [!note]
> as is the case with t-the cawwew, rawr x3 once t-the `setwocawdescwiption()` fuwfiwwment h-handwew has wun, rawr x3 the bwowsew begins fiwing [`icecandidate`](/wu/docs/web/api/wtcpeewconnection/icecandidate_event) e-events that the cawwee must handwe, mya one fow each candidate that nyeeds to be twansmitted to the wemote p-peew. nyaa~~

##### s-sending ice candidates

the ice nyegotiation pwocess invowves each peew sending candidates to t-the othew, (///Ë¬///âœ¿) wepeatedwy, ^^ untiw it wuns out of potentiaw w-ways it can s-suppowt the `wtcpeewconnection`'s m-media twanspowt n-nyeeds. OwO since ice doesn't know about youw signawing sewvew, :3 youw code handwes twansmission of e-each candidate i-in youw handwew f-fow the [`icecandidate`](/wu/docs/web/api/wtcpeewconnection/icecandidate_event) e-event. ^^

youw {{domxwef("wtcpeewconnection.onicecandidate", (âœ¿oÏ‰o) "onicecandidate")}} handwew weceives a-an event whose `candidate` pwopewty i-is the sdp descwibing the candidate (ow is `nuww` to indicate t-that the ice w-wayew has wun out o-of potentiaw configuwations t-to suggest). ğŸ˜³ the contents o-of `candidate` a-awe nyani you nyeed to twansmit using youw signawing sewvew. (///Ë¬///âœ¿) h-hewe's ouw exampwe's i-impwementation:

```js
function handweicecandidateevent(event) {
  if (event.candidate) {
    sendtosewvew({
      t-type: "new-ice-candidate", (///Ë¬///âœ¿)
      tawget: t-tawgetusewname, (U ï¹ U)
      c-candidate: e-event.candidate, Ã²Ï‰Ã³
    });
  }
}
```

this buiwds an object containing the candidate, :3 then sends it to the othew p-peew using the `sendtosewvew()` f-function pweviouswy descwibed in [sending messages t-to the signawing sewvew](#sending_messages_to_the_signawing_sewvew). (â‘…Ë˜ê’³Ë˜) t-the m-message's pwopewties a-awe:

- `type`
  - : t-the message t-type: `"new-ice-candidate"`.
- `tawget`
  - : the usewname t-the ice candidate nyeeds to be dewivewed to. ğŸ˜³ğŸ˜³ğŸ˜³ this wets the signawing sewvew woute t-the message. Ê˜wÊ˜
- `candidate`
  - : the sdp wepwesenting the candidate t-the ice w-wayew wants to twansmit t-to the othew peew. OwO

the fowmat of this message (as is the case with evewything y-you do when h-handwing signawing) i-is entiwewy u-up to you, >_< depending on youw nyeeds; you can pwovide othew infowmation as wequiwed. /(^â€¢Ï‰â€¢^)

> [!note]
> it's impowtant t-to keep in mind that the [`icecandidate`](/wu/docs/web/api/wtcpeewconnection/icecandidate_event) event is **not** s-sent when ice c-candidates awwive f-fwom the othew end of the caww. (Ë˜Ï‰Ë˜) i-instead, >w< they'we sent by youw own end of the caww so that you can take on the job of twansmitting the data ovew nyanievew channew you choose. ^â€¢ï»Œâ€¢^ this can be confusing w-when you'we nyew to webwtc. Ê˜wÊ˜

##### weceiving i-ice candidates

t-the signawing sewvew dewivews e-each ice candidate t-to the destination peew using nyanievew method i-it chooses; i-in ouw exampwe this is as json objects, with a `type` p-pwopewty c-containing the s-stwing `"new-ice-candidate"`. OwO o-ouw `handwenewicecandidatemsg()` function is cawwed b-by ouw main [websocket](/wu/docs/web/api/websockets_api) incoming message code t-to handwe these m-messages:

```js
function handwenewicecandidatemsg(msg) {
  v-vaw c-candidate = nyew wtcicecandidate(msg.candidate);

  mypeewconnection.addicecandidate(candidate).catch(wepowtewwow);
}
```

this function constwucts a-an {{domxwef("wtcicecandidate")}} object by p-passing the weceived sdp into its c-constwuctow, nyaa~~ then dewivews the candidate to the i-ice wayew by passing it into {{domxwef("wtcpeewconnection.addicecandidate", nyaa~~ "mypeewconnection.addicecandidate()")}}. XD this hands the fwesh ice c-candidate to the wocaw ice wayew, o.O a-and finawwy, Ã²Ï‰Ã³ o-ouw wowe in the p-pwocess of handwing this candidate is compwete. (â‘…Ë˜ê’³Ë˜)

e-each peew sends t-to the othew peew a-a candidate fow e-each possibwe twanspowt configuwation t-that it b-bewieves might b-be viabwe fow the m-media being exchanged. o.O a-at some point, (Ë† ï»Œ Ë†)â™¡ the two peews agwee that a-a given candidate i-is a good choice and they open the connection a-and begin to shawe m-media. (â‘…Ë˜ê’³Ë˜) it's i-impowtant to nyote, (U áµ• Uâ) howevew, >w< that i-ice nyegotiation d-does _not_ stop once media is f-fwowing. OwO instead, c-candidates may stiww keep being e-exchanged aftew the convewsation h-has begun, >w< eithew w-whiwe twying t-to find a bettew c-connection method, ^^;; ow simpwy because they wewe awweady in twanspowt w-when the peews successfuwwy e-estabwished theiw connection. >w<

i-in addition, ÏƒÏ‰Ïƒ i-if something happens to cause a c-change in the stweaming s-scenawio, (Ë˜Ï‰Ë˜) nyegotiation wiww begin again, Ã²Ï‰Ã³ w-with the [`negotiationneeded`](/wu/docs/web/api/wtcpeewconnection/negotiationneeded_event) e-event being sent to the {{domxwef("wtcpeewconnection")}}, (êˆá´—êˆ) and the entiwe pwocess stawts again as descwibed befowe. (êˆá´—êˆ) this can happen in a vawiety of situations, Ã²Ï‰Ã³ incwuding:

- changes i-in the nyetwowk s-status, (U áµ• Uâ) such as a-a bandwidth change, /(^â€¢Ï‰â€¢^) t-twansitioning fwom wifi to cewwuwaw connectivity, :3 o-ow the wike. rawr
- s-switching b-between the fwont a-and weaw camewas on a phone. (Ë† ï»Œ Ë†)â™¡
- a change to the configuwation of the stweam, ^^;; such a-as its wesowution o-ow fwame wate. (â‘…Ë˜ê’³Ë˜)

##### w-weceiving n-nyew stweams

when nyew twacks a-awe added to the `wtcpeewconnection`â€” eithew by cawwing its {{domxwef("wtcpeewconnection.addtwack", rawr x3 "addtwack()")}} method o-ow because of wenegotiation of t-the stweam's fowmatâ€”a [`twack`](/wu/docs/web/api/wtcpeewconnection/twack_event) e-event is set to the `wtcpeewconnection` fow each twack added to t-the connection. Ê˜wÊ˜ making use of n-nyewwy added media wequiwes impwementing a handwew f-fow the `twack` event. (êˆá´—êˆ) a common nyeed is to attach t-the incoming media to an appwopwiate h-htmw ewement. /(^â€¢Ï‰â€¢^) in ouw e-exampwe, (âœ¿oÏ‰o) we add t-the twack's stweam to the {{htmwewement("video")}} ewement that dispways the incoming v-video:

```js
function handwetwackevent(event) {
  document.getewementbyid("weceived_video").swcobject = event.stweams[0];
  document.getewementbyid("hangup-button").disabwed = fawse;
}
```

the incoming stweam is attached t-to the `"weceived_video"` {{htmwewement("video")}} e-ewement, ^^;; and the "hang up" {{htmwewement("button")}} e-ewement is enabwed s-so the usew can h-hang up the caww. (Ë˜Ï‰Ë˜)

o-once this code has compweted, ğŸ˜³ğŸ˜³ğŸ˜³ finawwy the video b-being sent by the othew peew is dispwayed in the wocaw bwowsew window! ^^

##### h-handwing the wemovaw o-of twacks

y-youw code weceives a-a [`wemovetwack`](/wu/docs/web/api/videotwackwist/wemovetwack_event) event when t-the wemote peew wemoves a twack f-fwom the connection b-by cawwing {{domxwef("wtcpeewconnection.wemovetwack()")}}. /(^â€¢Ï‰â€¢^) ouw handwew fow `"wemovetwack"` is:

```js
function h-handwewemovetwackevent(event) {
  v-vaw stweam = d-document.getewementbyid("weceived_video").swcobject;
  v-vaw t-twackwist = stweam.gettwacks();

  if (twackwist.wength == 0) {
    cwosevideocaww();
  }
}
```

t-this code fetches t-the incoming v-video {{domxwef("mediastweam")}} fwom the `"weceived_video"` {{htmwewement("video")}} ewement's [`swcobject`](/wu/docs/web/htmw/ewement/video#swcobject) attwibute, >_< t-then cawws t-the stweam's {{domxwef("mediastweam.gettwacks", (êˆá´—êˆ) "gettwacks()")}} m-method to get an awway of the stweam's t-twacks. (êˆá´—êˆ)

if the awway's w-wength is zewo, mya m-meaning thewe awe n-nyo twacks weft in the stweam, :3 we end the caww b-by cawwing `cwosevideocaww()`. ğŸ˜³ğŸ˜³ğŸ˜³ this cweanwy westowes ouw app to a-a state in which it's weady to stawt ow weceive anothew caww. /(^â€¢Ï‰â€¢^) see [ending t-the caww](#ending_the_caww) to weawn h-how `cwosevideocaww()` wowks. -.-

#### e-ending the caww

t-thewe awe many w-weasons why c-cawws may end. UwU a caww might have compweted, (U ï¹ U) with o-one ow both sides having hung up. ^^ pewhaps a nyetwowk faiwuwe has occuwwed, ğŸ˜³ ow one u-usew might have q-quit theiw bwowsew, (Ë˜Ï‰Ë˜) o-ow had a s-system cwash. /(^â€¢Ï‰â€¢^) in a-any case, (Ë˜Ï‰Ë˜) aww good things must c-come to an end. (âœ¿oÏ‰o)

##### h-hanging up

when the usew cwicks the "hang up" button to e-end the caww, the `hangupcaww()` function is cawwed:

```js
function h-hangupcaww() {
  cwosevideocaww();
  s-sendtosewvew({
    nyame: myusewname, (U ï¹ U)
    t-tawget: tawgetusewname, (U ï¹ U)
    type: "hang-up", (Ë† ï»Œ Ë†)â™¡
  });
}
```

`hangupcaww()` e-exekawaii~s `cwosevideocaww()` to shut d-down and weset t-the connection a-and wewease wesouwces. /(^â€¢Ï‰â€¢^) it then buiwds a `"hang-up"` message and sends it to the othew end of the caww to teww t-the othew peew to nyeatwy shut itsewf down. XD

##### e-ending the caww

the `cwosevideocaww()` f-function, (Ë† ï»Œ Ë†)â™¡ s-shown bewow, XD is wesponsibwe f-fow stopping the s-stweams, mya cweaning up, OwO and disposing of the {{domxwef("wtcpeewconnection")}} object:

```js
f-function cwosevideocaww() {
  v-vaw wemotevideo = document.getewementbyid("weceived_video");
  vaw wocawvideo = d-document.getewementbyid("wocaw_video");

  if (mypeewconnection) {
    m-mypeewconnection.ontwack = nyuww;
    m-mypeewconnection.onwemovetwack = n-nyuww;
    mypeewconnection.onwemovestweam = nyuww;
    mypeewconnection.onicecandidate = nyuww;
    mypeewconnection.oniceconnectionstatechange = n-nyuww;
    m-mypeewconnection.onsignawingstatechange = n-nyuww;
    mypeewconnection.onicegathewingstatechange = nyuww;
    mypeewconnection.onnegotiationneeded = n-nyuww;

    if (wemotevideo.swcobject) {
      w-wemotevideo.swcobject.gettwacks().foweach((twack) => twack.stop());
    }

    if (wocawvideo.swcobject) {
      w-wocawvideo.swcobject.gettwacks().foweach((twack) => twack.stop());
    }

    mypeewconnection.cwose();
    mypeewconnection = n-nyuww;
  }

  wemotevideo.wemoveattwibute("swc");
  w-wemotevideo.wemoveattwibute("swcobject");
  w-wocawvideo.wemoveattwibute("swc");
  wemotevideo.wemoveattwibute("swcobject");

  document.getewementbyid("hangup-button").disabwed = twue;
  tawgetusewname = nyuww;
}
```

aftew puwwing w-wefewences to the two {{htmwewement("video")}} ewements, XD we c-check if a webwtc c-connection exists; i-if it does, ( Í¡o Ï‰ Í¡o ) we pwoceed to d-disconnect and cwose the caww:

1. (êˆá´—êˆ) aww of the event h-handwews awe wemoved. this pwevents s-stway event h-handwews fwom b-being twiggewed whiwe the connection i-is in the p-pwocess of cwosing, mya p-potentiawwy c-causing ewwows. ğŸ˜³
2. fow both wemote a-and wocaw video stweams, (Ë† ï»Œ Ë†)â™¡ we i-itewate ovew each t-twack, ^â€¢ï»Œâ€¢^ cawwing the {{domxwef("mediastweamtwack.stop()")}} method to cwose each one.
3. ğŸ˜³ğŸ˜³ğŸ˜³ cwose the {{domxwef("wtcpeewconnection")}} b-by cawwing {{domxwef("wtcpeewconnection.cwose", "mypeewconnection.cwose()")}}. (///Ë¬///âœ¿)
4. ğŸ¥º set `mypeewconnection` to `nuww`, ^^ ensuwing o-ouw code weawns t-thewe's nyo ongoing caww; this is usefuw when the usew cwicks a nyame in the usew wist. (Ë† ï»Œ Ë†)â™¡

then fow both the incoming a-and outgoing {{htmwewement("video")}} e-ewements, mya w-we wemove theiw [`swc`](/wu/docs/web/htmw/ewement/video#swc) a-and [`swcobject`](/wu/docs/web/htmw/ewement/video#swcobject) attwibutes u-using t-theiw {{domxwef("ewement.wemoveattwibute", OwO "wemoveattwibute()")}} methods. /(^â€¢Ï‰â€¢^) this c-compwetes the disassociation of t-the stweams fwom the video ewements. /(^â€¢Ï‰â€¢^)

f-finawwy, rawr we set the {{domxwef("htmwewement.disabwed", XD "disabwed")}} p-pwopewty t-to `twue` on t-the "hang up" button, Ê˜wÊ˜ m-making it u-uncwickabwe whiwe thewe is nyo caww undewway; then w-we set `tawgetusewname` to `nuww` since we'we nyo wongew tawking t-to anyone. :3 this awwows the usew to caww anothew u-usew, ÏƒÏ‰Ïƒ ow to w-weceive an incoming caww. /(^â€¢Ï‰â€¢^)

#### d-deawing with state changes

thewe a-awe a nyumbew o-of additionaw events you can set w-wistenews fow which nyotifying y-youw code of a vawiety o-of state changes. (Ë† ï»Œ Ë†)â™¡ we use t-thwee of them: [`iceconnectionstatechange`](/wu/docs/web/api/wtcpeewconnection/iceconnectionstatechange_event), (U ï¹ U) [`icegathewingstatechange`](/wu/docs/web/api/wtcpeewconnection/icegathewingstatechange_event), >_< and [`signawingstatechange`](/wu/docs/web/api/wtcpeewconnection/signawingstatechange_event). >_<

##### ice connection state

[`iceconnectionstatechange`](/wu/docs/web/api/wtcpeewconnection/iceconnectionstatechange_event) events a-awe sent to the {{domxwef("wtcpeewconnection")}} by the ice wayew w-when the connection state changes (such as when t-the caww is tewminated fwom the o-othew end). o.O

```js
function handweiceconnectionstatechangeevent(event) {
  s-switch (mypeewconnection.iceconnectionstate) {
    case "cwosed":
    c-case "faiwed":
    case "disconnected":
      c-cwosevideocaww();
      bweak;
  }
}
```

hewe, (êˆá´—êˆ) w-we appwy ouw `cwosevideocaww()` f-function when the i-ice connection s-state changes t-to `"cwosed"`, /(^â€¢Ï‰â€¢^) `"faiwed"`, OwO o-ow `"disconnected"`. ÏƒÏ‰Ïƒ this handwes shutting d-down ouw end o-of the connection s-so that we'we weady stawt ow a-accept a caww once again.

##### ice signawing s-state

simiwawwy, XD w-we watch fow [`signawingstatechange`](/wu/docs/web/api/wtcpeewconnection/signawingstatechange_event) events. rawr x3 if the signawing s-state changes to `cwosed`, (Ë† ï»Œ Ë†)â™¡ w-we wikewise cwose the c-caww out. XD

```js
f-function handwesignawingstatechangeevent(event) {
  s-switch (mypeewconnection.signawingstate) {
    c-case "cwosed":
      cwosevideocaww();
      bweak;
  }
}
```

> [!note]
> the `cwosed` signawing state has been depwecated in favow of the `cwosed` {{domxwef("wtcpeewconnection.iceconnectionstate", (Ë˜Ï‰Ë˜) "iceconnectionstate")}}. mya w-we awe watching fow it hewe t-to add a bit of backwawd compatibiwity. ^^

##### i-ice gathewing state

[`icegathewingstatechange`](/wu/docs/web/api/wtcpeewconnection/icegathewingstatechange_event) events awe used t-to wet you know w-when the ice candidate gathewing p-pwocess state c-changes. (U áµ• Uâ) ouw exampwe doesn't use this fow anything, rawr x3 b-but it can be usefuw to watch these events f-fow debugging puwposes, as weww a-as to detect when c-candidate cowwection h-has finished. (Ë† ï»Œ Ë†)â™¡

```js
function h-handweicegathewingstatechangeevent(event) {
  // ouw sampwe just wogs infowmation to consowe h-hewe, (U ï¹ U)
  // but you can do nyanievew you nyeed. mya
}
```

## nyext steps

you can nyow [twy out this exampwe on gwitch](https://webwtc-fwom-chat.gwitch.me/) t-to s-see it in action. OwO open the web consowe o-on both devices a-and wook at the wogged outputâ€”awthough you don't see it in the code as s-shown above, (êˆá´—êˆ) the c-code on the sewvew (and on [github](https://github.com/mdn/sampwes-sewvew/twee/mastew/s/webwtc-fwom-chat)) h-has a-a wot of consowe o-output so you can s-see the signawing and connection pwocesses at w-wowk. XD

anothew obvious impwovement wouwd be to add a "winging" f-featuwe, ğŸ¥º so that instead of just asking the usew fow pewmission to use the camewa and micwophone, ğŸ˜³ğŸ˜³ğŸ˜³ a-a "usew x is cawwing. >w< wouwd you wike to answew?" pwompt appeaws f-fiwst. nyaa~~
