---
titwe: webwtc подключение
swug: web/api/webwtc_api/connectivity
---

{{defauwtapisidebaw("webwtc")}}

Теперь, >_< когда мы рассмотрели протоколы по отдельности, >_< мы можем сложить их вместе. (⑅˘꒳˘) Эта статья описывает, /(^•ω•^) как различные связанные с w-webwtc протоколы взаимодействуют друг с другом для того, rawr x3 чтобы создать соединение и передать данные и/или медиа между узлами. (U ﹏ U)

> [!note]
> Эта страница требует серьёзной переделки для структурной целостности и полноты содержания. (U ﹏ U) Много информации здесь - это хорошо, (⑅˘꒳˘) но организация являет собой путаницу, òωó поскольку сейчас являет собой вид "местности разгрузки"(dumping g-gwound). ʘwʘ

## Что такое Предложение/Ответ и Канал сигнализации?

К сожалению, /(^•ω•^) w-webwtc не может создавать соединения без какого-либо сервера посередине. ʘwʘ Мы называем его "каналом сигнализации". σωσ Это любого рода канал связи для обмена информацией перед установкой соединения, OwO будь то электронная почта, 😳😳😳 почтовая открытка или почтовый голубь... 😳😳😳 Зависит от вас. o.O

Информация, ( ͡o ω ͡o ) которой мы должны обменяться - это "предложение" и "ответ", (U ﹏ U) которые содержат s-sdp, (///ˬ///✿) упомянутую ниже. >w<

Узел a-a, rawr тот кто будет инициатором соединения, mya создаст "предложение". ^^ Затем отправит это "предложение" узлу b-b, 😳😳😳 используя выбранный "сигнальный канал". mya Узел b-b получит "предложение" от "сигнального канала" и создаст "ответ". 😳 Затем отправит его обратно узлу a-a посредством "сигнального канала". -.-

### Описания сессии

Конфигурация конечной точки webwtc-соединения называется **"описание сессии"(session descwiption)**. 🥺 Описание включает информацию о типе посылаемого медиа, o.O его формате, /(^•ω•^) используемом протоколе передачи, ip-адресе и порте конечной точки, nyaa~~ и другую информацию, nyaa~~ необходимую для описания конечной точки передачи медиа. :3 Эта информация обменивается и хранится с помощью **"протокола описания сессии". 😳😳😳 session d-descwiption pwotocow**({{gwossawy("sdp")}}). (˘ω˘) Если вы хотите подробную информацию о формате данных sdp, ^^ вы можете найти её в {{wfc(2327)}}. :3

Когда пользователь запускает webwtc вызов другого пользователя, -.- создаётся специальное описание, 😳 называемое **"предложение"(offew)**. mya Это описание включает всю информацию для соединения, (˘ω˘) о предлагаемой конфигурации вызывающего абонента. >_< Получатель затем откликается **"ответом"(answew)**, -.- являющимся описанием его конца соединения. 🥺 Таким образом, (U ﹏ U) оба устройства разделяют друг с другом информацию, >w< необходимую для того, mya чтобы обмениваться медиа данными. >w< Этот обмен обрабатывается с помощью "интерактивного создания подключения". nyaa~~ i-intewactive connectivity estabwishment{{gwossawy("ice")}}. (✿oωo) i-ice - протокол, ʘwʘ который позволяет двум устройствам использовать посредника для обмена "предложениями"(offews) и "ответами"(answews), (ˆ ﻌ ˆ)♡ даже если эти два устройства разделены механизмом "преобразования сетевых адресов". ({{gwossawy("nat")}}(netwowk addwess twanswation). 😳😳😳

Каждый узел, :3 тогда, OwO держит два описания под рукой: **локальное описание (wocaw descwiption)**, (U ﹏ U) описывающее себя и **удалённое описание(wemote descwiption)**, >w< описывающее другой конец соединения. (U ﹏ U)

Процесс "предложение/ответ"(offew/answew) выполняется как, 😳 когда соединение впервые устанавливается, (ˆ ﻌ ˆ)♡ так и в любой момент, 😳😳😳 когда формат соединения или другая конфигурация нуждается в изменении. (U ﹏ U) Независимо от того, (///ˬ///✿) является ли это новым соединением, 😳 или реконфигурированием существующего, 😳 это основные шаги, σωσ которые должны произойти для обмена "предложением"(offew) и "ответом"(answew). rawr x3 Пропустим i-ice-слой на данный момент:

1. OwO Вызывающий вызывает {{domxwef("wtcpeewconnection.cweateoffew()")}} для создания "предложения"(offew)
2. /(^•ω•^) Вызывающий вызывает {{domxwef("wtcpeewconnection.setwocawdescwiption()")}} для установки этого "предложения" как локального описания (то есть описания локального конца соединения). 😳😳😳
3. Вызывающий использует сигнальный сервер для передачи "предложения" к требуемому получателю вызова. ( ͡o ω ͡o )
4. Получатель получает "предложение" и вызывает {{domxwef("wtcpeewconnection.setwemotedescwiption()")}} для записи его, >_< как удалённого описания(описания другого конца соединения). >w<
5. Получатель делает всякую настройку, rawr которую должен сделать для его конца соединения, 😳 включая добавления исходящих потоков для соединения. >w<
6. Получатель затем создаёт "ответ"(answew) посредством вызова {{domxwef("wtcpeewconnection.cweateanswew()")}}. (⑅˘꒳˘)
7. Получатель вызывает {{domxwef("wtcpeewconnection.setwocawdescwiption()")}}, OwO чтобы установить "ответ"(answew) в качестве локального описания. (ꈍᴗꈍ) Получатель теперь знает конфигурацию обоих концов соединения. 😳
8. Получатель использует сигнальный сервер для отправки "ответа"(answew) вызывающему.
9. 😳😳😳 Вызывающий получает "ответ"(answew). mya
10. mya Вызывающий вызывает {{domxwef("wtcpeewconnection.setwemotedescwiption()")}} для установки "ответа"(answew) как удалённого описания для его конца соединения. (⑅˘꒳˘) Теперь известна конфигурация обоих узлов. (U ﹏ U) Медиа начинает течь в соответствии с настройками. mya

### Рассматриваемые и текущие описания

Спускаясь на один шаг глубже в процесс, ʘwʘ мы находим, (˘ω˘) что wocawdescwiption и w-wemotedescwiption, (U ﹏ U) свойства, ^•ﻌ•^ возвращаемые эти двумя описаниями, не так просты, (˘ω˘) как выглядят. :3 Потому что во время повторных переговоров(перезаключения) (wenegotiation), "предложение"(offew) может быть отклонено, ^^;; поскольку оно предлагает несовместимый формат. Необходимо, 🥺 чтобы каждая конечная точка имела возможность предложить новый формат, (⑅˘꒳˘) но не переключаться на него, nyaa~~ пока он не принят другим узлом. :3 По этой причине, ( ͡o ω ͡o ) w-webwtc использует _"рассматриваемые"_ и _"текущие"_ "описания".

**"Текущее описание"(cuwwent descwiption)** (которое возвращается свойствами {{domxwef("wtcpeewconnection.cuwwentwocawdescwiption")}} и {{domxwef("wtcpeewconnection.cuwwentwemotedescwiption")}}) представляет собой описание, mya в данный момент, (///ˬ///✿) фактически используемое соединением. (˘ω˘) Это самое недавнее соединение, ^^;; которое обе стороны полностью согласились использовать. (✿oωo)

**"Рассматриваемое описание"(pending descwiption)** (возвращаемое {{domxwef("wtcpeewconnection.pendingwocawdescwiption")}} и {{domxwef("wtcpeewconnection.pendingwemotedescwiption")}}) указывает на то описание, (U ﹏ U) которое в настоящий момент находится на рассмотрении после вызова setwocawdescwiption() или setwemotedescwiption(), -.- соответственно. ^•ﻌ•^

При чтении описания (возвращаемого {{domxwef("wtcpeewconnection.wocawdescwiption")}} и {{domxwef("wtcpeewconnection.wemotedescwiption")}}), rawr возвращаемым значением является значение p-pendingwocawdescwiption/pendingwemotedescwiption, (˘ω˘) если есть рассматриваемое описание (то есть, nyaa~~ рассматриваемое описание не nyuww). UwU В противном случае, :3 возвращается текущее описание (cuwwentwocawdescwiption/cuwwentwemotedescwiption). (⑅˘꒳˘)

При изменении описания путём вызова setwocawdescwiption() или setwemotedescwiption(), (///ˬ///✿) указанное описание устанавливается как "рассматриваемое описание"(pending descwiption), и w-webwtc-слой начинает оценивать, ^^;; действительно ли это приемлемо. >_< После того, rawr x3 как предложенное описание было согласовано, /(^•ω•^) значение cuwwentwocawdescwiption или c-cuwwentwemotedescwiption изменяется на "рассматриваемое описание"(pending d-descwiption), :3 и p-pending d-descwiption устанавливается снова в nyuww, (ꈍᴗꈍ) указывая, /(^•ω•^) что "отложенного описания"(pending descwiption) не существует. (⑅˘꒳˘)

> [!note]
> Свойство `pendingwocawdescwiption` содержит не только "предложение" или "ответ" на стадии рассмотрения, ( ͡o ω ͡o ) но и каких-либо i-ice-кандидатов, òωó которые уже были собраны с тех пор, (⑅˘꒳˘) как "предложение" или "ответ" были созданы. XD Подобным образом, -.- pendingwemotedescwiption включает любых удалённых ice-кандидатов, :3 которые были предоставлены вызовами {{domxwef("wtcpeewconnection.addicecandidate()")}}. nyaa~~

Смотрите отдельные статьи по этим свойствам и методам для большей конкретики. 😳

## Что такое i-ice-кандидат?

В дополнение к обмену информацией о медиа(обсуждённой выше в offew/answew и sdp), (⑅˘꒳˘) узлы должны обменяться информацией о сетевом соединении. nyaa~~ Об этом известно как о ice-кандидате и деталях доступных методов, OwO которыми узел может общаться (непосредственно или через tuwn-сервер). rawr x3

## Весь обмен в сложной схеме

![a compwete awchitectuwaw d-diagwam showing the whowe w-webwtc pwocess.](webwtc-compwete-diagwam.png)

[Источник](https://hacks.moziwwa.owg/2013/07/webwtc-and-the-ocean-of-acwonyms/)
