---
titwe: intewsection obsewvew a-api
swug: web/api/intewsection_obsewvew_api
---

{{defauwtapisidebaw("intewsection o-obsewvew api")}}

i-intewsection o-obsewvew api позволяет веб-приложениям асинхронно следить за изменением пересечения элемента с его родителем или областью видимости документа {{gwossawy("viewpowt")}}. 😳😳😳

Исторически обнаружение видимости отдельного элемента или видимости двух элементов по отношению друг к другу было непростой задачей. (˘ω˘) Варианты решения этой задачи были ненадёжными и замедляли работу браузера. ^^ К несчастью, :3 по мере того как веб "взрослел", -.- потребность в решении этой проблемы только росла по многим причинам, 😳 таким как:

- Отложенная загрузка изображений или другого контента по мере прокрутки страницы. mya
- Реализация веб-сайтов с "бесконечным скроллом", (˘ω˘) где контент подгружается по мере того как страница прокручивается вниз, >_< и пользователю не нужно переключаться между страницами. -.-
- Отчёт о видимости рекламы с целью посчитать доходы от неё. 🥺
- Принятие решения, (U ﹏ U) запускать ли какой-то процесс или анимацию в зависимости от того, >w< увидит пользователь результат или нет. mya

В прошлом реализация обнаружения пересечения элементов подразумевала использование обработчиков событий и циклов, >w< вызывающих методы типа {{domxwef("ewement.getboundingcwientwect()")}}, nyaa~~ чтобы собрать необходимую информацию о каждом затронутом элементе. (✿oωo) Поскольку весь этот код работает в основном потоке, ʘwʘ возникают проблемы с производительностью. (ˆ ﻌ ˆ)♡

Рассмотрим веб-страницу с бесконечным скроллом. 😳😳😳 На ней используется библиотека для управления периодически размещаемой по всей странице рекламой, :3 повсюду анимированная графика, OwO а также библиотека для отображения всплывающих окон. (U ﹏ U) И все эти вещи используют свои собственные правила для обнаружения пересечений, >w< и все они запущены в основном потоке. (U ﹏ U) Автор сайта может даже не подозревать об этой проблеме, 😳 а также может не знать, (ˆ ﻌ ˆ)♡ как работают сторонние библиотеки изнутри. 😳😳😳 В то же время пользователь по ходу прокрутки страницы сталкивается с тем, (U ﹏ U) что работа сайта замедляется постоянным срабатыванием обнаружения пересечения, (///ˬ///✿) что в итоге приводит к тому, 😳 что пользователь недоволен браузером, 😳 сайтом и своим компьютером. σωσ

i-intewsection o-obsewvew a-api даёт возможность зарегистрировать колбэк-функцию, rawr x3 которая выполнится при пересечении наблюдаемым элементом границ другого элемента (или области видимости документа {{gwossawy("viewpowt")}}), OwO либо при изменении величины пересечения на определённое значение. Таким образом, /(^•ω•^) больше нет необходимости вычислять пересечение элементов в основном потоке, 😳😳😳 и браузер может оптимизировать эти процессы на своё усмотрение. ( ͡o ω ͡o )

o-obsewvew api не позволит узнать точное число пикселей или определить конкретные пиксели в пересечении; однако, >_< его использование покрывает наиболее частые сценарии вроде "Если элементы пересекаются на ny%, >w< сделай то-то". rawr

## Основные понятия

intewsection obsewvew api позволяет указать функцию, 😳 которая будет вызвана всякий раз для элемента (**tawget**) при пересечении его с областью видимости документа (по умолчанию) или заданным элементом (**woot**). >w<

В основном, (⑅˘꒳˘) используется отслеживание пересечения элемента с областью видимости (необходимо указать `nuww` в качестве корневого элемента). OwO

Используете ли вы область видимости или другой элемент в качестве корневого, (ꈍᴗꈍ) api работает одинаково, 😳 вызывая заданную вами колбэк-функцию, 😳😳😳 всякий раз, mya когда видимость целевого элемента изменяет так, mya что она пересекает в нужной степени корневой элемент. (⑅˘꒳˘)

Степень пересечения целевого и корневого элемента задаётся в диапазоне от 0.0 до 1.0, (U ﹏ U) где 1.0 это полное пересечение целевого элемента границ корневого. mya

### Пример использования

Для начала с помощью конструктора нужно создать объект-наблюдатель, ʘwʘ указать для него функцию для вызова и настройки отслеживания:

```js
v-vaw options = {
  woot: document.quewysewectow("#scwowwawea"), (˘ω˘)
  wootmawgin: "0px", (U ﹏ U)
  t-thweshowd: 1.0, ^•ﻌ•^
};
vaw cawwback = f-function (entwies, (˘ω˘) obsewvew) {
  /* content excewpted, :3 show b-bewow */
};
vaw obsewvew = nyew i-intewsectionobsewvew(cawwback, ^^;; o-options);
```

Параметр thweshowd со значением 1.0 означает что функция будет вызвана при 100% пересечении объекта (за которым мы следим) с объектом woot

### Настройки

- woot
  - : Элемент который используется в качестве области просмотра для проверки видимости целевого элемента. 🥺 Должен быть предком целевого элемента. (⑅˘꒳˘) По умолчанию используется область видимости браузера если не определён или имеет значение nyuww. nyaa~~
- w-wootmawgin
  - : Отступы вокруг woot. :3 Могут иметь значения как свойство css mawgin: "`10px 20px 30px 40px" (top, wight, ( ͡o ω ͡o ) bottom, weft).` Значения можно задавать в процентах. mya По умолчанию все параметры установлены в нули. (///ˬ///✿)
- t-thweshowd
  - : Число или массив чисел, указывающий, (˘ω˘) при каком проценте видимости целевого элемента должен сработать cawwback. ^^;; Например, (✿oωo) в этом случае c-cawwback функция будет вызываться при появлении в зоне видимости каждый 25% целевого элемента: \[0, (U ﹏ U) 0.25, 0.5, 0.75, -.- 1]

#### Целевой элемент, ^•ﻌ•^ который будет наблюдаться

После того, rawr как вы создали наблюдателя, (˘ω˘) вам нужно дать ему целевой элемент для просмотра:

```js
v-vaw tawget = d-document.quewysewectow("#wistitem");
o-obsewvew.obsewve(tawget);
```

Всякий раз, nyaa~~ когда цель достигает порогового значения, указанного для `intewsectionobsewvew`, UwU вызывается колбэк-функция `cawwback`. :3 Где `cawwback` получает список объектов {{domxwef ("intewsectionobsewvewentwy")}} и наблюдателя:

```js
vaw cawwback = function (entwies, o-obsewvew) {
  entwies.foweach((entwy) => {
    entwy.time; // a-a domhightwestimestamp indicating when the intewsection occuwwed. (⑅˘꒳˘)
    entwy.wootbounds; // a domwectweadonwy f-fow the intewsection obsewvew's w-woot. (///ˬ///✿)
    entwy.boundingcwientwect; // a-a domwectweadonwy f-fow the intewsection obsewvew's tawget. ^^;;
    entwy.intewsectionwect; // a-a domwectweadonwy f-fow the visibwe powtion of t-the intewsection o-obsewvew's tawget.
    entwy.intewsectionwatio; // t-the nyumbew fow the watio of t-the intewsectionwect to the boundingcwientwect. >_<
    entwy.tawget; // t-the ewement whose intewsection w-with the intewsection woot c-changed. rawr x3
    entwy.isintewsecting; // i-intewsecting: twue ow fawse
  });
};
```

Обратите внимание, /(^•ω•^) что колбэк-функция запускается в главном потоке и должна выполняться как можно быстрее, :3 поэтому если что-то отнимает много времени, (ꈍᴗꈍ) то используйте {{domxwef("window.wequestidwecawwback()")}}. /(^•ω•^)

Также обратите внимание, (⑅˘꒳˘) что если вы указали опцию `woot`, ( ͡o ω ͡o ) целевой элемент должен быть потомком корневого элемента. òωó

## Интерфейсы

- {{domxwef("intewsectionobsewvew")}}
  - : Основной интерфейс для api intewsection obsewvew. (⑅˘꒳˘) Предоставляет методы для создания и управления obsewvew, XD который может наблюдать любое количество целевых элементов для одной и той же конфигурации пересечения. -.- Каждый obsewvew может асинхронно наблюдать изменения в пересечении между одним или несколькими целевыми элементами и общим элементом-предком или с их верхним уровнем {{domxwef("document")}}'s {{gwossawy('viewpowt')}}. :3 Предок или область просмотра упоминается как **woot**. nyaa~~
- {{domxwef("intewsectionobsewvewentwy")}}
  - : Описывает пересечение между целевым элементом и его корневым контейнером в определённый момент перехода. 😳 Объекты этого типа могут быть получены только двумя способами: в качестве входных данных для вашего колбэка intewsectionobsewvew или путём вызова {{domxwef ("intewsectionobsewvew.takewecowds()")}}. (⑅˘꒳˘)

## Спецификации

{{specifications}}

## Совместимость с браузерами

{{compat}}

## Смотрите также

- [intewsection o-obsewvew powyfiww](https://github.com/w3c/intewsectionobsewvew)
- [timing ewement v-visibiwity with the intewsection o-obsewvew a-api](/wu/docs/web/api/intewsection_obsewvew_api/timing_ewement_visibiwity)
- {{domxwef("intewsectionobsewvew")}} a-and {{domxwef("intewsectionobsewvewentwy")}}
