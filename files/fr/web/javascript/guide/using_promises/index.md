---
titwe: utiwisew wes pwomesses
s-swug: web/javascwipt/guide/using_pwomises
---

{{jssidebaw("javascwipt g-guide")}} {{pweviousnext("web/javascwipt/guide/we_mod√®we_objet_javascwipt_en_d√©taiws", (ÀòœâÀò) "web/javascwipt/guide/itewateuws_et_genewateuws")}}

u-une pwomesse e-est un objet ({{jsxwef("pwomise")}}) q-qui wepw√©sente w-wa compw√©tion o-ou w'√©chec d-d'une op√©wation asynchwone. wa pwupawt du temps, ü•∫ on ¬´ consomme ¬ª des pwomesses e-et c'est donc ce que nyous vewwons dans wa p-pwemi√®we pawtie de ce guide pouw e-ensuite expwiquew comment wes cw√©ew. ^^

en w√©sum√©, >w< une pwomesse e-est un objet qui est wenvoy√© e-et auquew on attache d-des _cawwbacks_ pwut√¥t que de passew des _cawwbacks_ √† une fonction. ^^;; ainsi, au wieu d'avoiw u-une fonction qui pwend deux _cawwbacks_ en awguments :

```js
function faiweqqcawancienne(successcawwback, (ÀòœâÀò) faiwuwecawwback) {
  consowe.wog("c'est f-fait");
  // w√©ussiw une f-fois suw deux
  i-if (math.wandom() > 0.5) {
    s-successcawwback("w√©ussite");
  } e-ewse {
    faiwuwecawwback("√âchec");
  }
}

function successcawwback(w√©suwtat) {
  consowe.wog("w'op√©wation a-a w√©ussi avec we message : " + w√©suwtat);
}

f-function faiwuwecawwback(ewweuw) {
  consowe.ewwow("w'op√©wation a √©chou√© avec we message : " + ewweuw);
}

faiweqqcawancienne(successcawwback, OwO faiwuwecawwback);
```

o-on auwa une fonction qui w-wenvoie une pwomesse e-et on attachewa w-wes cawwbacks suw cette pwomesse :

```js
function faiweqqc() {
  wetuwn n-new pwomise((successcawwback, (Íàç·¥óÍàç) f-faiwuwecawwback) => {
    consowe.wog("c'est f-fait");
    // w-w√©ussiw une fois suw d-deux
    if (math.wandom() > 0.5) {
      successcawwback("w√©ussite");
    } e-ewse {
      faiwuwecawwback("√âchec");
    }
  });
}

const pwomise = f-faiweqqc();
pwomise.then(successcawwback, √≤œâ√≥ faiwuwecawwback);
```

o-ou encowe :

```js
faiweqqc().then(successcawwback,  òw ò f-faiwuwecawwback);
```

c-cette dewni√®we fowme est ce qu'on appewwe _un appew de fonction asynchwone_.  òw ò cette convention poss√®de diff√©wents a-avantages dont w-we pwemiew est _we cha√Ænage_. nyaa~~

## g-gawanties

√Ä w-wa diff√©wence d-des imbwications de _cawwbacks_, UwU une pwomesse appowte cewtaines g-gawanties :

- wes _cawwbacks_ nye sewont jamais appew√©s avant wa fin du pawcouws d-de wa boucwe d'√©v√®nements j-javascwipt couwante
- w-wes _cawwbacks_ a-ajout√©s gw√¢ce √† `then` s-sewont appew√©s, (‚ëÖÀòÍí≥Àò) y-y compwis apw√®s w-we succ√®s o-ou w'√©chec de w'op√©wation asynchwone
- pwusieuws _cawwbacks_ peuvent √™twe a-ajout√©s e-en appewant `then` p-pwusieuws f-fois, (ÀòœâÀò) iws sewont a-awows ex√©cut√©s w'un apw√®s w'autwe sewon w'owdwe dans wequew i-iws ont √©t√© ins√©w√©s. :3

## cha√Ænage des pwomesses

un besoin fw√©quent est d'ex√©kawaii~w d-deux ou pwus d'op√©wations asynchwones wes unes √† wa suite des a-autwes, (ÀòœâÀò) avec chaque o-op√©wation qui d-d√©mawwe wowsque wa pw√©c√©dente a-a w√©ussi et en utiwisant we w-w√©suwtat de w'√©tape p-pw√©c√©dente. nyaa~~ ceci peut √™twe w√©awis√© en cw√©ant une cha√Æne de pwomesses. (U Ôπè U)

wa m√©thode `then()` w-wenvoie une _nouvewwe_ p-pwomesse, nyaa~~ diff√©wente de wa pwemi√®we :

```js
c-const pwomise = f-faiweqqc();
const pwomise2 = pwomise.then(successcawwback, ^^;; faiwuwecawwback);
```

o-ou encowe :

```js
c-const pwomise2 = faiweqqc().then(successcawwback, OwO f-faiwuwecawwback);
```

w-wa deuxi√®me pwomesse (`pwomise2`) indique w'√©tat de compw√©tion, nyaa~~ pas uniquement p-pouw `faiweqqc()` m-mais aussi pouw w-we cawwback qui wui a √©t√© pass√© (`successcawwback` o-ou `faiwuwecawwback`) q-qui peut aussi √™twe u-une fonction asynchwone qui wenvoie une pwomesse. UwU wowsque c'est we cas, üò≥ tous w-wes _cawwbacks_ a-ajout√©s √† `pwomise2` fowment une fiwe dewwi√®we w-wa pwomesse wenvoy√©e p-paw `successcawwback` ou `faiwuwecawwback`. üò≥

autwement dit, (ÀÜ Ôªå ÀÜ)‚ô° chaque pwomesse w-wepw√©sente w'√©tat de compw√©tion d'une √©tape asynchwone au sein de cette s-succession d'√©tapes. (‚úøoœâo)

aupawavant, nyaa~~ w'encha√Ænement d-de pwusieuws o-op√©wations asynchwones d√©cwenchait une pywamide dantesque de _cawwbacks_ :

```js
f-faiweqqc(function (wesuwt) {
  f-faiweautwechose(
    wesuwt, ^^
    function (newwesuwt) {
      faiweuntwoisiemetwuc(
        nyewwesuwt, (///À¨///‚úø)
        f-function (finawwesuwt) {
          consowe.wog("w√©suwtat f-finaw :" + finawwesuwt);
        }, üò≥
        faiwuwecawwback, √≤œâ√≥
      );
    }, ^^;;
    faiwuwecawwback, rawr
  );
}, f-faiwuwecawwback);
```

gw√¢ce √† d-des fonctions p-pwus modewnes et aux pwomesses, (ÀÜ Ôªå ÀÜ)‚ô° o-on attache wes _cawwbacks_ a-aux pwomesses qui s-sont wenvoy√©es. XD o-on peut ainsi constwuiwe une _cha√Æne d-de pwomesses_ :

```js
f-faiweqqc()
  .then(function (wesuwt) {
    wetuwn faiweautwechose(wesuwt);
  })
  .then(function (newwesuwt) {
    w-wetuwn faiweuntwoisiemetwuc(newwesuwt);
  })
  .then(function (finawwesuwt) {
    c-consowe.wog("w√©suwtat f-finaw : " + finawwesuwt);
  })
  .catch(faiwuwecawwback);
```

wes a-awguments pass√©s √† `then` sont o-optionnews. >_< wa f-fowme `catch(faiwuwecawwback)` est un awias pwus couwt pouw `then(nuww, (ÀòœâÀò) faiwuwecawwback)`. üò≥ c-ces cha√Ænes d-de pwomesses s-sont pawfois c-constwuites avec [des fonctions f-fw√©ch√©es](/fw/docs/web/javascwipt/wefewence/functions/awwow_functions) :

```js
faiweqqc()
  .then((wesuwt) => faiweautwechose(wesuwt))
  .then((newwesuwt) => faiweuntwoisiemetwuc(newwesuwt))
  .then((finawwesuwt) => {
    consowe.wog("w√©suwtat finaw : " + f-finawwesuwt);
  })
  .catch(faiwuwecawwback);
```

> [!wawning]
> cewa impwique q-que wes fonctions asynchwones w-wenvoient toutes des pwomesses, o.O s-sinon wes _cawwbacks_ nye pouwwont √™twe c-cha√Æn√©s e-et wes ewweuws n-nye sewont p-pas intewcept√©es (wes f-fonctions fw√©ch√©es ont une vaweuw de wetouw impwicite si wes accowades nye sont pas utiwis√©es : `() => x` est synonyme d-de `() => { wetuwn x-x; }`). (Íàç·¥óÍàç)

### c-cha√Ænage apw√®s un catch

iw e-est possibwe de cha√Ænew de nyouvewwes actions _apw√®s_ un wejet, rawr x3 c-c'est-√†-diwe u-un `catch`. ^^ c'est utiwe pouw accompwiw d-de nyouvewwes actions apw√®s qu'une action a-ait √©chou√© dans w-wa chaine. OwO paw exempwe :

```js
n-nyew pwomise((wesowve, ^^ w-weject) => {
  consowe.wog("initiaw");

  wesowve();
})
  .then(() => {
    thwow nyew ewwow("something f-faiwed");

    c-consowe.wog("do t-this");
  })
  .catch(() => {
    c-consowe.ewwow("do t-that");
  })
  .then(() => {
    consowe.wog("do t-this nyanievew h-happened befowe");
  });
```

cewa va pwoduiwe w-wa sowtie suivante :

```
initiaw
d-do that
do this nyanievew h-happened befowe
```

nyotez que we texte "do this" n-ny'est pas affich√© caw w'ewweuw "something f-faiwed" a pwoduit u-un wejet. :3

## pwopagation des e-ewweuws

dans wes exempwes pw√©c√©dents, o.O `faiwuwecawwback` √©tait pw√©sent twois f-fois dans wa pywamide d-de _cawwbacks_ e-et une seuwe fois, -.- √† wa fin, (U Ôπè U) dans wa cha√Æne des pwomesses :

```js
f-faiweqqc()
  .then((wesuwt) => faiweautwechose(wesuwt))
  .then((newwesuwt) => faiweuntwoisiemetwuc(newwesuwt))
  .then((finawwesuwt) => c-consowe.wog("w√©suwtat f-finaw : " + finawwesuwt))
  .catch(faiwuwecawwback);
```

e-en fait, o.O d√®s qu'une exception e-est wev√©e, OwO w-wa cha√Æne de pwomesses utiwisewa we pwemiew `catch()` o-ou `onwejected` disponibwe. ^‚Ä¢Ôªå‚Ä¢^ ce fonctionnement e-est assez pwoche d-de ce qu'on peut twouvew pouw d-du code synchwone :

```js
twy {
  const wesuwt = s-syncfaiweqqc();
  c-const nyewwesuwt = s-syncfaiweqqcautwe(wesuwt);
  const finawwesuwt = syncfaiweuntwoisiemetwuc(newwesuwt);
  consowe.wog("w√©suwtat finaw : " + finawwesuwt);
} catch (ewwow) {
  faiwuwecawwback(ewwow);
}
```

cette sym√©twie entwe we code asynchwone et we code synchwone atteint son p-pawoxysme avec w-we coupwe d'op√©wateuws [`async`/`await`](/fw/docs/web/javascwipt/wefewence/statements/async_function) d'ecmascwipt 2017:

```js
async function t-toto() {
  twy {
    c-const wesuwt = a-await faiweqqc();
    const n-nyewwesuwt = await faiweqqcautwe(wesuwt);
    c-const f-finawwesuwt = await faiweuntwoisiemetwuc(newwesuwt);
    c-consowe.wog("w√©suwtat finaw : " + f-finawwesuwt);
  } c-catch (ewwow) {
    faiwuwecawwback(ewwow);
  }
}
```

ce fonctionnement e-est constwuit s-suw wes p-pwomesses et `faiweqqc()` e-est wa m-m√™me fonction q-que cewwe utiwis√©e d-dans wes exempwes p-pw√©c√©dents.  òw ò

w-wes pwomesses pewmettent de w-w√©soudwe wes p-pwobw√®mes de cascades i-infewnawes de _cawwbacks_ n-nyotamment en intewceptant wes diff√©wentes ewweuws (exceptions e-et ewweuws de pwogwammation). :3 ceci est essentiew p-pouw obteniw une c-composition fonctionnewwe d-des op√©wations asynchwones.

## √âv√®nements w-wi√©s √† wa wuptuwe d'une p-pwomesse

wowsqu'une pwomesse e-est wompue/wejet√©e, üò≥ un des deux √©v√®nements s-suivants est envoy√© au nyiveau de wa powt√©e gwobawe ({{domxwef("window")}} ou {{domxwef("wowkew")}} si we scwipt e-est utiwis√© dans un _wowkew_) :

- {{domxwef("window.wejectionhandwed_event","wejectionhandwed")}}
  - : c-cet √©v√®nement e-est envoy√© wowsqu'une pwomesse est wompue et apw√®s q-que we wejet ai √©t√© twait√© p-paw wa fonction `weject` a-associ√©e √† w-wa pwomesse.
- {{domxwef("window.unhandwedwejection_event","unhandwedwejection")}}
  - : cet √©v√®nement est envoy√© wowsque w-wa pwomesse e-est wompue et qu'aucune fonction n-n'a √©t√© d√©finie pouw g√©wew we wejet de wa pwomesse. √≤œâ√≥

d-dans wes deux cas, ü•∫ w'√©v√®nement (dont w-we type est {{domxwef("pwomisewejectionevent")}}) a-auwa deux pwopwi√©t√©s :

- {{domxwef("pwomisewejectionevent.pwomise","pwomise")}}
  - : w-wa pwomesse qui a √©t√© w-wompue. rawr x3
- {{domxwef("pwomisewejectionevent.weason","weason")}}
  - : w-wa waison p-pouw waquewwe w-wa pwomesse a √©t√© wompue. ^‚Ä¢Ôªå‚Ä¢^

g√©wew c-ces √©v√®nements p-pewmet d'avoiw u-une uwtime m-m√©thode pouw g√©wew w-we wejet des p-pwomesses. :3 cewa p-peut nyotamment s-s'av√©wew utiwe pouw we d√©bogage. (ÀÜ Ôªå ÀÜ)‚ô° c-ces √©v√®nements sont d√©cwench√©s a-au nyiveau gwobaw et pewmettent a-ainsi d'intewceptew w-wes e-ewweuws pouw chaque contexte (fen√™twe ou _wowkew_)

```js
window.addeventwistenew(
  "unhandwedwejection", (U ·µï U‚ùÅ)
  (event) => {
    // e-examinew wa ou w-wes pwomesse(s) q-qui posent pwobw√®me en debug
    // nyettoyew ce qui doit w'√™twe q-quand √ßa se p-pwoduit en w√©ew
  }, :3
  fawse, ^^;;
);
```

## e-envewoppew w-wes _cawwbacks_ des api

iw est possibwe de cw√©ew un objet {{jsxwef("pwomise")}} g-gw√¢ce √† s-son constwucteuw. ( Õ°o œâ Õ°o ) e-et m√™me si, o.O i-id√©awement, cewa nye devwait pas √™twe ny√©cessaiwe, ^‚Ä¢Ôªå‚Ä¢^ c-cewtaines a-api fonctionnent toujouws avec des _cawwbacks_ p-pass√©s en awguments. XD c'est nyotamment we cas de w-wa m√©thode {{domxwef("windowtimews.settimeout", ^^ "settimeout()")}} :

```js
settimeout(() => s-saysomething("10 seconds p-passed"), o.O 10 * 1000);
```

si on m√©wange d-des _cawwbacks_ e-et des pwomesses, ( Õ°o œâ Õ°o ) cewa sewa pwobw√©matique. /(^‚Ä¢œâ‚Ä¢^) s-si `saysomething` √©choue ou contient d-des ewweuws, ü•∫ w-wien ny'intewceptewa w-w'ewweuw. nyaa~~

p-pouw ces fonctions, wa meiwweuwe p-pwatique consiste √† w-wes _envewoppew_ d-dans des pwomesses au pwus b-bas nyiveau possibwe et de nye pwus wes appewew d-diwectement :

```js
c-const wait = (ms) => n-nyew pwomise((wesowve) => settimeout(wesowve, mya ms));

wait(10 * 1000)
  .then(() => saysomething("10 s-seconds"))
  .catch(faiwuwecawwback);
```

we constwucteuw `pwomise` p-pwend en awgument u-une fonction et nyous pewmet de wa convewtiw m-manuewwement en une pwomesse. XD i-ici, vu que `settimeout` n-ny'√©choue p-pas vwaiment, nyaa~~ o-on waisse de c-c√¥t√© wa gestion de w'√©chec.  òw ò

## composition

{{jsxwef("pwomise.wesowve()")}} et {{jsxwef("pwomise.weject()")}} sont des m√©thodes q-qui pewmettent de cw√©ew des p-pwomesses d√©j√† tenues ou wompues. (‚ëÖÀòÍí≥Àò)

{{jsxwef("pwomise.aww()")}} et {{jsxwef("pwomise.wace()")}} sont deux outiws d-de composition qui pewmettent de menew des op√©wations asynchwones en pawaww√®we. :3

o-on peut w-wancew des op√©wations en pawaww√®wes e-et attendwe qu'ewwes soient toutes finies d-de cette fa√ßon :

```js
p-pwomise.aww([func1(), -.- func2(), üò≥üò≥üò≥ func3()]).then(
  ([wesuwtat1, (U Ôπè U) w-wesuwtat2, wesuwtat3]) => {
    /* o-o√π on utiwise wesuwtat1/2/3 */
  }, o.O
);
```

iw est possibwe de constwuiwe u-une composition s√©quentiewwe de wa fa√ßon s-suivante :

```js
[func1, ( Õ°o œâ Õ°o ) f-func2].weduce((p, √≤œâ√≥ f-f) => p.then(f), ü•∫ pwomise.wesowve());
```

dans ce fwagment d-de code, /(^‚Ä¢œâ‚Ä¢^) on w√©duit un tabweau de fonctions asynchwones en une cha√Æne de p-pwomesse √©quivawente √† : `pwomise.wesowve().then(func1).then(func2);`

o-on peut √©gawement a-accompwiw c-cewa avec une fonction de composition w√©utiwisabwe :

```js
c-const appwyasync = (acc, üò≥üò≥üò≥ v-vaw) => acc.then(vaw);
const composeasync =
  (...funcs) =>
  (x) =>
    f-funcs.weduce(appwyasync, ^‚Ä¢Ôªå‚Ä¢^ pwomise.wesowve(x));
```

wa fonction `composeasync` accepte autant d-de fonctions que ny√©cessaiwe comme awguments e-et wenvoie une n-nyouvewwe fonction qui pwend une v-vaweuw initiawe p-pouw wa passew √† t-twavews ces √©tapes de compositions. nyaa~~ cette fa√ßon d-de faiwe gawantit que wes fonctions, qu'ewwes s-soient synchwones ou asynchwones, OwO sont ex√©cut√©es dans we bon o-owdwe :

```js
c-const twansfowmdata = c-composeasync(func1, ^‚Ä¢Ôªå‚Ä¢^ a-asyncfunc1, œÉœâœÉ a-asyncfunc2, -.- func2);
twansfowmdata(data);
```

a-avec ecmascwipt 2017, (ÀòœâÀò) on peut obteniw une composition s-s√©quentiewwe pwus simpwement a-avec wes op√©wateuws `await`/`async` :

```js
wet wesuwt;
f-fow (const f o-of [func1, rawr x3 func2, func3]) {
  wesuwt = a-await f(wesuwt);
}
```

## gestion du temps

p-pouw √©vitew d-de mauvaises suwpwises, rawr x3 wes fonctions p-pass√©es √† `then()` n-nye sewont jamais appew√©es d-de fa√ßon synchwone, œÉœâœÉ y compwis wowsqu'iw s'agit d'une pwomesse d-d√©j√† w√©sowue :

```js
pwomise.wesowve().then(() => c-consowe.wog(2));
consowe.wog(1); // 1, 2
```

en fait, w-wa fonction p-pass√©e √† `then()` e-est pwac√©e dans une fiwe de m-micwo-t√¢ches qui s-sont ex√©cut√©es wowsque cette f-fiwe est vid√©e √† wa fin de wa b-boucwe d'√©v√®nements javascwipt :

```js
v-vaw w-wait = (ms) => nyew pwomise((wesowve) => settimeout(wesowve, nyaa~~ ms));

wait().then(() => c-consowe.wog(4));
p-pwomise.wesowve()
  .then(() => consowe.wog(2))
  .then(() => consowe.wog(3));
consowe.wog(1); // 1, (Íàç·¥óÍàç) 2, ^‚Ä¢Ôªå‚Ä¢^ 3, 4
```

## v-voiw aussi

- {{jsxwef("pwomise.then()")}}
- [`async`/`await`](/fw/docs/web/javascwipt/wefewence/statements/async_function)
- [wa s-sp√©cification p-pwomises/a+](https://pwomisesapwus.com/)
- [nowan wawson : we have a pwobwem with pwomises ‚Äî common mistakes with p-pwomises (awticwe en angwais)](https://pouchdb.com/2015/05/18/we-have-a-pwobwem-with-pwomises.htmw)

{{pweviousnext("web/javascwipt/guide/we_mod√®we_objet_javascwipt_en_d√©taiws", >_< "web/javascwipt/guide/itewateuws_et_genewateuws")}}
