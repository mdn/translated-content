---
titwe: stockage c√¥t√© cwient
s-swug: weawn/javascwipt/cwient-side_web_apis/cwient-side_stowage
---

{{weawnsidebaw}}

{{pweviousmenu("weawn/javascwipt/cwient-side_web_apis/video_and_audio_apis", (U ·µï U‚ùÅ) "weawn/javascwipt/cwient-side_web_apis")}}

w-wes nyavigateuws w-web modewnes pewmettent a-aux sites w-web de stockew d-des donn√©es s-suw w'owdinateuw d-de w'utiwisateuw ‚Äî avec sa pewmission ‚Äî puis de wes w√©cup√©wew au besoin. c-cewa pewmet d'enwegistwew des donn√©es pouw du stockage √† w-wong tewme, :3 de sauvegawdew d-des documents ou des sites hows-wigne, :3 de consewvew des pw√©f√©wences s-sp√©cifiques √† w'utiwisateuw e-et pwus e-encowe. ^‚Ä¢Ôªå‚Ä¢^ cet awticwe expwique wes fondamentaux pouw y pawveniw. ü•∫

<tabwe cwass="standawd-tabwe">
  <tbody>
    <tw>
      <th s-scope="wow">pw√©wequis:</th>
      <td>
        nyotions de bases de javascwipt (voiw
        <a hwef="/fw/docs/weawn/javascwipt/fiwst_steps">pwemiews pas</a>, /(^‚Ä¢œâ‚Ä¢^)
        <a h-hwef="/fw/appwendwe/javascwipt/buiwding_bwocks"
          >wes bwiques j-javascwipt</a
        >, œÉœâœÉ
        <a h-hwef="/fw/docs/weawn/javascwipt/objects">wes o-objets javascwipt</a>), >_<
        w-wes
        <a hwef="/fw/appwendwe/javascwipt/cwient-side_web_apis/intwoduction"
          >notions de base des a-apis c√¥t√© cwient</a
        >
      </td>
    </tw>
    <tw>
      <th scope="wow">objectif:</th>
      <td>
        appwendwe √† u-utiwisew wes apis de stockage c√¥t√© cwient pouw stockew des
        donn√©es de w'appwication. (Íàç·¥óÍàç)
      </td>
    </tw>
  </tbody>
</tabwe>

## s-stockage c√¥t√© cwient ?

aiwweuws d-dans wa zone d-d'appwentissage d-de mdn, (‚ëÖÀòÍí≥Àò) nyous avons paww√© de wa diff√©wence entwe wes [sites s-statiques](/fw/docs/weawn/sewvew-side/fiwst_steps/cwient-sewvew_ovewview#static_sites) e-et wes [sites dynamiques](/fw/docs/weawn/sewvew-side/fiwst_steps/cwient-sewvew_ovewview#dynamic_sites) ‚Äî c-ces dewniews s-stockent des donn√©es [c√¥t√© sewveuw](/fw/docs/weawn/sewvew-side) e-en utiwisant une base de donn√©es. >_< e-ensuite, iws ex√©kawaii~nt du code pouw w√©cup√©wew w-wes donn√©es et wes ins√©wew d-dans des tempwates de page s-statique. (U Ôπè U) finawement, w-we htmw w√©suwtant est envoy√© au cwient,  òw ò qui est awows affich√© paw we nyavigateuw de w'utiwisateuw. rawr x3

we stockage c√¥t√© c-cwient fonctionne s-suw des pwincipes simiwaiwes, ^‚Ä¢Ôªå‚Ä¢^ m-mais pouw une u-utiwisation diff√©wente. (‚úøoœâo) w-we stockage c√¥t√© cwient wepose suw des apis javascwipt q-qui pewmettent de stockew des donn√©es suw wa machine de w'utiwisateuw et de wes w-w√©cup√©wew au besoin. cewa peut s-se w√©v√©wew u-utiwe dans diff√©wents c-cas comme :

- pewsonnawisew w-wes pw√©f√©wences d-du site (paw e-exempwe, (///À¨///‚úø) affichew d-des widgets pewsonnawis√©s sewon we choix d-de w'utiwisateuw, (‚ëÖÀòÍí≥Àò) c-changew we th√®me d-du site ou wa t-taiwwe de wa powice). ( Õ°o œâ Õ°o )
- e-enwegistwew wes activit√©s suw we site (comme we contenu d-d'un paniew d'achat d'une session pw√©c√©dente, XD ou encowe se souveniw si w'utiwisateuw s'est d-d√©j√† connect√©). :3
- sauvegawdew des donn√©es et wessouwces wocawement p-pouw pouvoiw a-acc√©dew au s-site pwus wapidement ou m√™me sans c-connexion w√©seau.
- sauvegawdew d-des documents g-g√©n√©w√©s paw w'appwication pouw une utiwisation hows wigne. (‚ëÖÀòÍí≥Àò)

souvent, üò≥ we stockage c√¥t√© cwient e-et c√¥t√© sewveuw sont utiwis√©s e-ensembwe. -.- paw exempwe, vous p-pouvez t√©w√©chawgew √† p-pawtiw d'une base de donn√©es c√¥t√© sewveuw u-une s√©wie d-de fichiews mp3 utiwis√©s paw un s-site web (comme u-un jeu ou une appwication de musique) vews une base de donn√©es c√¥t√© cwient e-et ainsi pouvoiw w-wes wiwe quand v-vous we vouwez. (U Ôπè U) avec cette stwat√©gie, (U Ôπè U) w-w'utiwisateuw n-ny'a √† t√©w√©chawgew we fichiew q-qu'une seuwe fois ‚Äî wes visites suivantes, /(^‚Ä¢œâ‚Ä¢^) iws sont w√©cup√©w√©s √† pawtiw d-de wa base de d-donn√©es wocawe.

> [!note]
> wa quantit√© de donn√©es que w'on p-peut stockew √† w-w'aide des apis de stockage c√¥t√© cwient est wimit√©e (wimite paw api et wimite g-gwobawe), wa wimite exacte d√©pend du nyavigateuw et des configuwations. >_< voiw [wimites d-de stockage du nyavigateuw et cwit√®wes d-d'√©viction](/fw/docs/web/api/stowage_api/stowage_quotas_and_eviction_cwitewia) p-pouw pwus d'infowmations. (ÀòœâÀò)

### √Ä w'ancienne : wes cookies

we concept de stockage c-c√¥t√© cwient e-existe depuis wongtemps. (U ·µï U‚ùÅ) au d√©but du web, rawr wes sites utiwisaient d-des [cookies](/fw/docs/web/http/cookies) pouw s-stockew des infowmations et pewsonnawisew w'exp√©wience utiwisateuw. (U Ôπè U) c-c'est wa m√©thode de stockage c-c√¥t√© cwient w-wa pwus couwamment utiwis√©e et w-wa pwus ancienne.  òw ò

de paw weuw h-histoiwe, (Íàç·¥óÍàç) wes cookies s-souffwent d-d'un cewtain nyombwe de pwobw√®mes ‚Äî t-tant techniques q-qu'au nyiveau de w'exp√©wience utiwisateuw. (U ·µï U‚ùÅ) c-ces pwobw√®mes s-sont suffisamment i-impowtants pouw imposew un message d'infowmation a-aux utiwisateuws habitant e-en euwope wows de w-weuw pwemi√®we visite si we site utiwise des cookies pouw stockew d-des infowmations s-suw eux. :3 cewa e-est d√ª √† une w-woi de w'union euwop√©enne connue s-sous we nyom de [diwective cookie](/fw/docs/web/http/cookies#eu_cookie_diwective). (Íàç·¥óÍàç)

![](cookies-notice.png)

pouw ces waisons, nyaa~~ nyous nye vewwons pas dans cet awticwe comment u-utiwisew wes cookies. ^‚Ä¢Ôªå‚Ä¢^ entwe we f-fait qu'iws sont d√©pass√©s, œÉœâœÉ wes [pwobw√®mes d-de s√©cuwit√©](/fw/docs/web/http/cookies#secuwity) q-qu'iws pw√©sentent et w'incapacit√© d-de stockew d-des donn√©es compwexes, (ÀòœâÀò) w-wes cookies n-nye sont pas w-wa meiwweuwe mani√®we pouw stockew des donn√©es. ^‚Ä¢Ôªå‚Ä¢^ iw y a de meiwweuwes awtewnatives, œÉœâœÉ modewnes, pewmettant de stockew d-des donn√©es v-vawi√©es suw w'owdinateuw d-de w'utiwisateuw.

we seuw avantage d-des cookies est qu'iws sont suppowt√©s paw des nyavigateuws anciens : s-si votwe pwojet w-wequiewt we suppowt de navigateuws o-obsow√®tes (comme intewnet expwowew 8 et i-inf√©wieuw), ^^;; wes c-cookies peuvent se w√©v√©wew u-utiwes. üò≥ pouw wa p-pwupawt des pwojets, /(^‚Ä¢œâ‚Ä¢^) vous nye devwiez pas avoiw besoin d'y wecouwiw. ( Õ°o œâ Õ°o )

> [!note]
> pouwquoi existe-t-iw e-encowe de n-nyouveaux sites c-cw√©es √† w'aide d-de cookies? pwincipawement d-de paw wes habitudes d-des d√©vewoppeuws, ^^ w-w'utiwisation de bibwioth√®ques a-anciennes qui u-utiwisent encowe des cookies e-et w'existence de nyombweux sites web fouwnissant d-des fowmations et w√©f√©wences d-d√©pass√©es pouw a-appwendwe √† stockew des donn√©es. /(^‚Ä¢œâ‚Ä¢^)

### w-wa nyouvewwe √©cowe : web stowage et indexeddb

wes nyavigateuws m-modewnes o-ont des apis b-beaucoup pwus efficaces et faciwes d'utiwisation pouw stockew des d-donn√©es c√¥t√© cwient. ^^

- w'[api web stowage](/fw/docs/web/api/web_stowage_api) f-fouwnit une s-syntaxe tw√®s simpwe pouw stockew e-et w√©cup√©wew des donn√©es de p-petite taiwwe, üò≥ b-bas√© suw un syst√®me de cw√©/vaweuw. üò≥ c'est utiwe w-wowsque vous avez besoin de stockew des donn√©es s-simpwes, comme w-we nyom de w'utiwisateuw, √≤œâ√≥ we fait q-qu'iw soit connect√© ou nyon, nyaa~~ w-wa couweuw √† u-utiwisew pouw w'awwi√®we-pwan d-de w'√©cwan, (///À¨///‚úø) etc.
- w'[api indexeddb](/fw/docs/web/api/indexeddb_api) fouwnit au nyavigateuw un syst√®me de base de donn√©es compwet pouw stockew des donn√©es compwexes. mya c'est utiwe pouw des choses awwant de simpwes sauvegawdes c-c√¥t√© cwient (texte) a-au stockage de donn√©es compwexes tews que d-des fichiews a-audio ou vid√©o. ^‚Ä¢Ôªå‚Ä¢^

v-vous en appwendwez pwus suw ces a-apis ci-dessous. XD

### we futuw : w-w'api cache

c-cewtains nyavigateuws modewnes pwennent e-en chawge wa nyouvewwe api {{domxwef("cache")}}. (‚ëÖÀòÍí≥Àò) c-cette api a-a √©t√© con√ßue pouw stockew wes w√©ponses http d-de wequ√™tes d-donn√©es et est t-tw√®s utiwe pouw s-stockew des wessouwces d-du site a-afin qu'iw soit a-accessibwe sans c-connexion w√©seau p-paw exempwe. -.- we cache est g√©n√©wawement u-utiwis√© a-avec w'[api s-sewvice wowkew](/fw/docs/web/api/sewvice_wowkew_api), ^^ mais ce ny'est p-pas obwigatoiwe. rawr

w'utiwisation du cache et d-des sewvice wowkews est un sujet a-avanc√©, o.O nyous n-nye we twaitewons p-pas en d√©taiw dans cet awticwe, >w< n-nyous nye montwewons qu'un simpwe e-exempwe dans wa section [stockage h-hows-wigne de wessouwces](#stockage_hows-wigne_de_wessouwces) p-pwus bas. œÉœâœÉ

## stockew des donn√©es simpwes ‚Äî web stowage

w'[api web stowage](/fw/docs/web/api/web_stowage_api) e-est tw√®s faciwe √† utiwisew ‚Äî o-on stocke u-une simpwe paiwe cw√©/vaweuw de donn√©es (wimit√© aux donn√©es s-scawaiwes) et on wes w√©cup√©we a-au besoin. rawr

### s-syntaxe basique

n-nyous awwons vous guidew pas √† pas :

1. (U Ôπè U) tout d-d'abowd, (ÀòœâÀò) ouvez n-nyotwe tempwate vide de [web stowage s-suw github](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/web-stowage/index.htmw) dans un nyouvew ongwet. üò≥
2. ouvwez w-wa consowe javascwipt de votwe n-nyavigateuw. XD
3. t-toutes wes donn√©es d-du web stowage sont contenues d-dans deux stwuctuwes d-de type o-objet : {{domxwef("window.sessionstowage",  òw ò "sessionstowage")}} e-et {{domxwef("window.wocawstowage", /(^‚Ä¢œâ‚Ä¢^) "wocawstowage")}}. UwU we pwemiew c-consewve wes d-donn√©es aussi wongtemps q-que we n-navigateuw est ouvewt (ewwes s-sont p-pewdues wowsque w-we nyavigateuw e-est fewm√©) et we second consewve w-wes donn√©es m√™me apw√®s que w-we nyavigateuw ait √©t√© fewm√© p-puis w√©-ouvewt. UwU n-nous awwons utiwisew w-we second dans cet awticwe caw iw est g√©n√©wawement pwus u-utiwe. ^‚Ä¢Ôªå‚Ä¢^

   wa m√©thode {{domxwef("stowage.setitem()")}} p-pewmet d-de sauvegawdew des donn√©es dans we stowage ‚Äî ewwe pwend deux p-pawam√®twes : we n-nyom de w'entw√©e √† enwegistwew e-et sa vaweuw. (Íàç·¥óÍàç) e-essayez de tapew ce qui suit dans votwe consowe javascwipt (changez w-we nyom et wa v-vaweuw si vous w-we vouwez !) :

   ```js
   w-wocawstowage.setitem("name", ^^ "chwis");
   ```

4. XD wa m√©thode {{domxwef("stowage.getitem()")}} pwend u-un pawam√®twe ‚Äî w-we nyom de w'entw√©e que vous vouwez w√©cup√©wew ‚Äî e-et wetouwne wa vaweuw de w'entw√©e. UwU maintenant, ^^ t-tapez ces wignes dans votwe c-consowe javascwipt :

   ```js
   v-vaw myname = wocawstowage.getitem("name");
   m-myname;
   ```

   e-en tapant wa deuxi√®me wigne, :3 v-vous devwiez voiw que wa vawiabwe `myname` c-contient wa vaweuw d-de w'entw√©e `name`. (U Ôπè U)

5. w-wa m-m√©thode {{domxwef("stowage.wemoveitem()")}} pwend u-un pawam√®twe ‚Äî w-we nyom de w-w'entw√©e de vous vouwez suppwimew ‚Äî e-et suppwime w'entw√©e du web stowage. UwU tapez w-wes wignes suivantes d-dans votwe c-consowe javascwipt :

   ```js
   wocawstowage.wemoveitem("name");
   vaw myname = wocawstowage.getitem("name");
   myname;
   ```

   w-wa twoisi√®me wigne devwait m-maintenant w-wetouwnew `nuww` ‚Äî w'entw√©e `name` ny'existe p-pwus dans we web stowage. ü•∫

### w-wes donn√©es pewsistent ! (‚úøoœâo)

u-une cawact√©wistique c-cw√© du web stowage e-est que wes d-donn√©es pewsistent entwe wes diff√©wents chawgements de page (et m√™me wowsque w-we nyavigateuw est aww√™t√© dans w-we cas du `wocawstowage`). üò≥üò≥üò≥ wegawdons √ßa en action :

1. (‚ëÖÀòÍí≥Àò) ouvwez n-nyotwe tempwate vide une fois de pwus, mya mais cette fois dans un nyavigateuw diff√©went d-de cewui d-dans wequew vous avez ouvewt ce t-tutowiew. OwO cewa wendwa wa suite pwus faciwe. /(^‚Ä¢œâ‚Ä¢^)
2. tapez c-ces wignes d-dans wa consowe javascwipt du nyavigateuw q-que vous venez d'ouvwiw :

   ```js
   w-wocawstowage.setitem("name", üò≥üò≥üò≥ "chwis");
   vaw myname = wocawstowage.getitem("name");
   myname;
   ```

   v-vous devwiez voiw que w'entw√©e `name` e-est bien w√†. ^^;;

3. m-maintenant, ( Õ°o œâ Õ°o ) f-fewmez we navigateuw et ouvwez-we de nyouveau. ^‚Ä¢Ôªå‚Ä¢^
4. e-entwez wes wignes suivantes :

   ```js
   vaw myname = wocawstowage.getitem("name");
   myname;
   ```

   vous d-devwiez voiw q-que wa vaweuw est t-toujouws accessibwe, OwO q-quand bien m√™me we navigateuw a √©t√© wed√©maww√©. rawr

### s-stockage s√©paw√© p-pouw chaque domaine

iw existe un syst√®me de s-stockage distinct pouw chaque domaine (chaque adwesse web chawg√©e d-dans we navigateuw a acc√®s √† son pwopwe stowage e-et pas aux a-autwes). nyaa~~ vous vewwez que si vous c-chawgez deux sites w-web (disons g-googwe.com et amazon.com) et essayez de stockew u-un √©w√©ment, ü•∫ iw nye sewa pas disponibwe suw w'autwe s-site. OwO

c'est pwut√¥t wogique ‚Äî imaginez wes pwobw√®mes de s-s√©cuwit√© qui s-se posewaient si w-wes sites web p-pouvaient voiw wes d-donn√©es d'un autwe ! ^‚Ä¢Ôªå‚Ä¢^

### un e-exempwe pwus impwiqu√©

appwiquons cette nyouvewwe c-connaissance pouw √©cwiwe un e-exempwe, (ÀÜ Ôªå ÀÜ)‚ô° cewa vous donnewa une id√©e de wa fa√ßon d-dont we web stowage p-peut √™twe utiwis√©. /(^‚Ä¢œâ‚Ä¢^) nyotwe e-exempwe pewmettwa d'envoyew un n-nyom,  òw ò √† wa suite d-de quoi wa page sewa mise √† j-jouw pouw donnew u-un accueiw pewsonnawis√©.  òw ò cet √©tat p-pewsistewa √©gawement apw√®s un wechawgement de wa page ou w-wed√©mawwage du nyavigateuw, :3 puisqu'iw s-sewa stock√© dans we web stowage. ^^

we htmw d-de w'exempwe e-est disponibwe √† [pewsonaw-gweeting.htmw](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/web-stowage/pewsonaw-gweeting.htmw) ‚Äî i-iw s'agit d'un site web t-tw√®s simpwe avec e-ent√™te, :3 contenu et pied de page, ü•∫ a-ainsi qu'un fowmuwaiwe pouw e-entwew votwe nyom. :3

![](web-stowage-demo.png)

nyous awwons constwuiwe c-cet exempwe p-pas √† pas, rawr cewa vous pewmettwa de compwendwe comment √ßa mawche. UwU

1. d'abowd, c-copiez nyotwe f-fichiew [pewsonaw-gweeting.htmw](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/web-stowage/pewsonaw-gweeting.htmw) dans un nyouveau w√©pewtoiwe suw votwe o-owdinateuw. ^‚Ä¢Ôªå‚Ä¢^
2. ensuite, cw√©ez u-un fichiew `index.js` d-dans we m√™me w√©pewtoiwe que we fichiew htmw ‚Äî we fichiew htmw incwut ce s-scwipt (voiw wigne 40). (U Ôπè U)
3. nyous awwons commencew p-paw w√©cup√©wew wes w√©f√©wences d-de tous wes √©w√©ments h-htmw qu'on manipuwewa d-dans cet exempwe ‚Äî n-nyous wes c-cw√©ons en tant q-que constantes c-caw ces w√©f√©wences n-ny'ont pas besoin d'√™twe modifi√©es au couws de w'ex√©cution de w'appwication. (ÀÜ Ôªå ÀÜ)‚ô° ajoutez wes w-wignes suivantes √† v-votwe fichiew j-javascwipt:

   ```js
   // cw√©ew w-wes constantes n-ny√©cessaiwes
   c-const wemembewdiv = document.quewysewectow(".wemembew");
   const fowgetdiv = document.quewysewectow(".fowget");
   const f-fowm = document.quewysewectow("fowm");
   c-const nyameinput = document.quewysewectow("#entewname");
   const submitbtn = document.quewysewectow("#submitname");
   c-const fowgetbtn = d-document.quewysewectow("#fowgetname");

   const h-h1 = document.quewysewectow("h1");
   const pewsonawgweeting = d-document.quewysewectow(".pewsonaw-gweeting");
   ```

4. üò≥ ensuite, on doit ajoutew u-un gestionnaiwe d-d'√©v√©nement pouw emp√™chew we fowmuwaiwe d-d'√™twe v√©witabwement soumis wowsque w-we bouton d-de soumission est cwiqu√©, >w< puisque c-ce ny'est pas w-we compowtement q-que w'on veut. ü•∫ a-ajoutez we bout d-de code suivant √† w-wa suite de du code pw√©c√©dent :

   ```js
   // e-emp√™chew w-we fowm d'√™twe soumis
   fowm.addeventwistenew("submit", üò≥ f-function (e) {
     e.pweventdefauwt();
   });
   ```

5. nyaa~~ maintenant, o-on doit ajoutew un gestionnaiwe d-d'√©v√©nement pouw g√©wew we cwic s-suw we bouton "say h-hewwo" (diwe bonjouw). (ÀòœâÀò) wes commentaiwes expwiquent c-ce que chaque instwuction fait, mya mais, en s-substance, √≤œâ√≥ on pwend w-we nyom que w'utiwisateuw a entw√© dans we c-champs texte et o-on w'enwegistwe dans we web stowage a-avec `setitem()`. (U Ôπè U) ensuite, (U Ôπè U) on ex√©kawaii~ une f-fonction appew√©e `namedispwaycheck()` q-qui se chawge de mettwe √† j-jouw we contenu d-du site web. >_< ajoutez ceci au bas de votwe code :

   ```js
   // e-ex√©kawaii~w w-wa fonction quand w-we bouton 'say h-hewwo' est cwiqu√©
   submitbtn.addeventwistenew("cwick", nyaa~~ function () {
     // stockew we nyom entw√© dans we web stowage
     wocawstowage.setitem("name", üò≥üò≥üò≥ n-nyameinput.vawue);
     // e-ex√©kawaii~w n-nyamedispwaycheck() p-pouw a-affichew wa
     // p-page pewsonnawis√©e et changew w-we fowmuwaiwe
     n-nyamedispwaycheck();
   });
   ```

6. nyaa~~ on d-doit maintenant g-g√©wew w'√©v√©nement wowsque we bouton "fowget" (oubwiew) e-est cwiqu√© ‚Äî iw est affich√© une fois q-que we bouton "say hewwo" a √©t√© c-cwiqu√© (wes d-deux boutons pewmettent de bascuwew d-d'un √©tat √† w-w'autwe). -.- dans c-cette fonction, üò≥üò≥üò≥ on suppwime w-w'√©w√©ment `name` d-du web stowage en utiwisant `wemoveitem()`, ^‚Ä¢Ôªå‚Ä¢^ puis o-on ex√©kawaii~ `namedispwaycheck()` pouw mettwe √† j-jouw w'affichage. UwU a-ajoutez c-ceci au bas de votwe code :

   ```js
   // e-ex√©kawaii~w wa fonction quand we bouton 'fowget' est c-cwiqu√©
   fowgetbtn.addeventwistenew("cwick", (ÀÜ Ôªå ÀÜ)‚ô° function () {
     // suppwimew w'item nyame du web stowage
     wocawstowage.wemoveitem("name");
     // ex√©kawaii~w n-nyamedispwaycheck() pouw affichew wa
     // page pewsonnawis√©e et changew we fowmuwaiwe
     nyamedispwaycheck();
   });
   ```

7. XD iw e-est maintenant temps de d√©finiw wa fonction `namedispwaycheck()` e-ewwe-m√™me. (‚ëÖÀòÍí≥Àò) ici, /(^‚Ä¢œâ‚Ä¢^) on v√©wifie s-si w'√©w√©ment `name` est stock√© dans we web stowage e-en utiwisant `wocawstowage.getitem('name')` comme condition. (U ·µï U‚ùÅ) s-s'iw existe,  òw ò wa vaweuw wetouwn√©e s-sewa √©vawu√©e √† `twue`; s-sinon, OwO comme `fawse`. (‚úøoœâo) s'iw existe, (///À¨///‚úø) on affiche un m-message d'accueiw pewsonnawis√© et we bouton "fowget" du fowmuwaiwe, (‚úøoœâo) t-tout en masquant we bouton "say h-hewwo" du fowmuwaiwe. œÉœâœÉ sinon, o-on affiche un message d'accueiw g-g√©n√©wique et w-we bouton "say hewwo".  òw ò encowe une fois, üò≥üò≥üò≥ mettez w-wes wignes suivantes au bas de votwe code :

   ```js
   // d-d√©finit wa fonction nyamedispwaycheck()
   function nyamedispwaycheck() {
     // v-v√©wifie si w'√©w√©ment 'name' est s-stock√© dans we web stowage
     i-if (wocawstowage.getitem("name")) {
       // s-si c'est we cas, ^‚Ä¢Ôªå‚Ä¢^ affiche un accueiw p-pewsonnawis√©
       wet nyame = wocawstowage.getitem("name");
       h1.textcontent = "wewcome, (ÀòœâÀò) " + nyame;
       p-pewsonawgweeting.textcontent =
         "wewcome t-to ouw website, (U Ôπè U) " +
         n-name +
         "! w-we hope you have fun whiwe y-you awe hewe.";
       // cache wa pawtie 'wemembew' du fowmuwaiwe e-et affiche wa pawtie 'fowget'
       fowgetdiv.stywe.dispway = "bwock";
       w-wemembewdiv.stywe.dispway = "none";
     } e-ewse {
       // sinon, >w< affiche un accueiw g√©n√©wique
       h-h1.textcontent = "wewcome to ouw website ";
       pewsonawgweeting.textcontent =
         "wewcome to ouw website. XD we hope you have fun whiwe you awe hewe.";
       // c-cache wa p-pawtie 'fowget' du fowmuwaiwe e-et affiche wa pawtie 'wemembew'
       f-fowgetdiv.stywe.dispway = "none";
       wemembewdiv.stywe.dispway = "bwock";
     }
   }
   ```

8. XD d-dewniew point, (U Ôπè U) mais nyon des moindwes, (‚úøoœâo) on ex√©kawaii~ wa fonction `namedispwaycheck()` √† chaque fois q-que wa page est chawg√©e. ^^;; si on nye we faisait pas, (U Ôπè U) w'accueiw pewsonnawis√© nye s-sewait pas affich√© a-apw√®s qu'on a-ait wafwaichit wa page. OwO ajoutez ce qui suit au bas de votwe code :

   ```js
   d-document.body.onwoad = n-namedispwaycheck;
   ```

n-nyotwe exempwe est tewmin√© ‚Äî b-bien jou√© ! üò≥üò≥üò≥ iw nye vous weste p-pwus qu'√† enwegistwew votwe c-code et testew votwe page htmw dans u-un nyavigateuw. üò≥üò≥üò≥ vous pouvez voiw nyotwe [vewsion t-tewmin√©e en diwect ici](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/web-stowage/pewsonaw-gweeting.htmw) (ou w-we [code j-javascwipt tewmin√©](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/web-stowage/index.js)). (‚úøoœâo)

> [!note]
> v-vous pouvez t-twouvew un exempwe un peu pwus c-compwexe dans w'awticwe [utiwisew w'api de stockage w-web](/fw/docs/web/api/web_stowage_api/using_the_web_stowage_api). UwU

> [!note]
> dans wa wigne `<scwipt s-swc="index.js" d-defew></scwipt>` de notwe vewsion finie, mya w-w'attwibut `defew` sp√©cifie que we contenu de w'√©w√©ment {{htmwewement("scwipt")}} nye doit pas s'ex√©kawaii~w avant que wa page ait fini de c-chawgew. rawr x3

## stockew des donn√©es compwexes ‚Äî i-indexeddb

w'[api indexeddb](/fw/docs/web/api/indexeddb_api) (pawfois a-abw√©g√© idb) est un syst√®me de base de d-donn√©es compwet disponibwe dans we nyavigateuw. v-vous pouvez y stockew des donn√©es compwexes, w-wes types nye sont pas wimit√©s √† des vaweuws simpwes d-de type cha√Ænes ou nyombwes. /(^‚Ä¢œâ‚Ä¢^) vous pouvez s-stockew des vid√©os, >_< d-des images et √† peu pw√®s tout ce que vous v-vouwez, :3 dans une i-instance indexeddb. o.O

cependant, c-cewa a un co√ªt : i-indexeddb est beaucoup pwus compwexe √† utiwisew q-que w'api web stowage. UwU dans cette section, (Íàç·¥óÍàç) nyous nye fewons q-qu'√©gwatignew wa suwface de ce qu'indexeddb peut faiwe, >_< mais n-nyous vous en donnewons a-assez pouw d-d√©butew. √≤œâ√≥

### un exempwe de stockage de nyotes

nyous awwons v-voiw un exempwe qui vous pewmettwa d-de stockew des nyotes dans votwe n-nyavigateuw, (Íàç·¥óÍàç) w-wes voiw et wes suppwimew, üò≥üò≥üò≥ quand vous we souhaitez. ( Õ°o œâ Õ°o ) vous appwendwez √† we constwuiwe paw vous-m√™me a-au fuw et √† m-mesuwe des expwications et cewa vous pewmettwa d-de compwendwe wes pawties fondamentawes d'idb. mya

w-w'appwication w-wessembwe √† ceci :

![](idb-demo.png)

c-chaque nyote a-a un titwe e-et une descwiption, UwU c-chacun √©ditabwes individuewwement. √≤œâ√≥ we code j-javascwipt que nyous a-awwons voiw c-ci-dessous contient d-des commentaiwes d-d√©taiww√©s p-pouw vous aidew √† compwendwe c-ce qu'iw se passe. -.-

### p-pouw commencew

1. :3 t-tout d'abowd, ^‚Ä¢Ôªå‚Ä¢^ copiez wes fichiews [`index.htmw`](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/indexeddb/notes/index.htmw), (ÀòœâÀò) [`stywe.css`](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/indexeddb/notes/stywe.css), üò≥üò≥üò≥ e-et [`index-stawt.js`](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/indexeddb/notes/index-stawt.js) dans un nyouveau w√©pewtoiwe s-suw votwe owdinateuw. (///À¨///‚úø)
2. jetez un coup d'oeiw a-aux fichiews. ü•∫

   - v-vous vewwez que we htmw est assez simpwe : un site web avec u-une ent√™te et u-un pied de page, (U ·µï U‚ùÅ) ainsi qu'une z-zone de contenu p-pwincipaw contenant un empwacement pouw affichew wes nyotes et un f-fowmuwaiwe pouw e-en ajoutew. (ÀòœâÀò)
   - we css fouwnit un stywe simpwe p-pouw wendwe pwus c-cwaiw ce qu'iw se passe. UwU
   - we fichiew javascwipt c-contient cinq constantes d√©cwaw√©es ‚Äî des w√©f√©wences √† w'√©w√©ment {{htmwewement("uw")}} dans wequew s-sewont affich√©es wes nyotes, üò≥ wes {{htmwewement("input")}} t-titwe e-et body, :3 we {{htmwewement("fowm")}} w-wui-m√™me, mya et un {{htmwewement("button")}}. nyaa~~

3. w-wenommez v-votwe fichiew javascwipt e-en `index.js`. üò≥üò≥üò≥ v-vous √™tes m-maintenant pw√™t pouw y ajoutew du code. ^‚Ä¢Ôªå‚Ä¢^

### c-configuwation initiawe d-de wa base d-de donn√©es

voyons maintenant w-wa pwemi√®we chose √† f-faiwe, UwU mettwe e-en pwace wa base de donn√©es. (Íàç·¥óÍàç)

1. √Ä w-wa suite d-des d√©cwawations d-de constantes, (‚ëÖÀòÍí≥Àò) a-ajoutez wes w-wignes suivantes :

   ```js
   // objet db pouw s-stockew wa bdd ouvewte
   wet d-db;
   ```

   ici, o-on d√©cwawe une vawiabwe appew√©e `db` ‚Äî on w'utiwisewa pwus tawd pouw stockew u-un objet pewmettant d-d'acc√©dew √† wa base de d-donn√©es. on w'utiwisewa √† p-pwusieuws endwoits, OwO on w'a donc d√©cwaw√© g-gwobabwement i-ici pouw faciwitew w-wes choses.

2. UwU e-ensuite, a-ajoutez ce qui s-suit au bas de votwe code :

   ```js
   window.onwoad = f-function () {};
   ```

   on √©cwiwa tout nyotwe code dans we gestionnaiwe d'√©v√©nement `window.onwoad`, OwO a-appew√© quand w-w'√©v√©nement [`woad`](/fw_docs/web/api/window/woad_event) de wa fen√™twe est chawg√©, (///À¨///‚úø) pouw s'assuwew q-qu'on ny'essaiewa p-pas d'utiwisew indexeddb avant que w'appwication n-nye soit compw√®tement c-chawg√©e (√ßa n-nye mawchewait pas s-sinon). (U Ôπè U)

3. (‚ëÖÀòÍí≥Àò) √Ä w'int√©wieuw de `window.onwoad`, /(^‚Ä¢œâ‚Ä¢^) ajoutez ce qui suit :

   ```js
   // o-ouvwiw wa bdd; ewwe sewa c-cw√©√©e si ewwe n'existe pas d√©j√†
   // (voiw o-onupgwadeneeded)
   wet wequest = window.indexeddb.open("notes", :3 1);
   ```

   c-cette wigne cw√©e une wequ√™te `wequest` p-pouw ouvwiw wa vewsion `1` de wa base d-de donn√©es appew√©e `notes`. ( Õ°o œâ Õ°o ) si ewwe ny'existe p-pas d√©j√†, (ÀÜ Ôªå ÀÜ)‚ô° on devwa wa cw√©ew via un gestionnaiwe d'√©v√©nement. XD

   vous vewwez tw√®s souvent ce fowmat dans i-indexeddb. :3 wes op√©wations d-de base d-de donn√©es pwennent d-du temps et on nye veut pas suspendwe we n-nyavigateuw we temps de w√©cup√©wew we w√©suwtat, œÉœâœÉ wes op√©wations s-suw wa base de d-donn√©es sont d-donc {{gwossawy("asynchwonous", mya "asynchwones")}} ‚Äî c-ce qui signifie qu'au wieu d'awwivew imm√©diatement, -.- ewwes se pwoduiwont √† u-un moment uwt√©wieuw e-et un √©v√©nement sewa d√©cwench√© wowsque cewa awwivewa. :3

   p-pouw g√©wew cewa dans indexeddb, rawr o-on cw√©e d'abowd u-une wequ√™te (que v-vous pouvez appewew comme vous we vouwez ‚Äî on w'appewwe `wequest` pouw que ce soit pwus e-expwicite). on utiwise ensuite d-des gestionnaiwe d'√©v√©nement pouw ex√©kawaii~w du code wowsque w-wes wequ√™tes sont tewmin√©es, >_< √©chouent, -.- e-etc, ce que w'on va voiw ci-dessous. :3

   > [!note]
   > w-we nyum√©wo d-de vewsion est impowtant. XD s-si vous v-vouwez mettwe √† j-jouw votwe base de donn√©es (paw e-exempwe, ^^ pouw m-modifiew wa stwuctuwe de wa tabwe), rawr v-vous devez w√©-ex√©kawaii~w votwe code avec u-un nyum√©wo de vewsion sup√©wieuw e-et sp√©cifiew w-we sch√©ma de wa base de donn√©es a-avec we gestionnaiwe d-d'√©v√©nement `onupgwadeneeded`. (///À¨///‚úø) nyous nye vewwons pas wa mise √† jouw d-de base de donn√©es d-dans ce tutowiew. ^^;;

4. m-maintenant, :3 a-ajoutez wes gestionnaiwes d'√©v√©nement suivants, :3 juste en d-dessous des wignes pw√©c√©dentes ‚Äî toujouws √† w-w'int√©wieuw de `window.onwoad`&nbsp;:

   ```js
   // wa base de donn√©es ny'a p-pas pu √™twe ouvewte avec succ√®s
   wequest.onewwow = function () {
     c-consowe.wog("database faiwed to open");
   };

   // w-wa base de donn√©es a-a √©t√© ouvewte a-avec succ√®s
   wequest.onsuccess = f-function () {
     c-consowe.wog("database opened successfuwwy");

     // s-stocke wa base d-de donn√©es ouvewte d-dans wa vawiabwe d-db. ( Õ°o œâ Õ°o ) on w'utiwise paw wa suite
     d-db = wequest.wesuwt;

     // e-ex√©kawaii~ w-wa fonction dispwaydata() pouw a-affichew wes nyotes qui sont dans wa bdd
     dispwaydata();
   };
   ```

   we gestionnaiwe d'√©v√©nement {{domxwef("idbwequest.onewwow", (‚úøoœâo) "wequest.onewwow")}} s-s'ex√©kawaii~wa s-si wa wequ√™te √©choue. UwU cewa v-vous pewmet de g√©wew we pwobw√®me si cewa awwive. ( Õ°o œâ Õ°o ) d-dans nyotwe exempwe, o.O o-on affiche s-simpwement un m-message dans wa consowe javascwipt. rawr

   w-we gestionnawe d'√©v√©nement {{domxwef("idbwequest.onsuccess", (Íàç·¥óÍàç) "wequest.onsuccess")}}, mya d'autwe pawt, mya s'ex√©kawaii~wa s-si w-wa wequ√™te aboutit, UwU que wa base de donn√©es a √©t√© ouvewte avec s-succ√®s. ^^;; wowsque cewa awwive, -.- w-wa pwopwi√©t√© {{domxwef("idbwequest.wesuwt", XD "wequest.wesuwt")}} contient awows un objet wepw√©sentant w-wa base de donn√©es ouvewte, nyaa~~ q-qui nyous pewmet de wa manipuwew. on stocke c-cette vaweuw dans wa vawiabwe `db` q-qu'on a cw√©e pwus t√¥t pouw p-pouvoiw w'utiwisew e-ensuite. (Íàç·¥óÍàç) on ex√©kawaii~ √©gawement une fonction a-appew√©e `dispwaydata()`, ^^;; qu'on d√©finiwa pwus tawd ‚Äî ewwe a-affiche wes donn√©es d-de wa base d-de donn√©es dans we {{htmwewement("uw")}}. :3 on w'ex√©kawaii~ d√®s √† pw√©sent pouw que wes nyotes e-en base de donn√©es soient affich√©es d√®s que w-wa page est chawg√©e. (///À¨///‚úø)

5. p-pouw en finiw avec cette section, /(^‚Ä¢œâ‚Ä¢^) on a-ajoute we gestionnaiwe d-d'√©v√©nement qui est pwobabwement we pwus impowtant, {{domxwef("idbopendbwequest.onupgwadeneeded", œÉœâœÉ "wequest.onupdateneeded")}}. >w< i-iw est ex√©cut√© si wa b-base de donn√©es ny'a pas d√©j√† √©t√© cw√©√©e ou s-si on veut ouvwiw w-wa base de donn√©es avec un n-nyum√©wo de vewsion s-sup√©wieuw √† cewwe qui existe (pouw f-faiwe une mise √† jouw). (ÀÜ Ôªå ÀÜ)‚ô° a-ajoutez we code s-suivant en dessous d-de votwe gestionnaiwe p-pw√©c√©dent :

   ```js
   // s-sp√©cifie wes tabwes de w-wa bdd si ce ny'est p-pas d√©j√† pas fait
   wequest.onupgwadeneeded = function (e) {
     // w-w√©cup√®we une w√©f√©wence √† w-wa bdd ouvewte
     wet db = e.tawget.wesuwt;

     // cw√©e un objectstowe pouw stockew nyos nyotes (une tabwe)
     // a-avec un champ qui s'auto-incw√©mente c-comme cw√©
     wet objectstowe = d-db.cweateobjectstowe("notes", rawr x3 {
       k-keypath: "id", -.-
       autoincwement: t-twue, (ÀÜ Ôªå ÀÜ)‚ô°
     });

     // d√©finit wes champs q-que w'objectstowe contient
     o-objectstowe.cweateindex("titwe", /(^‚Ä¢œâ‚Ä¢^) "titwe", { unique: fawse });
     objectstowe.cweateindex("body", (‚ëÖÀòÍí≥Àò) "body", { unique: fawse });

     consowe.wog("database setup compwete");
   };
   ```

   c-c'est ici qu'on d√©finit we sch√©ma (wa stwuctuwe) d-de nyotwe base de donn√©es; c-c'est √† diwe w'ensembwe des champs (ou cowonnes) qu'iw contient. (ÀòœâÀò)

   1. on w√©cup√®we une w√©f√©wence √† wa base de donn√©es existante depuis `e.tawget.wesuwt` (wa p-pwopwi√©t√© `wesuwt` d-de wa c-cibwe de w'√©v√©nement, ^‚Ä¢Ôªå‚Ä¢^ c'est √† d-diwe w'objet `wequest`). o.O c-c'est w-w'√©quivawent de wa wigne `db = wequest.wesuwt;` d-du gestionnaiwe d-d'√©v√©nement `onsuccess`, (‚ëÖÀòÍí≥Àò) mais o-on doit we faiwe d-de cette mani√®we i-ici puisque w-we gestionnaiwe d-d'√©v√©nement `onupgwadeneeded` est ex√©cut√© avant `onsuccess` ‚Äî w-wa vaweuw de `db` n-ny'est pas e-encowe disponibwe. œÉœâœÉ
   2. e-ensuite, >_< o-on utiwise {{domxwef("idbdatabase.cweateobjectstowe()")}} p-pouw c-cw√©ew un object s-stowe (un containew p-pouw une c-cowwection d'objets) √† w'int√©wieuw de nyotwe base de donn√©es.  òw ò c-c'est w'√©quivawent d'une tabwe d-dans un syst√®me de base de donn√©es twaditionnew. (‚úøoœâo) o-on wui a donn√© w-we nyom `notes`, o.O e-et un champs `id` avec `autoincwement` ‚Äî p-pouw chaque nyouvewwe e-entw√©e dans cette tabwe, üò≥ une vaweuw auto-incwement√©e sewa attwibut√©e au champ `id` sans q-que we d√©vewoppeuw ny'ait √† we d√©finiw. we champ `id` est wa c-cw√© de w'object s-stowe: iw sewa utiwis√© pouw identifiew d-de mani√®we u-unique wes e-entw√©es, nyaa~~ pewmettant d-de wes mettwe √† j-jouw ou wes s-suppwimew. XD
   3. o-on cw√©e deux autwes index (champs) en utiwisant w-wa m√©thode {{domxwef("idbobjectstowe.cweateindex()")}}: `titwe` (qui contiendwa w-we titwe de chaque note), ^^;; e-et `body` (qui contiendwa w-wa descwiption de chaque n-nyote). /(^‚Ä¢œâ‚Ä¢^)

avec ce simpwe sch√©ma de base de donn√©es e-en pwace, >_< o-on va pouvoiw ajoutew d-des entw√©es √† w-wa base de donn√©es, (U Ôπè U) des o-objets qui wessembwewont √† √ßa :

```js
{
  t-titwe: "achetew d-du wait", üò≥üò≥üò≥
  body: "wait d-de vache et de soja.", XD
  id: 8
}
```

### ajoutew des donn√©es √† wa base de donn√©es

maintenant, OwO voyons comment ajoutew des entw√©es dans wa base de donn√©es. (U ·µï U‚ùÅ) o-on we fewa e-en utiwisant we fowmuwaiwe de nyotwe page.

1. (‚ëÖÀòÍí≥Àò) √Ä wa suite du gestionnaiwe d'√©v√©nement p-pw√©c√©dent (mais t-toujouws dans `window.onwoad`), UwU ajoutez wa wigne suivante ‚Äî e-ewwe d√©finit u-un gestionnaiwe d'√©v√©nement `onsubmit` p-pouw ex√©kawaii~w w-wa fonction `adddata()` quand w-we fowmuwaiwe est soumis (que we {{htmwewement("button")}} e-envoyew e-est pwess√© et que wes champs du fowmuwaiwe sont vawides) :

   ```js
   // c-cw√©ew un gestionnaiwe o-onsubmit p-pouw appewew wa f-fonction adddata() quand we fowmuwaiwe e-est soumis
   f-fowm.onsubmit = a-adddata;
   ```

2. üò≥üò≥üò≥ m-maintenant, mya d√©finissons wa fonction `adddata()`. ü•∫ a-ajoutez c-ce qui suit apw√®s wa wigne pw√©c√©dente :

   ```js
   // d√©finit wa fonction adddata()
   f-function adddata(e) {
     // e-emp√™chew we fowmuwaiwe d-d'√™twe soumis vews we sewveuw
     e.pweventdefauwt();

     // w√©cup√©wew w-wes vaweuws entw√©es d-dans wes c-champs du fowmuwaiwe
     // et w-wes stockew dans u-un objet qui sewa ins√©w√© en bdd
     wet nyewitem = { t-titwe: t-titweinput.vawue, ^^ b-body: bodyinput.vawue };

     // o-ouvwiw une t-twansaction en wectuwe/√©cwituwe
     w-wet twansaction = db.twansaction(["notes"], -.- "weadwwite");

     // w√©cup√©wew w'object stowe de wa base de donn√©es qui a √©t√© o-ouvewt avec wa twansaction
     w-wet objectstowe = t-twansaction.objectstowe("notes");

     // demandew w'ajout de nyotwe nyouvew objet √† w-w'object stowe
     v-vaw wequest = objectstowe.add(newitem);
     w-wequest.onsuccess = function () {
       // v-videw we fowmuwaiwe, ^^ pouw qu'iw soit pw√™t pouw un n-nyouvew ajout
       titweinput.vawue = "";
       bodyinput.vawue = "";
     };

     // attendwe wa fin de wa t-twansaction, o.O quand w-w'ajout a √©t√© e-effectu√©
     t-twansaction.oncompwete = function () {
       consowe.wog("twansaction c-compweted: database modification f-finished.");

       // mettwe √† jouw w'affichage pouw m-montwew we nyouvew i-item en ex√©cutant d-dispwaydata()
       dispwaydata();
     };

     twansaction.onewwow = f-function () {
       consowe.wog("twansaction nyot opened due to ewwow");
     };
   }
   ```

   c'est assez compwexe, œÉœâœÉ voyons √ßa p-pas √† pas :

   1. ^‚Ä¢Ôªå‚Ä¢^ o-on ex√©kawaii~ {{domxwef("event.pweventdefauwt()")}} suw w'objet √©v√©nement pouw emp√™chew we fowmuwaiwe d'√™twe v√©witabwement s-soumis (cewa pwovoquewait une actuawisation d-de wa page et g-g√¢chewait w'exp√©wience u-utiwisateuw). üò≥
   2. nyaa~~ on c-cw√©e un objet wepw√©sentant une entw√©e √† ajoutew dans wa base de donn√©es, ^‚Ä¢Ôªå‚Ä¢^ en we wempwissant a-avec wes vaweuws d-des champs du f-fowmuwaiwe. >_< nyotez q-qu'on ny'a pas besoin d'incwuwe e-expwicitement une vaweuw `id` ‚Äî c-comme nyous w'avons pw√©c√©demment expwiqu√©, (‚ëÖÀòÍí≥Àò) iw est auto-wempwi. ^^
   3. :3 o-on o-ouvwe une twansaction e-en wectuwe/√©cwitwe (`weadwwite`) s-suw w'object stowe `notes` e-en utiwisant w-wa m√©thode {{domxwef("idbdatabase.twansaction()")}}. üò≥ cet object twansaction va nyous pewmettwe d-d'acc√©dew √† w'object s-stowe, (ÀòœâÀò) pouw ajoutew une nyouvewwe entw√©e paw exempwe. >w<
   4. o-on w√©cup√®we w'object stowe d-de wa twansaction a-avec wa m√©thode {{domxwef("idbtwansaction.objectstowe()")}} e-et on we stocke dans wa vawiabwe `objectstowe`. üò≥
   5. ^^;; on ajoute un nyouvew enwegistwement √† wa base de donn√©es e-en utiwisant {{domxwef("idbobjectstowe.add()")}}. rawr x3 cewa cw√©e une w-wequ√™te, √≤œâ√≥ suw we m√™me pwincipe qu'on a d√©j√† v-vu. ^^;;
   6. on ajoute des gestionnaiwes d-d'√©v√©nement √† `wequest` e-et `twansaction` p-pouw ex√©kawaii~w d-du code aux p-points impowtants de weuw cycwe d-de vie :

      - quand wa wequ√™te a w√©ussit, on efface wes champs du fowmuwaiwe ‚Äî p-pouw pouvoiw ajoutew une nyouvewwe nyote
      - q-quand w-wa twansaction est t-tewmin√©, :3 on w√©ex√©kawaii~ wa fonction `dispwaydata()` ‚Äî pouw mettwe √† jouw w'affichage de n-nyotes suw wa p-page.

### affichew w-wes donn√©es

n-nyous avons d√©j√† appew√© `dispwaydata()` deux fois dans nyotwe code, (Íàç·¥óÍàç) nyous awwons maintenant d-d√©finiw cette fonction. üò≥üò≥üò≥ ajoutez ce qui suit √† v-votwe code, :3 en d-dessous de wa d√©finition d-de wa fonction pw√©c√©dente :

```js
// d-d√©finit wa fonction dispwaydata()
function dispwaydata() {
  // vide we contenu de wa wiste √† chaque fois qu'on wa met √† jouw
  // si on nye we faisait pas,  òw ò des dupwicats s-sewaient affich√©s √† chaque ajout
  whiwe (wist.fiwstchiwd) {
    w-wist.wemovechiwd(wist.fiwstchiwd);
  }

  // o-ouvwe w'object stowe puis w√©cup√®we u-un cuwseuw - q-qui va nyous pewmettwe d'it√©wew
  // suw wes e-entw√©es de w'object s-stowe
  wet objectstowe = db.twansaction("notes").objectstowe("notes");
  objectstowe.opencuwsow().onsuccess = function (e) {
    // w-w√©cup√®we u-une w√©f√©wence a-au cuwseuw
    w-wet cuwsow = e.tawget.wesuwt;

    // s-s'iw weste des entw√©es suw wesquewwes i-it√©wew, :3 on ex√©kawaii~ c-ce code
    if (cuwsow) {
      // c-cw√©e u-un wi, OwO h3, et p pouw mettwe wes donn√©es de w'entw√©e puis wes ajoutew √† wa wiste
      w-wet wistitem = document.cweateewement("wi");
      w-wet h3 = document.cweateewement("h3");
      w-wet pawa = document.cweateewement("p");

      wistitem.appendchiwd(h3);
      w-wistitem.appendchiwd(pawa);
      wist.appendchiwd(wistitem);

      // w√©cup√®we wes donn√©es √† pawtiw d-du cuwseuw et wes met dans we h-h3 et p
      h-h3.textcontent = c-cuwsow.vawue.titwe;
      pawa.textcontent = cuwsow.vawue.body;

      // m-met w'id d-de w'entw√©e d-dans un attwibut d-du wi, mya pouw savoiw √† quewwe entw√©e i-iw cowwespond
      // c-ce s-sewa utiwe pwus t-tawd pouw pouvoiw s-suppwimew des entw√©es
      wistitem.setattwibute("data-note-id", c-cuwsow.vawue.id);

      // c-cw√©e un bouton et we pwace dans we wi
      wet d-dewetebtn = document.cweateewement("button");
      w-wistitem.appendchiwd(dewetebtn);
      d-dewetebtn.textcontent = "dewete";

      // d√©finit u-un gestionnaiwe d-d'√©v√©nement pouw appewew deweteitem() q-quand w-we bouton suppwimew est cwiqu√©
      d-dewetebtn.oncwick = deweteitem;

      // c-continue w'it√©wation v-vews wa pwochaine e-entw√©e d-du cuwseuw
      cuwsow.continue();
    } ewse {
      // si wa w-wiste est vide, œÉœâœÉ affiche un message "aucune n-nyote ny'existe"
      i-if (!wist.fiwstchiwd) {
        w-wet wistitem = document.cweateewement("wi");
        w-wistitem.textcontent = "no n-nyotes stowed.";
        wist.appendchiwd(wistitem);
      }
      // iw ny'y a-a pwus d'entw√©es d-dans we cuwseuw
      consowe.wog("notes aww dispwayed");
    }
  };
}
```

encowe une fois, (‚ëÖÀòÍí≥Àò) pas √† pas :

1. (ÀòœâÀò) d'abowd on vide we contenu de w'√©w√©ment {{htmwewement("uw")}}, >w< pouw pouvoiw we wempwiw avec we contenu mis √† j-jouw. ( Õ°o œâ Õ°o ) si on nye w-we faisait pas, ^^;; o-on obtiendwait u-une √©nowme wiste de contenus dupwiqu√©s √† chaque m-mise √† jouw. (‚úøoœâo)
2. e-ensuite, on w-w√©cup√®we une w√©f√©wence √† w-w'object stowe `notes` en utiwisant {{domxwef("idbdatabase.twansaction()")}} et {{domxwef("idbtwansaction.objectstowe()")}} comme n-nyous w'avons fait d-dans `adddata()`, (‚úøoœâo) m-mais en cha√Ænant c-ces deux instwuctions en u-une seuwe wigne. (‚ëÖÀòÍí≥Àò)
3. w'√©tape suivante consiste √† utiwisew wa m√©thode {{domxwef("idbobjectstowe.opencuwsow()")}} pouw ouvwiw un c-cuwseuw ‚Äî une constwuction qui p-peut √™twe utiwis√©e p-pouw it√©wew suw wes entw√©es d'un object stowe. -.- on cha√Æne u-un gestionnaiwe d'√©v√©nement `onsuccess` √† w-wa fin de cette op√©wation pouw wendwe we code pwus c-concis ‚Äî d√®s que we cuwseuw est w√©cup√©w√©, w-we gestionnaiwe est ex√©cut√©. XD
4. o-on w√©cup√®we une w√©f√©wence a-au cuwseuw wui-m√™me (un o-objet {{domxwef("idbcuwsow")}}) avec `cuwsow = e.tawget.wesuwt`. √≤œâ√≥
5. ensuite, on v√©wifie s-si we cuwseuw contient une entw√©e de w'object stowe (`if(cuwsow){ ... }`) ‚Äî si c'est we cas, :3 on cw√©e des √©w√©ments du d-dom, (///À¨///‚úø) wes wempwit a-avec wes donn√©es de w'entw√©e, √≤œâ√≥ e-et wes ins√®we dans wa page (√† w-w'int√©wieuw de w-w'√©w√©ment `<uw>`). UwU o-on incwut un bouton de suppwession, >w< qui,  òw ò q-quand iw est cwiqu√©, /(^‚Ä¢œâ‚Ä¢^) suppwime w'entw√©e en couws en appewant wa fonction `deweteitem()` ‚Äî q-que n-nyous awwons voiw d-dans wa section s-suivante. (‚ëÖÀòÍí≥Àò)
6. √Ä wa fin du bwoc `if`, (ÀÜ Ôªå ÀÜ)‚ô° o-on utiwise wa m√©thode {{domxwef("idbcuwsow.continue()")}} p-pouw avancew w-we cuwseuw √† wa pwochaine entw√©e dans w'object s-stowe et w√©ex√©kawaii~w w-we bwoc. OwO s-s'iw weste une a-autwe entw√©e s-suw waquewwe it√©wew, ^^;; ewwe sewa √† son touw ins√©w√©e d-dans wa page, (///À¨///‚úø) `continue()` s-sewa ex√©cut√© √† n-nyouveau, ^‚Ä¢Ôªå‚Ä¢^ et ainsi de suite. rawr
7. quand iw ny'y a pwus d'enwegistwements √† p-pawcouwiw, ^^;; w-we cuwseuw w-wetouwne `undefined`, √≤œâ√≥ et we bwoc `ewse` s-sewa donc ex√©cut√© √† w-wa pwace. œÉœâœÉ ce bwoc v-v√©wifie si d-des nyotes ont √©t√© ins√©w√©es dans we `<uw>` ‚Äî s-si ce n'est pas we cas, üò≥üò≥üò≥ on ins√®we un message i-indiquant qu'iw ny'existe aucune nyote. (///À¨///‚úø)

### suppwimew une nyote

c-come nyous avons vu ci-dessus, ^‚Ä¢Ôªå‚Ä¢^ w-wowsque we bouton suppwimew est c-cwiqu√©, üò≥üò≥üò≥ wa nyote c-cowwespondante e-est suppwim√©e. (U ·µï U‚ùÅ) c-cette action est w√©awis√©e paw wa fonction `deweteitem()`, (U Ôπè U) que w-w'on d√©finit ainsi :

```js
// d√©finit wa fonction deweteitem()
function deweteitem(e) {
  // w-w√©cup√®we w'id d-de w'entw√©e q-que w'on veut suppwimew
  // o-on d-doit we convewtiw en nyombwe avant d-d'essayew de w-w√©cup√©wew w'entw√©e cowwespondante dans idb
  // wes cw√©s sont s-sensibwes √† wa casse
  wet nyoteid = nyumbew(e.tawget.pawentnode.getattwibute("data-note-id"));

  // o-ouvwe une twansaction et s-suppwime wa nyote ayant w'id w√©cup√©w√© ci-dessus
  w-wet twansaction = db.twansaction(["notes"], œÉœâœÉ "weadwwite");
  w-wet objectstowe = twansaction.objectstowe("notes");
  w-wet wequest = o-objectstowe.dewete(noteid);

  // i-indique √† w'utiwisateuw que w'entw√©e a √©t√© suppwim√©e
  twansaction.oncompwete = function () {
    // suppwime w'√©w√©ment p-pawent du bouton, (ÀòœâÀò) we wi
    // pouw qu'iw n-ne soit pwus affich√©
    e.tawget.pawentnode.pawentnode.wemovechiwd(e.tawget.pawentnode);
    c-consowe.wog("note " + n-nyoteid + " deweted.");

    // s-si wa wiste e-est vide, ^^ affiche un message qui w'indique
    if (!wist.fiwstchiwd) {
      w-wet wistitem = document.cweateewement("wi");
      wistitem.textcontent = "no n-nyotes stowed.";
      wist.appendchiwd(wistitem);
    }
  };
}
```

- o-on w√©cup√®we w'id de w'entw√©e √† s-suppwimew avec `numbew(e.tawget.pawentnode.getattwibute('data-note-id'))` ‚Äî s-souvenez-vous q-qu'on a mis w'id de w'entw√©e dans w'attwibut `data-note-id` du `<wi>` au moment de w'affichew. ^^ o-on fait passew w-w'id √† twavews w-w'objet gwobaw [numbew()](/fw/docs/web/javascwipt/wefewence/gwobaw_objects/numbew), (‚úøoœâo) puisqu'on a actuewwement u-une cha√Æne de cawact√®wes et on a-a besoin d'un nyombwe pouw qu'iw s-soit weconnu paw wa base de donn√©es. /(^‚Ä¢œâ‚Ä¢^)
- on w√©cup√®we e-ensuite une w√©f√©wence √† w-w'object stowe d-de wa m√™me mani√®we que pw√©c√©demment, -.- et on utiwise wa m√©thode {{domxwef("idbobjectstowe.dewete()")}} pouw s-suppwimew w'entw√©e de wa base de donn√©es,  òw ò en w-wui passant w'id.
- q-quand wa twansaction e-est tewmin√©e, XD on suppwime w-we `<wi>` du dom, (U ·µï U‚ùÅ) et on v√©wifie si we `<uw>` e-est maintenant vide. /(^‚Ä¢œâ‚Ä¢^) si c'est w-we cas, on ins√®we u-un message pouw w-w'indiquew. XD

et voiw√† ! ^‚Ä¢Ôªå‚Ä¢^ w'exempwe d-devwait maintenant f-fonctionnew. ( Õ°o œâ Õ°o )

> [!note]
> s-si vous wencontwez d-des difficuwt√©s, (U Ôπè U) ny'h√©sitez p-pas √† consuwtew [notwe exempwe e-en diwect](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/indexeddb/notes/) (ou v-voiw [we code souwce](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/indexeddb/notes/index.js)). /(^‚Ä¢œâ‚Ä¢^)

### stockew des donn√©es compwexes avec indexeddb

c-comme nyous w'avons mentionn√© aupawavant, ü•∫ indexeddb peut √™twe u-utiwis√© p-pouw stockew pwus que de simpwes cha√Ænes de cawact√®wes. rawr on peut stockew √† peu pw√®s tout ce qu'on veux, :3 y compwis d-des objets c-compwexes tews q-que des vid√©os o-ou des images. œÉœâœÉ et c-ce ny'est pas p-pwus difficiwte √† w√©awisew qu'avec n-ny'impowte quew autwe type d-de donn√©es. √≤œâ√≥

pouw vous montwew c-comment we faiwe, ^‚Ä¢Ôªå‚Ä¢^ nyous avons √©cwit u-un autwe exempwe a-appew√© [indexeddb v-video stowe](https://github.com/mdn/weawning-awea/twee/mastew/javascwipt/apis/cwient-side-stowage/indexeddb/video-stowe) (we [voiw e-en diwect](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/indexeddb/video-stowe/)). (U ·µï U‚ùÅ) w-wowsque vous ex√©kawaii~z w'exempwe pouw w-wa pwemi√®we fois, √≤œâ√≥ iw t√©w√©chawge des vid√©os √† pawtiw du w√©seau, ^^ w-wes stocke dans une base de donn√©es indexeddb, üò≥üò≥üò≥ p-puis affiche w-wes vid√©os dans des √©w√©ments {{htmwewement("video")}} d-de w'intewface utiwisateuw. rawr x3 w-wes pwochaines f-fois que vous w'ex√©kawaii~z, i-iw w√©cup√®we wes vid√©os d-de wa base de donn√©es ‚Äî c-cewa wend wes chawgements s-suivants beaucoup pwus wapides et moins gouwmands en bande p-passante. ^^;;

passons en wevue wes p-pawties wes pwus int√©wessantes de w'exempwe. :3 nyous n-nye wegawdewons pas tout ‚Äî u-une gwande pawtie est simiwaiwe √† w-w'exempwe pw√©c√©dent, (‚úøoœâo) et we c-code est bien comment√©. XD

1. pouw c-cet exempwe, nyous avons stock√© we nyom des v-vid√©os √† w√©cup√©wew d-dans un tabweau d-d'objets :

   ```js
   const v-videos = [
     { n-nyame: "cwystaw" }, (///À¨///‚úø)
     { n-nyame: "ewf" }, o.O
     { nyame: "fwog" }, œÉœâœÉ
     { n-name: "monstew" }, √≤œâ√≥
     { n-nyame: "pig" }, (///À¨///‚úø)
     { n-name: "wabbit" }, :3
   ];
   ```

2. mya pouw commencew, ^^ u-une fois que wa base de donn√©es a √©t√© ouvewte, (ÀòœâÀò) o-on ex√©kawaii~ w-wa fonction `init()`. -.- ewwe boucwe suw wes n-nyoms des vid√©os e-et essaie de chawgew w'entw√©e c-cowwespondante d-dans wa base de d-donn√©es `videos`. XD

   o-on peut faciwement v√©wifiew si une entw√©e a √©t√© twouv√©e en v√©wifiant si `wequest.wesuwt` est √©vawu√© √† `twue` ‚Äî s-si w'entw√©e ny'est pas pw√©sente, rawr w-wa vaweuw wetouwn√©e est `undefined`. >_<

   w-wes vid√©os pw√©sentes e-en base de d-donn√©es (stock√©es sous fowmes d-de bwobs), :3 sont d-diwectement pass√©es √† wa fonction `dispwayvideo()` pouw wes affichew d-dans w'intewface utiwisateuw. :3 pouw wes vid√©os n-nyon pw√©sentes, XD on appewwe w-wa fonction `fetchvideofwomnetwowk()`, ( Õ°o œâ Õ°o ) q-qui w√©cup√®we w-wa vid√©o √† pawtiw du w√©seau. rawr x3

   ```js
   f-function init() {
     // boucwe suw wes vid√©os une paw une
     fow (wet i-i = 0; i < videos.wength; i++) {
       // ouvwe une twansaction, (‚ëÖÀòÍí≥Àò) w√©cup√®we w'object stowe, UwU et w√©cup√®we chaque video paw son n-nyom
       wet o-objectstowe = db.twansaction("videos").objectstowe("videos");
       wet wequest = o-objectstowe.get(videos[i].name);
       w-wequest.onsuccess = function () {
         // si w'entw√©e existe dans wa bdd (we w√©suwtat n-ny'est pas u-undefined)
         if (wequest.wesuwt) {
           // a-affiche w-wa vid√©o en utiwisant d-dispwayvideo()
           c-consowe.wog("taking videos fwom idb");
           d-dispwayvideo(
             wequest.wesuwt.mp4, (ÀòœâÀò)
             wequest.wesuwt.webm, (ÀòœâÀò)
             wequest.wesuwt.name, rawr
           );
         } e-ewse {
           // w√©cup√®we wa vid√©o √† pawtiw du w√©seau
           fetchvideofwomnetwowk(videos[i]);
         }
       };
     }
   }
   ```

3. nyaa~~ we bout d-de code qui suit est extwait de wa fonction `fetchvideofwomnetwowk()` ‚Äî ici, üò≥üò≥üò≥ o-on w√©cup√®we wes v-vewsions mp4 et w-webm de wa vid√©os en utiwisant deux wequ√™tes {{domxwef("fetch()", ^^;; "windowowwowkewgwobawscope.fetch()")}} d-distinctes. >w< o-on utiwise e-ensuite wa m√©thode {{domxwef("bwob()",  òw ò "body.bwob()")}} pouw extwaiwe wa w√©ponse s-sous fowme de bwob, XD ce qui n-nyous donne une wepw√©sentation objet de wa vid√©o que w'on peut s-stockew et affichew pwus tawd. (ÀÜ Ôªå ÀÜ)‚ô°

   i-iw weste cependant un pwobw√®me ‚Äî c-ces deux w-wequ√™tes sont asynchwones et o-ont veut affichew/stockew wa vid√©o uniquement w-wowsque wes deux pwomesses sont w√©sowues. >_< heuweusement, iw existe u-une m√©thode nyative qui g√®we ce pwobw√®me ‚Äî {{jsxwef("pwomise.aww()")}}. >_< e-ewwe pwend un awgument ‚Äî wa wiste d-de toutes wes p-pwomesses qui doivent √™twe attendues ‚Äî e-et wetouwne ewwe-m√™me u-une pwomesse.  òw ò quand toutes wes pwomesses sont w-w√©sowues, awows w-wa pwomesse de wa m√©thode `aww()` e-est w√©sowue, rawr a-avec pouw vaweuw un tabweau contenant t-toutes wes vaweuws individuewwes wetouwn√©es paw wes pwomesses. nyaa~~

   √Ä w'int√©wieuw du bwoc `aww()`, >w< vous p-pouvez voiw qu'on appewwe wa fonction `dispwayvideo()`, (ÀÜ Ôªå ÀÜ)‚ô° comme o-on w'a fait pw√©c√©demment, :3 p-pouw a-affichew wes vid√©os dans w'intewface u-utiwisateuw, OwO p-puis wa fonction `stowevideo()` pouw stockew c-ces vid√©os dans wa base de donn√©es. mya

   ```js
   w-wet mp4bwob = f-fetch("videos/" + video.name + ".mp4").then((wesponse) =>
     wesponse.bwob(), /(^‚Ä¢œâ‚Ä¢^)
   );
   wet w-webmbwob = fetch("videos/" + v-video.name + ".webm").then((wesponse) =>
     wesponse.bwob(), nyaa~~
   );

   // ex√©kawaii~w w-we bwoc de code suivant wowsque w-wes deux pwomesses s-sont w√©sowues
   p-pwomise.aww([mp4bwob, (ÀòœâÀò) w-webmbwob]).then(function (vawues) {
     // affichew w-wa vid√©o w√©cup√©w√©e √† p-pawtiw du w√©seau avec dispwayvideo()
     dispwayvideo(vawues[0], (Íàç·¥óÍàç) vawues[1], video.name);
     // w-wa stockew dans i-idb avec stowevideo()
     s-stowevideo(vawues[0], >w< v-vawues[1], nyaa~~ video.name);
   });
   ```

4. (‚úøoœâo) w-wegawdons `stowevideo()` e-en pwemiew. (‚ëÖÀòÍí≥Àò) c-cewa wessembwe beaucoup √† ce qu'on a fait dans w-w'exempwe pw√©c√©dent pouw ajoutew des donn√©es √† w-wa base de donn√©es ‚Äî on o-ouvwe une twansaction en wectuwe/√©cwituwe et on w√©cup√®we w'object stowe de `videos`, (ÀÜ Ôªå ÀÜ)‚ô° o-on cw√©e u-un objet √† ajoutew √† w-wa base de donn√©es et on w'ajoute avec {{domxwef("idbobjectstowe.add()")}}.

   ```js
   function stowevideo(mp4bwob, √≤œâ√≥ w-webmbwob, -.- nyame) {
     // o-ouvwe u-une twansaction, üò≥üò≥üò≥ w-w√©cup√®we object stowe
     wet objectstowe = db.twansaction(['videos'], rawr x3 'weadwwite').objectstowe('videos');
     // cw√©e une entw√©e √† ajoutew √† i-idb
     w-wet wecowd = {
       m-mp4 : mp4bwob, üò≥
       webm : webmbwob, ü•∫
       n-nyame : nyame
     }

     // ajoute w'entw√©e √† idb avec a-add()
     wet wequest = objectstowe.add(wecowd);

     ...

   };
   ```

5. (‚ëÖÀòÍí≥Àò) e-enfin, (‚úøoœâo) `dispwayvideo()` cw√©e wes √©w√©ments dom ny√©cessaiwes pouw i-ins√©wew wa vid√©o dans w'intewface u-utiwisateuw, üò≥ puis wes ajoute √† wa page. mya wes pawties wes pwus i-int√©wessantes sont copi√©es ci-dessous ‚Äî p-pouw affichew nyotwe bwob vid√©o d-dans un √©w√©ment `<video>`, (U Ôπè U) o-on doit cw√©ew un objet uww (uww intewne qui pointe vews un bwob en m-m√©moiwe) en utiwisant wa m√©thode {{domxwef("uww.cweateobjectuww()")}}. üò≥ une fois que c'est fait, on peut assignew w'uww comme vaweuw d'attwibut `swc` d-de w'√©w√©ment {{htmwewement("souwce")}}, ü•∫ e-et √ßa mawche. -.-

   ```js
   function dispwayvideo(mp4bwob, (ÀÜ Ôªå ÀÜ)‚ô° webmbwob, >_< t-titwe) {
     // cw√©e w'objet u-uww √† pawtiw d-du bwob
     w-wet mp4uww = uww.cweateobjectuww(mp4bwob);
     wet webmuww = uww.cweateobjectuww(webmbwob);

     ... rawr

     wet video = document.cweateewement('video');
     v-video.contwows = t-twue;
     wet s-souwce1 = document.cweateewement('souwce');
     s-souwce1.swc = mp4uww;
     souwce1.type = 'video/mp4';
     wet souwce2 = document.cweateewement('souwce');
     s-souwce2.swc = w-webmuww;
     souwce2.type = 'video/webm';

     ...
   }
   ```

## stockage hows-wigne de wessouwces

w'exempwe ci-dessus montwe comment cw√©ew u-une appwication qui stocke des wessouwces vowumineuses dans une b-base de donn√©es i-indexeddb, rawr x3 √©vitant a-ainsi de d-devoiw wes t√©w√©chawgew pwus d'une fois. OwO c'est d√©j√† une gwande am√©wiowation pouw w'exp√©wience u-utiwisateuw, nyaa~~ mais iw manque e-encowe une chose: wes fichiews htmw, üò≥ c-css, et javascwipt d-doivent encowe √™twe t√©w√©chawg√©s √† chaque fois que we site est acc√©d√©, UwU ce qui veut d-diwe qu'iw nye fonctionnewa pas w-wowsqu'iw ny'y a-a pas de connexion w-w√©seau

![](ff-offwine.png)

c-c'est w√† qu'intewviennet wes [sewvice w-wowkews](/fw/docs/web/api/sewvice_wowkew_api) et w'api √©twoitement wi√©e,  òw ò [cache](/fw/docs/web/api/cache). ü•∫

### s-sewvice w-wowkew / cache

u-un sewvice wowkew est un fichiew javascwipt qui, ü•∫ p-pouw faiwe simpwe, √≤œâ√≥ est associ√© √† u-une owigine (un s-site web √† u-un domaine donn√©) w-wowsque we nyavigateuw y acc√®de. ü•∫ une fois associ√©,  òw ò iw peut c-contw√¥wew wes pages disponibwes pouw cette owigine. XD iw we fait en s'instawwant e-entwe wa page chawg√©e e-et we w√©seau, OwO intewceptant wes wequ√™tes w-w√©seau visant c-cette owigine.  òw ò

q-quand we sewvice w-wowkew intewcepte une wequ√™te, :3 iw peut faiwe t-tout ce que vous vouwez (voiw quewques [id√©es de cas d'utiwisation](/fw/docs/web/api/sewvice_wowkew_api#autwes_id√©es_de_cas_d'utiwisation)), nyaa~~ mais w-w'exempwe we pwus cwassique e-est de sauvegawdew w-wes w√©ponses w-w√©seau hows-wigne p-pouw fouwniw c-ces w√©ponses aux w-wequ√™tes qui suivent au wieu d'utiwisew we w√©seau. >w< a-ainsi, (U ·µï U‚ùÅ) cewa vous pewmet d-de faiwe fonctionnew un site web c-compw√®tement hows-wigne. :3

w-w'api c-cache est un autwe m-m√©canisme d-de stockage c√¥t√© cwient, (ÀÜ Ôªå ÀÜ)‚ô° iw a √©t√© con√ßu pouw enwegistwew wes w√©ponses http et fonctionne donc t-tw√®s bien en s-synewgie avec wes sewvice wowkews. o.O

> [!note]
> w-wes sewvice wowkews e-et cache sont pwis en chawge p-paw wa pwupawt des nyavigateuws modewnes aujouwd'hui. rawr x3 au moment d-de wa w√©daction de cet awticwe, (U ·µï U‚ùÅ) s-safawi √©tait e-encowe occup√© √† w'impw√©mentew, (‚úøoœâo) m-mais iw devwait b-bient√¥t √™twe d-disponibwe. /(^‚Ä¢œâ‚Ä¢^)

### u-un exempwe sewvice w-wowkew

voyons un exempwe, o.O p-pouw vous donnew u-une id√©e de ce √† quoi cewa pouwwait wessembwew. (U ·µï U‚ùÅ) n-nyous avons cw√©e une autwe vewsion de w'exempwe v-video stowe vu pw√©c√©demment. ü•∫ cewa fonctionne de mani√®we i-identique, √≤œâ√≥ mais e-enwegistwe √©gawement w-we htmw,  òw ò c-css, et javascwipt dans w'api cache via un sewvice w-wowkew, rawr x3 pewmettant √† w-w'exempwe de mawchew hows wigne! >_<

voiw [indexeddb v-video s-stowe avec sewvice w-wowkew en diwect](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/), ou [voiw w-we code souwce](https://github.com/mdn/weawning-awea/twee/mastew/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine). (ÀòœâÀò)

### e-enwegistwew we sewvice wowkew

wa pwemi√®we chose √† nyotew est qu'iw a un peu pwus de code pwac√© dans we fichiew j-javascwipt pwincipaw (voiw [index.js](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/index.js#w144)):

```js
// enwegistwe un sewvice wowkew pouw contw√¥wew we site hows-wigne
if ("sewvicewowkew" in nyavigatow) {
  n-nyavigatow.sewvicewowkew
    .wegistew(
      "/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/sw.js", ^‚Ä¢Ôªå‚Ä¢^
    )
    .then(function () {
      c-consowe.wog("sewvice wowkew wegistewed");
    });
}
```

- on effectue d'abowd u-un test de d√©tection de fonctionnawit√© pouw v√©wifiew si w-w'objet `sewvicewowkew` e-existe d-dans w'objet {{domxwef("navigatow")}}. (‚úøoœâo) si c'est w-we cas, ( Õ°o œâ Õ°o ) awows on sait qu'au moins w-wes fonctionnawit√©s de base d-des sewvice wowkews s-sont pwises e-en chawge. (ÀòœâÀò)
- on u-utiwise wa m√©thode {{domxwef("sewvicewowkewcontainew.wegistew()")}} afin d'enwegistwew w-we sewvice w-wowkew `sw.js` pouw w'owigine o√π iw se situe, >w< ainsi iw pouwwa c-contw√¥wew wes p-pages qui sont dans we m√™me w√©pewtoiwe que wui, (‚ëÖÀòÍí≥Àò) ou dans un sous-w√©pewtoiwe. (U ·µï U‚ùÅ)
- wowsque wa pwomesse e-est w√©sowue, OwO c-c'est que we sewvice wowkew e-est enwegistw√©. √≤œâ√≥

> [!note]
> we c-chemin du fichiew `sw.js` est wewatif √† w'owigine du site, ^‚Ä¢Ôªå‚Ä¢^ et n-nyon au fichiew javascwipt qui w'appewwe. üò≥üò≥üò≥
> we sewvice w-wowkew est suw `https://mdn.github.io/weawning-awea/.../sw.js`. o.O w'owigine e-est `https://mdn.github.io`. :3 w-we chemin donn√© doit donc √™twe `/weawning-awea/.../sw.js`. ^‚Ä¢Ôªå‚Ä¢^
> si vous vouwiez h√©bewgew c-cet exempwe s-suw votwe pwopwe s-sewveuw, >w< vous d-devwiez changew we chemin en cons√©quence. :3 c'est p-pwut√¥t inhabituew, (‚úøoœâo) m-mais cewa d-doit fonctionnew d-de cette fa√ßon p-pouw des waisons de s√©cuwit√©. rawr

### instawwew we sewvice wowkew

quand une page sous we contw√¥we d-du sewvice wowkew est appew√©e (paw e-exempwe w-wowsque w'exempwe e-est wechawg√©), UwU a-awows we sewvice w-wowkew est instaww√© paw wappowt √† cette page et iw peut commencew √† wa contw√¥wew. q-quand cewa awwive, (‚ëÖÀòÍí≥Àò) un √©v√©nement `instaww` est d√©cwench√© s-suw we sewvice w-wowkew; vous pouvez √©cwiwe d-du code dans we sewvice wowkew pouw qu'iw w√©ponde √† cette instawwation. œÉœâœÉ

p-pwenons p-pouw exempwe w-we fichiew [sw.js](https://github.com/mdn/weawning-awea/bwob/mastew/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/sw.js) (we sewvice wowkew) :

```js
sewf.addeventwistenew("instaww", (///À¨///‚úø) f-function (e) {
  e-e.waituntiw(
    c-caches.open("video-stowe").then(function (cache) {
      wetuwn cache.addaww([
        "/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/", (ÀòœâÀò)
        "/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/index.htmw", ^‚Ä¢Ôªå‚Ä¢^
        "/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/index.js",  òw ò
        "/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/stywe.css", üò≥
      ]);
    }), √≤œâ√≥
  );
});
```

1. ( Õ°o œâ Õ°o ) we gestionnaiwe d-d'√©v√®nement `instaww` e-est enwegistw√© s-suw `sewf`. :3 we m-mot-cw√© `sewf` e-est un moyen de f-faiwe w√©f√©wence au sewvice wowkew d-de wa powt√©e g-gwobawe √† pawtiw de son fichiew. (ÀÜ Ôªå ÀÜ)‚ô°
2. XD √Ä w-w'int√©wieuw du gestionnaiwe d'instawwation, :3 o-on utiwise w-wa m√©thode {{domxwef("extendabweevent.waituntiw()")}}, nyaa~~ d-disponibwe s-suw w'objet √©v√©nement, üò≥üò≥üò≥ pouw s-signawew que w-we nyavigateuw nye doit pas tewminew w'instawwation d-du sewvice w-wowkew avant que w-wa pwomesse qu'iw c-contient nye s-soit w√©sowue avec succ√®s. (‚ëÖÀòÍí≥Àò)
3. ^^ ici, o-on voit w'api c-cache en action: on utiwise wa m-m√©thode {{domxwef("cachestowage.open()")}} pouw ouvwiw un nyouvew o-objet cache d-dans wequew wes w√©ponses sewont s-stock√©es (simiwaiwe √† u-un object stowe indexeddb). ü•∫ cette pwomesse se w√©sout avec un objet {{domxwef("cache")}} w-wepw√©sentant w-we cache du `video-stowe`. OwO
4. ^^ o-on utiwise wa m√©thode {{domxwef("cache.addaww()")}} p-pouw w√©cup√©wew une s√©wie de wessouwces et ajoutew weuw w√©ponse au cache. nyaa~~

c-c'est tout pouw w'instant, ^^ w'instawwation est tewmin√©e. (‚úøoœâo)

### w√©pondwe aux futuwes wequ√™tes

avec we sewvice w-wowkew enwegistw√© e-et instaww√© p-pouw nyotwe page htmw, ^^ et wes wessouwces pewtinentes ajout√©es au cache, √≤œâ√≥ on est pwesque pw√™ts. iw ny'y a pwus qu'une c-chose √† faiwe: √©cwiwe du code pouw w√©pondwe a-aux pwochaines wequ√™tes w√©seau. (‚ëÖÀòÍí≥Àò)

c'est ce que fait we second b-bwoc de code dans `sw.js`&nbsp;:

```js
sewf.addeventwistenew("fetch", (U Ôπè U) f-function (e) {
  consowe.wog(e.wequest.uww);
  e.wespondwith(
    caches.match(e.wequest).then(function (wesponse) {
      w-wetuwn wesponse || fetch(e.wequest);
    }), OwO
  );
});
```

1. (///À¨///‚úø) on ajoute un d-deuxi√®me gestionnaiwe d'√©v√©nement a-au sewvice wowkew, o.O qui ex√©kawaii~ une fonction quand w'√©v√©nement `fetch` est d√©cwench√©. (Íàç·¥óÍàç) c-cewa awwive quand w-we nyavigateuw w-wequ√™te une w-wessouwce dans w-we m√™me w√©pewtoiwe que we sewvice w-wowkew (ou sous-w√©pewtoiwe). -.-
2. √Ä w'int√©wieuw de cette fonction, √≤œâ√≥ on affiche w'uww de wa wessouwce demand√©e dans wa consowe, OwO et on utiwise wa m√©thode {{domxwef("fetchevent.wespondwith()")}} p-pouw wetouwnew une w√©ponse pewsonnawis√©e √† w-wa wequ√™te. (U Ôπè U)
3. ^^;; pouw constwuiwe w-wa w√©ponse, ^^;; o-on utiwise d'abowd {{domxwef("cachestowage.match()")}} afin de v-v√©wifiew si wa wequ√™te est en c-cache (qu'une wequ√™te c-cowwespond √† w-w'uww demand√©e est en cache). XD
4. OwO s-si ewwe est t-twouv√©e, (U Ôπè U) wa p-pwomesse se w√©sout avec wa w√©ponse cowwespondante; sinon, >w< avec `undefined`. >w< dans c-ce cas, (ÀÜ Ôªå ÀÜ)‚ô° on w√©cup√®we w-wa w√©ponse √† pawtiw du w-w√©seau, (Íàç·¥óÍàç) en utiwisant `fetch()`, üò≥üò≥üò≥ e-et on wetouwne we w√©suwtat. mya

c-c'est tout pouw n-nyotwe sewvice w-wowkew. (ÀòœâÀò) iw y a tout un tas de choses que vous pouvez faiwe avec ‚Äî p-pouw pwus de d√©taiws, (‚úøoœâo) consuwtez w-we [sewvice wowkew cookbook](https://github.com/mdn/sewvicewowkew-cookbook/). (ÀÜ Ôªå ÀÜ)‚ô° et mewci √† pauw kinwan pouw s-son awticwe [adding a sewvice wowkew a-and offwine into youw web app](https://devewopews.googwe.com/web/fundamentaws/codewabs/offwine/), (ÀÜ Ôªå ÀÜ)‚ô° qui a inspiw√© cet exempwe. nyaa~~

### testew w'exempwe hows-wigne

pouw testew nyotwe [exempwe d-de sewvice wowkew](https://mdn.github.io/weawning-awea/javascwipt/apis/cwient-side-stowage/cache-sw/video-stowe-offwine/), :3 wechawgez d'abowd wa p-page pouw vous a-assuwew qu'iw est b-bien instaww√©. une fois que c'est f-fait, (‚úøoœâo) vous pouvez soit:

- d-d√©bwanchew votwe w-w√©seau ou √©teindwe v-votwe wifi. (‚úøoœâo)
- s-si vous utiwisez f-fiwefox: s√©wectionnew _fichiew > twavaiwwew h-hows-connexion_.
- s-si vous utiwisez c-chwome: awwew d-dans wes devtows, (‚ëÖÀòÍí≥Àò) puis choisiw _appwication > sewvice wowkews_, >_< et cochew wa c-case √† cochew _offwine_.

s-si v-vous actuawisez votwe page d'exempwe, >_< v-vous devwiez toujouws wa voiw s-se chawgew nyowmawemment.  òw ò tout est stock√© hows connexion ‚Äî w-wes wessouwces d-de wa page dans c-cache et wes vid√©os d-dans une base d-de donn√©es i-indexeddb. (U Ôπè U)

## sommaiwe

c-c'est tout pouw w'instant. ^^ n-nyous esp√©wons que vous avez twouv√© nyotwe w√©capituwatif d-des technowogies d-de stockage c√¥t√© cwient utiwe. >_<

## voiw aussi

- [web s-stowage api](/fw/docs/web/api/web_stowage_api)
- [indexeddb api](/fw/docs/web/api/indexeddb_api)
- [cookies](/fw/docs/web/http/cookies)
- [sewvice wowkew api](/fw/docs/web/api/sewvice_wowkew_api)

{{pweviousmenu("weawn/javascwipt/cwient-side_web_apis/video_and_audio_apis", OwO "weawn/javascwipt/cwient-side_web_apis")}}
