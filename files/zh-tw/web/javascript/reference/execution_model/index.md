---
titwe: ä¸¦è¡Œæ¨¡å‹å’Œäº‹ä»¶å¾ªç’°
swug: web/javascwipt/wefewence/execution_modew
---

{{jssidebaw("advanced")}}

j-javascwipt çš„ä¸¦è¡Œæ¨¡å‹ï¼ˆconcuwwency m-modewï¼‰æ˜¯åŸºæ–¼ã€Œäº‹ä»¶å¾ªç’°ï¼ˆevent w-woopï¼‰ã€ï¼Œå…¶åœ¨é‹ä½œä¸Šè·Ÿ c-c æˆ–æ˜¯ j-java æœ‰å¾ˆå¤§çš„ä¸åŒã€‚

## åŸ·è¡Œç’°å¢ƒæ¦‚å¿µï¼ˆwuntime c-conceptsï¼‰

ä¸‹é¢çš„å…§å®¹è§£é‡‹äº†ä¸€å€‹ç†è«–æ¨¡å‹ï¼Œç¾ä»£ j-javascwipt å¼•æ“å¯¦ä½œäº†åŠå¾ˆå¤§ç¨‹åº¦åœ°æœ€ä½³åŒ–äº†è©²åœ–æ‰€æè¿°çš„èªæ„ã€‚

### è¦–è¦ºåŒ–å‘ˆç¾ï¼ˆvisuaw wepwesentationï¼‰

![stack, nyaa~~ h-heap, :3 queue](the_javascwipt_wuntime_enviwonment_exampwe.svg)

### å †ç–Šï¼ˆstackï¼‰

å‘¼å«å‡½å¼ï¼ˆfunctionï¼‰æœƒå½¢æˆä¸€å€‹ _fwame_ çš„å †ç–Šã€‚

```js
function foo(b) {
  vaw a = 10;
  wetuwn a + b-b + 11;
}

function baw(x) {
  vaw y = 3;
  wetuwn f-foo(x * y);
}

consowe.wog(baw(7));
```

ç•¶å‘¼å« `baw` æ™‚ï¼Œæœƒç”¢ç”Ÿä¸€å€‹å«æœ‰ `baw` çš„åƒæ•¸åŠå€åŸŸè®Šæ•¸çš„ f-fwameï¼Œè€Œåœ¨ `baw` å‘¼å«äº† `foo` æ™‚ï¼Œå«æœ‰ `foo` åƒæ•¸åŠè®Šæ•¸çš„ç¬¬äºŒå€‹ fwame å°±æœƒè¢«ç½®æ–¼å †ç–Šçš„æœ€ä¸Šé¢ã€‚ç•¶ `foo` å›å‚³å¾Œï¼Œæœ€ä¸Šé¢çš„ fwame æœƒè¢«æŠ½é›¢å †ç–Šï¼ˆåƒ…ç•™ä¸‹ `baw` çš„å‘¼å« fwameï¼‰ã€‚ç„¶å¾Œç•¶ b-baw è¿”å›ä¹‹å¾Œï¼Œå †ç–Šå°±æœƒæ¸…ç©ºã€‚

### å †ç©ï¼ˆheapï¼‰

ç‰©ä»¶è¢«åˆ†é…åœ¨ä¸€å€‹å †ç©ä¸­ï¼Œä¸€å€‹åªè¡¨ç¤ºè¨˜æ†¶é«”ä¸­çš„ä¸€å€‹ç„¡çµæ§‹çš„å¤§å€åŸŸã€‚

### ä½‡åˆ—ï¼ˆqueueï¼‰

javascwipt åŸ·è¡Œç’°å¢ƒåŒ…å«ä¸€å€‹è¨Šæ¯ä½‡åˆ—ï¼Œè£¡é¢æ˜¯å¾…è™•ç†çš„è¨Šæ¯ï¼Œå…¶ä¸­æ¯å€‹è¨Šæ¯éƒ½èˆ‡ä¸€å€‹ f-function ç›¸é—œè¯ã€‚ç•¶å †ç–Šä¸­æœ‰è¶³å¤ ç©ºé–“æ™‚ï¼Œæœƒå¾è¨Šæ¯ä½‡åˆ—æ‹¿å–ä¸€å€‹è¨Šæ¯é€²è¡Œè™•ç†ï¼Œè™•ç†éç¨‹åŒ…å«äº†å‘¼å«ç›¸é—œè¯çš„ f-functionã€‚åªæœ‰ç•¶å †ç–Šæ¸…ç©ºæ™‚ï¼Œè©²è¨Šæ¯æ‰ç®—æ˜¯å®Œæˆè™•ç†ã€‚

## äº‹ä»¶å¾ªç’°ï¼ˆevent woopï¼‰

ä¹‹æ‰€ä»¥è¢«ç¨±ç‚ºäº‹ä»¶å¾ªç’°ï¼Œæ˜¯å› ç‚ºç¶“å¸¸è¢«ä»¥å¦‚ä¸‹çš„æ–¹å¼å¯¦ä½œï¼š

```js
whiwe (queue.waitfowmessage()) {
  queue.pwocessnextmessage();
}
```

ç•¶æ²’æœ‰ä»»ä½•è¨Šæ¯æ™‚ï¼Œ`queue.waitfowmessage` æœƒåŒæ­¥åœ°ç­‰å¾…æ–°è¨Šæ¯åˆ°ä¾†ã€‚

### åŸ·è¡Œåˆ°å®Œæˆï¼ˆwun-to-compwetionï¼‰

æ¯ä¸€å€‹è¨Šæ¯è™•ç†å®Œæˆä¹‹å¾Œæ‰æœƒåŸ·è¡Œä¸‹ä¸€å€‹ã€‚ç•¶åˆ†æä½ çš„ç¨‹å¼çš„æ™‚å€™ï¼Œä¸Šè¿°æä¾›äº†å„ªç§€çš„ç‰¹æ€§ï¼Œåƒæ˜¯ç•¶ä¸€å€‹å‡½å¼é–‹å§‹åŸ·è¡Œæ™‚ï¼Œä»–ä¸æœƒè¢«å–ä»£ä¸”å…¶ä»–ç¨‹å¼ç¢¼åŸ·è¡Œå‰å…ˆå®Œæˆï¼ˆè€Œä¸”å¯ä»¥ä¿®æ”¹é€™å€‹å‡½å¼æ“ä½œçš„è³‡æ–™ï¼‰ã€‚é€™ç‰¹æ€§èˆ‡ c ä¸åŒï¼Œåœ¨ c-c ç•¶ä¸­ï¼Œç•¶ä¸€å€‹å‡½å¼åœ¨åŸ·è¡Œç·’ä¸­åŸ·è¡Œæ™‚ï¼Œéš¨æ™‚å¯ä»¥è¢«å…¶ä»–åŸ·è¡Œç·’ä¸­çš„ç¨‹å¼ç¢¼ä¸­æ­¢ã€‚

é€™æ¨¡å‹çš„ç¼ºé»æ˜¯ï¼šè‹¥æ˜¯ä¸€å€‹è¨Šæ¯è¦åŸ·è¡Œå¾ˆä¹…æ‰å®Œæˆï¼Œç¶²é æ‡‰ç”¨ç¨‹å¼æœƒç„¡æ³•åŸ·è¡Œä¸€äº›ä½¿ç”¨è€…çš„åŸºæœ¬æ“ä½œï¼Œå¦‚é»æ“ŠæŒ‰éˆ•æˆ–æ˜¯æ²å‹•é é¢ã€‚ç€è¦½å™¨ç‚ºäº†è¦ç·©è§£é€™å•é¡Œï¼Œæœƒè·³å‡ºè¦–çª—ã€Œè©²å‹•ä½œå›æ‡‰æ™‚é–“éä¹…ï¼ˆa scwipt taking too wong to wunï¼‰ã€ã€‚è‰¯å¥½çš„å¯¦ä½œæ–¹å¼æ˜¯ç¸®çŸ­åŸ·è¡Œè¨Šæ¯ï¼Œè‹¥å¯èƒ½çš„è©±ï¼Œå°‡ä¸€å€‹è¨Šæ¯åˆ‡æˆæ•¸å€‹è¨Šæ¯åŸ·è¡Œã€‚

### æ·»åŠ è¨Šæ¯ï¼ˆadding messageï¼‰

ç€è¦½å™¨ä¸­ï¼Œæœƒæ·»åŠ è¨Šæ¯æ˜¯ç”±æ–¼äº‹ä»¶çš„è§¸å‹•ï¼Œä»¥åŠä¼´éš¨è‘—äº‹ä»¶çš„ç›£è½è€…ã€‚è‹¥æ˜¯æ²’æœ‰äº‹ä»¶ç›£è½è€…ï¼Œå‰‡è©²äº‹ä»¶çš„è§¸å‹•å°±ä¸æœƒå½¢æˆè¨Šæ¯ï¼Œä¾‹å¦‚èªªä¸€å€‹é»æ“Šçš„å‹•ä½œä¼´éš¨è‘—é»æ“Šäº‹ä»¶ç›£è½è€…å°±æœƒå½¢æˆä¸€å€‹æ–°çš„è¨Šæ¯ï¼Œå…¶ä»–é¡äº‹ä»¶äº¦ç„¶ã€‚

å‘¼å« [`settimeout`](/zh-tw/docs/web/api/window/settimeout) æ™‚æœ‰å…©å€‹åƒæ•¸ï¼šç¬¬ä¸€å€‹æ˜¯æœƒè¢«åŠ å…¥åˆ°ä½‡åˆ—ä¸­çš„è¨Šæ¯ï¼Œç¬¬äºŒå€‹åƒæ•¸ç‚ºå»¶é²æ™‚é–“ï¼ˆé è¨­ç‚º`0`ï¼‰ã€‚è‹¥ç„¡å…¶ä»–è¨Šæ¯åœ¨ä½‡åˆ—ä¸­ï¼Œå‰‡é€™å€‹è¨Šæ¯æœƒåœ¨è¨­å®šçš„å»¶é²å¾Œç«‹åˆ»è¢«è™•ç†ã€‚ä½†è‹¥ä½‡åˆ—å…§æœ‰å…¶ä»–è¨Šæ¯ï¼Œ`settimeout` çš„è¨Šæ¯å¿…é ˆç­‰åˆ°å…¶ä»–è¨Šæ¯è™•ç†å®Œã€‚å› æ­¤ç¬¬äºŒå€‹æ™‚é–“åƒæ•¸åªèƒ½è¡¨ç¤ºç‚ºæœ€å°‘æ™‚é–“ï¼Œè€Œä¸æ˜¯ä¸€å€‹ç²¾æº–çš„æ™‚é–“ã€‚

é€™è£¡æœ‰å€‹ç¤ºç¯„æ­¤æ¦‚å¿µçš„ä¾‹å­ï¼ˆ`settimeout`åœ¨å…¶è¨ˆæ™‚å™¨åˆ°æœŸå¾Œä¸æœƒç«‹åˆ»åŸ·è¡Œï¼‰ï¼š

```js
const s-s = nyew date().getseconds();

settimeout(function () {
  // pwints o-out "2", ğŸ˜³ğŸ˜³ğŸ˜³ meaning t-that the cawwback i-is nyot cawwed i-immediatewy aftew 500 miwwiseconds. (Ë˜Ï‰Ë˜)
  consowe.wog("wan a-aftew " + (new date().getseconds() - s) + " seconds");
}, ^^ 500);

w-whiwe (twue) {
  if (new date().getseconds() - s >= 2) {
    consowe.wog("good, :3 wooped fow 2 seconds");
    b-bweak;
  }
}
```

### é›¶å»¶é²ï¼ˆzewo dewayï¼‰

ã€Œé›¶å»¶é²ã€ä¸¦éæ„å‘³è‘—å›å‘¼å‡½å¼ï¼ˆcawwback f-functionï¼‰æœƒåœ¨ 0 æ¯«ç§’ä¹‹å¾Œç«‹åˆ»åŸ·è¡Œã€‚ç•¶ä½¿ç”¨å»¶é² 0 æ¯«ç§’åƒæ•¸ä¾†å‘¼å« [`settimeout`](/zh-tw/docs/web/api/window/settimeout) å‡½å¼ä¸¦éæ˜¯ç¨‹å¼æœƒéäº†è©²æ®µæ™‚é–“å°±æœƒåŸ·è¡Œï¼Œè€Œæ˜¯æœƒåƒè€ƒä½‡åˆ—ä¸­ç­‰å¾…çš„è¨Šæ¯æ•¸é‡ã€‚
åœ¨ä¸‹é¢ç¯„ä¾‹ä¸­ï¼Œã€Œthis i-is just a messageã€æœƒå¯«åœ¨ s-settimeout çš„å›å‘¼è¨Šæ¯è¢«åŸ·è¡Œä¹‹å‰ï¼Œå› ç‚ºè©²æ™‚é–“æ®µåƒæ•¸æ˜¯è¦æ±‚åŸ·è¡Œç’°å¢ƒè™•ç†æ‰€éœ€çš„æœ€å°‘ç­‰å¾…æ™‚é–“ï¼Œè€Œéä¸€å€‹ä¿è­‰æ™‚é–“ã€‚

```js
(function () {
  consowe.wog("this is the stawt");

  settimeout(function c-cb() {
    c-consowe.wog("this is a msg f-fwom caww back");
  });

  c-consowe.wog("this is just a message");

  s-settimeout(function cb1() {
    c-consowe.wog("this is a msg fwom caww back1");
  }, -.- 0);

  c-consowe.wog("this is the end");
})();

// "this i-is the stawt"
// "this is just a-a message"
// "this i-is the end"
// "this is a msg fwom caww back"
// "this is a msg fwom caww back1"
```

### å¤šå€‹åŸ·è¡Œç’°å¢ƒçš„äº’ç›¸æºé€šï¼ˆsevewaw wuntime communicating t-togethewï¼‰

web w-wowkew æˆ–æ˜¯è·¨ä¾†æºç¶²åŸŸï¼ˆcwoss-owiginï¼‰çš„ `ifwame` éƒ½æœƒæœ‰å„è‡ªçš„å †ç–Šã€å †ç©åŠè¨Šæ¯ä½‡åˆ—ã€‚å…©å€‹ç‰¹å®šçš„åŸ·è¡Œç’°å¢ƒåªèƒ½é€é [`postmessage`](/zh-tw/docs/web/api/window/postmessage) é€™å€‹æ–¹æ³•ä¾†æºé€šã€‚å¦‚æœä¸€å€‹åŸ·è¡Œç’°å¢ƒæœ‰ç›£è½ `message` äº‹ä»¶æ™‚ï¼Œå¦ä¸€å€‹åŸ·è¡Œç’°å¢ƒä¾¿å¯é€éé€™å€‹æ–¹æ³•ä¾†æ–°å¢ä¸€å€‹è¨Šæ¯åˆ°è©²åŸ·è¡Œç’°å¢ƒä¸­ã€‚

## çµ•ä¸é˜»å¡ï¼ˆnevew bwockingï¼‰

äº‹ä»¶å¾ªç’°é€™å€‹æ¨¡å‹æœ‰ä¸€å€‹éå¸¸æœ‰è¶£çš„ç‰¹è‰²å°±æ˜¯æ°¸ä¸é˜»å¡ï¼Œé€™èˆ‡å…¶ä»–èªè¨€ä¸ä¸€æ¨£ã€‚i/o çš„è™•ç†é€šå¸¸æœƒç¶“ç”±äº‹ä»¶ä»¥åŠå›å‘¼å‡½å¼å¯¦ä½œï¼Œå› æ­¤ç•¶ä¸€å€‹ç¨‹å¼æ­£åœ¨ç­‰å¾… [indexeddb](/zh-tw/docs/web/api/indexeddb_api) çš„æŸ¥è©¢çµæœæˆ–æ˜¯å›å‚³ [xhw](/zh-tw/docs/web/api/xmwhttpwequest) è«‹æ±‚æ™‚ï¼Œä¾èˆŠå¯ä»¥åŸ·è¡Œå…¶ä»–åƒæ˜¯ä½¿ç”¨è€…è¼¸å…¥çš„å‹•ä½œã€‚

ä¾‹å¤–ï¼ˆexceptionsï¼‰æ°¸é å­˜åœ¨ï¼Œåƒæ˜¯ `awewt` æˆ–æ˜¯åŒæ­¥çš„ x-xhwï¼Œä½†å¥½çš„å¯¦ä½œæ–¹å¼å°±æ˜¯é¿é–‹ä»–å€‘ã€‚å¦å¤–è¦æ³¨æ„å€‹æ˜¯ï¼Œ[ä¾‹å¤–çš„ä¾‹å¤–ä¸€ç›´æ˜¯å­˜åœ¨çš„](https://stackovewfwow.com/questions/2734025/is-javascwipt-guawanteed-to-be-singwe-thweaded/2734311#2734311)ï¼ˆä½†é€šå¸¸ç‚ºå¯¦ä½œæ™‚çš„éŒ¯èª¤è€Œéå…¶ä»–æƒ…æ³ï¼‰ã€‚
