---
title: ブラウザーのストレージ割り当てと削除基準
slug: Web/API/Storage_API/Storage_quotas_and_eviction_criteria
l10n:
  sourceCommit: 886f2641ae90a70858c5e7d0d20959c70ee44d9d
---

{{DefaultAPISidebar("Storage")}}

ウェブ開発者が、ユーザーのブラウザー（つまり、ユーザーがウェブサイトを閲覧するために使用している端末のローカルディスク）にデータを格納するために利用できる技術はたくさんあります。

ブラウザーがウェブサイトに格納することを許可するデータ量と、その制限に達したときにデータを削除するために使用する仕組みは、ブラウザーによって異なります。

この記事では、データを格納するために使用できるウェブ技術、ウェブサイトがデータを格納しすぎないように制限するためにブラウザーが所有しているクォータ、および必要なときにデータを削除するために使用する仕組みについて記述されています。

## ブラウザーでは、異なるウェブサイトのデータをどのように区切るのか

ブラウザーは、ユーザーがウェブ上で追跡されるリスクを縮小するために、ウェブサイトからのデータをさまざまな場所に格納します（バケットとも呼ばれます）。ほとんどの場合、ブラウザーは格納されるデータをオリジンごとに管理します。

このため、{{Glossary("origin", "オリジン")}}という用語は、この記事を理解する上で重要です。オリジンはスキーム（HTTPS　など）、ホスト名、ポート番号で定義します。例えば、`https://example.com` と `https://example.com/app/index.html` はスキーム (`https`)、ホスト名 (`example.com`) が同じであり、既定のポートであるため、同じオリジンに属します。

この記事で記述されているクォータと退去基準は、このオリジンが `https://example.com/site1/` や `https://example.com/site2/` のように複数のウェブサイトを実行するために使用されている場合でも、オリジン全体に適用されます。

しかし、例えばオリジンが複数の異なるサードパーティ製オリジンの {{HTMLElement('iframe')}} 要素内に読み込まれる場合など、ブラウザーではオリジンによって格納されるデータをさらに別個のパーティションに分けることができます。しかし、分かりやすいように、この記事では常にオリジンごとにデータが格納されることを想定しています。

## ブラウザーにデータを格納する技術は何か

ウェブ開発者は、ブラウザーにデータを格納するために以下のウェブ技術を使用することができます。

| 技術                                                                                                       | 説明                                                                                                                                                                                                                             |
| ---------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [Cookie](/ja/docs/Web/HTTP/Guides/Cookies)                                                                 | HTTP クッキーは、ウェブサーバーとブラウザーが互いに送信する小さなデータで、ページナビゲーションをまたいで状態情報を記憶します。                                                                                                  |
| [ウェブストレージ](/ja/docs/Web/API/Web_Storage_API)                                                       | ウェブストレージ API は、ウェブページが文字列のみのキーと値のペアを格納するために、[`localStorage`](/ja/docs/Web/API/Window/localStorage) と [`sessionStorage`](/ja/docs/Web/API/Window/sessionStorage) を含む機構を提供します。 |
| [IndexedDB](/ja/docs/Web/API/IndexedDB_API)                                                                | IndexedDB は、大規模なデータ構造をブラウザーに格納し、インデックスを作成して高性能な検索を行うためのウェブ API です。                                                                                                            |
| [キャッシュ API](/ja/docs/Web/API/Cache)                                                                   | キャッシュ API は、HTTP リクエストとレスポンスのオブジェクトペアの持続的な維持メカニズムを提供し、ウェブページの読み込みを高速化するために使用されます。                                                                         |
| [オリジンプライベートファイルシステム (OPFS)](/ja/docs/Web/API/File_System_API/Origin_private_file_system) | OPFS は、ページの元に対してプライベートなファイルシステムを提供し、ディレクトリーやファイルを読み書きするために使用することができます。                                                                                          |

上記に加え、ブラウザーは [WebAssembly](/ja/docs/WebAssembly) コードキャッシュなど、オリジンのために他にも型データをブラウザーに格納することに注意してください。

## ブラウザーに格納されるデータは維持されるか

オリジンのデータはブラウザーに、永続的とベストエフォートという 2 つの方法で格納されます。

- ベストエフォート: これは既定でデータが格納される方法です。ベストエフォートのデータは、オリジンがクォータ以下にあり、機器に十分なストレージ空間が保有され、ユーザーがブラウザー設定からデータの削除を選ばない限り維持されます。
- 永続的: オリジンは、永続的な方法でデータを格納するためにオプトインすることができます。このように格納されたデータは、ユーザーがブラウザー設定を用いて格納することを選んだ場合のみ、削除されます。詳しくは、[When is data evicted](#when_is_data_evicted)を参照してください。

オリジンによってブラウザーに格納されるデータは、既定ではベストエフォートです。 IndexedDB やキャッシュなどのウェブ技術を使用する場合、データはユーザーの権限を要求することなく透過的に格納されます。同様に、ブラウザーがベストエフォート型データを削除する必要がある場合、ユーザーにの断りなく削除されます。

何らかの理由で開発者が永続的なストレージを必要とする場合（例えば、他のどこにも維持されていない重要なデータに頼っているウェブアプリケーションを構築する場合）、{{domxref("Storage_API", "ストレージ API", "", "nocode")}} の {{domxref("StorageManager.persist()", "navigator.storage.persist()")}} メソッドを使用することでそれを行うことができます。

Firefox では、サイトが永続的ストレージを使用することを選ぶと、ユーザーに UI ポップアップでその権限がリクエストされたことが通知されます。

Safari と、ほとんどの Chromium ベースのブラウザー（Chrome や Edge など）は、ユーザーのサイトとの対話履歴に基づいて自動的にリクエストを承認または拒否し、ユーザーにプロンプトを表示させません。

なお、 [Chrome チームの調査](https://web.dev/articles/persistent-storage/)によると、データがブラウザーによって削除されることはとても稀であることを示しています。ユーザーがウェブサイトを定期的に訪問している場合、ベストエフォートモードであっても、格納されるデータがブラウザーによって取得される可能性はとても低いのです。

### プライベートブラウジング

プライベートブラウジングモード（Chrome では _Incognito_、 Edge では _InPrivate_ とも呼ばれる）では、ブラウザーによって異なるクォータが適用されることがあり、格納されるデータは通常、プライベートブラウジングモードが終わると削除されることに注意してください。

## どれだけのデータが格納できるか

### Cookie

ブラウザーごとに、オリジンごとに許可されるクッキーの数と、これらのクッキーがディスク上で使用できる空間について、異なる規則があります。クッキーはブラウザーとウェブサーバーの間でページナビゲーションにわたって小さな共有状態を保持するのに有益なものですが、ブラウザーのデータ格納のためにクッキーを使用することはお勧めできません。クッキーは HTTP リクエストごとに送信されるため、別のウェブ技術を使用することで格納できるデータをクッキーに格納すると、リクエストのサイズが不必要に大きくなります。

クッキーはブラウザーにデータを格納するために使用すべきではありませんから、クッキーの格納ブラウザーの制限はここでは取り上げません。

### ウェブストレージ

ウェブストレージは、 {{domxref("Window")}} オブジェクトの {{domxref("Window.localStorage", "localStorage")}} および {{domxref("Window.sessionStorage", "sessionStorage")}} プロパティを使用してアクセスすることができ、すべてのブラウザーでデータ量が最大 10MiB に制限されています。

ブラウザーはローカルストレージを 5MiB まで、オリジンごとにセッションストレージを 5MiB まで格納することができます。

この制限に達すると、ブラウザーは `QuotaExceededError` 例外を発生します。これは {{jsxref("Statements/try...catch","try...catch")}} ブロックを使用して処理しましょう。

### その他のウェブ技術

IndexedDB、キャッシュ API、ファイルシステム API（オリジンプライベートファイルシステムを定義する）などの他にもウェブ技術を使用して格納されるデータは、各ブラウザー固有のストレージ管理システムによって管理されます。

このシステムはこれらの API を使用してオリジンが格納するすべてのデータを管理します。

それぞれのブラウザーは、指定されたオリジンが使用することができるストレージの最大量を、あらゆるメカニズムを使って決定します。

#### Firefox

Firefox では、ベストエフォートモードでオリジンが使用できる最大ストレージ空間は、以下のいずれか小さい方です。

- ユーザーのプロファイルが格納されるディスク総容量の 10%。
- または、 10GiB は Firefox が同じ {{Glossary("eTLD", "eTLD+1 ドメイン")}}に属するすべてのオリジンに適用するグループ制限です。

永続的ストレージが許可されているオリジンは、総ディスクサイズの 50% （上限 8 TiB）まで格納することができ、eTLD+1 グループの制限を受けません。

例えば、端末に 500 GiB のハードドライブがある場合、 Firefox はオリジンに以下の量まで格納することを許可します。

- ベストエフォートモードの場合: eTLD+1 グループの制限である 10GiB のデータ。
- 永続モードの場合: 250 ギガバイト（ディスク総サイズの 50%）。

クォータは現在利用できるディスク空間ではなく、ハードドライブの**総**サイズに基づいて計算されるため、オリジンがそのクォータに到達することは実際には不可能かもしれないことに注意してください。これはセキュリティ上の理由から{{Glossary("fingerprinting", "フィンガープリンティング")}}を避けるために行われます。

#### Chrome および Chromium ベースのブラウザー

Chrome や Edge を含む [Chromium オープンソースプロジェクト](https://www.chromium.org/Home/)に基づくブラウザーでは、オリジンは永続モードとベストエフォートモードの両方で、総ディスクサイズの 60% まで格納することができます。

例えば、機器に 1TiB のハードドライブがある場合、ブラウザーは一つのオリジンが 600GiB まで使用することを許可します。

Firefox と同様に、このクォータはフィンガープリントを避けるためにハードドライブの合計サイズに基づいて計算されるため、オリジンは実際にはクォータに到達しない可能性があります。

#### Safari

WebKit は、ブラウザーアプリと、ウェブコンテンツを埋め込めるその他のアプリケーション（例： WKWebView を使用するアプリ）に対して異なる割り当てを行います。ブラウザーアプリとは、システムの既定のブラウザーとして設定可能なアプリケーションを指します。これには Safari やその他の WebKit ベースのサードパーティ製ブラウザーが含まれます。

macOS 14 および iOS 17 以降の場合、

- WebKit ベースのブラウザーアプリでは、それぞれのオリジンがディスク全体の約 60% まで格納することができます。
- ウェブコンテンツを埋め込む他の WebKit ベースのアプリでは、それぞれのオリジンがディスク全体の約 15% まで格納できます。ユーザーがサイトをホーム画面またはドックにウェブアプリとして保存した場合、ブラウザーアプリと同じオリジンクォータ（ディスク容量の約 60%）を使用することができます。

例えば、1 TiB のドライブを付けている macOS 端末では、 Safari ウェブブラウザー内のそれぞれのオリジンに対して約 600GiB の制限が適用されます。他のアプリの埋め込み WebView で実行するオリジンには、約 150GiB というより低い制限が割り当てられます。

プライバシーの理由から、{{Glossary("Same-origin policy", "別オリジンの")}}フレームは独立した割り当てが行われ、、親の約 1/10 の容量が割り当てられます。

他のブラウザー同様に、フィンガープリンティングを避けるために、クォータによって適用される正確な制限は異なることがあります。

WebKitは同時に、全体的なクォータを強制します。これにより、すべてのオリジンにわたる保存データは、ブラウザーアプリではディスク容量の 80% を超えて伸びず、ウェブコンテンツを表示させる非ブラウザーアプリではディスク容量の 20% を超えて伸びません。

WebKit のストレージポリシーの情報は、[WebKit ブログ](https://webkit.org/blog/14403/updates-to-storage-policy/)で見ることができます。

以前のバージョンの Safari では、オリジンには初期で 1 GiB の割り当てが設定されていました。オリジンがこの制限に達すると、 Safari はより多くのデータを保存する許可をユーザーに求めます。これは、オリジンがベストエフォートモードでデータを格納している場合でも、永続モードで格納している場合でも現れます。

> [!NOTE]
> iOS/iPadOS では、従来はサードパーティーブラウザーも WebKit を使用する必要があったため、これらの WebKit の制限は Safari と同様にそれらにも適用されます。EU 地域（iOS 17.4 以降）では、Apple が代替ブラウザーエンジンの使用を許可しています。そのような場合、WebKit のポリシーではなく、それらのブラウザー自分自身でエンジンのポリシーが適用されます。
>
> macOS では、WebKit 以外のブラウザー（例： Chromium/Firefox）は独自のストレージポリシーを使用します。
>
> EU 特有の詳しい情報は、[Apple Developer Support Page](https://developer.apple.com/support/alternative-browser-engines) において探すことができます。

## 利用可能な空間をチェックする方法

ウェブ開発者は、このオリジンで利用可能な空間がどれくらいか、オリジンがどれだけ使用しているかを{{domxref("Storage_API", "ストレージ API", "", "nocode")}} の{{domxref("StorageManager.estimate()", "navigator.storage.estimate()")}}メソッドで調べることができます。

このメソッドは使用量の推定値のみを返し、実際の値を返さないことに注意してください。オリジンによって格納されるリソースの一部は、他にもオリジンから来る可能性があり、ブラウザーは総使用値を報告する際に、自発的にオリジン間データのサイズをパディングします。

## オリジンがクォータを使い切った場合はどうなるか

例えば、IndexedDB、キャッシュ、OPFS を使用して、オリジンのクォータを超えて格納しようとすると、`QuotaExceededError` 例外が発生して失敗します。

ウェブ開発者はブラウザーストレージに書き込む JavaScript を {{jsxref("Statements/try...catch","try...catch")}} ブロックで囲むべきです。新しいデータを格納するために、データを削除して空間を解放することも推奨されます。

## データが退去されるのはいつか

データ退去とは、ブラウザーがオリジンの格納されるデータを削除するプロセスです。

データ消去は複数のケースで発生します。

- 端末の記憶領域が残り少なくなっているとき。
- ブラウザーに（すべてのオリジンにわたって）格納されるすべてのデータが、ブラウザーが端末上で使用するために必要な空間の大きさを超えた場合。
- 定期的に使用していないオリジンについては、 Safari でのみ発生します。

### ストレージ圧縮による退去

ストレージ圧縮とも呼ばれるように、端末のストレージ空間が不足している場合、ブラウザーが利用できる領域がオリジンの格納されるデータをすべて保存するのに必要な領域よりも少なくなる点があります。

ブラウザーは、このシナリオに対処するために LRU (Least Recently Used) ポリシーを使用します。最も最近使用したオリジンのデータは削除されます。ストレージの圧縮が続く場合、ブラウザーは 2 つ目に最も最近使用したオリジンに移動し、問題が解決するまでこれを繰り返します。

この退去メカニズムは、永続的でないオリジンにのみ適用され、 {{domxref("StorageManager.persist()", "navigator.storage.persist()")}} を使用してデータの永続性を付与されたオリジンはスキップされます。

### ブラウザーストレージの最大値を超えたことによる退去

ブラウザーによっては、端末のハードディスクで使用できる最大ストレージ空間を定義しています。例えば、Chromeは現在、全ディスクサイズの最大80%を使用しています。

この最大ストレージサイズは、すべてのオリジンの組み合わせによって格納されるデータが、どのオリジンも個々の割り当てを超えることなく、最大サイズを超える点があることを意味しています。

この場合、ブラウザーは[ストレージ圧縮による退去](#ストレージ圧縮による退去)で記述されているように、ベストエフォート型オリジンの削除を開始します。

### 積極的な退去

Safari は、クロスサイトトラッキング防止がオンになっている場合、積極的にデータを消去します。ブラウザーが使用されてから 7 日以内にクリックやタップなどのユーザー対話がなかったオリジンは、スクリプトから作成されたデータが削除されます。サーバーによって設定されたクッキーは、この削除の対象から除外されます。

## データはどのように消去されるのか

オリジンのデータがブラウザーによって削除される場合、データの一部ではなく、すべてのデータが同時に削除されます。例えばオリジンが IndexedDB とキャッシュ API を使用してデータを格納していた場合、両方の種類のデータが削除されます。

元のデータの一部だけを削除すると、不整合の問題が発生する可能性があるからです。

## 関連情報

- [ウェブのストレージ (web.dev)](https://web.dev/articles/storage-for-the-web)
- [永続的ストレージ (web.dev)](https://web.dev/articles/persistent-storage)
- [Chrome Web Storage and Quota Concepts](https://docs.google.com/document/d/19QemRTdIxYaJ4gkHYf2WWBNPbpuZQDNMpUVf8dQxj4U/edit)
